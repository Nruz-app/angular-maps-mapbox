var mL=Object.create;var Hx=Object.defineProperty,gL=Object.defineProperties,_L=Object.getOwnPropertyDescriptor,yL=Object.getOwnPropertyDescriptors,vL=Object.getOwnPropertyNames,L_=Object.getOwnPropertySymbols,xL=Object.getPrototypeOf,Gx=Object.prototype.hasOwnProperty,ZS=Object.prototype.propertyIsEnumerable;var WS=(s,l,h)=>l in s?Hx(s,l,{enumerable:!0,configurable:!0,writable:!0,value:h}):s[l]=h,$t=(s,l)=>{for(var h in l||={})Gx.call(l,h)&&WS(s,h,l[h]);if(L_)for(var h of L_(l))ZS.call(l,h)&&WS(s,h,l[h]);return s},lr=(s,l)=>gL(s,yL(l));var qx=(s,l)=>{var h={};for(var g in s)Gx.call(s,g)&&l.indexOf(g)<0&&(h[g]=s[g]);if(s!=null&&L_)for(var g of L_(s))l.indexOf(g)<0&&ZS.call(s,g)&&(h[g]=s[g]);return h};var bL=(s,l)=>()=>(l||s((l={exports:{}}).exports,l),l.exports);var wL=(s,l,h,g)=>{if(l&&typeof l=="object"||typeof l=="function")for(let I of vL(l))!Gx.call(s,I)&&I!==h&&Hx(s,I,{get:()=>l[I],enumerable:!(g=_L(l,I))||g.enumerable});return s};var Wx=(s,l,h)=>(h=s!=null?mL(xL(s)):{},wL(l||!s||!s.__esModule?Hx(h,"default",{value:s,enumerable:!0}):h,s));var Xl=(s,l,h)=>new Promise((g,I)=>{var n=$=>{try{H(h.next($))}catch(ae){I(ae)}},F=$=>{try{H(h.throw($))}catch(ae){I(ae)}},H=$=>$.done?g($.value):Promise.resolve($.value).then(n,F);H((h=h.apply(s,l)).next())});var Nv=bL((gE,_E)=>{"use strict";(function(s,l){typeof gE=="object"&&typeof _E<"u"?_E.exports=l():typeof define=="function"&&define.amd?define(l):(s=typeof globalThis<"u"?globalThis:s||self,s.mapboxgl=l())})(gE,function(){"use strict";var s,l,h;function g(n,F){if(!s)s=F;else if(!l)l=F;else{var H="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",$={};s($),h=F($),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(h.workerUrl=window.URL.createObjectURL(new Blob([H],{type:"text/javascript"})))}}g(["exports"],function(n){function F(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var H,$={},ae={};function Te(){if(H)return ae;H=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.setMatrixArrayType=function(f){ae.ARRAY_TYPE=e=f},ae.toRadian=function(f){return f*a},ae.equals=function(f,c){return Math.abs(f-c)<=o*Math.max(1,Math.abs(f),Math.abs(c))},ae.RANDOM=ae.ARRAY_TYPE=ae.EPSILON=void 0;var o=1e-6;ae.EPSILON=o;var e=typeof Float32Array<"u"?Float32Array:Array;ae.ARRAY_TYPE=e;var r=Math.random;ae.RANDOM=r;var a=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var f=0,c=arguments.length;c--;)f+=arguments[c]*arguments[c];return Math.sqrt(f)}),ae}var Fe,Ze={};function ze(){if(Fe)return Ze;function o(c){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},o(c)}Fe=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.create=function(){var c=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},Ze.clone=function(c){var p=new e.ARRAY_TYPE(4);return p[0]=c[0],p[1]=c[1],p[2]=c[2],p[3]=c[3],p},Ze.copy=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[3],c},Ze.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c},Ze.fromValues=function(c,p,v,w){var M=new e.ARRAY_TYPE(4);return M[0]=c,M[1]=p,M[2]=v,M[3]=w,M},Ze.set=function(c,p,v,w,M){return c[0]=p,c[1]=v,c[2]=w,c[3]=M,c},Ze.transpose=function(c,p){if(c===p){var v=p[1];c[1]=p[2],c[2]=v}else c[0]=p[0],c[1]=p[2],c[2]=p[1],c[3]=p[3];return c},Ze.invert=function(c,p){var v=p[0],w=p[1],M=p[2],_=p[3],E=v*_-M*w;return E?(c[0]=_*(E=1/E),c[1]=-w*E,c[2]=-M*E,c[3]=v*E,c):null},Ze.adjoint=function(c,p){var v=p[0];return c[0]=p[3],c[1]=-p[1],c[2]=-p[2],c[3]=v,c},Ze.determinant=function(c){return c[0]*c[3]-c[2]*c[1]},Ze.multiply=a,Ze.rotate=function(c,p,v){var w=p[0],M=p[1],_=p[2],E=p[3],D=Math.sin(v),b=Math.cos(v);return c[0]=w*b+_*D,c[1]=M*b+E*D,c[2]=w*-D+_*b,c[3]=M*-D+E*b,c},Ze.scale=function(c,p,v){var w=p[1],M=p[2],_=p[3],E=v[0],D=v[1];return c[0]=p[0]*E,c[1]=w*E,c[2]=M*D,c[3]=_*D,c},Ze.fromRotation=function(c,p){var v=Math.sin(p),w=Math.cos(p);return c[0]=w,c[1]=v,c[2]=-v,c[3]=w,c},Ze.fromScaling=function(c,p){return c[0]=p[0],c[1]=0,c[2]=0,c[3]=p[1],c},Ze.str=function(c){return"mat2("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+")"},Ze.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},Ze.LDU=function(c,p,v,w){return c[2]=w[2]/w[0],v[0]=w[0],v[1]=w[1],v[3]=w[3]-c[2]*v[1],[c,p,v]},Ze.add=function(c,p,v){return c[0]=p[0]+v[0],c[1]=p[1]+v[1],c[2]=p[2]+v[2],c[3]=p[3]+v[3],c},Ze.subtract=f,Ze.exactEquals=function(c,p){return c[0]===p[0]&&c[1]===p[1]&&c[2]===p[2]&&c[3]===p[3]},Ze.equals=function(c,p){var v=c[0],w=c[1],M=c[2],_=c[3],E=p[0],D=p[1],b=p[2],T=p[3];return Math.abs(v-E)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(w-D)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(D))&&Math.abs(M-b)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(b))&&Math.abs(_-T)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(T))},Ze.multiplyScalar=function(c,p,v){return c[0]=p[0]*v,c[1]=p[1]*v,c[2]=p[2]*v,c[3]=p[3]*v,c},Ze.multiplyScalarAndAdd=function(c,p,v,w){return c[0]=p[0]+v[0]*w,c[1]=p[1]+v[1]*w,c[2]=p[2]+v[2]*w,c[3]=p[3]+v[3]*w,c},Ze.sub=Ze.mul=void 0;var e=function(c,p){if(c&&c.__esModule)return c;if(c===null||o(c)!=="object"&&typeof c!="function")return{default:c};var v=r(void 0);if(v&&v.has(c))return v.get(c);var w={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var E=M?Object.getOwnPropertyDescriptor(c,_):null;E&&(E.get||E.set)?Object.defineProperty(w,_,E):w[_]=c[_]}return w.default=c,v&&v.set(c,w),w}(Te());function r(c){if(typeof WeakMap!="function")return null;var p=new WeakMap,v=new WeakMap;return(r=function(w){return w?v:p})(c)}function a(c,p,v){var w=p[0],M=p[1],_=p[2],E=p[3],D=v[0],b=v[1],T=v[2],C=v[3];return c[0]=w*D+_*b,c[1]=M*D+E*b,c[2]=w*T+_*C,c[3]=M*T+E*C,c}function f(c,p,v){return c[0]=p[0]-v[0],c[1]=p[1]-v[1],c[2]=p[2]-v[2],c[3]=p[3]-v[3],c}return Ze.mul=a,Ze.sub=f,Ze}var pt,vt={};function Cn(){if(pt)return vt;function o(c){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},o(c)}pt=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.create=function(){var c=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0,c[4]=0,c[5]=0),c[0]=1,c[3]=1,c},vt.clone=function(c){var p=new e.ARRAY_TYPE(6);return p[0]=c[0],p[1]=c[1],p[2]=c[2],p[3]=c[3],p[4]=c[4],p[5]=c[5],p},vt.copy=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[3],c[4]=p[4],c[5]=p[5],c},vt.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=0,c[5]=0,c},vt.fromValues=function(c,p,v,w,M,_){var E=new e.ARRAY_TYPE(6);return E[0]=c,E[1]=p,E[2]=v,E[3]=w,E[4]=M,E[5]=_,E},vt.set=function(c,p,v,w,M,_,E){return c[0]=p,c[1]=v,c[2]=w,c[3]=M,c[4]=_,c[5]=E,c},vt.invert=function(c,p){var v=p[0],w=p[1],M=p[2],_=p[3],E=p[4],D=p[5],b=v*_-w*M;return b?(c[0]=_*(b=1/b),c[1]=-w*b,c[2]=-M*b,c[3]=v*b,c[4]=(M*D-_*E)*b,c[5]=(w*E-v*D)*b,c):null},vt.determinant=function(c){return c[0]*c[3]-c[1]*c[2]},vt.multiply=a,vt.rotate=function(c,p,v){var w=p[0],M=p[1],_=p[2],E=p[3],D=p[4],b=p[5],T=Math.sin(v),C=Math.cos(v);return c[0]=w*C+_*T,c[1]=M*C+E*T,c[2]=w*-T+_*C,c[3]=M*-T+E*C,c[4]=D,c[5]=b,c},vt.scale=function(c,p,v){var w=p[1],M=p[2],_=p[3],E=p[4],D=p[5],b=v[0],T=v[1];return c[0]=p[0]*b,c[1]=w*b,c[2]=M*T,c[3]=_*T,c[4]=E,c[5]=D,c},vt.translate=function(c,p,v){var w=p[0],M=p[1],_=p[2],E=p[3],D=p[4],b=p[5],T=v[0],C=v[1];return c[0]=w,c[1]=M,c[2]=_,c[3]=E,c[4]=w*T+_*C+D,c[5]=M*T+E*C+b,c},vt.fromRotation=function(c,p){var v=Math.sin(p),w=Math.cos(p);return c[0]=w,c[1]=v,c[2]=-v,c[3]=w,c[4]=0,c[5]=0,c},vt.fromScaling=function(c,p){return c[0]=p[0],c[1]=0,c[2]=0,c[3]=p[1],c[4]=0,c[5]=0,c},vt.fromTranslation=function(c,p){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=p[0],c[5]=p[1],c},vt.str=function(c){return"mat2d("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+")"},vt.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3],c[4],c[5],1)},vt.add=function(c,p,v){return c[0]=p[0]+v[0],c[1]=p[1]+v[1],c[2]=p[2]+v[2],c[3]=p[3]+v[3],c[4]=p[4]+v[4],c[5]=p[5]+v[5],c},vt.subtract=f,vt.multiplyScalar=function(c,p,v){return c[0]=p[0]*v,c[1]=p[1]*v,c[2]=p[2]*v,c[3]=p[3]*v,c[4]=p[4]*v,c[5]=p[5]*v,c},vt.multiplyScalarAndAdd=function(c,p,v,w){return c[0]=p[0]+v[0]*w,c[1]=p[1]+v[1]*w,c[2]=p[2]+v[2]*w,c[3]=p[3]+v[3]*w,c[4]=p[4]+v[4]*w,c[5]=p[5]+v[5]*w,c},vt.exactEquals=function(c,p){return c[0]===p[0]&&c[1]===p[1]&&c[2]===p[2]&&c[3]===p[3]&&c[4]===p[4]&&c[5]===p[5]},vt.equals=function(c,p){var v=c[0],w=c[1],M=c[2],_=c[3],E=c[4],D=c[5],b=p[0],T=p[1],C=p[2],O=p[3],L=p[4],B=p[5];return Math.abs(v-b)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(b))&&Math.abs(w-T)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(T))&&Math.abs(M-C)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(C))&&Math.abs(_-O)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(O))&&Math.abs(E-L)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(L))&&Math.abs(D-B)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(B))},vt.sub=vt.mul=void 0;var e=function(c,p){if(c&&c.__esModule)return c;if(c===null||o(c)!=="object"&&typeof c!="function")return{default:c};var v=r(void 0);if(v&&v.has(c))return v.get(c);var w={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var E=M?Object.getOwnPropertyDescriptor(c,_):null;E&&(E.get||E.set)?Object.defineProperty(w,_,E):w[_]=c[_]}return w.default=c,v&&v.set(c,w),w}(Te());function r(c){if(typeof WeakMap!="function")return null;var p=new WeakMap,v=new WeakMap;return(r=function(w){return w?v:p})(c)}function a(c,p,v){var w=p[0],M=p[1],_=p[2],E=p[3],D=p[4],b=p[5],T=v[0],C=v[1],O=v[2],L=v[3],B=v[4],j=v[5];return c[0]=w*T+_*C,c[1]=M*T+E*C,c[2]=w*O+_*L,c[3]=M*O+E*L,c[4]=w*B+_*j+D,c[5]=M*B+E*j+b,c}function f(c,p,v){return c[0]=p[0]-v[0],c[1]=p[1]-v[1],c[2]=p[2]-v[2],c[3]=p[3]-v[3],c[4]=p[4]-v[4],c[5]=p[5]-v[5],c}return vt.mul=a,vt.sub=f,vt}var En,Ft={};function mi(){if(En)return Ft;function o(c){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},o(c)}En=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.create=function(){var c=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c},Ft.fromMat4=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[4],c[4]=p[5],c[5]=p[6],c[6]=p[8],c[7]=p[9],c[8]=p[10],c},Ft.clone=function(c){var p=new e.ARRAY_TYPE(9);return p[0]=c[0],p[1]=c[1],p[2]=c[2],p[3]=c[3],p[4]=c[4],p[5]=c[5],p[6]=c[6],p[7]=c[7],p[8]=c[8],p},Ft.copy=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[3],c[4]=p[4],c[5]=p[5],c[6]=p[6],c[7]=p[7],c[8]=p[8],c},Ft.fromValues=function(c,p,v,w,M,_,E,D,b){var T=new e.ARRAY_TYPE(9);return T[0]=c,T[1]=p,T[2]=v,T[3]=w,T[4]=M,T[5]=_,T[6]=E,T[7]=D,T[8]=b,T},Ft.set=function(c,p,v,w,M,_,E,D,b,T){return c[0]=p,c[1]=v,c[2]=w,c[3]=M,c[4]=_,c[5]=E,c[6]=D,c[7]=b,c[8]=T,c},Ft.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=1,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},Ft.transpose=function(c,p){if(c===p){var v=p[1],w=p[2],M=p[5];c[1]=p[3],c[2]=p[6],c[3]=v,c[5]=p[7],c[6]=w,c[7]=M}else c[0]=p[0],c[1]=p[3],c[2]=p[6],c[3]=p[1],c[4]=p[4],c[5]=p[7],c[6]=p[2],c[7]=p[5],c[8]=p[8];return c},Ft.invert=function(c,p){var v=p[0],w=p[1],M=p[2],_=p[3],E=p[4],D=p[5],b=p[6],T=p[7],C=p[8],O=C*E-D*T,L=-C*_+D*b,B=T*_-E*b,j=v*O+w*L+M*B;return j?(c[0]=O*(j=1/j),c[1]=(-C*w+M*T)*j,c[2]=(D*w-M*E)*j,c[3]=L*j,c[4]=(C*v-M*b)*j,c[5]=(-D*v+M*_)*j,c[6]=B*j,c[7]=(-T*v+w*b)*j,c[8]=(E*v-w*_)*j,c):null},Ft.adjoint=function(c,p){var v=p[0],w=p[1],M=p[2],_=p[3],E=p[4],D=p[5],b=p[6],T=p[7],C=p[8];return c[0]=E*C-D*T,c[1]=M*T-w*C,c[2]=w*D-M*E,c[3]=D*b-_*C,c[4]=v*C-M*b,c[5]=M*_-v*D,c[6]=_*T-E*b,c[7]=w*b-v*T,c[8]=v*E-w*_,c},Ft.determinant=function(c){var p=c[3],v=c[4],w=c[5],M=c[6],_=c[7],E=c[8];return c[0]*(E*v-w*_)+c[1]*(-E*p+w*M)+c[2]*(_*p-v*M)},Ft.multiply=a,Ft.translate=function(c,p,v){var w=p[0],M=p[1],_=p[2],E=p[3],D=p[4],b=p[5],T=p[6],C=p[7],O=p[8],L=v[0],B=v[1];return c[0]=w,c[1]=M,c[2]=_,c[3]=E,c[4]=D,c[5]=b,c[6]=L*w+B*E+T,c[7]=L*M+B*D+C,c[8]=L*_+B*b+O,c},Ft.rotate=function(c,p,v){var w=p[0],M=p[1],_=p[2],E=p[3],D=p[4],b=p[5],T=p[6],C=p[7],O=p[8],L=Math.sin(v),B=Math.cos(v);return c[0]=B*w+L*E,c[1]=B*M+L*D,c[2]=B*_+L*b,c[3]=B*E-L*w,c[4]=B*D-L*M,c[5]=B*b-L*_,c[6]=T,c[7]=C,c[8]=O,c},Ft.scale=function(c,p,v){var w=v[0],M=v[1];return c[0]=w*p[0],c[1]=w*p[1],c[2]=w*p[2],c[3]=M*p[3],c[4]=M*p[4],c[5]=M*p[5],c[6]=p[6],c[7]=p[7],c[8]=p[8],c},Ft.fromTranslation=function(c,p){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=1,c[5]=0,c[6]=p[0],c[7]=p[1],c[8]=1,c},Ft.fromRotation=function(c,p){var v=Math.sin(p),w=Math.cos(p);return c[0]=w,c[1]=v,c[2]=0,c[3]=-v,c[4]=w,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},Ft.fromScaling=function(c,p){return c[0]=p[0],c[1]=0,c[2]=0,c[3]=0,c[4]=p[1],c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},Ft.fromMat2d=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=0,c[3]=p[2],c[4]=p[3],c[5]=0,c[6]=p[4],c[7]=p[5],c[8]=1,c},Ft.fromQuat=function(c,p){var v=p[0],w=p[1],M=p[2],_=p[3],E=v+v,D=w+w,b=M+M,T=v*E,C=w*E,O=w*D,L=M*E,B=M*D,j=M*b,z=_*E,U=_*D,q=_*b;return c[0]=1-O-j,c[3]=C-q,c[6]=L+U,c[1]=C+q,c[4]=1-T-j,c[7]=B-z,c[2]=L-U,c[5]=B+z,c[8]=1-T-O,c},Ft.normalFromMat4=function(c,p){var v=p[0],w=p[1],M=p[2],_=p[3],E=p[4],D=p[5],b=p[6],T=p[7],C=p[8],O=p[9],L=p[10],B=p[11],j=p[12],z=p[13],U=p[14],q=p[15],K=v*D-w*E,re=v*b-M*E,ne=v*T-_*E,te=w*b-M*D,pe=w*T-_*D,ie=M*T-_*b,me=C*z-O*j,ye=C*U-L*j,_e=C*q-B*j,be=O*U-L*z,Se=O*q-B*z,Ae=L*q-B*U,Ie=K*Ae-re*Se+ne*be+te*_e-pe*ye+ie*me;return Ie?(c[0]=(D*Ae-b*Se+T*be)*(Ie=1/Ie),c[1]=(b*_e-E*Ae-T*ye)*Ie,c[2]=(E*Se-D*_e+T*me)*Ie,c[3]=(M*Se-w*Ae-_*be)*Ie,c[4]=(v*Ae-M*_e+_*ye)*Ie,c[5]=(w*_e-v*Se-_*me)*Ie,c[6]=(z*ie-U*pe+q*te)*Ie,c[7]=(U*ne-j*ie-q*re)*Ie,c[8]=(j*pe-z*ne+q*K)*Ie,c):null},Ft.projection=function(c,p,v){return c[0]=2/p,c[1]=0,c[2]=0,c[3]=0,c[4]=-2/v,c[5]=0,c[6]=-1,c[7]=1,c[8]=1,c},Ft.str=function(c){return"mat3("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+")"},Ft.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8])},Ft.add=function(c,p,v){return c[0]=p[0]+v[0],c[1]=p[1]+v[1],c[2]=p[2]+v[2],c[3]=p[3]+v[3],c[4]=p[4]+v[4],c[5]=p[5]+v[5],c[6]=p[6]+v[6],c[7]=p[7]+v[7],c[8]=p[8]+v[8],c},Ft.subtract=f,Ft.multiplyScalar=function(c,p,v){return c[0]=p[0]*v,c[1]=p[1]*v,c[2]=p[2]*v,c[3]=p[3]*v,c[4]=p[4]*v,c[5]=p[5]*v,c[6]=p[6]*v,c[7]=p[7]*v,c[8]=p[8]*v,c},Ft.multiplyScalarAndAdd=function(c,p,v,w){return c[0]=p[0]+v[0]*w,c[1]=p[1]+v[1]*w,c[2]=p[2]+v[2]*w,c[3]=p[3]+v[3]*w,c[4]=p[4]+v[4]*w,c[5]=p[5]+v[5]*w,c[6]=p[6]+v[6]*w,c[7]=p[7]+v[7]*w,c[8]=p[8]+v[8]*w,c},Ft.exactEquals=function(c,p){return c[0]===p[0]&&c[1]===p[1]&&c[2]===p[2]&&c[3]===p[3]&&c[4]===p[4]&&c[5]===p[5]&&c[6]===p[6]&&c[7]===p[7]&&c[8]===p[8]},Ft.equals=function(c,p){var v=c[0],w=c[1],M=c[2],_=c[3],E=c[4],D=c[5],b=c[6],T=c[7],C=c[8],O=p[0],L=p[1],B=p[2],j=p[3],z=p[4],U=p[5],q=p[6],K=p[7],re=p[8];return Math.abs(v-O)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(w-L)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(L))&&Math.abs(M-B)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(B))&&Math.abs(_-j)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(j))&&Math.abs(E-z)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(z))&&Math.abs(D-U)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(U))&&Math.abs(b-q)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(q))&&Math.abs(T-K)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(K))&&Math.abs(C-re)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(re))},Ft.sub=Ft.mul=void 0;var e=function(c,p){if(c&&c.__esModule)return c;if(c===null||o(c)!=="object"&&typeof c!="function")return{default:c};var v=r(void 0);if(v&&v.has(c))return v.get(c);var w={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var E=M?Object.getOwnPropertyDescriptor(c,_):null;E&&(E.get||E.set)?Object.defineProperty(w,_,E):w[_]=c[_]}return w.default=c,v&&v.set(c,w),w}(Te());function r(c){if(typeof WeakMap!="function")return null;var p=new WeakMap,v=new WeakMap;return(r=function(w){return w?v:p})(c)}function a(c,p,v){var w=p[0],M=p[1],_=p[2],E=p[3],D=p[4],b=p[5],T=p[6],C=p[7],O=p[8],L=v[0],B=v[1],j=v[2],z=v[3],U=v[4],q=v[5],K=v[6],re=v[7],ne=v[8];return c[0]=L*w+B*E+j*T,c[1]=L*M+B*D+j*C,c[2]=L*_+B*b+j*O,c[3]=z*w+U*E+q*T,c[4]=z*M+U*D+q*C,c[5]=z*_+U*b+q*O,c[6]=K*w+re*E+ne*T,c[7]=K*M+re*D+ne*C,c[8]=K*_+re*b+ne*O,c}function f(c,p,v){return c[0]=p[0]-v[0],c[1]=p[1]-v[1],c[2]=p[2]-v[2],c[3]=p[3]-v[3],c[4]=p[4]-v[4],c[5]=p[5]-v[5],c[6]=p[6]-v[6],c[7]=p[7]-v[7],c[8]=p[8]-v[8],c}return Ft.mul=a,Ft.sub=f,Ft}var Eo,Bt={};function To(){if(Eo)return Bt;function o(_){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},o(_)}Eo=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.create=function(){var _=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},Bt.clone=function(_){var E=new e.ARRAY_TYPE(16);return E[0]=_[0],E[1]=_[1],E[2]=_[2],E[3]=_[3],E[4]=_[4],E[5]=_[5],E[6]=_[6],E[7]=_[7],E[8]=_[8],E[9]=_[9],E[10]=_[10],E[11]=_[11],E[12]=_[12],E[13]=_[13],E[14]=_[14],E[15]=_[15],E},Bt.copy=function(_,E){return _[0]=E[0],_[1]=E[1],_[2]=E[2],_[3]=E[3],_[4]=E[4],_[5]=E[5],_[6]=E[6],_[7]=E[7],_[8]=E[8],_[9]=E[9],_[10]=E[10],_[11]=E[11],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15],_},Bt.fromValues=function(_,E,D,b,T,C,O,L,B,j,z,U,q,K,re,ne){var te=new e.ARRAY_TYPE(16);return te[0]=_,te[1]=E,te[2]=D,te[3]=b,te[4]=T,te[5]=C,te[6]=O,te[7]=L,te[8]=B,te[9]=j,te[10]=z,te[11]=U,te[12]=q,te[13]=K,te[14]=re,te[15]=ne,te},Bt.set=function(_,E,D,b,T,C,O,L,B,j,z,U,q,K,re,ne,te){return _[0]=E,_[1]=D,_[2]=b,_[3]=T,_[4]=C,_[5]=O,_[6]=L,_[7]=B,_[8]=j,_[9]=z,_[10]=U,_[11]=q,_[12]=K,_[13]=re,_[14]=ne,_[15]=te,_},Bt.identity=a,Bt.transpose=function(_,E){if(_===E){var D=E[1],b=E[2],T=E[3],C=E[6],O=E[7],L=E[11];_[1]=E[4],_[2]=E[8],_[3]=E[12],_[4]=D,_[6]=E[9],_[7]=E[13],_[8]=b,_[9]=C,_[11]=E[14],_[12]=T,_[13]=O,_[14]=L}else _[0]=E[0],_[1]=E[4],_[2]=E[8],_[3]=E[12],_[4]=E[1],_[5]=E[5],_[6]=E[9],_[7]=E[13],_[8]=E[2],_[9]=E[6],_[10]=E[10],_[11]=E[14],_[12]=E[3],_[13]=E[7],_[14]=E[11],_[15]=E[15];return _},Bt.invert=function(_,E){var D=E[0],b=E[1],T=E[2],C=E[3],O=E[4],L=E[5],B=E[6],j=E[7],z=E[8],U=E[9],q=E[10],K=E[11],re=E[12],ne=E[13],te=E[14],pe=E[15],ie=D*L-b*O,me=D*B-T*O,ye=D*j-C*O,_e=b*B-T*L,be=b*j-C*L,Se=T*j-C*B,Ae=z*ne-U*re,Ie=z*te-q*re,$e=z*pe-K*re,Ke=U*te-q*ne,Ue=U*pe-K*ne,ut=q*pe-K*te,lt=ie*ut-me*Ue+ye*Ke+_e*$e-be*Ie+Se*Ae;return lt?(_[0]=(L*ut-B*Ue+j*Ke)*(lt=1/lt),_[1]=(T*Ue-b*ut-C*Ke)*lt,_[2]=(ne*Se-te*be+pe*_e)*lt,_[3]=(q*be-U*Se-K*_e)*lt,_[4]=(B*$e-O*ut-j*Ie)*lt,_[5]=(D*ut-T*$e+C*Ie)*lt,_[6]=(te*ye-re*Se-pe*me)*lt,_[7]=(z*Se-q*ye+K*me)*lt,_[8]=(O*Ue-L*$e+j*Ae)*lt,_[9]=(b*$e-D*Ue-C*Ae)*lt,_[10]=(re*be-ne*ye+pe*ie)*lt,_[11]=(U*ye-z*be-K*ie)*lt,_[12]=(L*Ie-O*Ke-B*Ae)*lt,_[13]=(D*Ke-b*Ie+T*Ae)*lt,_[14]=(ne*me-re*_e-te*ie)*lt,_[15]=(z*_e-U*me+q*ie)*lt,_):null},Bt.adjoint=function(_,E){var D=E[0],b=E[1],T=E[2],C=E[3],O=E[4],L=E[5],B=E[6],j=E[7],z=E[8],U=E[9],q=E[10],K=E[11],re=E[12],ne=E[13],te=E[14],pe=E[15];return _[0]=L*(q*pe-K*te)-U*(B*pe-j*te)+ne*(B*K-j*q),_[1]=-(b*(q*pe-K*te)-U*(T*pe-C*te)+ne*(T*K-C*q)),_[2]=b*(B*pe-j*te)-L*(T*pe-C*te)+ne*(T*j-C*B),_[3]=-(b*(B*K-j*q)-L*(T*K-C*q)+U*(T*j-C*B)),_[4]=-(O*(q*pe-K*te)-z*(B*pe-j*te)+re*(B*K-j*q)),_[5]=D*(q*pe-K*te)-z*(T*pe-C*te)+re*(T*K-C*q),_[6]=-(D*(B*pe-j*te)-O*(T*pe-C*te)+re*(T*j-C*B)),_[7]=D*(B*K-j*q)-O*(T*K-C*q)+z*(T*j-C*B),_[8]=O*(U*pe-K*ne)-z*(L*pe-j*ne)+re*(L*K-j*U),_[9]=-(D*(U*pe-K*ne)-z*(b*pe-C*ne)+re*(b*K-C*U)),_[10]=D*(L*pe-j*ne)-O*(b*pe-C*ne)+re*(b*j-C*L),_[11]=-(D*(L*K-j*U)-O*(b*K-C*U)+z*(b*j-C*L)),_[12]=-(O*(U*te-q*ne)-z*(L*te-B*ne)+re*(L*q-B*U)),_[13]=D*(U*te-q*ne)-z*(b*te-T*ne)+re*(b*q-T*U),_[14]=-(D*(L*te-B*ne)-O*(b*te-T*ne)+re*(b*B-T*L)),_[15]=D*(L*q-B*U)-O*(b*q-T*U)+z*(b*B-T*L),_},Bt.determinant=function(_){var E=_[0],D=_[1],b=_[2],T=_[3],C=_[4],O=_[5],L=_[6],B=_[7],j=_[8],z=_[9],U=_[10],q=_[11],K=_[12],re=_[13],ne=_[14],te=_[15];return(E*O-D*C)*(U*te-q*ne)-(E*L-b*C)*(z*te-q*re)+(E*B-T*C)*(z*ne-U*re)+(D*L-b*O)*(j*te-q*K)-(D*B-T*O)*(j*ne-U*K)+(b*B-T*L)*(j*re-z*K)},Bt.multiply=f,Bt.translate=function(_,E,D){var b,T,C,O,L,B,j,z,U,q,K,re,ne=D[0],te=D[1],pe=D[2];return E===_?(_[12]=E[0]*ne+E[4]*te+E[8]*pe+E[12],_[13]=E[1]*ne+E[5]*te+E[9]*pe+E[13],_[14]=E[2]*ne+E[6]*te+E[10]*pe+E[14],_[15]=E[3]*ne+E[7]*te+E[11]*pe+E[15]):(T=E[1],C=E[2],O=E[3],L=E[4],B=E[5],j=E[6],z=E[7],U=E[8],q=E[9],K=E[10],re=E[11],_[0]=b=E[0],_[1]=T,_[2]=C,_[3]=O,_[4]=L,_[5]=B,_[6]=j,_[7]=z,_[8]=U,_[9]=q,_[10]=K,_[11]=re,_[12]=b*ne+L*te+U*pe+E[12],_[13]=T*ne+B*te+q*pe+E[13],_[14]=C*ne+j*te+K*pe+E[14],_[15]=O*ne+z*te+re*pe+E[15]),_},Bt.scale=function(_,E,D){var b=D[0],T=D[1],C=D[2];return _[0]=E[0]*b,_[1]=E[1]*b,_[2]=E[2]*b,_[3]=E[3]*b,_[4]=E[4]*T,_[5]=E[5]*T,_[6]=E[6]*T,_[7]=E[7]*T,_[8]=E[8]*C,_[9]=E[9]*C,_[10]=E[10]*C,_[11]=E[11]*C,_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15],_},Bt.rotate=function(_,E,D,b){var T,C,O,L,B,j,z,U,q,K,re,ne,te,pe,ie,me,ye,_e,be,Se,Ae,Ie,$e,Ke,Ue=b[0],ut=b[1],lt=b[2],tt=Math.hypot(Ue,ut,lt);return tt<e.EPSILON?null:(Ue*=tt=1/tt,ut*=tt,lt*=tt,T=Math.sin(D),C=Math.cos(D),B=E[1],j=E[2],z=E[3],q=E[5],K=E[6],re=E[7],te=E[9],pe=E[10],ie=E[11],me=Ue*Ue*(O=1-C)+C,be=Ue*ut*O-lt*T,Se=ut*ut*O+C,Ae=lt*ut*O+Ue*T,Ie=Ue*lt*O+ut*T,$e=ut*lt*O-Ue*T,Ke=lt*lt*O+C,_[0]=(L=E[0])*me+(U=E[4])*(ye=ut*Ue*O+lt*T)+(ne=E[8])*(_e=lt*Ue*O-ut*T),_[1]=B*me+q*ye+te*_e,_[2]=j*me+K*ye+pe*_e,_[3]=z*me+re*ye+ie*_e,_[4]=L*be+U*Se+ne*Ae,_[5]=B*be+q*Se+te*Ae,_[6]=j*be+K*Se+pe*Ae,_[7]=z*be+re*Se+ie*Ae,_[8]=L*Ie+U*$e+ne*Ke,_[9]=B*Ie+q*$e+te*Ke,_[10]=j*Ie+K*$e+pe*Ke,_[11]=z*Ie+re*$e+ie*Ke,E!==_&&(_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_)},Bt.rotateX=function(_,E,D){var b=Math.sin(D),T=Math.cos(D),C=E[4],O=E[5],L=E[6],B=E[7],j=E[8],z=E[9],U=E[10],q=E[11];return E!==_&&(_[0]=E[0],_[1]=E[1],_[2]=E[2],_[3]=E[3],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[4]=C*T+j*b,_[5]=O*T+z*b,_[6]=L*T+U*b,_[7]=B*T+q*b,_[8]=j*T-C*b,_[9]=z*T-O*b,_[10]=U*T-L*b,_[11]=q*T-B*b,_},Bt.rotateY=function(_,E,D){var b=Math.sin(D),T=Math.cos(D),C=E[0],O=E[1],L=E[2],B=E[3],j=E[8],z=E[9],U=E[10],q=E[11];return E!==_&&(_[4]=E[4],_[5]=E[5],_[6]=E[6],_[7]=E[7],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[0]=C*T-j*b,_[1]=O*T-z*b,_[2]=L*T-U*b,_[3]=B*T-q*b,_[8]=C*b+j*T,_[9]=O*b+z*T,_[10]=L*b+U*T,_[11]=B*b+q*T,_},Bt.rotateZ=function(_,E,D){var b=Math.sin(D),T=Math.cos(D),C=E[0],O=E[1],L=E[2],B=E[3],j=E[4],z=E[5],U=E[6],q=E[7];return E!==_&&(_[8]=E[8],_[9]=E[9],_[10]=E[10],_[11]=E[11],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[0]=C*T+j*b,_[1]=O*T+z*b,_[2]=L*T+U*b,_[3]=B*T+q*b,_[4]=j*T-C*b,_[5]=z*T-O*b,_[6]=U*T-L*b,_[7]=q*T-B*b,_},Bt.fromTranslation=function(_,E){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=E[0],_[13]=E[1],_[14]=E[2],_[15]=1,_},Bt.fromScaling=function(_,E){return _[0]=E[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=E[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=E[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Bt.fromRotation=function(_,E,D){var b,T,C,O=D[0],L=D[1],B=D[2],j=Math.hypot(O,L,B);return j<e.EPSILON?null:(O*=j=1/j,L*=j,B*=j,b=Math.sin(E),T=Math.cos(E),_[0]=O*O*(C=1-T)+T,_[1]=L*O*C+B*b,_[2]=B*O*C-L*b,_[3]=0,_[4]=O*L*C-B*b,_[5]=L*L*C+T,_[6]=B*L*C+O*b,_[7]=0,_[8]=O*B*C+L*b,_[9]=L*B*C-O*b,_[10]=B*B*C+T,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)},Bt.fromXRotation=function(_,E){var D=Math.sin(E),b=Math.cos(E);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=b,_[6]=D,_[7]=0,_[8]=0,_[9]=-D,_[10]=b,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Bt.fromYRotation=function(_,E){var D=Math.sin(E),b=Math.cos(E);return _[0]=b,_[1]=0,_[2]=-D,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=D,_[9]=0,_[10]=b,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Bt.fromZRotation=function(_,E){var D=Math.sin(E),b=Math.cos(E);return _[0]=b,_[1]=D,_[2]=0,_[3]=0,_[4]=-D,_[5]=b,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Bt.fromRotationTranslation=c,Bt.fromQuat2=function(_,E){var D=new e.ARRAY_TYPE(3),b=-E[0],T=-E[1],C=-E[2],O=E[3],L=E[4],B=E[5],j=E[6],z=E[7],U=b*b+T*T+C*C+O*O;return U>0?(D[0]=2*(L*O+z*b+B*C-j*T)/U,D[1]=2*(B*O+z*T+j*b-L*C)/U,D[2]=2*(j*O+z*C+L*T-B*b)/U):(D[0]=2*(L*O+z*b+B*C-j*T),D[1]=2*(B*O+z*T+j*b-L*C),D[2]=2*(j*O+z*C+L*T-B*b)),c(_,E,D),_},Bt.getTranslation=function(_,E){return _[0]=E[12],_[1]=E[13],_[2]=E[14],_},Bt.getScaling=p,Bt.getRotation=function(_,E){var D=new e.ARRAY_TYPE(3);p(D,E);var b=1/D[0],T=1/D[1],C=1/D[2],O=E[0]*b,L=E[1]*T,B=E[2]*C,j=E[4]*b,z=E[5]*T,U=E[6]*C,q=E[8]*b,K=E[9]*T,re=E[10]*C,ne=O+z+re,te=0;return ne>0?(te=2*Math.sqrt(ne+1),_[3]=.25*te,_[0]=(U-K)/te,_[1]=(q-B)/te,_[2]=(L-j)/te):O>z&&O>re?(te=2*Math.sqrt(1+O-z-re),_[3]=(U-K)/te,_[0]=.25*te,_[1]=(L+j)/te,_[2]=(q+B)/te):z>re?(te=2*Math.sqrt(1+z-O-re),_[3]=(q-B)/te,_[0]=(L+j)/te,_[1]=.25*te,_[2]=(U+K)/te):(te=2*Math.sqrt(1+re-O-z),_[3]=(L-j)/te,_[0]=(q+B)/te,_[1]=(U+K)/te,_[2]=.25*te),_},Bt.fromRotationTranslationScale=function(_,E,D,b){var T=E[0],C=E[1],O=E[2],L=E[3],B=T+T,j=C+C,z=O+O,U=T*B,q=T*j,K=T*z,re=C*j,ne=C*z,te=O*z,pe=L*B,ie=L*j,me=L*z,ye=b[0],_e=b[1],be=b[2];return _[0]=(1-(re+te))*ye,_[1]=(q+me)*ye,_[2]=(K-ie)*ye,_[3]=0,_[4]=(q-me)*_e,_[5]=(1-(U+te))*_e,_[6]=(ne+pe)*_e,_[7]=0,_[8]=(K+ie)*be,_[9]=(ne-pe)*be,_[10]=(1-(U+re))*be,_[11]=0,_[12]=D[0],_[13]=D[1],_[14]=D[2],_[15]=1,_},Bt.fromRotationTranslationScaleOrigin=function(_,E,D,b,T){var C=E[0],O=E[1],L=E[2],B=E[3],j=C+C,z=O+O,U=L+L,q=C*j,K=C*z,re=C*U,ne=O*z,te=O*U,pe=L*U,ie=B*j,me=B*z,ye=B*U,_e=b[0],be=b[1],Se=b[2],Ae=T[0],Ie=T[1],$e=T[2],Ke=(1-(ne+pe))*_e,Ue=(K+ye)*_e,ut=(re-me)*_e,lt=(K-ye)*be,tt=(1-(q+pe))*be,Je=(te+ie)*be,xt=(re+me)*Se,ht=(te-ie)*Se,mt=(1-(q+ne))*Se;return _[0]=Ke,_[1]=Ue,_[2]=ut,_[3]=0,_[4]=lt,_[5]=tt,_[6]=Je,_[7]=0,_[8]=xt,_[9]=ht,_[10]=mt,_[11]=0,_[12]=D[0]+Ae-(Ke*Ae+lt*Ie+xt*$e),_[13]=D[1]+Ie-(Ue*Ae+tt*Ie+ht*$e),_[14]=D[2]+$e-(ut*Ae+Je*Ie+mt*$e),_[15]=1,_},Bt.fromQuat=function(_,E){var D=E[0],b=E[1],T=E[2],C=E[3],O=D+D,L=b+b,B=T+T,j=D*O,z=b*O,U=b*L,q=T*O,K=T*L,re=T*B,ne=C*O,te=C*L,pe=C*B;return _[0]=1-U-re,_[1]=z+pe,_[2]=q-te,_[3]=0,_[4]=z-pe,_[5]=1-j-re,_[6]=K+ne,_[7]=0,_[8]=q+te,_[9]=K-ne,_[10]=1-j-U,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Bt.frustum=function(_,E,D,b,T,C,O){var L=1/(D-E),B=1/(T-b),j=1/(C-O);return _[0]=2*C*L,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*C*B,_[6]=0,_[7]=0,_[8]=(D+E)*L,_[9]=(T+b)*B,_[10]=(O+C)*j,_[11]=-1,_[12]=0,_[13]=0,_[14]=O*C*2*j,_[15]=0,_},Bt.perspectiveNO=v,Bt.perspectiveZO=function(_,E,D,b,T){var C,O=1/Math.tan(E/2);return _[0]=O/D,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=O,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,T!=null&&T!==1/0?(_[10]=T*(C=1/(b-T)),_[14]=T*b*C):(_[10]=-1,_[14]=-b),_},Bt.perspectiveFromFieldOfView=function(_,E,D,b){var T=Math.tan(E.upDegrees*Math.PI/180),C=Math.tan(E.downDegrees*Math.PI/180),O=Math.tan(E.leftDegrees*Math.PI/180),L=Math.tan(E.rightDegrees*Math.PI/180),B=2/(O+L),j=2/(T+C);return _[0]=B,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=j,_[6]=0,_[7]=0,_[8]=-(O-L)*B*.5,_[9]=(T-C)*j*.5,_[10]=b/(D-b),_[11]=-1,_[12]=0,_[13]=0,_[14]=b*D/(D-b),_[15]=0,_},Bt.orthoNO=w,Bt.orthoZO=function(_,E,D,b,T,C,O){var L=1/(E-D),B=1/(b-T),j=1/(C-O);return _[0]=-2*L,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=j,_[11]=0,_[12]=(E+D)*L,_[13]=(T+b)*B,_[14]=C*j,_[15]=1,_},Bt.lookAt=function(_,E,D,b){var T,C,O,L,B,j,z,U,q,K,re=E[0],ne=E[1],te=E[2],pe=b[0],ie=b[1],me=b[2],ye=D[0],_e=D[1],be=D[2];return Math.abs(re-ye)<e.EPSILON&&Math.abs(ne-_e)<e.EPSILON&&Math.abs(te-be)<e.EPSILON?a(_):(z=re-ye,U=ne-_e,q=te-be,T=ie*(q*=K=1/Math.hypot(z,U,q))-me*(U*=K),C=me*(z*=K)-pe*q,O=pe*U-ie*z,(K=Math.hypot(T,C,O))?(T*=K=1/K,C*=K,O*=K):(T=0,C=0,O=0),L=U*O-q*C,B=q*T-z*O,j=z*C-U*T,(K=Math.hypot(L,B,j))?(L*=K=1/K,B*=K,j*=K):(L=0,B=0,j=0),_[0]=T,_[1]=L,_[2]=z,_[3]=0,_[4]=C,_[5]=B,_[6]=U,_[7]=0,_[8]=O,_[9]=j,_[10]=q,_[11]=0,_[12]=-(T*re+C*ne+O*te),_[13]=-(L*re+B*ne+j*te),_[14]=-(z*re+U*ne+q*te),_[15]=1,_)},Bt.targetTo=function(_,E,D,b){var T=E[0],C=E[1],O=E[2],L=b[0],B=b[1],j=b[2],z=T-D[0],U=C-D[1],q=O-D[2],K=z*z+U*U+q*q;K>0&&(z*=K=1/Math.sqrt(K),U*=K,q*=K);var re=B*q-j*U,ne=j*z-L*q,te=L*U-B*z;return(K=re*re+ne*ne+te*te)>0&&(re*=K=1/Math.sqrt(K),ne*=K,te*=K),_[0]=re,_[1]=ne,_[2]=te,_[3]=0,_[4]=U*te-q*ne,_[5]=q*re-z*te,_[6]=z*ne-U*re,_[7]=0,_[8]=z,_[9]=U,_[10]=q,_[11]=0,_[12]=T,_[13]=C,_[14]=O,_[15]=1,_},Bt.str=function(_){return"mat4("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+", "+_[4]+", "+_[5]+", "+_[6]+", "+_[7]+", "+_[8]+", "+_[9]+", "+_[10]+", "+_[11]+", "+_[12]+", "+_[13]+", "+_[14]+", "+_[15]+")"},Bt.frob=function(_){return Math.hypot(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])},Bt.add=function(_,E,D){return _[0]=E[0]+D[0],_[1]=E[1]+D[1],_[2]=E[2]+D[2],_[3]=E[3]+D[3],_[4]=E[4]+D[4],_[5]=E[5]+D[5],_[6]=E[6]+D[6],_[7]=E[7]+D[7],_[8]=E[8]+D[8],_[9]=E[9]+D[9],_[10]=E[10]+D[10],_[11]=E[11]+D[11],_[12]=E[12]+D[12],_[13]=E[13]+D[13],_[14]=E[14]+D[14],_[15]=E[15]+D[15],_},Bt.subtract=M,Bt.multiplyScalar=function(_,E,D){return _[0]=E[0]*D,_[1]=E[1]*D,_[2]=E[2]*D,_[3]=E[3]*D,_[4]=E[4]*D,_[5]=E[5]*D,_[6]=E[6]*D,_[7]=E[7]*D,_[8]=E[8]*D,_[9]=E[9]*D,_[10]=E[10]*D,_[11]=E[11]*D,_[12]=E[12]*D,_[13]=E[13]*D,_[14]=E[14]*D,_[15]=E[15]*D,_},Bt.multiplyScalarAndAdd=function(_,E,D,b){return _[0]=E[0]+D[0]*b,_[1]=E[1]+D[1]*b,_[2]=E[2]+D[2]*b,_[3]=E[3]+D[3]*b,_[4]=E[4]+D[4]*b,_[5]=E[5]+D[5]*b,_[6]=E[6]+D[6]*b,_[7]=E[7]+D[7]*b,_[8]=E[8]+D[8]*b,_[9]=E[9]+D[9]*b,_[10]=E[10]+D[10]*b,_[11]=E[11]+D[11]*b,_[12]=E[12]+D[12]*b,_[13]=E[13]+D[13]*b,_[14]=E[14]+D[14]*b,_[15]=E[15]+D[15]*b,_},Bt.exactEquals=function(_,E){return _[0]===E[0]&&_[1]===E[1]&&_[2]===E[2]&&_[3]===E[3]&&_[4]===E[4]&&_[5]===E[5]&&_[6]===E[6]&&_[7]===E[7]&&_[8]===E[8]&&_[9]===E[9]&&_[10]===E[10]&&_[11]===E[11]&&_[12]===E[12]&&_[13]===E[13]&&_[14]===E[14]&&_[15]===E[15]},Bt.equals=function(_,E){var D=_[0],b=_[1],T=_[2],C=_[3],O=_[4],L=_[5],B=_[6],j=_[7],z=_[8],U=_[9],q=_[10],K=_[11],re=_[12],ne=_[13],te=_[14],pe=_[15],ie=E[0],me=E[1],ye=E[2],_e=E[3],be=E[4],Se=E[5],Ae=E[6],Ie=E[7],$e=E[8],Ke=E[9],Ue=E[10],ut=E[11],lt=E[12],tt=E[13],Je=E[14],xt=E[15];return Math.abs(D-ie)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(ie))&&Math.abs(b-me)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(me))&&Math.abs(T-ye)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(ye))&&Math.abs(C-_e)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(_e))&&Math.abs(O-be)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(be))&&Math.abs(L-Se)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(Se))&&Math.abs(B-Ae)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(Ae))&&Math.abs(j-Ie)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(Ie))&&Math.abs(z-$e)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs($e))&&Math.abs(U-Ke)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(Ke))&&Math.abs(q-Ue)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(Ue))&&Math.abs(K-ut)<=e.EPSILON*Math.max(1,Math.abs(K),Math.abs(ut))&&Math.abs(re-lt)<=e.EPSILON*Math.max(1,Math.abs(re),Math.abs(lt))&&Math.abs(ne-tt)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(tt))&&Math.abs(te-Je)<=e.EPSILON*Math.max(1,Math.abs(te),Math.abs(Je))&&Math.abs(pe-xt)<=e.EPSILON*Math.max(1,Math.abs(pe),Math.abs(xt))},Bt.sub=Bt.mul=Bt.ortho=Bt.perspective=void 0;var e=function(_,E){if(_&&_.__esModule)return _;if(_===null||o(_)!=="object"&&typeof _!="function")return{default:_};var D=r(void 0);if(D&&D.has(_))return D.get(_);var b={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var C in _)if(C!=="default"&&Object.prototype.hasOwnProperty.call(_,C)){var O=T?Object.getOwnPropertyDescriptor(_,C):null;O&&(O.get||O.set)?Object.defineProperty(b,C,O):b[C]=_[C]}return b.default=_,D&&D.set(_,b),b}(Te());function r(_){if(typeof WeakMap!="function")return null;var E=new WeakMap,D=new WeakMap;return(r=function(b){return b?D:E})(_)}function a(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function f(_,E,D){var b=E[0],T=E[1],C=E[2],O=E[3],L=E[4],B=E[5],j=E[6],z=E[7],U=E[8],q=E[9],K=E[10],re=E[11],ne=E[12],te=E[13],pe=E[14],ie=E[15],me=D[0],ye=D[1],_e=D[2],be=D[3];return _[0]=me*b+ye*L+_e*U+be*ne,_[1]=me*T+ye*B+_e*q+be*te,_[2]=me*C+ye*j+_e*K+be*pe,_[3]=me*O+ye*z+_e*re+be*ie,_[4]=(me=D[4])*b+(ye=D[5])*L+(_e=D[6])*U+(be=D[7])*ne,_[5]=me*T+ye*B+_e*q+be*te,_[6]=me*C+ye*j+_e*K+be*pe,_[7]=me*O+ye*z+_e*re+be*ie,_[8]=(me=D[8])*b+(ye=D[9])*L+(_e=D[10])*U+(be=D[11])*ne,_[9]=me*T+ye*B+_e*q+be*te,_[10]=me*C+ye*j+_e*K+be*pe,_[11]=me*O+ye*z+_e*re+be*ie,_[12]=(me=D[12])*b+(ye=D[13])*L+(_e=D[14])*U+(be=D[15])*ne,_[13]=me*T+ye*B+_e*q+be*te,_[14]=me*C+ye*j+_e*K+be*pe,_[15]=me*O+ye*z+_e*re+be*ie,_}function c(_,E,D){var b=E[0],T=E[1],C=E[2],O=E[3],L=b+b,B=T+T,j=C+C,z=b*L,U=b*B,q=b*j,K=T*B,re=T*j,ne=C*j,te=O*L,pe=O*B,ie=O*j;return _[0]=1-(K+ne),_[1]=U+ie,_[2]=q-pe,_[3]=0,_[4]=U-ie,_[5]=1-(z+ne),_[6]=re+te,_[7]=0,_[8]=q+pe,_[9]=re-te,_[10]=1-(z+K),_[11]=0,_[12]=D[0],_[13]=D[1],_[14]=D[2],_[15]=1,_}function p(_,E){var D=E[4],b=E[5],T=E[6],C=E[8],O=E[9],L=E[10];return _[0]=Math.hypot(E[0],E[1],E[2]),_[1]=Math.hypot(D,b,T),_[2]=Math.hypot(C,O,L),_}function v(_,E,D,b,T){var C,O=1/Math.tan(E/2);return _[0]=O/D,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=O,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,T!=null&&T!==1/0?(_[10]=(T+b)*(C=1/(b-T)),_[14]=2*T*b*C):(_[10]=-1,_[14]=-2*b),_}function w(_,E,D,b,T,C,O){var L=1/(E-D),B=1/(b-T),j=1/(C-O);return _[0]=-2*L,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*j,_[11]=0,_[12]=(E+D)*L,_[13]=(T+b)*B,_[14]=(O+C)*j,_[15]=1,_}function M(_,E,D){return _[0]=E[0]-D[0],_[1]=E[1]-D[1],_[2]=E[2]-D[2],_[3]=E[3]-D[3],_[4]=E[4]-D[4],_[5]=E[5]-D[5],_[6]=E[6]-D[6],_[7]=E[7]-D[7],_[8]=E[8]-D[8],_[9]=E[9]-D[9],_[10]=E[10]-D[10],_[11]=E[11]-D[11],_[12]=E[12]-D[12],_[13]=E[13]-D[13],_[14]=E[14]-D[14],_[15]=E[15]-D[15],_}return Bt.perspective=v,Bt.ortho=w,Bt.mul=f,Bt.sub=M,Bt}var Jo,Vt={},Ut={};function Xa(){if(Jo)return Ut;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(T)}Jo=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.create=a,Ut.clone=function(T){var C=new e.ARRAY_TYPE(3);return C[0]=T[0],C[1]=T[1],C[2]=T[2],C},Ut.length=f,Ut.fromValues=function(T,C,O){var L=new e.ARRAY_TYPE(3);return L[0]=T,L[1]=C,L[2]=O,L},Ut.copy=function(T,C){return T[0]=C[0],T[1]=C[1],T[2]=C[2],T},Ut.set=function(T,C,O,L){return T[0]=C,T[1]=O,T[2]=L,T},Ut.add=function(T,C,O){return T[0]=C[0]+O[0],T[1]=C[1]+O[1],T[2]=C[2]+O[2],T},Ut.subtract=c,Ut.multiply=p,Ut.divide=v,Ut.ceil=function(T,C){return T[0]=Math.ceil(C[0]),T[1]=Math.ceil(C[1]),T[2]=Math.ceil(C[2]),T},Ut.floor=function(T,C){return T[0]=Math.floor(C[0]),T[1]=Math.floor(C[1]),T[2]=Math.floor(C[2]),T},Ut.min=function(T,C,O){return T[0]=Math.min(C[0],O[0]),T[1]=Math.min(C[1],O[1]),T[2]=Math.min(C[2],O[2]),T},Ut.max=function(T,C,O){return T[0]=Math.max(C[0],O[0]),T[1]=Math.max(C[1],O[1]),T[2]=Math.max(C[2],O[2]),T},Ut.round=function(T,C){return T[0]=Math.round(C[0]),T[1]=Math.round(C[1]),T[2]=Math.round(C[2]),T},Ut.scale=function(T,C,O){return T[0]=C[0]*O,T[1]=C[1]*O,T[2]=C[2]*O,T},Ut.scaleAndAdd=function(T,C,O,L){return T[0]=C[0]+O[0]*L,T[1]=C[1]+O[1]*L,T[2]=C[2]+O[2]*L,T},Ut.distance=w,Ut.squaredDistance=M,Ut.squaredLength=_,Ut.negate=function(T,C){return T[0]=-C[0],T[1]=-C[1],T[2]=-C[2],T},Ut.inverse=function(T,C){return T[0]=1/C[0],T[1]=1/C[1],T[2]=1/C[2],T},Ut.normalize=function(T,C){var O=C[0],L=C[1],B=C[2],j=O*O+L*L+B*B;return j>0&&(j=1/Math.sqrt(j)),T[0]=C[0]*j,T[1]=C[1]*j,T[2]=C[2]*j,T},Ut.dot=E,Ut.cross=function(T,C,O){var L=C[0],B=C[1],j=C[2],z=O[0],U=O[1],q=O[2];return T[0]=B*q-j*U,T[1]=j*z-L*q,T[2]=L*U-B*z,T},Ut.lerp=function(T,C,O,L){var B=C[0],j=C[1],z=C[2];return T[0]=B+L*(O[0]-B),T[1]=j+L*(O[1]-j),T[2]=z+L*(O[2]-z),T},Ut.hermite=function(T,C,O,L,B,j){var z=j*j,U=z*(2*j-3)+1,q=z*(j-2)+j,K=z*(j-1),re=z*(3-2*j);return T[0]=C[0]*U+O[0]*q+L[0]*K+B[0]*re,T[1]=C[1]*U+O[1]*q+L[1]*K+B[1]*re,T[2]=C[2]*U+O[2]*q+L[2]*K+B[2]*re,T},Ut.bezier=function(T,C,O,L,B,j){var z=1-j,U=z*z,q=j*j,K=U*z,re=3*j*U,ne=3*q*z,te=q*j;return T[0]=C[0]*K+O[0]*re+L[0]*ne+B[0]*te,T[1]=C[1]*K+O[1]*re+L[1]*ne+B[1]*te,T[2]=C[2]*K+O[2]*re+L[2]*ne+B[2]*te,T},Ut.random=function(T,C){C=C||1;var O=2*e.RANDOM()*Math.PI,L=2*e.RANDOM()-1,B=Math.sqrt(1-L*L)*C;return T[0]=Math.cos(O)*B,T[1]=Math.sin(O)*B,T[2]=L*C,T},Ut.transformMat4=function(T,C,O){var L=C[0],B=C[1],j=C[2],z=O[3]*L+O[7]*B+O[11]*j+O[15];return T[0]=(O[0]*L+O[4]*B+O[8]*j+O[12])/(z=z||1),T[1]=(O[1]*L+O[5]*B+O[9]*j+O[13])/z,T[2]=(O[2]*L+O[6]*B+O[10]*j+O[14])/z,T},Ut.transformMat3=function(T,C,O){var L=C[0],B=C[1],j=C[2];return T[0]=L*O[0]+B*O[3]+j*O[6],T[1]=L*O[1]+B*O[4]+j*O[7],T[2]=L*O[2]+B*O[5]+j*O[8],T},Ut.transformQuat=function(T,C,O){var L=O[0],B=O[1],j=O[2],z=C[0],U=C[1],q=C[2],K=B*q-j*U,re=j*z-L*q,ne=L*U-B*z,te=B*ne-j*re,pe=j*K-L*ne,ie=L*re-B*K,me=2*O[3];return re*=me,ne*=me,pe*=2,ie*=2,T[0]=z+(K*=me)+(te*=2),T[1]=U+re+pe,T[2]=q+ne+ie,T},Ut.rotateX=function(T,C,O,L){var B=[],j=[];return B[0]=C[0]-O[0],B[1]=C[1]-O[1],B[2]=C[2]-O[2],j[0]=B[0],j[1]=B[1]*Math.cos(L)-B[2]*Math.sin(L),j[2]=B[1]*Math.sin(L)+B[2]*Math.cos(L),T[0]=j[0]+O[0],T[1]=j[1]+O[1],T[2]=j[2]+O[2],T},Ut.rotateY=function(T,C,O,L){var B=[],j=[];return B[0]=C[0]-O[0],B[1]=C[1]-O[1],B[2]=C[2]-O[2],j[0]=B[2]*Math.sin(L)+B[0]*Math.cos(L),j[1]=B[1],j[2]=B[2]*Math.cos(L)-B[0]*Math.sin(L),T[0]=j[0]+O[0],T[1]=j[1]+O[1],T[2]=j[2]+O[2],T},Ut.rotateZ=function(T,C,O,L){var B=[],j=[];return B[0]=C[0]-O[0],B[1]=C[1]-O[1],B[2]=C[2]-O[2],j[0]=B[0]*Math.cos(L)-B[1]*Math.sin(L),j[1]=B[0]*Math.sin(L)+B[1]*Math.cos(L),j[2]=B[2],T[0]=j[0]+O[0],T[1]=j[1]+O[1],T[2]=j[2]+O[2],T},Ut.angle=function(T,C){var O=T[0],L=T[1],B=T[2],j=C[0],z=C[1],U=C[2],q=Math.sqrt(O*O+L*L+B*B)*Math.sqrt(j*j+z*z+U*U),K=q&&E(T,C)/q;return Math.acos(Math.min(Math.max(K,-1),1))},Ut.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T},Ut.str=function(T){return"vec3("+T[0]+", "+T[1]+", "+T[2]+")"},Ut.exactEquals=function(T,C){return T[0]===C[0]&&T[1]===C[1]&&T[2]===C[2]},Ut.equals=function(T,C){var O=T[0],L=T[1],B=T[2],j=C[0],z=C[1],U=C[2];return Math.abs(O-j)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(j))&&Math.abs(L-z)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(z))&&Math.abs(B-U)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(U))},Ut.forEach=Ut.sqrLen=Ut.len=Ut.sqrDist=Ut.dist=Ut.div=Ut.mul=Ut.sub=void 0;var e=function(T,C){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var O=r(void 0);if(O&&O.has(T))return O.get(T);var L={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in T)if(j!=="default"&&Object.prototype.hasOwnProperty.call(T,j)){var z=B?Object.getOwnPropertyDescriptor(T,j):null;z&&(z.get||z.set)?Object.defineProperty(L,j,z):L[j]=T[j]}return L.default=T,O&&O.set(T,L),L}(Te());function r(T){if(typeof WeakMap!="function")return null;var C=new WeakMap,O=new WeakMap;return(r=function(L){return L?O:C})(T)}function a(){var T=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0),T}function f(T){return Math.hypot(T[0],T[1],T[2])}function c(T,C,O){return T[0]=C[0]-O[0],T[1]=C[1]-O[1],T[2]=C[2]-O[2],T}function p(T,C,O){return T[0]=C[0]*O[0],T[1]=C[1]*O[1],T[2]=C[2]*O[2],T}function v(T,C,O){return T[0]=C[0]/O[0],T[1]=C[1]/O[1],T[2]=C[2]/O[2],T}function w(T,C){return Math.hypot(C[0]-T[0],C[1]-T[1],C[2]-T[2])}function M(T,C){var O=C[0]-T[0],L=C[1]-T[1],B=C[2]-T[2];return O*O+L*L+B*B}function _(T){var C=T[0],O=T[1],L=T[2];return C*C+O*O+L*L}function E(T,C){return T[0]*C[0]+T[1]*C[1]+T[2]*C[2]}Ut.sub=c,Ut.mul=p,Ut.div=v,Ut.dist=w,Ut.sqrDist=M,Ut.len=f,Ut.sqrLen=_;var D,b=(D=a(),function(T,C,O,L,B,j){var z,U;for(C||(C=3),O||(O=0),U=L?Math.min(L*C+O,T.length):T.length,z=O;z<U;z+=C)D[0]=T[z],D[1]=T[z+1],D[2]=T[z+2],B(D,D,j),T[z]=D[0],T[z+1]=D[1],T[z+2]=D[2];return T});return Ut.forEach=b,Ut}var Ya,Fu,Xt={};function gi(){if(Ya)return Xt;function o(b){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},o(b)}Ya=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.create=a,Xt.clone=function(b){var T=new e.ARRAY_TYPE(4);return T[0]=b[0],T[1]=b[1],T[2]=b[2],T[3]=b[3],T},Xt.fromValues=function(b,T,C,O){var L=new e.ARRAY_TYPE(4);return L[0]=b,L[1]=T,L[2]=C,L[3]=O,L},Xt.copy=function(b,T){return b[0]=T[0],b[1]=T[1],b[2]=T[2],b[3]=T[3],b},Xt.set=function(b,T,C,O,L){return b[0]=T,b[1]=C,b[2]=O,b[3]=L,b},Xt.add=function(b,T,C){return b[0]=T[0]+C[0],b[1]=T[1]+C[1],b[2]=T[2]+C[2],b[3]=T[3]+C[3],b},Xt.subtract=f,Xt.multiply=c,Xt.divide=p,Xt.ceil=function(b,T){return b[0]=Math.ceil(T[0]),b[1]=Math.ceil(T[1]),b[2]=Math.ceil(T[2]),b[3]=Math.ceil(T[3]),b},Xt.floor=function(b,T){return b[0]=Math.floor(T[0]),b[1]=Math.floor(T[1]),b[2]=Math.floor(T[2]),b[3]=Math.floor(T[3]),b},Xt.min=function(b,T,C){return b[0]=Math.min(T[0],C[0]),b[1]=Math.min(T[1],C[1]),b[2]=Math.min(T[2],C[2]),b[3]=Math.min(T[3],C[3]),b},Xt.max=function(b,T,C){return b[0]=Math.max(T[0],C[0]),b[1]=Math.max(T[1],C[1]),b[2]=Math.max(T[2],C[2]),b[3]=Math.max(T[3],C[3]),b},Xt.round=function(b,T){return b[0]=Math.round(T[0]),b[1]=Math.round(T[1]),b[2]=Math.round(T[2]),b[3]=Math.round(T[3]),b},Xt.scale=function(b,T,C){return b[0]=T[0]*C,b[1]=T[1]*C,b[2]=T[2]*C,b[3]=T[3]*C,b},Xt.scaleAndAdd=function(b,T,C,O){return b[0]=T[0]+C[0]*O,b[1]=T[1]+C[1]*O,b[2]=T[2]+C[2]*O,b[3]=T[3]+C[3]*O,b},Xt.distance=v,Xt.squaredDistance=w,Xt.length=M,Xt.squaredLength=_,Xt.negate=function(b,T){return b[0]=-T[0],b[1]=-T[1],b[2]=-T[2],b[3]=-T[3],b},Xt.inverse=function(b,T){return b[0]=1/T[0],b[1]=1/T[1],b[2]=1/T[2],b[3]=1/T[3],b},Xt.normalize=function(b,T){var C=T[0],O=T[1],L=T[2],B=T[3],j=C*C+O*O+L*L+B*B;return j>0&&(j=1/Math.sqrt(j)),b[0]=C*j,b[1]=O*j,b[2]=L*j,b[3]=B*j,b},Xt.dot=function(b,T){return b[0]*T[0]+b[1]*T[1]+b[2]*T[2]+b[3]*T[3]},Xt.cross=function(b,T,C,O){var L=C[0]*O[1]-C[1]*O[0],B=C[0]*O[2]-C[2]*O[0],j=C[0]*O[3]-C[3]*O[0],z=C[1]*O[2]-C[2]*O[1],U=C[1]*O[3]-C[3]*O[1],q=C[2]*O[3]-C[3]*O[2],K=T[0],re=T[1],ne=T[2],te=T[3];return b[0]=re*q-ne*U+te*z,b[1]=-K*q+ne*j-te*B,b[2]=K*U-re*j+te*L,b[3]=-K*z+re*B-ne*L,b},Xt.lerp=function(b,T,C,O){var L=T[0],B=T[1],j=T[2],z=T[3];return b[0]=L+O*(C[0]-L),b[1]=B+O*(C[1]-B),b[2]=j+O*(C[2]-j),b[3]=z+O*(C[3]-z),b},Xt.random=function(b,T){var C,O,L,B,j,z;T=T||1;do j=(C=2*e.RANDOM()-1)*C+(O=2*e.RANDOM()-1)*O;while(j>=1);do z=(L=2*e.RANDOM()-1)*L+(B=2*e.RANDOM()-1)*B;while(z>=1);var U=Math.sqrt((1-j)/z);return b[0]=T*C,b[1]=T*O,b[2]=T*L*U,b[3]=T*B*U,b},Xt.transformMat4=function(b,T,C){var O=T[0],L=T[1],B=T[2],j=T[3];return b[0]=C[0]*O+C[4]*L+C[8]*B+C[12]*j,b[1]=C[1]*O+C[5]*L+C[9]*B+C[13]*j,b[2]=C[2]*O+C[6]*L+C[10]*B+C[14]*j,b[3]=C[3]*O+C[7]*L+C[11]*B+C[15]*j,b},Xt.transformQuat=function(b,T,C){var O=T[0],L=T[1],B=T[2],j=C[0],z=C[1],U=C[2],q=C[3],K=q*O+z*B-U*L,re=q*L+U*O-j*B,ne=q*B+j*L-z*O,te=-j*O-z*L-U*B;return b[0]=K*q+te*-j+re*-U-ne*-z,b[1]=re*q+te*-z+ne*-j-K*-U,b[2]=ne*q+te*-U+K*-z-re*-j,b[3]=T[3],b},Xt.zero=function(b){return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b},Xt.str=function(b){return"vec4("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")"},Xt.exactEquals=function(b,T){return b[0]===T[0]&&b[1]===T[1]&&b[2]===T[2]&&b[3]===T[3]},Xt.equals=function(b,T){var C=b[0],O=b[1],L=b[2],B=b[3],j=T[0],z=T[1],U=T[2],q=T[3];return Math.abs(C-j)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(j))&&Math.abs(O-z)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(z))&&Math.abs(L-U)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(U))&&Math.abs(B-q)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(q))},Xt.forEach=Xt.sqrLen=Xt.len=Xt.sqrDist=Xt.dist=Xt.div=Xt.mul=Xt.sub=void 0;var e=function(b,T){if(b&&b.__esModule)return b;if(b===null||o(b)!=="object"&&typeof b!="function")return{default:b};var C=r(void 0);if(C&&C.has(b))return C.get(b);var O={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in b)if(B!=="default"&&Object.prototype.hasOwnProperty.call(b,B)){var j=L?Object.getOwnPropertyDescriptor(b,B):null;j&&(j.get||j.set)?Object.defineProperty(O,B,j):O[B]=b[B]}return O.default=b,C&&C.set(b,O),O}(Te());function r(b){if(typeof WeakMap!="function")return null;var T=new WeakMap,C=new WeakMap;return(r=function(O){return O?C:T})(b)}function a(){var b=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0,b[3]=0),b}function f(b,T,C){return b[0]=T[0]-C[0],b[1]=T[1]-C[1],b[2]=T[2]-C[2],b[3]=T[3]-C[3],b}function c(b,T,C){return b[0]=T[0]*C[0],b[1]=T[1]*C[1],b[2]=T[2]*C[2],b[3]=T[3]*C[3],b}function p(b,T,C){return b[0]=T[0]/C[0],b[1]=T[1]/C[1],b[2]=T[2]/C[2],b[3]=T[3]/C[3],b}function v(b,T){return Math.hypot(T[0]-b[0],T[1]-b[1],T[2]-b[2],T[3]-b[3])}function w(b,T){var C=T[0]-b[0],O=T[1]-b[1],L=T[2]-b[2],B=T[3]-b[3];return C*C+O*O+L*L+B*B}function M(b){return Math.hypot(b[0],b[1],b[2],b[3])}function _(b){var T=b[0],C=b[1],O=b[2],L=b[3];return T*T+C*C+O*O+L*L}Xt.sub=f,Xt.mul=c,Xt.div=p,Xt.dist=v,Xt.sqrDist=w,Xt.len=M,Xt.sqrLen=_;var E,D=(E=a(),function(b,T,C,O,L,B){var j,z;for(T||(T=4),C||(C=0),z=O?Math.min(O*T+C,b.length):b.length,j=C;j<z;j+=T)E[0]=b[j],E[1]=b[j+1],E[2]=b[j+2],E[3]=b[j+3],L(E,E,B),b[j]=E[0],b[j+1]=E[1],b[j+2]=E[2],b[j+3]=E[3];return b});return Xt.forEach=D,Xt}function Qo(){if(Fu)return Vt;function o(ie){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(me){return typeof me}:function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me},o(ie)}Fu=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.create=v,Vt.identity=function(ie){return ie[0]=0,ie[1]=0,ie[2]=0,ie[3]=1,ie},Vt.setAxisAngle=w,Vt.getAxisAngle=function(ie,me){var ye=2*Math.acos(me[3]),_e=Math.sin(ye/2);return _e>e.EPSILON?(ie[0]=me[0]/_e,ie[1]=me[1]/_e,ie[2]=me[2]/_e):(ie[0]=1,ie[1]=0,ie[2]=0),ye},Vt.getAngle=function(ie,me){var ye=C(ie,me);return Math.acos(2*ye*ye-1)},Vt.multiply=M,Vt.rotateX=function(ie,me,ye){ye*=.5;var _e=me[0],be=me[1],Se=me[2],Ae=me[3],Ie=Math.sin(ye),$e=Math.cos(ye);return ie[0]=_e*$e+Ae*Ie,ie[1]=be*$e+Se*Ie,ie[2]=Se*$e-be*Ie,ie[3]=Ae*$e-_e*Ie,ie},Vt.rotateY=function(ie,me,ye){ye*=.5;var _e=me[0],be=me[1],Se=me[2],Ae=me[3],Ie=Math.sin(ye),$e=Math.cos(ye);return ie[0]=_e*$e-Se*Ie,ie[1]=be*$e+Ae*Ie,ie[2]=Se*$e+_e*Ie,ie[3]=Ae*$e-be*Ie,ie},Vt.rotateZ=function(ie,me,ye){ye*=.5;var _e=me[0],be=me[1],Se=me[2],Ae=me[3],Ie=Math.sin(ye),$e=Math.cos(ye);return ie[0]=_e*$e+be*Ie,ie[1]=be*$e-_e*Ie,ie[2]=Se*$e+Ae*Ie,ie[3]=Ae*$e-Se*Ie,ie},Vt.calculateW=function(ie,me){var ye=me[0],_e=me[1],be=me[2];return ie[0]=ye,ie[1]=_e,ie[2]=be,ie[3]=Math.sqrt(Math.abs(1-ye*ye-_e*_e-be*be)),ie},Vt.exp=_,Vt.ln=E,Vt.pow=function(ie,me,ye){return E(ie,me),T(ie,ie,ye),_(ie,ie),ie},Vt.slerp=D,Vt.random=function(ie){var me=e.RANDOM(),ye=e.RANDOM(),_e=e.RANDOM(),be=Math.sqrt(1-me),Se=Math.sqrt(me);return ie[0]=be*Math.sin(2*Math.PI*ye),ie[1]=be*Math.cos(2*Math.PI*ye),ie[2]=Se*Math.sin(2*Math.PI*_e),ie[3]=Se*Math.cos(2*Math.PI*_e),ie},Vt.invert=function(ie,me){var ye=me[0],_e=me[1],be=me[2],Se=me[3],Ae=ye*ye+_e*_e+be*be+Se*Se,Ie=Ae?1/Ae:0;return ie[0]=-ye*Ie,ie[1]=-_e*Ie,ie[2]=-be*Ie,ie[3]=Se*Ie,ie},Vt.conjugate=function(ie,me){return ie[0]=-me[0],ie[1]=-me[1],ie[2]=-me[2],ie[3]=me[3],ie},Vt.fromMat3=b,Vt.fromEuler=function(ie,me,ye,_e){var be=.5*Math.PI/180;me*=be,ye*=be,_e*=be;var Se=Math.sin(me),Ae=Math.cos(me),Ie=Math.sin(ye),$e=Math.cos(ye),Ke=Math.sin(_e),Ue=Math.cos(_e);return ie[0]=Se*$e*Ue-Ae*Ie*Ke,ie[1]=Ae*Ie*Ue+Se*$e*Ke,ie[2]=Ae*$e*Ke-Se*Ie*Ue,ie[3]=Ae*$e*Ue+Se*Ie*Ke,ie},Vt.str=function(ie){return"quat("+ie[0]+", "+ie[1]+", "+ie[2]+", "+ie[3]+")"},Vt.setAxes=Vt.sqlerp=Vt.rotationTo=Vt.equals=Vt.exactEquals=Vt.normalize=Vt.sqrLen=Vt.squaredLength=Vt.len=Vt.length=Vt.lerp=Vt.dot=Vt.scale=Vt.mul=Vt.add=Vt.set=Vt.copy=Vt.fromValues=Vt.clone=void 0;var e=p(Te()),r=p(mi()),a=p(Xa()),f=p(gi());function c(ie){if(typeof WeakMap!="function")return null;var me=new WeakMap,ye=new WeakMap;return(c=function(_e){return _e?ye:me})(ie)}function p(ie,me){if(ie&&ie.__esModule)return ie;if(ie===null||o(ie)!=="object"&&typeof ie!="function")return{default:ie};var ye=c(me);if(ye&&ye.has(ie))return ye.get(ie);var _e={},be=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Se in ie)if(Se!=="default"&&Object.prototype.hasOwnProperty.call(ie,Se)){var Ae=be?Object.getOwnPropertyDescriptor(ie,Se):null;Ae&&(Ae.get||Ae.set)?Object.defineProperty(_e,Se,Ae):_e[Se]=ie[Se]}return _e.default=ie,ye&&ye.set(ie,_e),_e}function v(){var ie=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(ie[0]=0,ie[1]=0,ie[2]=0),ie[3]=1,ie}function w(ie,me,ye){ye*=.5;var _e=Math.sin(ye);return ie[0]=_e*me[0],ie[1]=_e*me[1],ie[2]=_e*me[2],ie[3]=Math.cos(ye),ie}function M(ie,me,ye){var _e=me[0],be=me[1],Se=me[2],Ae=me[3],Ie=ye[0],$e=ye[1],Ke=ye[2],Ue=ye[3];return ie[0]=_e*Ue+Ae*Ie+be*Ke-Se*$e,ie[1]=be*Ue+Ae*$e+Se*Ie-_e*Ke,ie[2]=Se*Ue+Ae*Ke+_e*$e-be*Ie,ie[3]=Ae*Ue-_e*Ie-be*$e-Se*Ke,ie}function _(ie,me){var ye=me[0],_e=me[1],be=me[2],Se=me[3],Ae=Math.sqrt(ye*ye+_e*_e+be*be),Ie=Math.exp(Se),$e=Ae>0?Ie*Math.sin(Ae)/Ae:0;return ie[0]=ye*$e,ie[1]=_e*$e,ie[2]=be*$e,ie[3]=Ie*Math.cos(Ae),ie}function E(ie,me){var ye=me[0],_e=me[1],be=me[2],Se=me[3],Ae=Math.sqrt(ye*ye+_e*_e+be*be),Ie=Ae>0?Math.atan2(Ae,Se)/Ae:0;return ie[0]=ye*Ie,ie[1]=_e*Ie,ie[2]=be*Ie,ie[3]=.5*Math.log(ye*ye+_e*_e+be*be+Se*Se),ie}function D(ie,me,ye,_e){var be,Se,Ae,Ie,$e,Ke=me[0],Ue=me[1],ut=me[2],lt=me[3],tt=ye[0],Je=ye[1],xt=ye[2],ht=ye[3];return(Se=Ke*tt+Ue*Je+ut*xt+lt*ht)<0&&(Se=-Se,tt=-tt,Je=-Je,xt=-xt,ht=-ht),1-Se>e.EPSILON?(be=Math.acos(Se),Ae=Math.sin(be),Ie=Math.sin((1-_e)*be)/Ae,$e=Math.sin(_e*be)/Ae):(Ie=1-_e,$e=_e),ie[0]=Ie*Ke+$e*tt,ie[1]=Ie*Ue+$e*Je,ie[2]=Ie*ut+$e*xt,ie[3]=Ie*lt+$e*ht,ie}function b(ie,me){var ye,_e=me[0]+me[4]+me[8];if(_e>0)ye=Math.sqrt(_e+1),ie[3]=.5*ye,ie[0]=(me[5]-me[7])*(ye=.5/ye),ie[1]=(me[6]-me[2])*ye,ie[2]=(me[1]-me[3])*ye;else{var be=0;me[4]>me[0]&&(be=1),me[8]>me[3*be+be]&&(be=2);var Se=(be+1)%3,Ae=(be+2)%3;ye=Math.sqrt(me[3*be+be]-me[3*Se+Se]-me[3*Ae+Ae]+1),ie[be]=.5*ye,ie[3]=(me[3*Se+Ae]-me[3*Ae+Se])*(ye=.5/ye),ie[Se]=(me[3*Se+be]+me[3*be+Se])*ye,ie[Ae]=(me[3*Ae+be]+me[3*be+Ae])*ye}return ie}Vt.clone=f.clone,Vt.fromValues=f.fromValues,Vt.copy=f.copy,Vt.set=f.set,Vt.add=f.add,Vt.mul=M;var T=f.scale;Vt.scale=T;var C=f.dot;Vt.dot=C,Vt.lerp=f.lerp;var O=f.length;Vt.length=O,Vt.len=O;var L=f.squaredLength;Vt.squaredLength=L,Vt.sqrLen=L;var B=f.normalize;Vt.normalize=B,Vt.exactEquals=f.exactEquals,Vt.equals=f.equals;var j,z,U,q=(j=a.create(),z=a.fromValues(1,0,0),U=a.fromValues(0,1,0),function(ie,me,ye){var _e=a.dot(me,ye);return _e<-.999999?(a.cross(j,z,me),a.len(j)<1e-6&&a.cross(j,U,me),a.normalize(j,j),w(ie,j,Math.PI),ie):_e>.999999?(ie[0]=0,ie[1]=0,ie[2]=0,ie[3]=1,ie):(a.cross(j,me,ye),ie[0]=j[0],ie[1]=j[1],ie[2]=j[2],ie[3]=1+_e,B(ie,ie))});Vt.rotationTo=q;var K,re,ne=(K=v(),re=v(),function(ie,me,ye,_e,be,Se){return D(K,me,be,Se),D(re,ye,_e,Se),D(ie,K,re,2*Se*(1-Se)),ie});Vt.sqlerp=ne;var te,pe=(te=r.create(),function(ie,me,ye,_e){return te[0]=ye[0],te[3]=ye[1],te[6]=ye[2],te[1]=_e[0],te[4]=_e[1],te[7]=_e[2],te[2]=-me[0],te[5]=-me[1],te[8]=-me[2],B(ie,b(ie,te))});return Vt.setAxes=pe,Vt}var Ka,nn={};function es(){if(Ka)return nn;function o(D){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},o(D)}Ka=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.create=function(){var D=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0,D[4]=0,D[5]=0,D[6]=0,D[7]=0),D[3]=1,D},nn.clone=function(D){var b=new e.ARRAY_TYPE(8);return b[0]=D[0],b[1]=D[1],b[2]=D[2],b[3]=D[3],b[4]=D[4],b[5]=D[5],b[6]=D[6],b[7]=D[7],b},nn.fromValues=function(D,b,T,C,O,L,B,j){var z=new e.ARRAY_TYPE(8);return z[0]=D,z[1]=b,z[2]=T,z[3]=C,z[4]=O,z[5]=L,z[6]=B,z[7]=j,z},nn.fromRotationTranslationValues=function(D,b,T,C,O,L,B){var j=new e.ARRAY_TYPE(8);j[0]=D,j[1]=b,j[2]=T,j[3]=C;var z=.5*O,U=.5*L,q=.5*B;return j[4]=z*C+U*T-q*b,j[5]=U*C+q*D-z*T,j[6]=q*C+z*b-U*D,j[7]=-z*D-U*b-q*T,j},nn.fromRotationTranslation=p,nn.fromTranslation=function(D,b){return D[0]=0,D[1]=0,D[2]=0,D[3]=1,D[4]=.5*b[0],D[5]=.5*b[1],D[6]=.5*b[2],D[7]=0,D},nn.fromRotation=function(D,b){return D[0]=b[0],D[1]=b[1],D[2]=b[2],D[3]=b[3],D[4]=0,D[5]=0,D[6]=0,D[7]=0,D},nn.fromMat4=function(D,b){var T=r.create();a.getRotation(T,b);var C=new e.ARRAY_TYPE(3);return a.getTranslation(C,b),p(D,T,C),D},nn.copy=v,nn.identity=function(D){return D[0]=0,D[1]=0,D[2]=0,D[3]=1,D[4]=0,D[5]=0,D[6]=0,D[7]=0,D},nn.set=function(D,b,T,C,O,L,B,j,z){return D[0]=b,D[1]=T,D[2]=C,D[3]=O,D[4]=L,D[5]=B,D[6]=j,D[7]=z,D},nn.getDual=function(D,b){return D[0]=b[4],D[1]=b[5],D[2]=b[6],D[3]=b[7],D},nn.setDual=function(D,b){return D[4]=b[0],D[5]=b[1],D[6]=b[2],D[7]=b[3],D},nn.getTranslation=function(D,b){var T=b[4],C=b[5],O=b[6],L=b[7],B=-b[0],j=-b[1],z=-b[2],U=b[3];return D[0]=2*(T*U+L*B+C*z-O*j),D[1]=2*(C*U+L*j+O*B-T*z),D[2]=2*(O*U+L*z+T*j-C*B),D},nn.translate=function(D,b,T){var C=b[0],O=b[1],L=b[2],B=b[3],j=.5*T[0],z=.5*T[1],U=.5*T[2],q=b[4],K=b[5],re=b[6],ne=b[7];return D[0]=C,D[1]=O,D[2]=L,D[3]=B,D[4]=B*j+O*U-L*z+q,D[5]=B*z+L*j-C*U+K,D[6]=B*U+C*z-O*j+re,D[7]=-C*j-O*z-L*U+ne,D},nn.rotateX=function(D,b,T){var C=-b[0],O=-b[1],L=-b[2],B=b[3],j=b[4],z=b[5],U=b[6],q=b[7],K=j*B+q*C+z*L-U*O,re=z*B+q*O+U*C-j*L,ne=U*B+q*L+j*O-z*C,te=q*B-j*C-z*O-U*L;return r.rotateX(D,b,T),D[4]=K*(B=D[3])+te*(C=D[0])+re*(L=D[2])-ne*(O=D[1]),D[5]=re*B+te*O+ne*C-K*L,D[6]=ne*B+te*L+K*O-re*C,D[7]=te*B-K*C-re*O-ne*L,D},nn.rotateY=function(D,b,T){var C=-b[0],O=-b[1],L=-b[2],B=b[3],j=b[4],z=b[5],U=b[6],q=b[7],K=j*B+q*C+z*L-U*O,re=z*B+q*O+U*C-j*L,ne=U*B+q*L+j*O-z*C,te=q*B-j*C-z*O-U*L;return r.rotateY(D,b,T),D[4]=K*(B=D[3])+te*(C=D[0])+re*(L=D[2])-ne*(O=D[1]),D[5]=re*B+te*O+ne*C-K*L,D[6]=ne*B+te*L+K*O-re*C,D[7]=te*B-K*C-re*O-ne*L,D},nn.rotateZ=function(D,b,T){var C=-b[0],O=-b[1],L=-b[2],B=b[3],j=b[4],z=b[5],U=b[6],q=b[7],K=j*B+q*C+z*L-U*O,re=z*B+q*O+U*C-j*L,ne=U*B+q*L+j*O-z*C,te=q*B-j*C-z*O-U*L;return r.rotateZ(D,b,T),D[4]=K*(B=D[3])+te*(C=D[0])+re*(L=D[2])-ne*(O=D[1]),D[5]=re*B+te*O+ne*C-K*L,D[6]=ne*B+te*L+K*O-re*C,D[7]=te*B-K*C-re*O-ne*L,D},nn.rotateByQuatAppend=function(D,b,T){var C=T[0],O=T[1],L=T[2],B=T[3],j=b[0],z=b[1],U=b[2],q=b[3];return D[0]=j*B+q*C+z*L-U*O,D[1]=z*B+q*O+U*C-j*L,D[2]=U*B+q*L+j*O-z*C,D[3]=q*B-j*C-z*O-U*L,D[4]=(j=b[4])*B+(q=b[7])*C+(z=b[5])*L-(U=b[6])*O,D[5]=z*B+q*O+U*C-j*L,D[6]=U*B+q*L+j*O-z*C,D[7]=q*B-j*C-z*O-U*L,D},nn.rotateByQuatPrepend=function(D,b,T){var C=b[0],O=b[1],L=b[2],B=b[3],j=T[0],z=T[1],U=T[2],q=T[3];return D[0]=C*q+B*j+O*U-L*z,D[1]=O*q+B*z+L*j-C*U,D[2]=L*q+B*U+C*z-O*j,D[3]=B*q-C*j-O*z-L*U,D[4]=C*(q=T[7])+B*(j=T[4])+O*(U=T[6])-L*(z=T[5]),D[5]=O*q+B*z+L*j-C*U,D[6]=L*q+B*U+C*z-O*j,D[7]=B*q-C*j-O*z-L*U,D},nn.rotateAroundAxis=function(D,b,T,C){if(Math.abs(C)<e.EPSILON)return v(D,b);var O=Math.hypot(T[0],T[1],T[2]);C*=.5;var L=Math.sin(C),B=L*T[0]/O,j=L*T[1]/O,z=L*T[2]/O,U=Math.cos(C),q=b[0],K=b[1],re=b[2],ne=b[3];D[0]=q*U+ne*B+K*z-re*j,D[1]=K*U+ne*j+re*B-q*z,D[2]=re*U+ne*z+q*j-K*B,D[3]=ne*U-q*B-K*j-re*z;var te=b[4],pe=b[5],ie=b[6],me=b[7];return D[4]=te*U+me*B+pe*z-ie*j,D[5]=pe*U+me*j+ie*B-te*z,D[6]=ie*U+me*z+te*j-pe*B,D[7]=me*U-te*B-pe*j-ie*z,D},nn.add=function(D,b,T){return D[0]=b[0]+T[0],D[1]=b[1]+T[1],D[2]=b[2]+T[2],D[3]=b[3]+T[3],D[4]=b[4]+T[4],D[5]=b[5]+T[5],D[6]=b[6]+T[6],D[7]=b[7]+T[7],D},nn.multiply=w,nn.scale=function(D,b,T){return D[0]=b[0]*T,D[1]=b[1]*T,D[2]=b[2]*T,D[3]=b[3]*T,D[4]=b[4]*T,D[5]=b[5]*T,D[6]=b[6]*T,D[7]=b[7]*T,D},nn.lerp=function(D,b,T,C){var O=1-C;return M(b,T)<0&&(C=-C),D[0]=b[0]*O+T[0]*C,D[1]=b[1]*O+T[1]*C,D[2]=b[2]*O+T[2]*C,D[3]=b[3]*O+T[3]*C,D[4]=b[4]*O+T[4]*C,D[5]=b[5]*O+T[5]*C,D[6]=b[6]*O+T[6]*C,D[7]=b[7]*O+T[7]*C,D},nn.invert=function(D,b){var T=E(b);return D[0]=-b[0]/T,D[1]=-b[1]/T,D[2]=-b[2]/T,D[3]=b[3]/T,D[4]=-b[4]/T,D[5]=-b[5]/T,D[6]=-b[6]/T,D[7]=b[7]/T,D},nn.conjugate=function(D,b){return D[0]=-b[0],D[1]=-b[1],D[2]=-b[2],D[3]=b[3],D[4]=-b[4],D[5]=-b[5],D[6]=-b[6],D[7]=b[7],D},nn.normalize=function(D,b){var T=E(b);if(T>0){T=Math.sqrt(T);var C=b[0]/T,O=b[1]/T,L=b[2]/T,B=b[3]/T,j=b[4],z=b[5],U=b[6],q=b[7],K=C*j+O*z+L*U+B*q;D[0]=C,D[1]=O,D[2]=L,D[3]=B,D[4]=(j-C*K)/T,D[5]=(z-O*K)/T,D[6]=(U-L*K)/T,D[7]=(q-B*K)/T}return D},nn.str=function(D){return"quat2("+D[0]+", "+D[1]+", "+D[2]+", "+D[3]+", "+D[4]+", "+D[5]+", "+D[6]+", "+D[7]+")"},nn.exactEquals=function(D,b){return D[0]===b[0]&&D[1]===b[1]&&D[2]===b[2]&&D[3]===b[3]&&D[4]===b[4]&&D[5]===b[5]&&D[6]===b[6]&&D[7]===b[7]},nn.equals=function(D,b){var T=D[0],C=D[1],O=D[2],L=D[3],B=D[4],j=D[5],z=D[6],U=D[7],q=b[0],K=b[1],re=b[2],ne=b[3],te=b[4],pe=b[5],ie=b[6],me=b[7];return Math.abs(T-q)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(q))&&Math.abs(C-K)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(K))&&Math.abs(O-re)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(re))&&Math.abs(L-ne)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(ne))&&Math.abs(B-te)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(te))&&Math.abs(j-pe)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(pe))&&Math.abs(z-ie)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(ie))&&Math.abs(U-me)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(me))},nn.sqrLen=nn.squaredLength=nn.len=nn.length=nn.dot=nn.mul=nn.setReal=nn.getReal=void 0;var e=c(Te()),r=c(Qo()),a=c(To());function f(D){if(typeof WeakMap!="function")return null;var b=new WeakMap,T=new WeakMap;return(f=function(C){return C?T:b})(D)}function c(D,b){if(D&&D.__esModule)return D;if(D===null||o(D)!=="object"&&typeof D!="function")return{default:D};var T=f(b);if(T&&T.has(D))return T.get(D);var C={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var L in D)if(L!=="default"&&Object.prototype.hasOwnProperty.call(D,L)){var B=O?Object.getOwnPropertyDescriptor(D,L):null;B&&(B.get||B.set)?Object.defineProperty(C,L,B):C[L]=D[L]}return C.default=D,T&&T.set(D,C),C}function p(D,b,T){var C=.5*T[0],O=.5*T[1],L=.5*T[2],B=b[0],j=b[1],z=b[2],U=b[3];return D[0]=B,D[1]=j,D[2]=z,D[3]=U,D[4]=C*U+O*z-L*j,D[5]=O*U+L*B-C*z,D[6]=L*U+C*j-O*B,D[7]=-C*B-O*j-L*z,D}function v(D,b){return D[0]=b[0],D[1]=b[1],D[2]=b[2],D[3]=b[3],D[4]=b[4],D[5]=b[5],D[6]=b[6],D[7]=b[7],D}function w(D,b,T){var C=b[0],O=b[1],L=b[2],B=b[3],j=T[4],z=T[5],U=T[6],q=T[7],K=b[4],re=b[5],ne=b[6],te=b[7],pe=T[0],ie=T[1],me=T[2],ye=T[3];return D[0]=C*ye+B*pe+O*me-L*ie,D[1]=O*ye+B*ie+L*pe-C*me,D[2]=L*ye+B*me+C*ie-O*pe,D[3]=B*ye-C*pe-O*ie-L*me,D[4]=C*q+B*j+O*U-L*z+K*ye+te*pe+re*me-ne*ie,D[5]=O*q+B*z+L*j-C*U+re*ye+te*ie+ne*pe-K*me,D[6]=L*q+B*U+C*z-O*j+ne*ye+te*me+K*ie-re*pe,D[7]=B*q-C*j-O*z-L*U+te*ye-K*pe-re*ie-ne*me,D}nn.getReal=r.copy,nn.setReal=r.copy,nn.mul=w;var M=r.dot;nn.dot=M;var _=r.length;nn.length=_,nn.len=_;var E=r.squaredLength;return nn.squaredLength=E,nn.sqrLen=E,nn}var Ja,Rs,Gt={};function qd(){if(Ja)return Gt;function o(b){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},o(b)}Ja=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=a,Gt.clone=function(b){var T=new e.ARRAY_TYPE(2);return T[0]=b[0],T[1]=b[1],T},Gt.fromValues=function(b,T){var C=new e.ARRAY_TYPE(2);return C[0]=b,C[1]=T,C},Gt.copy=function(b,T){return b[0]=T[0],b[1]=T[1],b},Gt.set=function(b,T,C){return b[0]=T,b[1]=C,b},Gt.add=function(b,T,C){return b[0]=T[0]+C[0],b[1]=T[1]+C[1],b},Gt.subtract=f,Gt.multiply=c,Gt.divide=p,Gt.ceil=function(b,T){return b[0]=Math.ceil(T[0]),b[1]=Math.ceil(T[1]),b},Gt.floor=function(b,T){return b[0]=Math.floor(T[0]),b[1]=Math.floor(T[1]),b},Gt.min=function(b,T,C){return b[0]=Math.min(T[0],C[0]),b[1]=Math.min(T[1],C[1]),b},Gt.max=function(b,T,C){return b[0]=Math.max(T[0],C[0]),b[1]=Math.max(T[1],C[1]),b},Gt.round=function(b,T){return b[0]=Math.round(T[0]),b[1]=Math.round(T[1]),b},Gt.scale=function(b,T,C){return b[0]=T[0]*C,b[1]=T[1]*C,b},Gt.scaleAndAdd=function(b,T,C,O){return b[0]=T[0]+C[0]*O,b[1]=T[1]+C[1]*O,b},Gt.distance=v,Gt.squaredDistance=w,Gt.length=M,Gt.squaredLength=_,Gt.negate=function(b,T){return b[0]=-T[0],b[1]=-T[1],b},Gt.inverse=function(b,T){return b[0]=1/T[0],b[1]=1/T[1],b},Gt.normalize=function(b,T){var C=T[0],O=T[1],L=C*C+O*O;return L>0&&(L=1/Math.sqrt(L)),b[0]=T[0]*L,b[1]=T[1]*L,b},Gt.dot=function(b,T){return b[0]*T[0]+b[1]*T[1]},Gt.cross=function(b,T,C){var O=T[0]*C[1]-T[1]*C[0];return b[0]=b[1]=0,b[2]=O,b},Gt.lerp=function(b,T,C,O){var L=T[0],B=T[1];return b[0]=L+O*(C[0]-L),b[1]=B+O*(C[1]-B),b},Gt.random=function(b,T){T=T||1;var C=2*e.RANDOM()*Math.PI;return b[0]=Math.cos(C)*T,b[1]=Math.sin(C)*T,b},Gt.transformMat2=function(b,T,C){var O=T[0],L=T[1];return b[0]=C[0]*O+C[2]*L,b[1]=C[1]*O+C[3]*L,b},Gt.transformMat2d=function(b,T,C){var O=T[0],L=T[1];return b[0]=C[0]*O+C[2]*L+C[4],b[1]=C[1]*O+C[3]*L+C[5],b},Gt.transformMat3=function(b,T,C){var O=T[0],L=T[1];return b[0]=C[0]*O+C[3]*L+C[6],b[1]=C[1]*O+C[4]*L+C[7],b},Gt.transformMat4=function(b,T,C){var O=T[0],L=T[1];return b[0]=C[0]*O+C[4]*L+C[12],b[1]=C[1]*O+C[5]*L+C[13],b},Gt.rotate=function(b,T,C,O){var L=T[0]-C[0],B=T[1]-C[1],j=Math.sin(O),z=Math.cos(O);return b[0]=L*z-B*j+C[0],b[1]=L*j+B*z+C[1],b},Gt.angle=function(b,T){var C=b[0],O=b[1],L=T[0],B=T[1],j=Math.sqrt(C*C+O*O)*Math.sqrt(L*L+B*B);return Math.acos(Math.min(Math.max(j&&(C*L+O*B)/j,-1),1))},Gt.zero=function(b){return b[0]=0,b[1]=0,b},Gt.str=function(b){return"vec2("+b[0]+", "+b[1]+")"},Gt.exactEquals=function(b,T){return b[0]===T[0]&&b[1]===T[1]},Gt.equals=function(b,T){var C=b[0],O=b[1],L=T[0],B=T[1];return Math.abs(C-L)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(L))&&Math.abs(O-B)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(B))},Gt.forEach=Gt.sqrLen=Gt.sqrDist=Gt.dist=Gt.div=Gt.mul=Gt.sub=Gt.len=void 0;var e=function(b,T){if(b&&b.__esModule)return b;if(b===null||o(b)!=="object"&&typeof b!="function")return{default:b};var C=r(void 0);if(C&&C.has(b))return C.get(b);var O={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in b)if(B!=="default"&&Object.prototype.hasOwnProperty.call(b,B)){var j=L?Object.getOwnPropertyDescriptor(b,B):null;j&&(j.get||j.set)?Object.defineProperty(O,B,j):O[B]=b[B]}return O.default=b,C&&C.set(b,O),O}(Te());function r(b){if(typeof WeakMap!="function")return null;var T=new WeakMap,C=new WeakMap;return(r=function(O){return O?C:T})(b)}function a(){var b=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(b[0]=0,b[1]=0),b}function f(b,T,C){return b[0]=T[0]-C[0],b[1]=T[1]-C[1],b}function c(b,T,C){return b[0]=T[0]*C[0],b[1]=T[1]*C[1],b}function p(b,T,C){return b[0]=T[0]/C[0],b[1]=T[1]/C[1],b}function v(b,T){return Math.hypot(T[0]-b[0],T[1]-b[1])}function w(b,T){var C=T[0]-b[0],O=T[1]-b[1];return C*C+O*O}function M(b){return Math.hypot(b[0],b[1])}function _(b){var T=b[0],C=b[1];return T*T+C*C}Gt.len=M,Gt.sub=f,Gt.mul=c,Gt.div=p,Gt.dist=v,Gt.sqrDist=w,Gt.sqrLen=_;var E,D=(E=a(),function(b,T,C,O,L,B){var j,z;for(T||(T=2),C||(C=0),z=O?Math.min(O*T+C,b.length):b.length,j=C;j<z;j+=T)E[0]=b[j],E[1]=b[j+1],L(E,E,B),b[j]=E[0],b[j+1]=E[1];return b});return Gt.forEach=D,Gt}function Qa(){if(Rs)return $;function o(b){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},o(b)}Rs=1,Object.defineProperty($,"__esModule",{value:!0}),$.vec4=$.vec3=$.vec2=$.quat2=$.quat=$.mat4=$.mat3=$.mat2d=$.mat2=$.glMatrix=void 0;var e=D(Te());$.glMatrix=e;var r=D(ze());$.mat2=r;var a=D(Cn());$.mat2d=a;var f=D(mi());$.mat3=f;var c=D(To());$.mat4=c;var p=D(Qo());$.quat=p;var v=D(es());$.quat2=v;var w=D(qd());$.vec2=w;var M=D(Xa());$.vec3=M;var _=D(gi());function E(b){if(typeof WeakMap!="function")return null;var T=new WeakMap,C=new WeakMap;return(E=function(O){return O?C:T})(b)}function D(b,T){if(b&&b.__esModule)return b;if(b===null||o(b)!=="object"&&typeof b!="function")return{default:b};var C=E(T);if(C&&C.has(b))return C.get(b);var O={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in b)if(B!=="default"&&Object.prototype.hasOwnProperty.call(b,B)){var j=L?Object.getOwnPropertyDescriptor(b,B):null;j&&(j.get||j.set)?Object.defineProperty(O,B,j):O[B]=b[B]}return O.default=b,C&&C.set(b,O),O}return $.vec4=_,$}var el,tl,Io,nl,Ee=Qa(),rl=function(){if(tl)return el;function o(e,r,a,f){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=a,this.p2y=f}return tl=1,el=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,f=0;f<8;f++){var c=this.sampleCurveX(a)-e;if(Math.abs(c)<r)return a;var p=this.sampleCurveDerivativeX(a);if(Math.abs(p)<1e-6)break;a-=c/p}var v=0,w=1;for(a=e,f=0;f<20&&(c=this.sampleCurveX(a),!(Math.abs(c-e)<r));f++)e>c?v=a:w=a,a=.5*(w-v)+v;return a},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},el}(),il=F(rl);function ra(){if(nl)return Io;function o(e,r){this.x=e,this.y=r}return nl=1,Io=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,a=e.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),a=Math.sin(e),f=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=f,this},_rotateAround:function(e,r){var a=Math.cos(e),f=Math.sin(e),c=r.y+f*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-f*(this.y-r.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e},Io}var at=F(ra());function si(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let r=0;r<o.length;r++)if(!si(o[r],e[r]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(let r in o)if(!si(o[r],e[r]))return!1;return!0}return o===e}let _i=Math.PI/180,ol=180/Math.PI;function ln(o){return o*_i}function Fr(o){return o*ol}let Zi=[[0,0],[1,0],[1,1],[0,1]];function Ps(o){if(o<=0)return 0;if(o>=1)return 1;let e=o*o,r=e*o;return 4*(o<.5?r:3*(o-e)+r-.75)}function ia(o,e,r,a){let f=new il(o,e,r,a);return function(c){return f.solve(c)}}let oa=ia(.25,.1,.25,1);function Yt(o,e,r){return Math.min(r,Math.max(e,o))}function So(o,e,r){return(r=Yt((r-o)/(e-o),0,1))*r*(3-2*r)}function ao(o,e,r){let a=r-e,f=((o-e)%a+a)%a+e;return f===e?r:f}function Os(o,e,r){if(!o.length)return r(null,[]);let a=o.length,f=new Array(o.length),c=null;o.forEach((p,v)=>{e(p,(w,M)=>{w&&(c=w),f[v]=M,--a==0&&r(c,f)})})}function ai(o,...e){for(let r of e)for(let a in r)o[a]=r[a];return o}let ts=1;function sa(){return ts++}function sl(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function al(o,e){o.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function yi(o,e){return o.indexOf(e,o.length-e.length)!==-1}function ll(o,e,r){let a={};for(let f in o)a[f]=e.call(this,o[f],f,o);return a}function cl(o,e,r){let a={};for(let f in o)e.call(this,o[f],f,o)&&(a[f]=o[f]);return a}function Ni(o){return Array.isArray(o)?o.map(Ni):typeof o=="object"&&o?ll(o,Ni):o}let aa={};function qt(o){aa[o]||(typeof console<"u"&&console.warn(o),aa[o]=!0)}function Do(o,e,r){return(r.y-o.y)*(e.x-o.x)>(e.y-o.y)*(r.x-o.x)}function Nu(o){let e=0;for(let r,a,f=0,c=o.length,p=c-1;f<c;p=f++)r=o[f],a=o[p],e+=(a.x-r.x)*(r.y+a.y);return e}function Mi([o,e,r]){let a=ln(e+90),f=ln(r);return{x:o*Math.cos(a)*Math.sin(f),y:o*Math.sin(a)*Math.sin(f),z:o*Math.cos(f),azimuthal:e,polar:r}}function ns(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ul(o){let e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,f,c)=>{let p=f||c;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){let r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let hl=null;function dl(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function zu(o,e,r,a){for(;e<r;){let f=e+r>>1;o[f]<a?e=f+1:r=f}return e}function fl(o,e,r,a){for(;e<r;){let f=e+r>>1;o[f]<=a?e=f+1:r=f}return e}function Bu(o){return o>0?1/(1.001-o):1+o}function Vu(o){return o>0?1-1/(1.001-o):-o}let Dr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Dr.API_URL)return null;try{let o=new URL(Dr.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function sc(o){return Dr.API_URL_REGEX.test(o)}function ju(o){return Dr.API_SPRITE_REGEX.test(o)}let ac,$r,Mo,Ne,W,J;function Q(){return ac==null&&(ac=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ac}let ue={now:()=>Ne!==void 0?Ne:performance.now(),setNow(o){Ne=o},restoreNow(){Ne=void 0},frame(o){let e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){let{width:r,height:a}=o;W||(W=document.createElement("canvas"));let f=W.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(r>W.width||a>W.height)&&(W.width=r,W.height=a),f.clearRect(-e,-e,r+2*e,a+2*e),f.drawImage(o,0,0,r,a),f.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:o=>($r||($r=document.createElement("a")),$r.href=o,$r.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Mo==null&&(Mo=window.matchMedia("(prefers-reduced-motion: reduce)")),Mo.matches)},hasCanvasFingerprintNoise(){if(J!==void 0)return J;if(!Q())return J=!1,!1;let o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0}),r=0;for(let f=0;f<o.width;++f)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(f,0,1,1);let a=e.getImageData(0,0,o.width,o.height);r=0;for(let f=0;f<a.data.length;++f)if(f%4!=3&&r++!==a.data[f])return J=!0,!0;return J=!1,!1}};function de(o,e){let r=o.indexOf("?");if(r<0)return`${o}?${new URLSearchParams(e).toString()}`;let a=new URLSearchParams(o.slice(r));for(let f in e)a.set(f,e[f]);return`${o.slice(0,r)}?${a.toString()}`}function ve(o,e={persistentParams:[]}){let r=o.indexOf("?");if(r<0)return o;let a=new URLSearchParams,f=new URLSearchParams(o.slice(r));for(let p of e.persistentParams){let v=f.get(p);v&&a.set(p,v)}let c=a.toString();return`${o.slice(0,r)}${c.length>0?`?${c}`:""}`}let Ce="mapbox-tiles",xe=500,Le=50,Oe=["language","worldview","jobid"],ke,Xe;function ot(){try{return caches}catch{}}function st(){let o=ot();o&&ke==null&&(ke=o.open(Ce))}let Tt=1/0,Mt={supported:!1,testSupport:function(o){!sn&&Dt&&(hn?pn(o):Ct=o)}},Ct,Dt,sn=!1,hn=!1,Kt=typeof self<"u"?self:{};function pn(o){let e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Dt),o.isContextLost())return;Mt.supported=!0}catch{}o.deleteTexture(e),sn=!0}Kt.document&&(Dt=Kt.document.createElement("img"),Dt.onload=function(){Ct&&pn(Ct),Ct=null,hn=!0},Dt.onerror=function(){sn=!0,Ct=null},Dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let _n={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(_n);class vr extends Error{constructor(e,r,a){r===401&&sc(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Co=ns()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Mr=function(o,e){if(!(/^file:/.test(r=o.url)||/^file:/.test(Co())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,f){let c=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Co(),referrerPolicy:a.referrerPolicy,signal:c.signal}),v=!1,w=!1,M=(_=p.url).indexOf("sku=")>0&&sc(_);var _;a.type==="json"&&p.headers.set("Accept","application/json");let E=(b,T,C)=>{if(w)return;if(b&&b.message!=="SecurityError"&&qt(b.toString()),T&&C)return D(T);let O=Date.now();fetch(p).then(L=>{if(L.ok){let B=M?L.clone():null;return D(L,B,O)}return f(new vr(L.statusText,L.status,a.url))}).catch(L=>{L.name!=="AbortError"&&f(new Error(`${L.message} ${a.url}`))})},D=(b,T,C)=>{(a.type==="arrayBuffer"?b.arrayBuffer():a.type==="json"?b.json():b.text()).then(O=>{w||(T&&C&&function(L,B,j){if(st(),ke==null)return;let z=ul(B.headers.get("Cache-Control")||"");if(z["no-store"])return;let U={status:B.status,statusText:B.statusText,headers:new Headers};B.headers.forEach((re,ne)=>U.headers.set(ne,re)),z["max-age"]&&U.headers.set("Expires",new Date(j+1e3*z["max-age"]).toUTCString());let q=U.headers.get("Expires");if(!q||new Date(q).getTime()-j<42e4)return;let K=ve(L.url,{persistentParams:Oe});if(B.status===206){let re=L.headers.get("Range");if(!re)return;U.status=200,K=de(K,{range:re})}(function(re,ne){if(Xe===void 0)try{new Response(new ReadableStream),Xe=!0}catch{Xe=!1}Xe?ne(re.body):re.blob().then(ne)})(B,re=>{let ne=new Response((te=B.status)!==200&&te!==404&&[101,103,204,205,304].includes(te)?null:re,U);var te;st(),ke?.then(pe=>pe.put(K,ne)).catch(pe=>qt(pe.message))})}(p,T,C),v=!0,f(null,O,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(O=>{w||f(new Error(O.message))})};return M?function(b,T){if(st(),ke==null)return T(null);ke.then(C=>{let O=ve(b.url,{persistentParams:Oe}),L=b.headers.get("Range");L&&(O=de(O,{range:L})),C.match(O).then(B=>{let j=function(z){if(!z)return!1;let U=new Date(z.headers.get("Expires")||0),q=ul(z.headers.get("Cache-Control")||"");return U>Date.now()&&!q["no-cache"]}(B);C.delete(O),j&&C.put(O,B.clone()),T(null,B,j)}).catch(T)}).catch(T)}(p,E):E(null,null),{cancel:()=>{w=!0,v||c.abort()}}}(o,e);if(ns()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var r;return function(a,f){let c=new XMLHttpRequest;c.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(let p in a.headers)c.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=a.credentials==="include",c.onerror=()=>{f(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let p=c.response;if(a.type==="json")try{p=JSON.parse(c.response)}catch(v){return f(v)}f(null,p,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else f(new vr(c.statusText,c.status,a.url))},c.send(a.body),{cancel:()=>c.abort()}}(o,e)},Ar=function(o,e){return Mr(ai(o,{type:"arrayBuffer"}),e)};function li(o){let e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}let lc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",rs,cc;rs=[],cc=0;let Wd=function(o,e){if(Mt.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),cc>=Dr.MAX_PARALLEL_IMAGE_REQUESTS){let c={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return rs.push(c),c}cc++;let r=!1,a=()=>{if(!r)for(r=!0,cc--;rs.length&&cc<Dr.MAX_PARALLEL_IMAGE_REQUESTS;){let c=rs.shift(),{requestParameters:p,callback:v,cancelled:w}=c;w||(c.cancel=Wd(p,v).cancel)}},f=Ar(o,(c,p,v,w)=>{a(),c?e(c):p&&(self.createImageBitmap?function(M,_){let E=new Blob([new Uint8Array(M)],{type:"image/png"});createImageBitmap(E).then(D=>{_(null,D)}).catch(D=>{_(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(M,_)=>e(M,_,v,w)):function(M,_){let E=new Image;E.onload=()=>{_(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=lc})},E.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let D=new Blob([new Uint8Array(M)],{type:"image/png"});E.src=M.byteLength?URL.createObjectURL(D):lc}(p,(M,_)=>e(M,_,v,w)))});return{cancel:()=>{f.cancel(),a()}}};var eg,Zd,Xd,ci={exports:{}},lo={exports:{}},is={exports:{}},Ao=function(){if(Xd)return ci.exports;Xd=1;var o=(eg||(eg=1,lo.exports=function(r,a){var f,c,p,v,w,M,_,E;for(c=r.length-(f=3&r.length),p=a,w=3432918353,M=461845907,E=0;E<c;)_=255&r.charCodeAt(E)|(255&r.charCodeAt(++E))<<8|(255&r.charCodeAt(++E))<<16|(255&r.charCodeAt(++E))<<24,++E,p=27492+(65535&(v=5*(65535&(p=(p^=_=(65535&(_=(_=(65535&_)*w+(((_>>>16)*w&65535)<<16)&4294967295)<<15|_>>>17))*M+(((_>>>16)*M&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(_=0,f){case 3:_^=(255&r.charCodeAt(E+2))<<16;case 2:_^=(255&r.charCodeAt(E+1))<<8;case 1:p^=_=(65535&(_=(_=(65535&(_^=255&r.charCodeAt(E)))*w+(((_>>>16)*w&65535)<<16)&4294967295)<<15|_>>>17))*M+(((_>>>16)*M&65535)<<16)&4294967295}return p^=r.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),lo.exports),e=(Zd||(Zd=1,is.exports=function(r,a){for(var f,c=r.length,p=a^c,v=0;c>=4;)f=1540483477*(65535&(f=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(f>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),c-=4,++v;switch(c){case 3:p^=(255&r.charCodeAt(v+2))<<16;case 2:p^=(255&r.charCodeAt(v+1))<<8;case 1:p=1540483477*(65535&(p^=255&r.charCodeAt(v)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),is.exports);return ci.exports=o,ci.exports.murmur3=o,ci.exports.murmur2=e,ci.exports}(),co=F(Ao);class Ro{constructor(e,...r){ai(this,r[0]||{}),this.type=e}}class Uu extends Ro{constructor(e,r={}){super("error",ai({error:e},r))}}function Yd(o,e,r){r[o]&&r[o].indexOf(e)!==-1||(r[o]=r[o]||[],r[o].push(e))}function Ls(o,e,r){if(r&&r[o]){let a=r[o].indexOf(e);a!==-1&&r[o].splice(a,1)}}class ks{on(e,r){return this._listeners=this._listeners||{},Yd(e,r,this._listeners),this}off(e,r){return Ls(e,r,this._listeners),Ls(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Yd(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){let a=typeof e=="string"?new Ro(e,r):e,f=a.type;if(this.listens(f)){a.target=this;let c=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(let w of c)w.call(this,a);let p=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(let w of p)Ls(f,w,this._oneTimeListeners),w.call(this,a);let v=this._eventedParent;v&&(ai(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(a))}else a instanceof Uu&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var tg,Kd={},Xi=function(){if(tg)return Kd;tg=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(c){return(c=Math.round(c))<0?0:c>255?255:c}function r(c){return e(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function a(c){return(p=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:p>1?1:p;var p}function f(c,p,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?c+(p-c)*v*6:2*v<1?p:3*v<2?c+(p-c)*(2/3-v)*6:c}try{Kd.parseCSSColor=function(c){var p,v=c.replace(/ /g,"").toLowerCase();if(v in o)return o[v].slice();if(v[0]==="#")return v.length===4?(p=parseInt(v.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:v.length===7&&(p=parseInt(v.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var w=v.indexOf("("),M=v.indexOf(")");if(w!==-1&&M+1===v.length){var _=v.substr(0,w),E=v.substr(w+1,M-(w+1)).split(","),D=1;switch(_){case"rgba":if(E.length!==4)return null;D=a(E.pop());case"rgb":return E.length!==3?null:[r(E[0]),r(E[1]),r(E[2]),D];case"hsla":if(E.length!==4)return null;D=a(E.pop());case"hsl":if(E.length!==3)return null;var b=(parseFloat(E[0])%360+360)%360/360,T=a(E[1]),C=a(E[2]),O=C<=.5?C*(T+1):C+T-C*T,L=2*C-O;return[e(255*f(L,O,b+1/3)),e(255*f(L,O,b)),e(255*f(L,O,b-1/3)),D];default:return null}}return null}}catch{}return Kd}();class vn{constructor(e,r,a,f=1){this.r=e,this.g=r,this.b=a,this.a=f}static parse(e){if(!e)return;if(e instanceof vn)return e;if(typeof e!="string")return;let r=Xi.parseCSSColor(e);return r?new vn(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toStringPremultipliedAlpha(){let[e,r,a,f]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${f})`}toString(){let[e,r,a,f]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*a)},${f})`}toRenderColor(e){let{r,g:a,b:f,a:c}=this;return new Jd(e,r,a,f,c)}clone(){return new vn(this.r,this.g,this.b,this.a)}}class Jd{constructor(e,r,a,f,c){if(e){let p=e.image.height,v=p*p;r=c===0?0:r/c*(p-1),a=c===0?0:a/c*(p-1),f=c===0?0:f/c*(p-1);let w=Math.floor(r),M=Math.floor(a),_=Math.floor(f),E=Math.ceil(r),D=Math.ceil(a),b=Math.ceil(f),T=r-w,C=a-M,O=f-_,L=e.image.data,B=4*(w+M*v+_*p),j=4*(w+M*v+b*p),z=4*(w+D*v+_*p),U=4*(w+D*v+b*p),q=4*(E+M*v+_*p),K=4*(E+M*v+b*p),re=4*(E+D*v+_*p),ne=4*(E+D*v+b*p);if(B<0||ne>=L.length)throw new Error("out of range");this.r=At(At(At(L[B],L[j],O),At(L[z],L[U],O),C),At(At(L[q],L[K],O),At(L[re],L[ne],O),C),T)/255*c,this.g=At(At(At(L[B+1],L[j+1],O),At(L[z+1],L[U+1],O),C),At(At(L[q+1],L[K+1],O),At(L[re+1],L[ne+1],O),C),T)/255*c,this.b=At(At(At(L[B+2],L[j+2],O),At(L[z+2],L[U+2],O),C),At(At(L[q+2],L[K+2],O),At(L[re+2],L[ne+2],O),C),T)/255*c,this.a=c}else this.r=r,this.g=a,this.b=f,this.a=c}toArray(){let{r:e,g:r,b:a,a:f}=this;return f===0?[0,0,0,0]:[255*e/f,255*r/f,255*a/f,f]}toHslaArray(){if(this.a===0)return[0,0,0,0];let{r:e,g:r,b:a,a:f}=this,c=Math.min(Math.max(e/f,0),1),p=Math.min(Math.max(r/f,0),1),v=Math.min(Math.max(a/f,0),1),w=Math.min(c,p,v),M=Math.max(c,p,v),_=(w+M)/2;if(w===M)return[0,0,100*_,f];let E=M-w,D=_>.5?E/(2-M-w):E/(M+w),b=0;return M===c?b=(p-v)/E+(p<v?6:0):M===p?b=(v-c)/E+2:M===v&&(b=(c-p)/E+4),b*=60,[Math.min(Math.max(b,0),360),Math.min(Math.max(100*D,0),100),Math.min(Math.max(100*_,0),100),f]}toArray01(){let{r:e,g:r,b:a,a:f}=this;return f===0?[0,0,0,0]:[e/f,r/f,a/f,f]}toArray01Scaled(e){let{r,g:a,b:f,a:c}=this;return c===0?[0,0,0]:[r/c*e,a/c*e,f/c*e]}toArray01PremultipliedAlpha(){let{r:e,g:r,b:a,a:f}=this;return[e,r,a,f]}toArray01Linear(){let{r:e,g:r,b:a,a:f}=this;return f===0?[0,0,0,0]:[Math.pow(e/f,2.2),Math.pow(r/f,2.2),Math.pow(a/f,2.2),f]}}function At(o,e,r){return o*(1-r)+e*r}function ng(o,e,r){return o.map((a,f)=>At(a,e[f],r))}vn.black=new vn(0,0,0,1),vn.white=new vn(1,1,1,1),vn.transparent=new vn(0,0,0,0),vn.red=new vn(1,0,0,1),vn.blue=new vn(0,0,1,1);var $u=Object.freeze({__proto__:null,array:ng,color:function(o,e,r){return new vn(At(o.r,e.r,r),At(o.g,e.g,r),At(o.b,e.b,r),At(o.a,e.a,r))},number:At});function Hu(o,...e){for(let r of e)for(let a in r)o[a]=r[a];return o}class Qt extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Gu{constructor(e,r=[]){this.parent=e,this.bindings={};for(let[a,f]of r)this.bindings[a]=f}concat(e){return new Gu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let la={kind:"null"},yt={kind:"number"},Tn={kind:"string"},dn={kind:"boolean"},Zr={kind:"color"},os={kind:"object"},gn={kind:"value"},uc={kind:"collator"},Po={kind:"formatted"},hc={kind:"resolvedImage"};function Nr(o,e){return{kind:"array",itemType:o,N:e}}function cr(o){if(o.kind==="array"){let e=cr(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}let Qd=[la,yt,Tn,dn,Zr,Po,os,Nr(gn),hc];function vi(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!vi(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(let r of Qd)if(!vi(r,e))return null}}return`Expected ${cr(o)} but found ${cr(e)} instead.`}function qu(o,e){return e.some(r=>r.kind===o.kind)}function dc(o,e){return e.some(r=>r==="null"?o===null:r==="array"?Array.isArray(o):r==="object"?o&&!Array.isArray(o)&&typeof o=="object":r===typeof o)}class Wu{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fc{constructor(e,r,a,f,c){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=f,this.textColor=c}}class Xr{constructor(e){this.sections=e}static fromString(e){return new Xr([new fc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary)}static factory(e){return e instanceof Xr?e:Xr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let r of this.sections){if(r.image){e.push(["image",r.image.namePrimary]);continue}e.push(r.text);let a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class Oo{constructor(e,r){if(this.id=e,this.options=r||{params:{}},this.options.transform){let{a,b:f,c,d:p,e:v,f:w}=this.options.transform;this.options.transform=new DOMMatrix([a,f,c,p,v,w])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(e){return JSON.parse(e).id}static deserializeFromString(e){let r=JSON.parse(e),{a,b:f,c,d:p,e:v,f:w}=r.options.transform;return new DOMMatrix([a,f,c,p,v,w]),new Oo(r.id,r.options)}scaleSelf(e){return this.options.transform=this.options.transform.scale(e),this}serialize(){let e={id:this.id};this.options&&(e.options=this.options);let{a:r,b:a,c:f,d:c,e:p,f:v}=this.options.transform;return e.options.transform={a:r,b:a,c:f,d:c,e:p,f:v},JSON.stringify(e)}}class Hr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),e.optionsPrimary&&(this.optionsPrimary=e.optionsPrimary),e.optionsSecondary&&(this.optionsSecondary=e.optionsSecondary),this.available=e.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new Oo(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new Oo(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(e){return typeof e=="string"?Hr.build(e):e}static build(e,r,a,f){return e?new Hr({namePrimary:e,nameSecondary:r,optionsPrimary:a,optionsSecondary:f,available:!1}):null}}function ef(o,e,r,a){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[o,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[o,e,r,a]:[o,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ss(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof vn||o instanceof Wu||o instanceof Xr||o instanceof Hr)return!0;if(Array.isArray(o)){for(let e of o)if(!ss(e))return!1;return!0}if(typeof o=="object"){for(let e in o)if(!ss(o[e]))return!1;return!0}return!1}function sr(o){if(o===null)return la;if(typeof o=="string")return Tn;if(typeof o=="boolean")return dn;if(typeof o=="number")return yt;if(o instanceof vn)return Zr;if(o instanceof Wu)return uc;if(o instanceof Xr)return Po;if(o instanceof Hr)return hc;if(Array.isArray(o)){let e=o.length,r;for(let a of o){let f=sr(a);if(r){if(r===f)continue;r=gn;break}r=f}return Nr(r||gn,e)}return os}function Yi(o){let e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof vn?o.toStringPremultipliedAlpha():o instanceof Xr||o instanceof Hr?o.toString():JSON.stringify(o)}class zr{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ss(e[1]))return r.error("invalid value");let a=e[1],f=sr(a),c=r.expectedType;return f.kind!=="array"||f.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(f=c),new zr(f,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Xr?this.value.serialize():this.value}}class xr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let pc={string:Tn,number:yt,boolean:dn,object:os};class uo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,f=1,c=e[0];if(c==="array"){let v,w;if(e.length>2){let M=e[1];if(typeof M!="string"||!(M in pc)||M==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=pc[M],f++}else v=gn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);w=e[2],f++}a=Nr(v,w)}else a=pc[c];let p=[];for(;f<e.length;f++){let v=r.parse(e[f],f,gn);if(!v)return null;p.push(v)}return new uo(a,p)}evaluate(e){for(let r=0;r<this.args.length;r++){let a=this.args[r].evaluate(e);if(!vi(this.type,sr(a)))return a;if(r===this.args.length-1)throw new xr(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${cr(sr(a))} but was expected to be of type ${cr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,r=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);let f=e.N;(typeof f=="number"||this.args.length>1)&&r.push(f)}}return r.concat(this.args.map(a=>a.serialize()))}}class ca{constructor(e){this.type=Po,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");let f=[],c=!1;for(let p=1;p<=e.length-1;++p){let v=e[p];if(c&&typeof v=="object"&&!Array.isArray(v)){c=!1;let w=null;if(v["font-scale"]&&(w=r.parseObjectValue(v["font-scale"],p,"font-scale",yt),!w))return null;let M=null;if(v["text-font"]&&(M=r.parseObjectValue(v["text-font"],p,"text-font",Nr(Tn)),!M))return null;let _=null;if(v["text-color"]&&(_=r.parseObjectValue(v["text-color"],p,"text-color",Zr),!_))return null;let E=f[f.length-1];E.scale=w,E.font=M,E.textColor=_}else{let w=r.parse(e[p],p,gn);if(!w)return null;let M=w.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,f.push({content:w,scale:null,font:null,textColor:null})}}return new ca(f)}evaluate(e){return new Xr(this.sections.map(r=>{let a=r.content.evaluate(e);return sr(a)===hc?new fc("",a,null,null,null):new fc(Yi(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(let r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let r of this.sections){e.push(r.content.serialize());let a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class mc{constructor(e,r,a,f){this._imageWarnHistory={},this.type=hc,this.inputPrimary=e,this.inputSecondary=r,this.inputPrimaryParams=a,this.inputSecondaryParams=f}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let a=1,f=[];function c(){if(a<e.length){let v=r.parse(e[a],a++,Tn);return v?(f.push({image:v,options:void 0}),!0):(r.error(f.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function p(){if(a<e.length){if((v=e[a])===null||typeof v!="object"||Array.isArray(v))return!0;let w=e[a].params,M=r.concat(a);if(!w)return a++,!0;if(typeof w!="object"||w.constructor!==Object)return M.error('Image options "params" should be an object'),!1;let _={},E=M.concat(void 0,"params");for(let D in w){if(!D)return E.error("Image parameter name should be non-empty"),!1;let b=E.concat(void 0,D).parse(w[D],void 0,Zr,void 0,{typeAnnotation:"coerce"});if(!b)return!1;_[D]=b}return f[f.length-1].options=_,a++,!0}var v;return!0}for(let v=0;v<2;v++)if(!c()||!p())return;return new mc(f[0].image,f[1]?f[1].image:void 0,f[0].options,f[1]?f[1].options:void 0)}evaluateParams(e,r){let a={};if(r){for(let f in r)if(r[f])try{let c=r[f].evaluate(e),p=`Ignoring image parameter "${f}" with semi-transparent color ${c.toString()}`;if(c.a!==1){this._imageWarnHistory[p]||(console.warn(p),this._imageWarnHistory[p]=!0);continue}a[f]=c}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){let r=Hr.build(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0,this.inputPrimaryParams?this.evaluateParams(e,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(e,this.inputSecondaryParams):void 0);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&e.availableImages&&(r.available=e.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(e){if(e(this.inputPrimary),this.inputPrimaryParams)for(let r in this.inputPrimaryParams)this.inputPrimaryParams[r]&&e(this.inputPrimaryParams[r]);if(this.inputSecondary&&(e(this.inputSecondary),this.inputSecondaryParams))for(let r in this.inputSecondaryParams)this.inputSecondaryParams[r]&&e(this.inputSecondaryParams[r])}outputDefined(){return!1}serializeParams(e){let r={};if(e){for(let a in e)e[a]&&(r[a]=e[a].serialize());return{params:r}}}serialize(){let e=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&e.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(e.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&e.push(this.serializeParams(this.inputSecondaryParams))),e}}function ho(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}let tf={"to-boolean":dn,"to-color":Zr,"to-number":yt,"to-string":Tn};class as{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a=e[0],f=[],c=la;if(a==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);c=Nr(r.expectedType.itemType,p)}else{if(!(p>0&&ss(e[1][0])))return null;c=Nr(sr(e[1][0]),p)}for(let v=0;v<p;v++){let w=e[1][v],M;if(ho(w)==="array")M=r.parse(w,void 0,c.itemType);else{let _=ho(w);if(_!==c.itemType.kind)return r.error(`Expected ${c.itemType.kind} but found ${_}.`);M=r.registry.literal.parse(["literal",w===void 0?null:w],r)}if(!M)return null;f.push(M)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");c=tf[a];for(let p=1;p<e.length;p++){let v=r.parse(e[p],p,gn);if(!v)return null;f.push(v)}}return new as(c,f)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(let f of this.args){if(r=f.evaluate(e),a=null,r instanceof vn)return r;if(typeof r=="string"){let c=e.parseColor(r);if(c)return c}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ef(r[0],r[1],r[2],r[3]),!a))return new vn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new xr(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(let a of this.args){if(r=a.evaluate(e),r===null)return 0;let f=Number(r);if(!isNaN(f))return f}throw new xr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Xr.fromString(Yi(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Hr.build(Yi(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):Yi(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ca([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new mc(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}let qv=["Unknown","Point","LineString","Polygon"];class nf{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-e[0])+this.featureDistanceData.bearing[1]*(f*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=vn.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class xi{constructor(e,r,a,f,c){this.name=e,this.type=r,this._evaluate=a,this.args=f,this._overloadIndex=c}evaluate(e){if(!this._evaluate){let r=xi.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){let a=e[0],f=xi.definitions[a];if(!f)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let c=Array.isArray(f)?f[0]:f.type,p=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,v=[],w=null,M=-1;for(let[_,E]of p){if(Array.isArray(_)&&_.length!==e.length-1)continue;v.push(_),M++,w=new Ic(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);let D=[],b=!1;for(let T=1;T<e.length;T++){let C=e[T],O=Array.isArray(_)?_[T-1]:_.type,L=w.parse(C,1+D.length,O);if(!L){b=!0;break}D.push(L)}if(!b)if(Array.isArray(_)&&_.length!==D.length)w.error(`Expected ${_.length} arguments, but found ${D.length} instead.`);else{for(let T=0;T<D.length;T++){let C=Array.isArray(_)?_[T]:_.type,O=D[T];w.concat(T+1).checkSubtype(C,O.type)}if(w.errors.length===0)return new xi(a,c,E,D,M)}}if(v.length===1)r.errors.push(...w.errors);else{let _=(v.length?v:p.map(([D])=>D)).map(rf).join(" | "),E=[];for(let D=1;D<e.length;D++){let b=r.parse(e[D],1+E.length);if(!b)return null;E.push(cr(b.type))}r.error(`Expected arguments of type ${_}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){xi.definitions=r;for(let a in r)e[a]=xi}}function rf(o){return Array.isArray(o)?`(${o.map(cr).join(", ")})`:`(${cr(o.type)}...)`}class Zu{constructor(e,r,a){this.type=uc,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");let f=a["case-sensitive"]===void 0?r.parse(!1,1,dn):r.parseObjectValue(a["case-sensitive"],1,"case-sensitive",dn);if(!f)return null;let c=a["diacritic-sensitive"]===void 0?r.parse(!1,1,dn):r.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",dn);if(!c)return null;let p=null;return a.locale&&(p=r.parseObjectValue(a.locale,1,"locale",Tn),!p)?null:new Zu(f,c,p)}evaluate(e){return new Wu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function gc(o,e,r=0,a=o.length-1,f=Wv){for(;a>r;){if(a-r>600){let w=a-r+1,M=e-r+1,_=Math.log(w),E=.5*Math.exp(2*_/3),D=.5*Math.sqrt(_*E*(w-E)/w)*(M-w/2<0?-1:1);gc(o,e,Math.max(r,Math.floor(e-M*E/w+D)),Math.min(a,Math.floor(e+(w-M)*E/w+D)),f)}let c=o[e],p=r,v=a;for(_c(o,r,e),f(o[a],c)>0&&_c(o,r,a);p<v;){for(_c(o,p,v),p++,v--;f(o[p],c)<0;)p++;for(;f(o[v],c)>0;)v--}f(o[r],c)===0?_c(o,r,v):(v++,_c(o,v,a)),v<=e&&(r=v+1),e<=v&&(a=v-1)}}function _c(o,e,r){let a=o[e];o[e]=o[r],o[r]=a}function Wv(o,e){return o<e?-1:o>e?1:0}function Zv(o){let e=0;for(let r,a,f=0,c=o.length,p=c-1;f<c;p=f++)r=o[f],a=o[p],e+=(a.x-r.x)*(r.y+a.y);return e}function yc(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function vc(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function Xv(o,e,r){let a=o[0]-e[0],f=o[1]-e[1],c=o[0]-r[0],p=o[1]-r[1];return a*p-c*f==0&&a*c<=0&&f*p<=0}function pl(o,e,r=!1){let a=!1;for(let v=0,w=e.length;v<w;v++){let M=e[v];for(let _=0,E=M.length,D=E-1;_<E;D=_++){let b=M[D],T=M[_];if(Xv(o,b,T))return r;(c=b)[1]>(f=o)[1]!=(p=T)[1]>f[1]&&f[0]<(p[0]-c[0])*(f[1]-c[1])/(p[1]-c[1])+c[0]&&(a=!a)}}var f,c,p;return a}function of(o,e,r,a){let f=a[0]-r[0],c=a[1]-r[1],p=(o[0]-r[0])*c-f*(o[1]-r[1]),v=(e[0]-r[0])*c-f*(e[1]-r[1]);return p>0&&v<0||p<0&&v>0}function ls(o,e,r,a){return(f=[a[0]-r[0],a[1]-r[1]])[0]*(c=[e[0]-o[0],e[1]-o[1]])[1]-f[1]*c[0]!=0&&!(!of(o,e,r,a)||!of(r,a,o,e));var f,c}let Fs=8192;function Yv(o,e){let r=(180+o[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(r*f*Fs),Math.round(a*f*Fs)]}function sf(o,e){for(let r=0;r<e.length;r++)if(pl(o,e[r]))return!0;return!1}function Kv(o,e,r){for(let a of r)for(let f=0,c=a.length,p=c-1;f<c;p=f++)if(ls(o,e,a[p],a[f]))return!0;return!1}function rg(o,e){for(let r=0;r<o.length;++r)if(!pl(o[r],e))return!1;for(let r=0;r<o.length-1;++r)if(Kv(o[r],o[r+1],e))return!1;return!0}function Jv(o,e){for(let r=0;r<e.length;r++)if(rg(o,e[r]))return!0;return!1}function af(o,e,r){let a=[];for(let f=0;f<o.length;f++){let c=[];for(let p=0;p<o[f].length;p++){let v=Yv(o[f][p],r);yc(e,v),c.push(v)}a.push(c)}return a}function ua(o,e,r){let a=[];for(let f=0;f<o.length;f++){let c=af(o[f],e,r);a.push(c)}return a}function Jt(o,e,r,a){if(o[0]<r[0]||o[0]>r[2]){let f=.5*a,c=o[0]-r[0]>f?-a:r[0]-o[0]>f?a:0;c===0&&(c=o[0]-r[2]>f?-a:r[2]-o[0]>f?a:0),o[0]+=c}yc(e,o)}function It(o,e,r,a){let f=Math.pow(2,a.z)*Fs,c=[a.x*Fs,a.y*Fs],p=[];if(!o)return p;for(let v of o)for(let w of v){let M=[w.x+c[0],w.y+c[1]];Jt(M,e,r,f),p.push(M)}return p}function Xu(o,e,r,a){let f=Math.pow(2,a.z)*Fs,c=[a.x*Fs,a.y*Fs],p=[];if(!o)return p;for(let w of o){let M=[];for(let _ of w){let E=[_.x+c[0],_.y+c[1]];yc(e,E),M.push(E)}p.push(M)}if(e[2]-e[0]<=f/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let w of p)for(let M of w)Jt(M,e,r,f)}var v;return p}class Ot{constructor(e,r){this.type=dn,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ss(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let f=0;f<a.features.length;++f){let c=a.features[f].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Ot(a,a.features[f].geometry)}else if(a.type==="Feature"){let f=a.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Ot(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ot(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){let f=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let v=af(a.coordinates,c,p),w=It(r.geometry(),f,c,p);if(!vc(f,c))return!1;for(let M of w)if(!pl(M,v))return!1}if(a.type==="MultiPolygon"){let v=ua(a.coordinates,c,p),w=It(r.geometry(),f,c,p);if(!vc(f,c))return!1;for(let M of w)if(!sf(M,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){let f=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(a.type==="Polygon"){let v=af(a.coordinates,c,p),w=Xu(r.geometry(),f,c,p);if(!vc(f,c))return!1;for(let M of w)if(!rg(M,v))return!1}if(a.type==="MultiPolygon"){let v=ua(a.coordinates,c,p),w=Xu(r.geometry(),f,c,p);if(!vc(f,c))return!1;for(let M of w)if(!Jv(M,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let ml={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Yu=1/298.257223563,kt=Yu*(2-Yu),gl=Math.PI/180;class ha{static fromTile(e,r,a){let f=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),c=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/gl;return new ha(c,a)}static get units(){return ml}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!ml[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(ml).join(", ")}`);let a=6378.137*gl*(r?ml[r]:1),f=Math.cos(e*gl),c=1/(1-kt*(1-f*f)),p=Math.sqrt(c);this.kx=a*p*f,this.ky=a*p*c*(1-kt)}distance(e,r){let a=bi(e[0]-r[0])*this.kx,f=(e[1]-r[1])*this.ky;return Math.sqrt(a*a+f*f)}bearing(e,r){let a=bi(r[0]-e[0])*this.kx;return Math.atan2(a,(r[1]-e[1])*this.ky)/gl}destination(e,r,a){let f=a*gl;return this.offset(e,Math.sin(f)*r,Math.cos(f)*r)}offset(e,r,a){return[e[0]+r/this.kx,e[1]+a/this.ky]}lineDistance(e){let r=0;for(let a=0;a<e.length-1;a++)r+=this.distance(e[a],e[a+1]);return r}area(e){let r=0;for(let a=0;a<e.length;a++){let f=e[a];for(let c=0,p=f.length,v=p-1;c<p;v=c++)r+=bi(f[c][0]-f[v][0])*(f[c][1]+f[v][1])*(a?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let a=0;if(r<=0)return e[0];for(let f=0;f<e.length-1;f++){let c=e[f],p=e[f+1],v=this.distance(c,p);if(a+=v,a>r)return Ku(c,p,(r-(a-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,r,a){let[f,c]=r,p=bi(a[0]-f)*this.kx,v=(a[1]-c)*this.ky;if(p!==0||v!==0){let w=(bi(e[0]-f)*this.kx*p+(e[1]-c)*this.ky*v)/(p*p+v*v);w>1?(f=a[0],c=a[1]):w>0&&(f+=p/this.kx*w,c+=v/this.ky*w)}return p=bi(e[0]-f)*this.kx,v=(e[1]-c)*this.ky,Math.sqrt(p*p+v*v)}pointOnLine(e,r){let a=1/0,f=e[0][0],c=e[0][1],p=0,v=0;for(let w=0;w<e.length-1;w++){let M=e[w][0],_=e[w][1],E=bi(e[w+1][0]-M)*this.kx,D=(e[w+1][1]-_)*this.ky,b=0;E===0&&D===0||(b=(bi(r[0]-M)*this.kx*E+(r[1]-_)*this.ky*D)/(E*E+D*D),b>1?(M=e[w+1][0],_=e[w+1][1]):b>0&&(M+=E/this.kx*b,_+=D/this.ky*b)),E=bi(r[0]-M)*this.kx,D=(r[1]-_)*this.ky;let T=E*E+D*D;T<a&&(a=T,f=M,c=_,p=w,v=b)}return{point:[f,c],index:p,t:Math.max(0,Math.min(1,v))}}lineSlice(e,r,a){let f=this.pointOnLine(a,e),c=this.pointOnLine(a,r);if(f.index>c.index||f.index===c.index&&f.t>c.t){let M=f;f=c,c=M}let p=[f.point],v=f.index+1,w=c.index;!lf(a[v],p[0])&&v<=w&&p.push(a[v]);for(let M=v+1;M<=w;M++)p.push(a[M]);return lf(a[w],c.point)||p.push(c.point),p}lineSliceAlong(e,r,a){let f=0,c=[];for(let p=0;p<a.length-1;p++){let v=a[p],w=a[p+1],M=this.distance(v,w);if(f+=M,f>e&&c.length===0&&c.push(Ku(v,w,(e-(f-M))/M)),f>=r)return c.push(Ku(v,w,(r-(f-M))/M)),c;f>e&&c.push(w)}return c}bufferPoint(e,r){let a=r/this.ky,f=r/this.kx;return[e[0]-f,e[1]-a,e[0]+f,e[1]+a]}bufferBBox(e,r){let a=r/this.ky,f=r/this.kx;return[e[0]-f,e[1]-a,e[2]+f,e[3]+a]}insideBBox(e,r){return bi(e[0]-r[0])>=0&&bi(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function lf(o,e){return o[0]===e[0]&&o[1]===e[1]}function Ku(o,e,r){let a=bi(e[0]-o[0]);return[o[0]+a*r,o[1]+(e[1]-o[1])*r]}function bi(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class Gr{constructor(e=[],r=(a,f)=>a<f?-1:a>f?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:r,compare:a}=this,f=r[e];for(;e>0;){let c=e-1>>1,p=r[c];if(a(f,p)>=0)break;r[e]=p,e=c}r[e]=f}_down(e){let{data:r,compare:a}=this,f=this.length>>1,c=r[e];for(;e<f;){let p=1+(e<<1),v=p+1;if(v<this.length&&a(r[v],r[p])<0&&(p=v),a(r[p],c)>=0)break;r[e]=r[p],e=p}r[e]=c}}var ct=8192;function cf(o,e){return e.dist-o.dist}let Ju=100,xc=50;function Ns(o){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==o[r])return!1;return!0}function Br(o){return o[1]-o[0]+1}function cs(o,e){let r=o[1]>=o[0]&&o[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function uf(o,e){if(o[0]>o[1])return[null,null];let r=Br(o);if(e){if(r===2)return[o,null];let a=Math.floor(r/2);return[[o[0],o[0]+a],[o[0]+a,o[1]]]}{if(r===1)return[o,null];let a=Math.floor(r/2)-1;return[[o[0],o[0]+a],[o[0]+a+1,o[1]]]}}function da(o,e){let r=[1/0,1/0,-1/0,-1/0];if(!cs(e,o.length))return r;for(let a=e[0];a<=e[1];++a)yc(r,o[a]);return r}function fa(o){let e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<o.length;++r)for(let a=0;a<o[r].length;++a)yc(e,o[r][a]);return e}function pa(o,e,r){if(Ns(o)||Ns(e))return NaN;let a=0,f=0;return o[2]<e[0]&&(a=e[0]-o[2]),o[0]>e[2]&&(a=o[0]-e[2]),o[1]>e[3]&&(f=o[1]-e[3]),o[3]<e[1]&&(f=e[1]-o[3]),r.distance([0,0],[a,f])}function hf(o){return 360*o-180}function Qv(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function df(o,e){let r=Math.pow(2,e.z),a=(o.y/ct+e.y)/r;return[hf((o.x/ct+e.x)/r),Qv(a)]}function e0(o,e){let r=[];for(let a=0;a<o.length;++a)r.push(df(o[a],e));return r}function ig(o,e,r){let a=r.pointOnLine(e,o).point;return r.distance(o,a)}function ff(o,e,r,a,f){let c=r.slice(a[0],a[1]+1),p=1/0;for(let v=e[0];v<=e[1];++v)if((p=Math.min(p,ig(o[v],c,f)))===0)return 0;return p}function pf(o,e,r,a,f){let c=Math.min(f.pointToSegmentDistance(o,r,a),f.pointToSegmentDistance(e,r,a)),p=Math.min(f.pointToSegmentDistance(r,o,e),f.pointToSegmentDistance(a,o,e));return Math.min(c,p)}function t0(o,e,r,a,f){if(!cs(e,o.length)||!cs(a,r.length))return NaN;let c=1/0;for(let p=e[0];p<e[1];++p)for(let v=a[0];v<a[1];++v){if(ls(o[p],o[p+1],r[v],r[v+1]))return 0;c=Math.min(c,pf(o[p],o[p+1],r[v],r[v+1],f))}return c}function og(o,e,r,a,f){if(!cs(e,o.length)||!cs(a,r.length))return NaN;let c=1/0;for(let p=e[0];p<=e[1];++p)for(let v=a[0];v<=a[1];++v)if((c=Math.min(c,f.distance(o[p],r[v])))===0)return c;return c}function ma(o,e,r){if(pl(o,e,!0))return 0;let a=1/0;for(let f of e){let c=f.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[c-1]&&(a=Math.min(a,r.pointToSegmentDistance(o,f[c-1],f[0])))===0||(a=Math.min(a,ig(o,f,r)))===0)return a}return a}function n0(o,e,r,a){if(!cs(e,o.length))return NaN;for(let c=e[0];c<=e[1];++c)if(pl(o[c],r,!0))return 0;let f=1/0;for(let c=e[0];c<e[1];++c)for(let p of r)for(let v=0,w=p.length,M=w-1;v<w;M=v++){if(ls(o[c],o[c+1],p[M],p[v]))return 0;f=Math.min(f,pf(o[c],o[c+1],p[M],p[v],a))}return f}function sg(o,e){for(let r of o)for(let a=0;a<=r.length-1;++a)if(pl(r[a],e,!0))return!0;return!1}function mf(o,e,r,a=1/0){let f=fa(o),c=fa(e);if(a!==1/0&&pa(f,c,r)>=a)return a;if(vc(f,c)){if(sg(o,e))return 0}else if(sg(e,o))return 0;let p=a;for(let v of o)for(let w=0,M=v.length,_=M-1;w<M;_=w++)for(let E of e)for(let D=0,b=E.length,T=b-1;D<b;T=D++){if(ls(v[_],v[w],E[T],E[D]))return 0;p=Math.min(p,pf(v[_],v[w],E[T],E[D],r))}return p}function bc(o,e,r,a,f,c,p){if(c===null||p===null)return;let v=pa(da(a,c),da(f,p),r);v<e&&o.push({dist:v,range1:c,range2:p})}function ag(o,e,r,a,f=1/0){let c=Math.min(a.distance(o[0],r[0][0]),f);if(c===0)return c;let p=new Gr([{dist:0,range1:[0,o.length-1],range2:[0,0]}],cf),v=e?xc:Ju,w=fa(r);for(;p.length;){let M=p.pop();if(M.dist>=c)continue;let _=M.range1;if(Br(_)<=v){if(!cs(_,o.length))return NaN;if(e){let E=n0(o,_,r,a);if((c=Math.min(c,E))===0)return c}else for(let E=_[0];E<=_[1];++E){let D=ma(o[E],r,a);if((c=Math.min(c,D))===0)return c}}else{let E=uf(_,e);if(E[0]!==null){let D=pa(da(o,E[0]),w,a);D<c&&p.push({dist:D,range1:E[0],range2:[0,0]})}if(E[1]!==null){let D=pa(da(o,E[1]),w,a);D<c&&p.push({dist:D,range1:E[1],range2:[0,0]})}}}return c}function Ki(o,e,r,a,f,c=1/0){let p=Math.min(c,f.distance(o[0],r[0]));if(p===0)return p;let v=new Gr([{dist:0,range1:[0,o.length-1],range2:[0,r.length-1]}],cf),w=e?xc:Ju,M=a?xc:Ju;for(;v.length;){let _=v.pop();if(_.dist>=p)continue;let E=_.range1,D=_.range2;if(Br(E)<=w&&Br(D)<=M){if(!cs(E,o.length)||!cs(D,r.length))return NaN;if(e&&a?p=Math.min(p,t0(o,E,r,D,f)):e||a?e&&!a?p=Math.min(p,ff(r,D,o,E,f)):!e&&a&&(p=Math.min(p,ff(o,E,r,D,f))):p=Math.min(p,og(o,E,r,D,f)),p===0)return p}else{let b=uf(E,e),T=uf(D,a);bc(v,p,f,o,r,b[0],T[0]),bc(v,p,f,o,r,b[0],T[1]),bc(v,p,f,o,r,b[1],T[0]),bc(v,p,f,o,r,b[1],T[1])}}return p}function Qu(o,e,r,a,f=1/0){let c=f,p=da(o,[0,o.length-1]);for(let v of r)if(!(c!==1/0&&pa(p,da(v,[0,v.length-1]),a)>=c)&&(c=Math.min(c,Ki(o,e,v,!0,a,c)),c===0))return c;return c}function wc(o,e,r,a,f=1/0){let c=f,p=da(o,[0,o.length-1]);for(let v of r){if(c!==1/0&&pa(p,fa(v),a)>=c)continue;let w=ag(o,e,v,a,c);if(isNaN(w))return w;if((c=Math.min(c,w))===0)return c}return c}function eh(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class zs{constructor(e,r){this.type=yt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ss(e[1])){let a=e[1];if(a.type==="FeatureCollection"){for(let f=0;f<a.features.length;++f)if(eh(a.features[f].geometry.type))return new zs(a,a.features[f].geometry)}else if(a.type==="Feature"){if(eh(a.geometry.type))return new zs(a,a.geometry)}else if(eh(a.type))return new zs(a,a)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let r=e.geometry(),a=e.canonicalID();if(r!=null&&a!=null){if(e.geometryType()==="Point")return function(f,c,p){let v=[];for(let M of f)for(let _ of M)v.push(df(_,c));let w=new ha(v[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Ki(v,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",w):p.type==="MultiLineString"?Qu(v,!1,p.coordinates,w):p.type==="Polygon"||p.type==="MultiPolygon"?wc(v,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,w):null}(r,a,this.geometries);if(e.geometryType()==="LineString")return function(f,c,p){let v=[];for(let M of f){let _=[];for(let E of M)_.push(df(E,c));v.push(_)}let w=new ha(v[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Qu(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v,w);if(p.type==="MultiLineString"){let M=1/0;for(let _=0;_<p.coordinates.length;_++){let E=Qu(p.coordinates[_],!0,v,w,M);if(isNaN(E))return E;if((M=Math.min(M,E))===0)return M}return M}if(p.type==="Polygon"||p.type==="MultiPolygon"){let M=1/0;for(let _=0;_<v.length;_++){let E=wc(v[_],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,w,M);if(isNaN(E))return E;if((M=Math.min(M,E))===0)return M}return M}return null}(r,a,this.geometries);if(e.geometryType()==="Polygon")return function(f,c,p){let v=[];for(let M of function(_,E){let D=_.length;if(D<=1)return[_];let b=[],T,C;for(let O=0;O<D;O++){let L=Zv(_[O]);L!==0&&(_[O].area=Math.abs(L),C===void 0&&(C=L<0),C===L<0?(T&&b.push(T),T=[_[O]]):T.push(_[O]))}return T&&b.push(T),b}(f)){let _=[];for(let E=0;E<M.length;++E)_.push(e0(M[E],c));v.push(_)}let w=new ha(v[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return wc(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v,w);if(p.type==="MultiLineString"){let M=1/0;for(let _=0;_<p.coordinates.length;_++){let E=wc(p.coordinates[_],!0,v,w,M);if(isNaN(E))return E;if((M=Math.min(M,E))===0)return M}return M}return p.type==="Polygon"||p.type==="MultiPolygon"?function(M,_,E){let D=1/0;for(let b of M)for(let T of _){let C=mf(b,T,E,D);if(isNaN(C))return C;if((D=Math.min(D,C))===0)return D}return D}(p.type==="Polygon"?[p.coordinates]:p.coordinates,v,w):null}(r,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function th(o,e){switch(o){case"string":return Yi(e);case"number":return+e;case"boolean":return!!e;case"color":return vn.parse(e);case"formatted":return Xr.fromString(Yi(e));case"resolvedImage":return Hr.build(Yi(e))}return e}function gf(o,e,r,a){return a!==void 0&&(o=a*Math.round(o/a)),e!==void 0&&o<e&&(o=e),r!==void 0&&o>r&&(o=r),o}class ga{constructor(e,r,a){this.type=e,this.key=r,this.scope=a}static parse(e,r){let a=r.expectedType;if(a==null&&(a=gn),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");let f=r.parse(e[1],1);if(!(f instanceof zr))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let c=r.parse(e[2],2);return c instanceof zr?new ga(a,Yi(f.value),Yi(c.value)):r.error("Scope of 'config' expression must be a string literal.")}return new ga(a,Yi(f.value))}evaluate(e){let r=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(r);if(!a)return null;let{type:f,value:c,values:p,minValue:v,maxValue:w,stepValue:M}=a,_=a.default.evaluate(e),E=_;if(c){let D=e.scope;e.scope=(D||"").split("").slice(1).join(""),E=c.evaluate(e),e.scope=D}return f&&(E=th(f,E)),E===void 0||v===void 0&&w===void 0&&M===void 0||(typeof E=="number"?E=gf(E,v,w,M):Array.isArray(E)&&(E=E.map(D=>typeof D=="number"?gf(D,v,w,M):D))),c!==void 0&&E!==void 0&&p&&!p.includes(E)&&(E=_,f&&(E=th(f,E))),(f&&f!==this.type||E!==void 0&&sr(E)!==this.type)&&(E=th(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function _l(o){if(o instanceof xi&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Ot||o instanceof zs)return!1;let e=!0;return o.eachChild(r=>{e&&!_l(r)&&(e=!1)}),e}function Ec(o){if(o instanceof xi&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(r=>{e&&!Ec(r)&&(e=!1)}),e}function Tc(o){if(o instanceof ga)return new Set([o.key]);let e=new Set;return o.eachChild(r=>{e=new Set([...e,...Tc(r)])}),e}function _a(o,e){if(o instanceof xi&&e.indexOf(o.name)>=0)return!1;let r=!0;return o.eachChild(a=>{r&&!_a(a,e)&&(r=!1)}),r}class ya{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let a=e[1];return r.scope.has(a)?new ya(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class yl{constructor(e,r=[],a,f=new Gu,c=[],p,v){this.registry=e,this.path=r,this.key=r.map(w=>typeof w=="string"?`['${w}']`:`[${w}]`).join(""),this.scope=f,this.errors=c,this.expectedType=a,this._scope=p,this.options=v}parse(e,r,a,f,c={}){return r||a?this.concat(r,null,a,f)._parse(e,c):this._parse(e,c)}parseObjectValue(e,r,a,f,c,p={}){return this.concat(r,a,f,c)._parse(e,p)}_parse(e,r){function a(f,c,p){return p==="assert"?new uo(c,[f]):p==="coerce"?new as(c,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let f=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(f){let c=f.parse(e,this);if(!c)return null;if(this.expectedType){let p=this.expectedType,v=c.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||v.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(p,v))return null}else c=a(c,p,r.typeAnnotation||"coerce");else c=a(c,p,r.typeAnnotation||"assert")}if(!(c instanceof zr)&&c.type.kind!=="resolvedImage"&&nh(c)){let p=new nf(this._scope,this.options);try{c=new zr(c.type,c.evaluate(p))}catch(v){return this.error(v.message),null}}return c}return as.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a,f){let c=typeof e=="number"?this.path.concat(e):this.path;c=typeof r=="string"?c.concat(r):c;let p=f?this.scope.concat(f):this.scope;return new yl(this.registry,c,a||null,p,this.errors,this._scope,this.options)}error(e,...r){let a=`${this.key}${r.map(f=>`[${f}]`).join("")}`;this.errors.push(new Qt(a,e))}checkSubtype(e,r){let a=vi(e,r);return a&&this.error(a),a}}var Ic=yl;function nh(o){if(o instanceof ya)return nh(o.boundExpression);if(o instanceof xi&&o.name==="error"||o instanceof Zu||o instanceof Ot||o instanceof zs||o instanceof ga)return!1;let e=o instanceof as||o instanceof uo,r=!0;return o.eachChild(a=>{r=e?r&&nh(a):r&&a instanceof zr}),!!r&&_l(o)&&_a(o,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Sc(o,e){let r=o.length-1,a,f,c=0,p=r,v=0;for(;c<=p;)if(v=Math.floor((c+p)/2),a=o[v],f=o[v+1],a<=e){if(v===r||e<f)return v;c=v+1}else{if(!(a>e))throw new xr("Input is not a number.");p=v-1}return 0}class vl{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(let[f,c]of a)this.labels.push(f),this.outputs.push(c)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");let a=r.parse(e[1],1,yt);if(!a)return null;let f=[],c=null;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);for(let p=1;p<e.length;p+=2){let v=p===1?-1/0:e[p],w=e[p+1],M=p,_=p+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(f.length&&f[f.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);let E=r.parse(w,_,c);if(!E)return null;c=c||E.type,f.push([v,E])}return new vl(c,a,f)}evaluate(e){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);let f=this.input.evaluate(e);if(f<=r[0])return a[0].evaluate(e);let c=r.length;return f>=r[c-1]?a[c-1].evaluate(e):a[Sc(r,f)].evaluate(e)}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}let va=.95047,cn=1.08883,lg=4/29,xl=6/29,cg=3*xl*xl,ug=xl*xl*xl,r0=Math.PI/180,Xn=180/Math.PI;function _f(o){return o>ug?Math.pow(o,1/3):o/cg+lg}function yf(o){return o>xl?o*o*o:cg*(o-lg)}function vf(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function xf(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function hg(o){let e=xf(o.r),r=xf(o.g),a=xf(o.b),f=_f((.4124564*e+.3575761*r+.1804375*a)/va),c=_f((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*c-16,a:500*(f-c),b:200*(c-_f((.0193339*e+.119192*r+.9503041*a)/cn)),alpha:o.a}}function dg(o){let e=(o.l+16)/116,r=isNaN(o.a)?e:e+o.a/500,a=isNaN(o.b)?e:e-o.b/200;return e=1*yf(e),r=va*yf(r),a=cn*yf(a),new vn(vf(3.2404542*r-1.5371385*e-.4985314*a),vf(-.969266*r+1.8760108*e+.041556*a),vf(.0556434*r-.2040259*e+1.0572252*a),o.alpha)}function i0(o,e,r){let a=e-o;return o+r*(a>180||a<-180?a-360*Math.round(a/360):a)}let Dc={forward:hg,reverse:dg,interpolate:function(o,e,r){return{l:At(o.l,e.l,r),a:At(o.a,e.a,r),b:At(o.b,e.b,r),alpha:At(o.alpha,e.alpha,r)}}},Mc={forward:function(o){let{l:e,a:r,b:a}=hg(o),f=Math.atan2(a,r)*Xn;return{h:f<0?f+360:f,c:Math.sqrt(r*r+a*a),l:e,alpha:o.a}},reverse:function(o){let e=o.h*r0,r=o.c;return dg({l:o.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:o.alpha})},interpolate:function(o,e,r){return{h:i0(o.h,e.h,r),c:At(o.c,e.c,r),l:At(o.l,e.l,r),alpha:At(o.alpha,e.alpha,r)}}};var fg=Object.freeze({__proto__:null,hcl:Mc,lab:Dc});class Ci{constructor(e,r,a,f,c,p){this.type=e,this.operator=r,this.interpolation=a,this.input=f,this.dynamicStops=c,this.labels=[],this.outputs=[];for(let[v,w]of p)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(e,r,a,f){let c=0;if(e.name==="exponential")c=bf(r,e.base,a,f);else if(e.name==="linear")c=bf(r,1,a,f);else if(e.name==="cubic-bezier"){let p=e.controlPoints;c=new il(p[0],p[1],p[2],p[3]).solve(bf(r,1,a,f))}return c}static parse(e,r){let[a,f,c,...p]=e;if(!Array.isArray(f)||f.length===0)return r.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){let M=f[1];if(typeof M!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:M}}else{if(f[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(f[0])}`,1,0);{let M=f.slice(1);if(M.length!==4||M.some(_=>typeof _!="number"||_<0||_>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<3)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(c=r.parse(c,2,yt),!c)return null;let v=[],w=null;if(a==="interpolate-hcl"||a==="interpolate-lab"?w=Zr:r.expectedType&&r.expectedType.kind!=="value"&&(w=r.expectedType),e.length-1==3){let M=r.parse(p[0],3,gn);return M?new Ci(w,a,f,c,M,v):null}for(let M=0;M<p.length;M+=2){let _=p[M],E=p[M+1],D=M+3,b=M+4;if(typeof _!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=_)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let T=r.parse(E,b,w);if(!T)return null;w=w||T.type,v.push([_,T])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Ci(w,a,f,c,null,v):r.error(`Type ${cr(w)} is not interpolatable.`)}evaluate(e){let r=this.labels,a=this.outputs;if(this.dynamicStops){let _=this.dynamicStops.evaluate(e);if(_.length%2!=0)throw new xr("Expected an even number of arguments.");r=[],a=[];for(let E=0;E<_.length;E+=2){let D=_[E],b=new zr(yt,_[E+1]);if(typeof D!="number")throw new xr('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(r.length&&r[r.length-1]>=D)throw new xr('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');r.push(D),a.push(b)}if(r.length===0)throw new xr("Expected at least one input/output pair.")}if(r.length===1)return a[0].evaluate(e);let f=this.input.evaluate(e);if(f<=r[0])return a[0].evaluate(e);let c=r.length;if(f>=r[c-1])return a[c-1].evaluate(e);let p=Sc(r,f),v=Ci.interpolationFactor(this.interpolation,f,r[p],r[p+1]),w=a[p].evaluate(e),M=a[p+1].evaluate(e);return this.operator==="interpolate"?$u[this.type.kind.toLowerCase()](w,M,v):this.operator==="interpolate-hcl"?Mc.reverse(Mc.interpolate(Mc.forward(w),Mc.forward(M),v)):Dc.reverse(Dc.interpolate(Dc.forward(w),Dc.forward(M),v))}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let r=[this.operator,e,this.input.serialize()];if(this.dynamicStops)r.push(this.dynamicStops.serialize());else for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function bf(o,e,r,a){let f=a-r,c=o-r;return f===0?0:e===1?c/f:(Math.pow(e,c)-1)/(Math.pow(e,f)-1)}class rh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null,f=r.expectedType;f&&f.kind!=="value"&&(a=f);let c=[];for(let v of e.slice(1)){let w=r.parse(v,1+c.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,c.push(w)}let p=f&&c.some(v=>vi(f,v.type));return new rh(p?gn:a,c)}evaluate(e){let r,a=null,f=0;for(let c of this.args){if(f++,a=c.evaluate(e),a&&a instanceof Hr&&!a.available&&(r||(r=a),a=null,f===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class ih{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let c=1;c<e.length-1;c+=2){let p=e[c];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,c);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",c);let v=r.parse(e[c+1],c+1);if(!v)return null;a.push([p,v])}let f=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return f?new ih(a,f):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}class wf{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=r.parse(e[1],1,yt),f=r.parse(e[2],2,Nr(r.expectedType||gn));return a&&f?new wf(f.type.itemType,a,f):null}evaluate(e){let r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new xr(`Array index out of bounds: ${r} < 0.`);if(r>a.length-1)throw new xr(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r===Math.floor(r))return a[r];let f=Math.floor(r),c=Math.ceil(r),p=a[f],v=a[c];if(typeof p!="number"||typeof v!="number")throw new xr(`Cannot interpolate between non-number values at index ${r}.`);let w=r-f;return p*(1-w)+v*w}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ef{constructor(e,r){this.type=dn,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=r.parse(e[1],1,gn),f=r.parse(e[2],2,gn);return a&&f?qu(a.type,[dn,Tn,yt,la,gn])?new Ef(a,f):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${cr(a.type)} instead`):null}evaluate(e){let r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!dc(r,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${cr(sr(r))} instead.`);if(!dc(a,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${cr(sr(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class oh{constructor(e,r,a){this.type=yt,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=r.parse(e[1],1,gn),f=r.parse(e[2],2,gn);if(!a||!f)return null;if(!qu(a.type,[dn,Tn,yt,la,gn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${cr(a.type)} instead`);if(e.length===4){let c=r.parse(e[3],3,yt);return c?new oh(a,f,c):null}return new oh(a,f)}evaluate(e){let r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!dc(r,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${cr(sr(r))} instead.`);if(!dc(a,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${cr(sr(a))} instead.`);if(this.fromIndex){let f=this.fromIndex.evaluate(e);return a.indexOf(r,f)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Tf{constructor(e,r,a,f,c,p){this.inputType=e,this.type=r,this.input=a,this.cases=f,this.outputs=c,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,f;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);let c={},p=[];for(let M=2;M<e.length-1;M+=2){let _=e[M],E=e[M+1];Array.isArray(_)||(_=[_]);let D=r.concat(M);if(_.length===0)return D.error("Expected at least one branch label.");for(let T of _){if(typeof T!="number"&&typeof T!="string")return D.error("Branch labels must be numbers or strings.");if(typeof T=="number"&&Math.abs(T)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof T=="number"&&Math.floor(T)!==T)return D.error("Numeric branch labels must be integer values.");if(a){if(D.checkSubtype(a,sr(T)))return null}else a=sr(T);if(c[String(T)]!==void 0)return D.error("Branch labels must be unique.");c[String(T)]=p.length}let b=r.parse(E,M,f);if(!b)return null;f=f||b.type,p.push(b)}let v=r.parse(e[1],1,gn);if(!v)return null;let w=r.parse(e[e.length-1],e.length-1,f);return w?v.type.kind!=="value"&&r.concat(1).checkSubtype(a,v.type)?null:new Tf(a,f,v,c,p,w):null}evaluate(e){let r=this.input.evaluate(e);return(sr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],f={};for(let p of r){let v=f[this.cases[p]];v===void 0?(f[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[v][1].push(p)}let c=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,v]of a)e.push(v.length===1?c(v[0]):v.map(c)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class If{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);let f=[];for(let p=1;p<e.length-1;p+=2){let v=r.parse(e[p],p,dn);if(!v)return null;let w=r.parse(e[p+1],p+1,a);if(!w)return null;f.push([v,w]),a=a||w.type}let c=r.parse(e[e.length-1],e.length-1,a);return c?new If(a,f,c):null}evaluate(e){for(let[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class sh{constructor(e,r,a,f){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=f}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=r.parse(e[1],1,gn),f=r.parse(e[2],2,yt);if(!a||!f)return null;if(!qu(a.type,[Nr(gn),Tn,gn]))return r.error(`Expected first argument to be of type array or string, but found ${cr(a.type)} instead`);if(e.length===4){let c=r.parse(e[3],3,yt);return c?new sh(a.type,a,f,c):null}return new sh(a.type,a,f)}evaluate(e){let r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!dc(r,["string","array"]))throw new xr(`Expected first argument to be of type array or string, but found ${cr(sr(r))} instead.`);if(this.endIndex){let f=this.endIndex.evaluate(e);return r.slice(a,f)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function pg(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function mg(o,e,r,a){return a.compare(e,r)===0}function bl(o,e,r){let a=o!=="=="&&o!=="!=";return class xR{constructor(c,p,v){this.type=dn,this.lhs=c,this.rhs=p,this.collator=v,this.hasUntypedArgument=c.type.kind==="value"||p.type.kind==="value"}static parse(c,p){if(c.length!==3&&c.length!==4)return p.error("Expected two or three arguments.");let v=c[0],w=p.parse(c[1],1,gn);if(!w)return null;if(!pg(v,w.type))return p.concat(1).error(`"${v}" comparisons are not supported for type '${cr(w.type)}'.`);let M=p.parse(c[2],2,gn);if(!M)return null;if(!pg(v,M.type))return p.concat(2).error(`"${v}" comparisons are not supported for type '${cr(M.type)}'.`);if(w.type.kind!==M.type.kind&&w.type.kind!=="value"&&M.type.kind!=="value")return p.error(`Cannot compare types '${cr(w.type)}' and '${cr(M.type)}'.`);a&&(w.type.kind==="value"&&M.type.kind!=="value"?w=new uo(M.type,[w]):w.type.kind!=="value"&&M.type.kind==="value"&&(M=new uo(w.type,[M])));let _=null;if(c.length===4){if(w.type.kind!=="string"&&M.type.kind!=="string"&&w.type.kind!=="value"&&M.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(_=p.parse(c[3],3,uc),!_)return null}return new xR(w,M,_)}evaluate(c){let p=this.lhs.evaluate(c),v=this.rhs.evaluate(c);if(a&&this.hasUntypedArgument){let w=sr(p),M=sr(v);if(w.kind!==M.kind||w.kind!=="string"&&w.kind!=="number")throw new xr(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${w.kind}, ${M.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let w=sr(p),M=sr(v);if(w.kind!=="string"||M.kind!=="string")return e(c,p,v)}return this.collator?r(c,p,v,this.collator.evaluate(c)):e(c,p,v)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){let c=[o];return this.eachChild(p=>{c.push(p.serialize())}),c}}}let o0=bl("==",function(o,e,r){return e===r},mg),s0=bl("!=",function(o,e,r){return e!==r},function(o,e,r,a){return!mg(0,e,r,a)}),a0=bl("<",function(o,e,r){return e<r},function(o,e,r,a){return a.compare(e,r)<0}),l0=bl(">",function(o,e,r){return e>r},function(o,e,r,a){return a.compare(e,r)>0}),c0=bl("<=",function(o,e,r){return e<=r},function(o,e,r,a){return a.compare(e,r)<=0}),u0=bl(">=",function(o,e,r){return e>=r},function(o,e,r,a){return a.compare(e,r)>=0});class Sf{constructor(e,r,a,f,c,p){this.type=Tn,this.number=e,this.locale=r,this.currency=a,this.unit=f,this.minFractionDigits=c,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");let a=r.parse(e[1],1,yt);if(!a)return null;let f=e[2];if(typeof f!="object"||Array.isArray(f))return r.error("NumberFormat options argument must be an object.");let c=null;if(f.locale&&(c=r.parseObjectValue(f.locale,2,"locale",Tn),!c))return null;let p=null;if(f.currency&&(p=r.parseObjectValue(f.currency,2,"currency",Tn),!p))return null;let v=null;if(f.unit&&(v=r.parseObjectValue(f.unit,2,"unit",Tn),!v))return null;let w=null;if(f["min-fraction-digits"]&&(w=r.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",yt),!w))return null;let M=null;return f["max-fraction-digits"]&&(M=r.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",yt),!M)?null:new Sf(a,c,p,v,w,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Df{constructor(e){this.type=yt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${cr(a.type)} instead.`):new Df(a):null}evaluate(e){let r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new xr(`Expected value to be of type string or array, but found ${cr(sr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function ah(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let wl={"==":o0,"!=":s0,">":l0,"<":a0,">=":u0,"<=":c0,array:uo,at:wf,boolean:uo,case:If,coalesce:rh,collator:Zu,format:ca,image:mc,in:Ef,"index-of":oh,interpolate:Ci,"interpolate-hcl":Ci,"interpolate-lab":Ci,length:Df,let:ih,literal:zr,match:Tf,number:uo,"number-format":Sf,object:uo,slice:sh,step:vl,string:uo,"to-boolean":as,"to-color":as,"to-number":as,"to-string":as,var:ya,within:Ot,distance:zs,config:ga};function Mf(o,[e,r,a,f]){e=e.evaluate(o),r=r.evaluate(o),a=a.evaluate(o);let c=f?f.evaluate(o):1,p=ef(e,r,a,c);if(p)throw new xr(p);return new vn(e/255*c,r/255*c,a/255*c,c)}function gg(o,[e,r,a,f]){e=e.evaluate(o),r=r.evaluate(o),a=a.evaluate(o);let c=f?f.evaluate(o):1,p=function(M,_,E,D){return typeof M=="number"&&M>=0&&M<=360?typeof _=="number"&&_>=0&&_<=100&&typeof E=="number"&&E>=0&&E<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[M,_,E,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[M,_,E,D]:[M,_,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[M,_,E,D]:[M,_,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,a,c);if(p)throw new xr(p);let v=`hsla(${e}, ${r}%, ${a}%, ${c})`,w=vn.parse(v);if(!w)throw new xr(`Failed to parse HSLA color: ${v}`);return w}function _g(o,e){return o in e}function Cf(o,e){let r=e[o];return r===void 0?null:r}function Bs(o){return{type:o}}function Af(o){return{result:"success",value:o}}function zi(o){return{result:"error",value:o}}function lh(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Cc(o){return o["property-type"]==="data-driven"}function yg(o){return lh(o.expression,"measure-light")}function ch(o){return lh(o.expression,"zoom")}function Ac(o){return!!o.expression&&o.expression.interpolated}function Rf(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function h0(o){return o}function Pf(o,e){let r=e.type==="color",a=o.stops&&typeof o.stops[0][0]=="object",f=a||!(a||o.property!==void 0),c=o.type||(Ac(e)?"exponential":"interval");if(r&&((o=Hu({},o)).stops&&(o.stops=o.stops.map(M=>[M[0],vn.parse(M[1])])),o.default=vn.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!fg[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let p,v,w;if(c==="exponential")p=vg;else if(c==="interval")p=f0;else if(c==="categorical"){p=d0,v=Object.create(null);for(let M of o.stops)v[M[0]]=M[1];w=typeof o.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);p=xg}if(a){let M={},_=[];for(let b=0;b<o.stops.length;b++){let T=o.stops[b],C=T[0].zoom;M[C]===void 0&&(M[C]={zoom:C,type:o.type,property:o.property,default:o.default,stops:[]},_.push(C)),M[C].stops.push([T[0].value,T[1]])}let E=[];for(let b of _)E.push([M[b].zoom,Pf(M[b],e)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:Ci.interpolationFactor.bind(void 0,D),zoomStops:E.map(b=>b[0]),evaluate:({zoom:b},T)=>vg({stops:E,base:o.base},e,b).evaluate(b,T)}}if(f){let M=c==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Ci.interpolationFactor.bind(void 0,M),zoomStops:o.stops.map(_=>_[0]),evaluate:({zoom:_})=>p(o,e,_,v,w)}}return{kind:"source",evaluate(M,_){let E=_&&_.properties?_.properties[o.property]:void 0;return E===void 0?El(o.default,e.default):p(o,e,E,v,w)}}}function El(o,e,r){return o!==void 0?o:e!==void 0?e:r!==void 0?r:void 0}function d0(o,e,r,a,f){return El(typeof r===f?a[r]:void 0,o.default,e.default)}function f0(o,e,r){if(ho(r)!=="number")return El(o.default,e.default);let a=o.stops.length;if(a===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[a-1][0])return o.stops[a-1][1];let f=Sc(o.stops.map(c=>c[0]),r);return o.stops[f][1]}function vg(o,e,r){let a=o.base!==void 0?o.base:1;if(ho(r)!=="number")return El(o.default,e.default);let f=o.stops.length;if(f===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[f-1][0])return o.stops[f-1][1];let c=Sc(o.stops.map(_=>_[0]),r),p=function(_,E,D,b){let T=b-D,C=_-D;return T===0?0:E===1?C/T:(Math.pow(E,C)-1)/(Math.pow(E,T)-1)}(r,a,o.stops[c][0],o.stops[c+1][0]),v=o.stops[c][1],w=o.stops[c+1][1],M=$u[e.type]||h0;if(o.colorSpace&&o.colorSpace!=="rgb"){let _=fg[o.colorSpace];M=(E,D)=>_.reverse(_.interpolate(_.forward(E),_.forward(D),p))}return typeof v.evaluate=="function"?{evaluate(..._){let E=v.evaluate.apply(void 0,_),D=w.evaluate.apply(void 0,_);if(E!==void 0&&D!==void 0)return M(E,D,p)}}:M(v,w,p)}function xg(o,e,r){return e.type==="color"?r=vn.parse(r):e.type==="formatted"?r=Xr.fromString(r.toString()):e.type==="resolvedImage"?r=Hr.build(r.toString()):ho(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),El(r,o.default,e.default)}xi.register(wl,{error:[{kind:"error"},[Tn],(o,[e])=>{throw new xr(e.evaluate(o))}],typeof:[Tn,[gn],(o,[e])=>cr(sr(e.evaluate(o)))],"to-rgba":[Nr(yt,4),[Zr],(o,[e])=>e.evaluate(o).toRenderColor(null).toArray()],"to-hsla":[Nr(yt,4),[Zr],(o,[e])=>e.evaluate(o).toRenderColor(null).toHslaArray()],rgb:[Zr,[yt,yt,yt],Mf],rgba:[Zr,[yt,yt,yt,yt],Mf],hsl:[Zr,[yt,yt,yt],gg],hsla:[Zr,[yt,yt,yt,yt],gg],has:{type:dn,overloads:[[[Tn],(o,[e])=>_g(e.evaluate(o),o.properties())],[[Tn,os],(o,[e,r])=>_g(e.evaluate(o),r.evaluate(o))]]},get:{type:gn,overloads:[[[Tn],(o,[e])=>Cf(e.evaluate(o),o.properties())],[[Tn,os],(o,[e,r])=>Cf(e.evaluate(o),r.evaluate(o))]]},"feature-state":[gn,[Tn],(o,[e])=>Cf(e.evaluate(o),o.featureState||{})],properties:[os,[],o=>o.properties()],"geometry-type":[Tn,[],o=>o.geometryType()],id:[gn,[],o=>o.id()],zoom:[yt,[],o=>o.globals.zoom],pitch:[yt,[],o=>o.globals.pitch||0],"distance-from-center":[yt,[],o=>o.distanceFromCenter()],"measure-light":[yt,[Tn],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[yt,[],o=>o.globals.heatmapDensity||0],"line-progress":[yt,[],o=>o.globals.lineProgress||0],"raster-value":[yt,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[yt,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[yt,[],o=>o.globals.skyRadialProgress||0],accumulated:[gn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[yt,Bs(yt),(o,e)=>{let r=0;for(let a of e)r+=a.evaluate(o);return r}],"*":[yt,Bs(yt),(o,e)=>{let r=1;for(let a of e)r*=a.evaluate(o);return r}],"-":{type:yt,overloads:[[[yt,yt],(o,[e,r])=>e.evaluate(o)-r.evaluate(o)],[[yt],(o,[e])=>-e.evaluate(o)]]},"/":[yt,[yt,yt],(o,[e,r])=>e.evaluate(o)/r.evaluate(o)],"%":[yt,[yt,yt],(o,[e,r])=>e.evaluate(o)%r.evaluate(o)],ln2:[yt,[],()=>Math.LN2],pi:[yt,[],()=>Math.PI],e:[yt,[],()=>Math.E],"^":[yt,[yt,yt],(o,[e,r])=>Math.pow(e.evaluate(o),r.evaluate(o))],sqrt:[yt,[yt],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[yt,[yt],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[yt,[yt],(o,[e])=>Math.log(e.evaluate(o))],log2:[yt,[yt],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[yt,[yt],(o,[e])=>Math.sin(e.evaluate(o))],cos:[yt,[yt],(o,[e])=>Math.cos(e.evaluate(o))],tan:[yt,[yt],(o,[e])=>Math.tan(e.evaluate(o))],asin:[yt,[yt],(o,[e])=>Math.asin(e.evaluate(o))],acos:[yt,[yt],(o,[e])=>Math.acos(e.evaluate(o))],atan:[yt,[yt],(o,[e])=>Math.atan(e.evaluate(o))],min:[yt,Bs(yt),(o,e)=>Math.min(...e.map(r=>r.evaluate(o)))],max:[yt,Bs(yt),(o,e)=>Math.max(...e.map(r=>r.evaluate(o)))],abs:[yt,[yt],(o,[e])=>Math.abs(e.evaluate(o))],round:[yt,[yt],(o,[e])=>{let r=e.evaluate(o);return r<0?-Math.round(-r):Math.round(r)}],floor:[yt,[yt],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[yt,[yt],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[dn,[Tn,gn],(o,[e,r])=>o.properties()[e.value]===r.value],"filter-id-==":[dn,[gn],(o,[e])=>o.id()===e.value],"filter-type-==":[dn,[Tn],(o,[e])=>o.geometryType()===e.value],"filter-<":[dn,[Tn,gn],(o,[e,r])=>{let a=o.properties()[e.value],f=r.value;return typeof a==typeof f&&a<f}],"filter-id-<":[dn,[gn],(o,[e])=>{let r=o.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[dn,[Tn,gn],(o,[e,r])=>{let a=o.properties()[e.value],f=r.value;return typeof a==typeof f&&a>f}],"filter-id->":[dn,[gn],(o,[e])=>{let r=o.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[dn,[Tn,gn],(o,[e,r])=>{let a=o.properties()[e.value],f=r.value;return typeof a==typeof f&&a<=f}],"filter-id-<=":[dn,[gn],(o,[e])=>{let r=o.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[dn,[Tn,gn],(o,[e,r])=>{let a=o.properties()[e.value],f=r.value;return typeof a==typeof f&&a>=f}],"filter-id->=":[dn,[gn],(o,[e])=>{let r=o.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[dn,[gn],(o,[e])=>e.value in o.properties()],"filter-has-id":[dn,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[dn,[Nr(Tn)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[dn,[Nr(gn)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[dn,[Tn,Nr(gn)],(o,[e,r])=>r.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[dn,[Tn,Nr(gn)],(o,[e,r])=>function(a,f,c,p){for(;c<=p;){let v=c+p>>1;if(f[v]===a)return!0;f[v]>a?p=v-1:c=v+1}return!1}(o.properties()[e.value],r.value,0,r.value.length-1)],all:{type:dn,overloads:[[[dn,dn],(o,[e,r])=>e.evaluate(o)&&r.evaluate(o)],[Bs(dn),(o,e)=>{for(let r of e)if(!r.evaluate(o))return!1;return!0}]]},any:{type:dn,overloads:[[[dn,dn],(o,[e,r])=>e.evaluate(o)||r.evaluate(o)],[Bs(dn),(o,e)=>{for(let r of e)if(r.evaluate(o))return!0;return!1}]]},"!":[dn,[dn],(o,[e])=>!e.evaluate(o)],"is-supported-script":[dn,[Tn],(o,[e])=>{let r=o.globals&&o.globals.isSupportedScript;return!r||r(e.evaluate(o))}],upcase:[Tn,[Tn],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[Tn,[Tn],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[Tn,Bs(gn),(o,e)=>e.map(r=>Yi(r.evaluate(o))).join("")],"resolved-locale":[Tn,[uc],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[yt,[yt,yt,gn],(o,e)=>{let[r,a,f]=e.map(p=>p.evaluate(o));if(r>a||r===a)return r;let c;if(typeof f=="string")c=function(p){let v=0;if(p.length===0)return v;for(let w=0;w<p.length;w++)v=(v<<5)-v+p.charCodeAt(w),v|=0;return v}(f);else{if(typeof f!="number")throw new xr(`Invalid seed input: ${f}`);c=f}return r+ah(c)()*(a-r)}]});class uh{constructor(e,r,a,f){this.expression=e,this._warningHistory={},this._evaluator=new nf(a,f),this._defaultValue=r?function(c){return c.type==="color"&&(Rf(c.default)||Array.isArray(c.default))?new vn(0,0,0,0):c.type==="color"?vn.parse(c.default)||null:c.default===void 0?null:c.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=Tc(e)}evaluateWithoutErrorHandling(e,r,a,f,c,p,v,w){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=f||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,f,c,p,v,w){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{let M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new xr(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function Tl(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in wl}function Il(o,e,r,a){let f=new Ic(wl,[],e?function(p){let v={color:Zr,string:Tn,number:yt,enum:Tn,boolean:dn,formatted:Po,resolvedImage:hc};return p.type==="array"?Nr(v[p.value]||gn,p.length):v[p.type]}(e):void 0,void 0,void 0,r,a),c=f.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Af(new uh(c,e,r,a)):zi(f.errors)}class hh{constructor(e,r,a,f){this.kind=e,this._styleExpression=r,this.isLightConstant=a,this.isLineProgressConstant=f,this.isStateDependent=e!=="constant"&&!Ec(r.expression),this.configDependencies=Tc(r.expression)}evaluateWithoutErrorHandling(e,r,a,f,c,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,f,c,p)}evaluate(e,r,a,f,c,p){return this._styleExpression.evaluate(e,r,a,f,c,p)}}class Rc{constructor(e,r,a,f,c,p){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Ec(r.expression),this.isLightConstant=c,this.isLineProgressConstant=p,this.configDependencies=Tc(r.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,r,a,f,c,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,f,c,p)}evaluate(e,r,a,f,c,p){return this._styleExpression.evaluate(e,r,a,f,c,p)}interpolationFactor(e,r,a){return this.interpolationType?Ci.interpolationFactor(this.interpolationType,e,r,a):0}}function bg(o,e,r,a){if((o=Il(o,e,r,a)).result==="error")return o;let f=o.value.expression,c=_l(f);if(!c&&!Cc(e))return zi([new Qt("","data expressions not supported")]);let p=_a(f,["zoom","pitch","distance-from-center"]);if(!p&&!ch(e))return zi([new Qt("","zoom expressions not supported")]);let v=_a(f,["measure-light"]);if(!v&&!yg(e))return zi([new Qt("","measure-light expression not supported")]);let w=_a(f,["line-progress"]);if(!w&&!function(E){return lh(E.expression,"line-progress")}(e))return zi([new Qt("","line-progress expression not supported")]);let M=e.expression&&e.expression.relaxZoomRestriction,_=Oc(f);return _||p||M?_ instanceof Qt?zi([_]):_ instanceof Ci&&!Ac(e)?zi([new Qt("",'"interpolate" expressions cannot be used with this property')]):Af(_?new Rc(c&&w?"camera":"composite",o.value,_.labels,_ instanceof Ci?_.interpolation:void 0,v,w):new hh(c&&w?"constant":"source",o.value,v,w)):zi([new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Pc{constructor(e,r){this._parameters=e,this._specification=r,Hu(this,Pf(this._parameters,this._specification))}static deserialize(e){return new Pc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Oc(o){let e=null;if(o instanceof ih)e=Oc(o.result);else if(o instanceof rh){for(let r of o.args)if(e=Oc(r),e)break}else(o instanceof vl||o instanceof Ci)&&o.input instanceof xi&&o.input.name==="zoom"&&(e=o);return e instanceof Qt||o.eachChild(r=>{let a=Oc(r);a instanceof Qt?e=a:e&&a&&e!==a&&(e=new Qt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Of,wg,p0=function(){if(wg)return Of;wg=1,Of=e;var o=3;function e(r,a,f){var c=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var p=new Int32Array(this.arrayBuffer);r=p[0],this.d=(a=p[1])+2*(f=p[2]);for(var v=0;v<this.d*this.d;v++){var w=p[o+v],M=p[o+v+1];c.push(w===M?null:p.subarray(w,M))}var _=p[o+c.length+1];this.keys=p.subarray(p[o+c.length],_),this.bboxes=p.subarray(_),this.insert=this._insertReadonly}else{this.d=a+2*f;for(var E=0;E<this.d*this.d;E++)c.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=r,this.padding=f,this.scale=a/r,this.uid=0;var D=f/a*r;this.min=-D,this.max=r+D}return e.prototype.insert=function(r,a,f,c,p){this._forEachCell(a,f,c,p,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,a,f,c,p,v){this.cells[p].push(v)},e.prototype.query=function(r,a,f,c,p){var v=this.min,w=this.max;if(r<=v&&a<=v&&w<=f&&w<=c&&!p)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(r,a,f,c,this._queryCell,M,{},p),M},e.prototype._queryCell=function(r,a,f,c,p,v,w,M){var _=this.cells[p];if(_!==null)for(var E=this.keys,D=this.bboxes,b=0;b<_.length;b++){var T=_[b];if(w[T]===void 0){var C=4*T;(M?M(D[C+0],D[C+1],D[C+2],D[C+3]):r<=D[C+2]&&a<=D[C+3]&&f>=D[C+0]&&c>=D[C+1])?(w[T]=!0,v.push(E[T])):w[T]=!1}}},e.prototype._forEachCell=function(r,a,f,c,p,v,w,M){for(var _=this._convertToCellCoord(r),E=this._convertToCellCoord(a),D=this._convertToCellCoord(f),b=this._convertToCellCoord(c),T=_;T<=D;T++)for(var C=E;C<=b;C++){var O=this.d*C+T;if((!M||M(this._convertFromCellCoord(T),this._convertFromCellCoord(C),this._convertFromCellCoord(T+1),this._convertFromCellCoord(C+1)))&&p.call(this,r,a,f,c,O,v,w,M))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,a=o+this.cells.length+1+1,f=0,c=0;c<this.cells.length;c++)f+=this.cells[c].length;var p=new Int32Array(a+f+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var v=a,w=0;w<r.length;w++){var M=r[w];p[o+w]=v,p.set(M,v),v+=M.length}return p[o+r.length]=v,p.set(this.keys,v),p[o+r.length+1]=v+=this.keys.length,p.set(this.bboxes,v),v+=this.bboxes.length,p.buffer},Of}(),xa=F(p0);let dh={};function _t(o,e,r={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),dh[e]={klass:o,omit:r.omit||[]}}_t(Object,"Object"),xa.serialize=function(o,e){let r=o.toArrayBuffer();return e&&e.add(r),{buffer:r}},xa.deserialize=function(o){return new xa(o.buffer)},Object.defineProperty(xa,"name",{value:"Grid"}),_t(xa,"Grid"),typeof DOMMatrix<"u"&&_t(DOMMatrix,"DOMMatrix"),_t(vn,"Color"),_t(Error,"Error"),_t(Xr,"Formatted"),_t(fc,"FormattedSection"),_t(vr,"AJAXError"),_t(Hr,"ResolvedImage"),_t(Pc,"StylePropertyFunction"),_t(uh,"StyleExpression",{omit:["_evaluator"]}),_t(Oo,"ImageIdWithOptions"),_t(Rc,"ZoomDependentExpression"),_t(hh,"ZoomConstantExpression"),_t(xi,"CompoundExpression",{omit:["_evaluate"]});for(let o in wl)dh[wl[o]._classRegistryKey]||_t(wl[o],`Expression${o}`);function Lf(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function kf(o){return self.ImageBitmap&&o instanceof ImageBitmap}function Vs(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Lf(o)||kf(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){let r=[];for(let a of o)r.push(Vs(a,e));return r}if(o instanceof Map){let r={$name:"Map"};for(let[a,f]of o.entries())r[a]=Vs(f);return r}if(o instanceof Set){let r={$name:"Set"},a=0;for(let f of o.values())r[++a]=Vs(f);return r}if(typeof o=="object"){let r=o.constructor,a=r._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${a}".`);let f=r.serialize?r.serialize(o,e):{};if(!r.serialize){for(let c in o)o.hasOwnProperty(c)&&(dh[a].omit.indexOf(c)>=0||(f[c]=Vs(o[c],e)));o instanceof Error&&(f.message=o.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(f.$name=a),f}throw new Error("can't serialize object of type "+typeof o)}function ba(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Lf(o)||kf(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(ba);if(typeof o=="object"){let e=o.$name||"Object";if(e==="Map"){let f=new Map;for(let c of Object.keys(o))c!=="$name"&&f.set(c,ba(o[c]));return f}if(e==="Set"){let f=new Set;for(let c of Object.keys(o))c!=="$name"&&f.add(ba(o[c]));return f}let{klass:r}=dh[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(o);let a=Object.create(r.prototype);for(let f of Object.keys(o))f!=="$name"&&(a[f]=ba(o[f]));return a}throw new Error("can't deserialize object of type "+typeof o)}let bt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function Ff(o){for(let e of o)if(fh(e.charCodeAt(0)))return!0;return!1}function m0(o){for(let e of o)if(!g0(e.charCodeAt(0)))return!1;return!0}function g0(o){return!(bt.Arabic(o)||bt["Arabic Supplement"](o)||bt["Arabic Extended-A"](o)||bt["Arabic Presentation Forms-A"](o)||bt["Arabic Presentation Forms-B"](o))}function fh(o){return!(o!==746&&o!==747&&(o<4352||!(bt["Bopomofo Extended"](o)||bt.Bopomofo(o)||bt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||bt["CJK Compatibility Ideographs"](o)||bt["CJK Compatibility"](o)||bt["CJK Radicals Supplement"](o)||bt["CJK Strokes"](o)||!(!bt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||bt["CJK Unified Ideographs Extension A"](o)||bt["CJK Unified Ideographs"](o)||bt["Enclosed CJK Letters and Months"](o)||bt["Hangul Compatibility Jamo"](o)||bt["Hangul Jamo Extended-A"](o)||bt["Hangul Jamo Extended-B"](o)||bt["Hangul Jamo"](o)||bt["Hangul Syllables"](o)||bt.Hiragana(o)||bt["Ideographic Description Characters"](o)||bt.Kanbun(o)||bt["Kangxi Radicals"](o)||bt["Katakana Phonetic Extensions"](o)||bt.Katakana(o)&&o!==12540||!(!bt["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!bt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||bt["Unified Canadian Aboriginal Syllabics"](o)||bt["Unified Canadian Aboriginal Syllabics Extended"](o)||bt["Vertical Forms"](o)||bt["Yijing Hexagram Symbols"](o)||bt["Yi Syllables"](o)||bt["Yi Radicals"](o))))}function Nf(o){return!(fh(o)||function(e){return!!(bt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||bt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||bt["Letterlike Symbols"](e)||bt["Number Forms"](e)||bt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||bt["Control Pictures"](e)&&e!==9251||bt["Optical Character Recognition"](e)||bt["Enclosed Alphanumerics"](e)||bt["Geometric Shapes"](e)||bt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||bt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||bt["CJK Symbols and Punctuation"](e)||bt.Katakana(e)||bt["Private Use Area"](e)||bt["CJK Compatibility Forms"](e)||bt["Small Form Variants"](e)||bt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(o))}function zf(o){return o>=1424&&o<=2303||bt["Arabic Presentation Forms-A"](o)||bt["Arabic Presentation Forms-B"](o)}function Eg(o,e){return!(!e&&zf(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||bt.Khmer(o))}function Bf(o){for(let e of o)if(zf(e.charCodeAt(0)))return!0;return!1}let Lc="deferred",ph="loading",Vf="loaded",mh=null,Ai="unavailable",js=null,jf=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(Ai="error"),mh&&mh(o)};function Uf(){Sl.fire(new Ro("pluginStateChange",{pluginStatus:Ai,pluginURL:js}))}let Sl=new ks,gh=function(){return Ai},kc=function(){if(Ai!==Lc||!js)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ai=ph,Uf(),js&&Ar({url:js},o=>{o?jf(o):(Ai=Vf,Uf())})},Bi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ai===Vf||Bi.applyArabicShaping!=null,isLoading:()=>Ai===ph,setState(o){Ai=o.pluginStatus,js=o.pluginURL},isParsed:()=>Bi.applyArabicShaping!=null&&Bi.processBidirectionalText!=null&&Bi.processStyledBidirectionalText!=null,getPluginURL:()=>js};class Gn{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,a){for(let f of r)if(!Eg(f.charCodeAt(0),a))return!1;return!0}(e,Bi.isLoaded())}}class _h{constructor(e,r,a,f){this.property=e,this.value=r,this.expression=function(c,p,v,w){if(Rf(c))return new Pc(c,p);if(Tl(c)||Array.isArray(c)&&c.length>0){let M=bg(c,p,v,w);if(M.result==="error")throw new Error(M.value.map(_=>`${_.key}: ${_.message}`).join(", "));return M.value}{let M=c;return typeof c=="string"&&p.type==="color"&&(M=vn.parse(c)),{kind:"constant",configDependencies:new Set,evaluate:()=>M}}}(r===void 0?e.specification.default:r,e.specification,a,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class Fc{constructor(e,r,a){this.property=e,this.value=new _h(e,void 0,r,a)}transitioned(e,r){return new $f(this.property,this.value,r,ai({},e.transition,this.transition),e.now)}untransitioned(){return new $f(this.property,this.value,null,{},0)}}class yh{constructor(e,r,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=a,this.configDependencies=new Set}getValue(e){return Ni(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Fc(this._values[e].property,this._scope,this._options)),this._values[e].value=new _h(this._values[e].property,r===null?void 0:Ni(r),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);let a=this._properties.properties;if(e)for(let f in e){let c=e[f];if(yi(f,"-transition")){let p=f.slice(0,-11);a[p]&&this.setTransition(p,c)}else a.hasOwnProperty(f)&&this.setValue(f,c)}}getTransition(e){return Ni(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Fc(this._values[e].property)),this._values[e].transition=Ni(r)||void 0}serialize(){let e={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(e[r]=a);let f=this.getTransition(r);f!==void 0&&(e[`${r}-transition`]=f)}return e}transitioned(e,r){let a=new Nc(this._properties);for(let f of Object.keys(this._values))a._values[f]=this._values[f].transitioned(e,r._values[f]);return a}untransitioned(){let e=new Nc(this._properties);for(let r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class $f{constructor(e,r,a,f,c){let p=f.delay||0,v=f.duration||0;c=c||0,this.property=e,this.value=r,this.begin=c+p,this.end=this.begin+v,e.specification.transition&&(f.delay||f.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){let f=e.now||0,c=this.value.possiblyEvaluate(e,r,a),p=this.prior;if(p){if(f>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(f<this.begin)return p.possiblyEvaluate(e,r,a);{let v=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,a),c,Ps(v))}}return c}}class Nc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){let f=new Cl(this._properties);for(let c of Object.keys(this._values))f._values[c]=this._values[c].possiblyEvaluate(e,r,a);return f}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Dl{constructor(e,r,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=a,this.configDependencies=new Set}getValue(e){return Ni(this._values[e].value)}setValue(e,r){this._values[e]=new _h(this._values[e].property,r===null?void 0:Ni(r),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){let e={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){let f=new Cl(this._properties);for(let c of Object.keys(this._values))f._values[c]=this._values[c].possiblyEvaluate(e,r,a);return f}}class Ml{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,f){return this.property.evaluate(this.value,this.parameters,e,r,a,f)}}class Cl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class nt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){let f=$u[this.specification.type];return f?f(e,r,a):e}}class ft{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,f){return new Ml(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,f)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Ml(this,{kind:"constant",value:void 0},e.parameters);let f=$u[this.specification.type];return f?new Ml(this,{kind:"constant",value:f(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,f,c,p){return e.kind==="constant"?e.value:e.evaluate(r,a,f,c,p)}}class Al{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,f){return!!e.expression.evaluate(r,null,{},a,f)}interpolate(){return!1}}class er{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let r=new Gn(0,{});for(let a in e){let f=e[a];f.specification.overridable&&this.overridableProperties.push(a);let c=this.defaultPropertyValues[a]=new _h(f,void 0),p=this.defaultTransitionablePropertyValues[a]=new Fc(f);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=c.possiblyEvaluate(r)}}}_t(ft,"DataDrivenProperty"),_t(nt,"DataConstantProperty"),_t(Al,"ColorRampProperty");var Pe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Tg(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function vh(o){if(Array.isArray(o))return o.map(vh);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){let e={};for(let r in o)e[r]=vh(o[r]);return e}return Tg(o)}function Hf(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(let e of o.slice(1))if(!Hf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ig(o,e="",r=null,a="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Hf(o)||(o=xh(o));let f=o,c=!0;try{c=function(_){if(!Rl(_))return _;let E=vh(_);return Dg(E),E=Sg(E),E}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let p=null,v=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){v=Pe[`filter_${a}`];let _=Il(c,v,e,r);if(_.result==="error")throw new Error(_.value.map(E=>`${E.key}: ${E.message}`).join(", "));p=(E,D,b)=>_.value.evaluate(E,D,{},b)}let w=null,M=null;if(c!==f){let _=Il(f,v,e,r);if(_.result==="error")throw new Error(_.value.map(E=>`${E.key}: ${E.message}`).join(", "));w=(E,D,b,T,C)=>_.value.evaluate(E,D,{},b,void 0,void 0,T,C),M=!_l(_.value.expression)}return{filter:p,dynamicFilter:w||void 0,needGeometry:Mg(c),needFeature:!!M}}function Sg(o){if(!Array.isArray(o))return o;let e=function(r){if(_0.has(r[0])){for(let a=1;a<r.length;a++)if(Rl(r[a]))return!0}return r}(o);return e===!0?e:e.map(r=>Sg(r))}function Dg(o){let e=!1,r=[];if(o[0]==="case"){for(let a=1;a<o.length-1;a+=2)e=e||Rl(o[a]),r.push(o[a+1]);r.push(o[o.length-1])}else if(o[0]==="match"){e=e||Rl(o[1]);for(let a=2;a<o.length-1;a+=2)r.push(o[a+1]);r.push(o[o.length-1])}else if(o[0]==="step"){e=e||Rl(o[1]);for(let a=1;a<o.length-1;a+=2)r.push(o[a+1])}e&&(o.length=0,o.push("any",...r));for(let a=1;a<o.length;a++)Dg(o[a])}function Rl(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<o.length;r++)if(Rl(o[r]))return!0;return!1}let _0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function y0(o,e){return o<e?-1:o>e?1:0}function Mg(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(Mg(o[e]))return!0;return!1}function xh(o){if(!o)return!0;let e=o[0];return o.length<=1?e!=="any":e==="=="?Us(o[1],o[2],"=="):e==="!="?wa(Us(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Us(o[1],o[2],e):e==="any"?(r=o.slice(1),["any"].concat(r.map(xh))):e==="all"?["all"].concat(o.slice(1).map(xh)):e==="none"?["all"].concat(o.slice(1).map(xh).map(wa)):e==="in"?Gf(o[1],o.slice(2)):e==="!in"?wa(Gf(o[1],o.slice(2))):e==="has"?qf(o[1]):e!=="!has"||wa(qf(o[1]));var r}function Us(o,e,r){switch(o){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,o,e]}}function Gf(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",o,["literal",e.sort(y0)]]:["filter-in-small",o,["literal",e]]}}function qf(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function wa(o){return["!",o]}let bh="";function Lo(o,e){return e?`${o}${bh}${e}`:o}let us="-transition",Cg=new Set(["fill","line","background","hillshade","raster"]);class kr extends ks{constructor(e,r,a,f,c){if(super(),this.id=e.id,this.fqid=Lo(this.id,a),this.type=e.type,this.scope=a,this.lut=f,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;let p=Il(this.filter,Pe[`filter_${e.type}`]);p.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...p.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new Dl(r.layout,this.scope,c),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new yh(r.paint,this.scope,c);for(let p in e.paint)this.setPaintProperty(p,e.paint[p]);for(let p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Cl(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&Cg.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);let a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return yi(e,us)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){let a=this._transitionablePaint,f=a._properties.properties;if(yi(e,us)){let E=e.slice(0,-11);return f[E]&&a.setTransition(E,r||void 0),!1}if(!f[e])return!1;let c=a._values[e],p=c.value.isDataDriven(),v=c.value;a.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);let w=a._values[e].value,M=w.isDataDriven(),_=yi(e,"pattern")||e==="line-dasharray";return M||p||_||this._handleOverridablePaintPropertyUpdate(e,v,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,a){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return cl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let r=this.paint.get(e);if(r instanceof Ml&&Cc(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Ig(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,a,f,c,p,v,w,M){}}let v0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class zc{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xn(o,e=1){let r=0,a=0;return{members:o.map(f=>{let c=v0[f.type].BYTES_PER_ELEMENT,p=r=Ag(r,Math.max(e,c)),v=f.components||1;return a=Math.max(a,c),r+=c*v,{name:f.name,type:f.type,components:v,offset:p}}),size:Ag(r,Math.max(a,e)),alignment:e}}function Ag(o,e){return Math.ceil(o/e)*e}class hs extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){let a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){let f=2*e;return this.int16[f+0]=r,this.int16[f+1]=a,e}}hs.prototype.bytesPerElement=4,_t(hs,"StructArrayLayout2i4");class Pl extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){let f=this.length;return this.resize(f+1),this.emplace(f,e,r,a)}emplace(e,r,a,f){let c=3*e;return this.int16[c+0]=r,this.int16[c+1]=a,this.int16[c+2]=f,e}}Pl.prototype.bytesPerElement=6,_t(Pl,"StructArrayLayout3i6");class ds extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,f){let c=this.length;return this.resize(c+1),this.emplace(c,e,r,a,f)}emplace(e,r,a,f,c){let p=4*e;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=f,this.int16[p+3]=c,e}}ds.prototype.bytesPerElement=8,_t(ds,"StructArrayLayout4i8");class wh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,f,c)}emplace(e,r,a,f,c,p){let v=5*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=f,this.int16[v+3]=c,this.int16[v+4]=p,e}}wh.prototype.bytesPerElement=10,_t(wh,"StructArrayLayout5i10");class Bc extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v){let w=this.length;return this.resize(w+1),this.emplace(w,e,r,a,f,c,p,v)}emplace(e,r,a,f,c,p,v,w){let M=6*e,_=12*e,E=3*e;return this.int16[M+0]=r,this.int16[M+1]=a,this.uint8[_+4]=f,this.uint8[_+5]=c,this.uint8[_+6]=p,this.uint8[_+7]=v,this.float32[E+2]=w,e}}Bc.prototype.bytesPerElement=12,_t(Bc,"StructArrayLayout2i4ub1f12");class ko extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){let f=this.length;return this.resize(f+1),this.emplace(f,e,r,a)}emplace(e,r,a,f){let c=3*e;return this.float32[c+0]=r,this.float32[c+1]=a,this.float32[c+2]=f,e}}ko.prototype.bytesPerElement=12,_t(ko,"StructArrayLayout3f12");class Yr extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,f,c)}emplace(e,r,a,f,c,p){let v=6*e,w=3*e;return this.uint16[v+0]=r,this.uint16[v+1]=a,this.uint16[v+2]=f,this.uint16[v+3]=c,this.float32[w+2]=p,e}}Yr.prototype.bytesPerElement=12,_t(Yr,"StructArrayLayout4ui1f12");class Eh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,f){let c=this.length;return this.resize(c+1),this.emplace(c,e,r,a,f)}emplace(e,r,a,f,c){let p=4*e;return this.uint16[p+0]=r,this.uint16[p+1]=a,this.uint16[p+2]=f,this.uint16[p+3]=c,e}}Eh.prototype.bytesPerElement=8,_t(Eh,"StructArrayLayout4ui8");class Vc extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p){let v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,f,c,p)}emplace(e,r,a,f,c,p,v){let w=6*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.int16[w+2]=f,this.int16[w+3]=c,this.int16[w+4]=p,this.int16[w+5]=v,e}}Vc.prototype.bytesPerElement=12,_t(Vc,"StructArrayLayout6i12");class Wf extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v,w,M,_,E,D){let b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,f,c,p,v,w,M,_,E,D)}emplace(e,r,a,f,c,p,v,w,M,_,E,D,b){let T=12*e;return this.int16[T+0]=r,this.int16[T+1]=a,this.int16[T+2]=f,this.int16[T+3]=c,this.uint16[T+4]=p,this.uint16[T+5]=v,this.uint16[T+6]=w,this.uint16[T+7]=M,this.int16[T+8]=_,this.int16[T+9]=E,this.int16[T+10]=D,this.int16[T+11]=b,e}}Wf.prototype.bytesPerElement=24,_t(Wf,"StructArrayLayout4i4ui4i24");class Zf extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p){let v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,f,c,p)}emplace(e,r,a,f,c,p,v){let w=10*e,M=5*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.int16[w+2]=f,this.float32[M+2]=c,this.float32[M+3]=p,this.float32[M+4]=v,e}}Zf.prototype.bytesPerElement=20,_t(Zf,"StructArrayLayout3i3f20");class Ea extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f){let c=this.length;return this.resize(c+1),this.emplace(c,e,r,a,f)}emplace(e,r,a,f,c){let p=4*e;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=f,this.float32[p+3]=c,e}}Ea.prototype.bytesPerElement=16,_t(Ea,"StructArrayLayout4f16");class Xf extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Xf.prototype.bytesPerElement=4,_t(Xf,"StructArrayLayout1ul4");class $s extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){let a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){let f=2*e;return this.uint16[f+0]=r,this.uint16[f+1]=a,e}}$s.prototype.bytesPerElement=4,_t($s,"StructArrayLayout2ui4");class Yf extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v,w,M,_,E,D,b){let T=this.length;return this.resize(T+1),this.emplace(T,e,r,a,f,c,p,v,w,M,_,E,D,b)}emplace(e,r,a,f,c,p,v,w,M,_,E,D,b,T){let C=20*e,O=10*e;return this.int16[C+0]=r,this.int16[C+1]=a,this.int16[C+2]=f,this.int16[C+3]=c,this.int16[C+4]=p,this.float32[O+3]=v,this.float32[O+4]=w,this.float32[O+5]=M,this.float32[O+6]=_,this.int16[C+14]=E,this.uint32[O+8]=D,this.uint16[C+18]=b,this.uint16[C+19]=T,e}}Yf.prototype.bytesPerElement=40,_t(Yf,"StructArrayLayout5i4f1i1ul2ui40");class Th extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v){let w=this.length;return this.resize(w+1),this.emplace(w,e,r,a,f,c,p,v)}emplace(e,r,a,f,c,p,v,w){let M=8*e;return this.int16[M+0]=r,this.int16[M+1]=a,this.int16[M+2]=f,this.int16[M+4]=c,this.int16[M+5]=p,this.int16[M+6]=v,this.int16[M+7]=w,e}}Th.prototype.bytesPerElement=16,_t(Th,"StructArrayLayout3i2i2i16");class Kf extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,f,c)}emplace(e,r,a,f,c,p){let v=4*e,w=8*e;return this.float32[v+0]=r,this.float32[v+1]=a,this.float32[v+2]=f,this.int16[w+6]=c,this.int16[w+7]=p,e}}Kf.prototype.bytesPerElement=16,_t(Kf,"StructArrayLayout2f1f2i16");class Jf extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p){let v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,f,c,p)}emplace(e,r,a,f,c,p,v){let w=20*e,M=5*e;return this.uint8[w+0]=r,this.uint8[w+1]=a,this.float32[M+1]=f,this.float32[M+2]=c,this.float32[M+3]=p,this.float32[M+4]=v,e}}Jf.prototype.bytesPerElement=20,_t(Jf,"StructArrayLayout2ub4f20");class Vr extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){let f=this.length;return this.resize(f+1),this.emplace(f,e,r,a)}emplace(e,r,a,f){let c=3*e;return this.uint16[c+0]=r,this.uint16[c+1]=a,this.uint16[c+2]=f,e}}Vr.prototype.bytesPerElement=6,_t(Vr,"StructArrayLayout3ui6");class Qf extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O,L,B,j,z,U){let q=this.length;return this.resize(q+1),this.emplace(q,e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O,L,B,j,z,U)}emplace(e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O,L,B,j,z,U,q){let K=30*e,re=15*e,ne=60*e;return this.int16[K+0]=r,this.int16[K+1]=a,this.int16[K+2]=f,this.float32[re+2]=c,this.float32[re+3]=p,this.uint16[K+8]=v,this.uint16[K+9]=w,this.uint32[re+5]=M,this.uint32[re+6]=_,this.uint32[re+7]=E,this.uint16[K+16]=D,this.uint16[K+17]=b,this.uint16[K+18]=T,this.float32[re+10]=C,this.float32[re+11]=O,this.uint8[ne+48]=L,this.uint8[ne+49]=B,this.uint8[ne+50]=j,this.uint32[re+13]=z,this.int16[K+28]=U,this.uint8[ne+58]=q,e}}Qf.prototype.bytesPerElement=60,_t(Qf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ep extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O,L,B,j,z,U,q,K,re,ne,te,pe,ie,me,ye,_e,be){let Se=this.length;return this.resize(Se+1),this.emplace(Se,e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O,L,B,j,z,U,q,K,re,ne,te,pe,ie,me,ye,_e,be)}emplace(e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O,L,B,j,z,U,q,K,re,ne,te,pe,ie,me,ye,_e,be,Se){let Ae=20*e,Ie=40*e,$e=80*e;return this.float32[Ae+0]=r,this.float32[Ae+1]=a,this.int16[Ie+4]=f,this.int16[Ie+5]=c,this.int16[Ie+6]=p,this.int16[Ie+7]=v,this.int16[Ie+8]=w,this.int16[Ie+9]=M,this.int16[Ie+10]=_,this.int16[Ie+11]=E,this.int16[Ie+12]=D,this.uint16[Ie+13]=b,this.uint16[Ie+14]=T,this.uint16[Ie+15]=C,this.uint16[Ie+16]=O,this.uint16[Ie+17]=L,this.uint16[Ie+18]=B,this.uint16[Ie+19]=j,this.uint16[Ie+20]=z,this.uint16[Ie+21]=U,this.uint16[Ie+22]=q,this.uint16[Ie+23]=K,this.uint16[Ie+24]=re,this.uint16[Ie+25]=ne,this.uint16[Ie+26]=te,this.uint16[Ie+27]=pe,this.uint32[Ae+14]=ie,this.float32[Ae+15]=me,this.float32[Ae+16]=ye,this.float32[Ae+17]=_e,this.float32[Ae+18]=be,this.uint8[$e+76]=Se,e}}ep.prototype.bytesPerElement=80,_t(ep,"StructArrayLayout2f9i15ui1ul4f1ub80");class jc extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}jc.prototype.bytesPerElement=4,_t(jc,"StructArrayLayout1f4");class Hs extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,f,c)}emplace(e,r,a,f,c,p){let v=5*e;return this.float32[v+0]=r,this.float32[v+1]=a,this.float32[v+2]=f,this.float32[v+3]=c,this.float32[v+4]=p,e}}Hs.prototype.bytesPerElement=20,_t(Hs,"StructArrayLayout5f20");class Ih extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v){let w=this.length;return this.resize(w+1),this.emplace(w,e,r,a,f,c,p,v)}emplace(e,r,a,f,c,p,v,w){let M=7*e;return this.float32[M+0]=r,this.float32[M+1]=a,this.float32[M+2]=f,this.float32[M+3]=c,this.float32[M+4]=p,this.float32[M+5]=v,this.float32[M+6]=w,e}}Ih.prototype.bytesPerElement=28,_t(Ih,"StructArrayLayout7f28");class Fo extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v,w,M,_,E){let D=this.length;return this.resize(D+1),this.emplace(D,e,r,a,f,c,p,v,w,M,_,E)}emplace(e,r,a,f,c,p,v,w,M,_,E,D){let b=11*e;return this.float32[b+0]=r,this.float32[b+1]=a,this.float32[b+2]=f,this.float32[b+3]=c,this.float32[b+4]=p,this.float32[b+5]=v,this.float32[b+6]=w,this.float32[b+7]=M,this.float32[b+8]=_,this.float32[b+9]=E,this.float32[b+10]=D,e}}Fo.prototype.bytesPerElement=44,_t(Fo,"StructArrayLayout11f44");class Sh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v,w,M){let _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,f,c,p,v,w,M)}emplace(e,r,a,f,c,p,v,w,M,_){let E=9*e;return this.float32[E+0]=r,this.float32[E+1]=a,this.float32[E+2]=f,this.float32[E+3]=c,this.float32[E+4]=p,this.float32[E+5]=v,this.float32[E+6]=w,this.float32[E+7]=M,this.float32[E+8]=_,e}}Sh.prototype.bytesPerElement=36,_t(Sh,"StructArrayLayout9f36");class Ol extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){let a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){let f=2*e;return this.float32[f+0]=r,this.float32[f+1]=a,e}}Ol.prototype.bytesPerElement=8,_t(Ol,"StructArrayLayout2f8");class tp extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,f){let c=this.length;return this.resize(c+1),this.emplace(c,e,r,a,f)}emplace(e,r,a,f,c){let p=6*e;return this.uint32[3*e+0]=r,this.uint16[p+2]=a,this.uint16[p+3]=f,this.uint16[p+4]=c,e}}tp.prototype.bytesPerElement=12,_t(tp,"StructArrayLayout1ul3ui12");class np extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}np.prototype.bytesPerElement=2,_t(np,"StructArrayLayout1ui2");class Uc extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O){let L=this.length;return this.resize(L+1),this.emplace(L,e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O)}emplace(e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O,L){let B=16*e;return this.float32[B+0]=r,this.float32[B+1]=a,this.float32[B+2]=f,this.float32[B+3]=c,this.float32[B+4]=p,this.float32[B+5]=v,this.float32[B+6]=w,this.float32[B+7]=M,this.float32[B+8]=_,this.float32[B+9]=E,this.float32[B+10]=D,this.float32[B+11]=b,this.float32[B+12]=T,this.float32[B+13]=C,this.float32[B+14]=O,this.float32[B+15]=L,e}}Uc.prototype.bytesPerElement=64,_t(Uc,"StructArrayLayout16f64");class $c extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,f,c,p,v){let w=this.length;return this.resize(w+1),this.emplace(w,e,r,a,f,c,p,v)}emplace(e,r,a,f,c,p,v,w){let M=10*e,_=5*e;return this.uint16[M+0]=r,this.uint16[M+1]=a,this.uint16[M+2]=f,this.uint16[M+3]=c,this.float32[_+2]=p,this.float32[_+3]=v,this.float32[_+4]=w,e}}$c.prototype.bytesPerElement=20,_t($c,"StructArrayLayout4ui3f20");class rp extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}rp.prototype.bytesPerElement=2,_t(rp,"StructArrayLayout1i2");class Dh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Dh.prototype.bytesPerElement=1,_t(Dh,"StructArrayLayout1ub1");class Rg extends zc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Rg.prototype.size=40;class ip extends Yf{get(e){return new Rg(this,e)}}_t(ip,"CollisionBoxArray");class Hc extends zc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Hc.prototype.size=60;class Pg extends Qf{get(e){return new Hc(this,e)}}_t(Pg,"PlacedSymbolArray");class Og extends zc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Og.prototype.size=80;class Lg extends ep{get(e){return new Og(this,e)}}_t(Lg,"SymbolInstanceArray");class kg extends jc{getoffsetX(e){return this.float32[1*e+0]}}_t(kg,"GlyphOffsetArray");class Fg extends hs{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}_t(Fg,"SymbolLineVertexArray");class Gc extends zc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Gc.prototype.size=12;class qc extends tp{get(e){return new Gc(this,e)}}_t(qc,"FeatureIndexArray");class Ri extends $s{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}_t(Ri,"FillExtrusionCentroidArray");class Wc extends zc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Wc.prototype.size=6;class Ng extends Pl{get(e){return new Wc(this,e)}}_t(Ng,"FillExtrusionWallArray");let x0=xn([{name:"a_pos",components:2,type:"Int16"}],4),b0=xn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ur{constructor(e=[]){this.segments=e}_prepareSegment(e,r,a,f){let c=this.segments[this.segments.length-1];return e>ur.MAX_VERTEX_ARRAY_LENGTH&&qt(`Max vertices per segment is ${ur.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>ur.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==f)&&(c={vertexOffset:r,primitiveOffset:a,vertexLength:0,primitiveLength:0},f!==void 0&&(c.sortKey=f),this.segments.push(c)),c}prepareSegment(e,r,a,f){return this._prepareSegment(e,r.length,a.length,f)}get(){return this.segments}destroy(){for(let e of this.segments)for(let r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,f){return new ur([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:f,vaos:{},sortKey:0}])}}function Mh(o,e){return 256*(o=Yt(Math.floor(o),0,255))+Yt(Math.floor(e),0,255)}ur.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_t(ur,"SegmentVector");let w0=xn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),op=xn([{name:"a_dash",components:4,type:"Uint16"}]);class Zc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,a,f){this.ids.push(zg(e)),this.positions.push(r,a,f)}eachPosition(e,r){let a=zg(e),f=0,c=this.ids.length-1;for(;f<c;){let p=f+c>>1;this.ids[p]>=a?c=p:f=p+1}for(;this.ids[f]===a;)r(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(e,r){let a=new Float64Array(e.ids),f=new Uint32Array(e.positions);return Xc(a,f,0,a.length-1),r&&(r.add(a.buffer),r.add(f.buffer)),{ids:a,positions:f}}static deserialize(e){let r=new Zc,a;r.ids=e.ids,r.positions=e.positions;for(let f of r.ids)f!==a&&r.uniqueIds.push(f),a=f;return r.indexed=!0,r}}function zg(o){let e=+o;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:co(String(o))}function Xc(o,e,r,a){for(;r<a;){let f=o[r+a>>1],c=r-1,p=a+1;for(;;){do c++;while(o[c]<f);do p--;while(o[p]>f);if(c>=p)break;Ch(o,c,p),Ch(e,3*c,3*p),Ch(e,3*c+1,3*p+1),Ch(e,3*c+2,3*p+2)}p-r<a-p?(Xc(o,e,r,p),r=p+1):(Xc(o,e,p+1,a),a=p)}}function Ch(o,e,r){let a=o[e];o[e]=o[r],o[r]=a}_t(Zc,"FeaturePositionMap");class No{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Yc extends No{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class pr extends No{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Ji extends No{constructor(e){super(e),this.current=[0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Ll extends No{constructor(e){super(e),this.current=[0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Kc extends No{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Bg extends No{constructor(e){super(e),this.current=vn.transparent.toRenderColor(null)}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let Vg=new Float32Array(16);class Jc extends No{constructor(e){super(e),this.current=Vg}set(e,r,a){if(this.fetchUniformLocation(e,r)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let f=1;f<16;f++)if(a[f]!==this.current[f]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}let sp=new Float32Array(9),E0=new Float32Array(4);class ap extends No{constructor(e){super(e),this.current=E0}set(e,r,a){if(this.fetchUniformLocation(e,r)){for(let f=0;f<4;f++)if(a[f]!==this.current[f]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function lp(o){return[Mh(255*o.r,255*o.g),Mh(255*o.b,255*o.a)]}class Ta{constructor(e,r,a,f){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=a,this.context=f}setUniform(e,r,a,f,c){let p=f.constantOr(this.value);r.set(e,c,p instanceof vn?p.toRenderColor(this.ignoreLut?null:this.context.lut):p)}getBinding(e,r){return this.type==="color"?new Bg(e):new pr(e)}}class Ia{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,f,c){let p=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;p&&r.set(e,c,p)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new Kc(e):new pr(e)}}class fs{constructor(e,r,a,f){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(c=>({name:`a_${c}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,a,f,c,p,v){let w=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Gn(0,{brightness:p}),r,{},c,f,v):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Gn(0,{brightness:p}),r,{},c,f,v)==="none"),this.paintVertexArray.resize(e),this._setPaintValue(w,e,M,this.context)}updatePaintArray(e,r,a,f,c,p,v){let w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v},a,f,void 0,c):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:v},a,f,void 0,c)==="none"),this._setPaintValue(e,r,w,this.context)}_setPaintValue(e,r,a,f){if(this.type==="color"){let c=lp(a.toRenderColor(this.ignoreLut?null:f.lut));for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fo{constructor(e,r,a,f,c,p){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=f,this.context=c,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,a,f,c,p,v){let w=this.expression.evaluate(new Gn(this.context.zoom,{brightness:p}),r,{},c,f,v),M=this.expression.evaluate(new Gn(this.context.zoom+1,{brightness:p}),r,{},c,f,v);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Gn(this.context.zoom,{brightness:p}),r,{},c,f,v)==="none");let _=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(_,e,w,M,this.context)}updatePaintArray(e,r,a,f,c,p,v){let w=this.expression.evaluate({zoom:this.context.zoom,brightness:v},a,f,void 0,c),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},a,f,void 0,c);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:v},a,f,void 0,c)==="none"),this._setPaintValue(e,r,w,M,this.context)}_setPaintValue(e,r,a,f,c){if(this.type==="color"){let p=lp(a.toRenderColor(this.ignoreLut?null:c.lut)),v=lp(a.toRenderColor(this.ignoreLut?null:c.lut));for(let w=e;w<r;w++)this.paintVertexArray.emplace(w,p[0],p[1],v[0],v[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,a,f);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,f,c){let p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,v=Yt(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);r.set(e,c,v)}getBinding(e,r){return new pr(e)}}class Gs{constructor(e,r,a,f,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(a==="array"?op:w0).members;for(let p=0;p<r.length;++p);this.paintVertexArray=new f}populatePaintArray(e,r,a,f){let c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,f,c,p,v){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,r,a,f){if(!f||!a)return;let c=f[a];if(!c)return;let{tl:p,br:v,pixelRatio:w}=c;for(let M=e;M<r;M++)this.paintVertexArray.emplace(M,p[0],p[1],v[0],v[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sa{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[],this.context=r;let f=[];for(let c in e.paint._values){let p=e.paint.get(c),v=e.paint.get(`${c}-use-theme`);if(c.endsWith("-use-theme")||!a(c)||!(p instanceof Ml&&Cc(p.property.specification)))continue;let w=I0(c,e.type),M=p.value,_=p.property.specification.type,E=!!p.property.useIntegerZoom,D=c==="line-dasharray"||c.endsWith("pattern"),b=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||v&&v.value.kind!=="constant";if(M.kind!=="constant"||b)if(M.kind==="source"||b||D){let T=jg(c,_,"source");this.binders[c]=D?new Gs(M,w,_,T,e.id):new fs(M,w,_,T),f.push(`/a_${c}`)}else{let T=jg(c,_,"composite");this.binders[c]=new fo(M,w,_,E,r,T),f.push(`/z_${c}`)}else this.binders[c]=D?new Ia(M.value,w):new Ta(M.value,w,_,r),f.push(`/u_${c}`);v&&(this.binders[c].ignoreLut=v.constantOr("default")==="none",this.binders[c].lutExpression=v.value,this.binders[c].checkUseTheme=!0)}this.cacheKey=f.sort().join("")}getMaxValue(e){let r=this.binders[e];return r instanceof fs||r instanceof fo?r.maxValue:0}populatePaintArrays(e,r,a,f,c,p,v){for(let w in this.binders){let M=this.binders[w];M.context=this.context,M instanceof fs||M instanceof fo||M instanceof Gs?M.populatePaintArray(e,r,a,f,c,p,v):M.lutExpression&&M instanceof Ta&&M.lutExpression&&(M.lutExpression.kind==="composite"||M.lutExpression.kind==="source")&&(M.ignoreLut=M.lutExpression.evaluate(new Gn(0,{brightness:p}),r,{},c,f,v)==="none")}}setConstantPatternPositions(e){for(let r in this.binders){let a=this.binders[r];a instanceof Ia&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,f,c,p,v,w,M){let _=!1,E=Object.keys(e),D=E.length!==0&&!w,b=D?E:r.uniqueIds;this.context.lut=c.lut;for(let T in this.binders){let C=this.binders[T];if(C.context=this.context,(C instanceof fs||C instanceof fo||C instanceof Gs)&&C.expression&&C.expression.kind&&C.expression.kind!=="constant"&&(C.expression.isStateDependent===!0||C.expression.isLightConstant===!1)){let O=c.paint.get(T);C.expression=O.value;for(let L of b){let B=e[L.toString()];r.eachPosition(L,(j,z,U)=>{let q=f.feature(j);C.updatePaintArray(z,U,q,B,p,v,M)})}if(!D)for(let L of a.uniqueIds){let B=e[L.toString()];a.eachPosition(L,(j,z,U)=>{let q=f.feature(j);C.updatePaintArray(z,U,q,B,p,v,M)})}_=!0}}return _}defines(){let e=[];for(let r in this.binders){let a=this.binders[r];(a instanceof Ta||a instanceof Ia)&&e.push(...a.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){let e=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof fs||a instanceof fo||a instanceof Gs)for(let f=0;f<a.paintVertexAttributes.length;f++)e.push(a.paintVertexAttributes[f].name)}return e}getBinderUniforms(){let e=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof Ta||a instanceof Ia||a instanceof fo)for(let f of a.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let r=[];for(let a in this.binders){let f=this.binders[a];if(f instanceof Ta||f instanceof Ia||f instanceof fo)for(let c of f.uniformNames)r.push({name:c,property:a,binding:f.getBinding(e,c)})}return r}setUniforms(e,r,a,f,c){for(let{name:p,property:v,binding:w}of a){if(this.binders[v].checkUseTheme&&this.binders[v]instanceof Ta){let M=f.get(`${v}-use-theme`);M.isConstant()&&(this.binders[v].ignoreLut=M.constantOr("default")==="none")}this.binders[v].setUniform(e,w,c,f.get(v),p)}}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let r=this.binders[e];(r instanceof fs||r instanceof fo||r instanceof Gs)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(let r in this.binders){let a=this.binders[r];(a instanceof fs||a instanceof fo||a instanceof Gs)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let r=this.binders[e];(r instanceof fs||r instanceof fo||r instanceof Gs)&&r.destroy()}}}class qs{constructor(e,r,a=()=>!0){this.programConfigurations={};for(let f of e)this.programConfigurations[f.id]=new Sa(f,r,a);this.needsUpload=!1,this._featureMap=new Zc,this._featureMapWithoutIds=new Zc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,a,f,c,p,v,w){for(let M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,r,f,c,p,v,w);r.id!==void 0?this._featureMap.add(r.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,f,c,p,v){for(let w of a)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,w,f,c,p,v||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let T0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function I0(o,e){return T0[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}let S0={"line-pattern":{source:Yr,composite:Yr},"fill-pattern":{source:Yr,composite:Yr},"fill-extrusion-pattern":{source:Yr,composite:Yr},"line-dasharray":{source:Eh,composite:Eh}},Ah={color:{source:Ol,composite:Ea},number:{source:jc,composite:Ol}};function jg(o,e,r){let a=S0[o];return a&&a[r]||Ah[e][r]}_t(Ta,"ConstantBinder"),_t(Ia,"PatternConstantBinder"),_t(fs,"SourceExpressionBinder"),_t(Gs,"PatternCompositeBinder"),_t(fo,"CompositeExpressionBinder"),_t(Sa,"ProgramConfiguration",{omit:["_buffers"]}),_t(qs,"ProgramConfigurationSet");let ui=ct/Math.PI/2,kl=5,Ug=6,$g=16383,Fl=64,Rh=[Fl,32,16],Vi=-ui,ji=ui;function Nl(o,e,r,a=ui){return r=ln(r),[o*Math.sin(r)*a,-e*a,o*Math.cos(r)*a]}function Da(o,e,r){return Nl(Math.cos(ln(o)),Math.sin(ln(o)),e,r)}let Ma=63710088e-1,cp=2*Math.PI*Ma;class mn{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mn(ao(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let r=Math.PI/180,a=this.lat*r,f=e.lat*r,c=Math.sin(a)*Math.sin(f)+Math.cos(a)*Math.cos(f)*Math.cos((e.lng-this.lng)*r);return Ma*Math.acos(Math.min(c,1))}toBounds(e=0){let r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new Ws({lng:this.lng-a,lat:this.lat-r},{lng:this.lng+a,lat:this.lat+r})}toEcef(e){return Da(this.lat,this.lng,ui+e*ui/Ma)}static convert(e){if(e instanceof mn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new mn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new mn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ws{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){let a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{let a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof mn?new mn(e.lng,e.lat):mn.convert(e),this}setSouthWest(e){return this._sw=e instanceof mn?new mn(e.lng,e.lat):mn.convert(e),this}extend(e){let r=this._sw,a=this._ne,f,c;if(e instanceof mn)f=e,c=e;else{if(!(e instanceof Ws))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ws.convert(e)):this.extend(mn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(mn.convert(e)):this;if(f=e._sw,c=e._ne,!f||!c)return this}return r||a?(r.lng=Math.min(f.lng,r.lng),r.lat=Math.min(f.lat,r.lat),a.lng=Math.max(c.lng,a.lng),a.lat=Math.max(c.lat,a.lat)):(this._sw=new mn(f.lng,f.lat),this._ne=new mn(c.lng,c.lat)),this}getCenter(){return new mn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new mn(this.getWest(),this.getNorth())}getSouthEast(){return new mn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:r,lat:a}=mn.convert(e),f=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&f}static convert(e){if(e)return e instanceof Ws?e:new Ws(e)}}let D0=0,M0=25.5;function Ph(o){return cp*Math.cos(o*Math.PI/180)}function zo(o){return(180+o)/360}function po(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function hi(o,e){return o/Ph(e)}function Pi(o){return 360*o-180}function jr(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Hg(o,e){return o*Ph(jr(e))}let hr=85.051129;function up(o){return Math.cos(ln(Yt(o,-hr,hr)))}function zl(o,e){let r=Yt(e,D0,M0),a=Math.pow(2,r);return up(o)*cp/(512*a)}function u(o){return 1/Math.cos(o*Math.PI/180)}function t(o,e=0){let r=Math.exp(Math.PI*(1-(o.y+e/ct)/(1<<o.z)*2));return 80150034*r/(r*r+1)/ct/(1<<o.z)}class i{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){let a=mn.convert(e);return new i(zo(a.lng),po(a.lat),hi(r,a.lat))}toLngLat(){return new mn(Pi(this.x),jr(this.y))}toAltitude(){return Hg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/cp*u(jr(this.y))}}function d(o,e,r,a,f,c,p,v,w){let M=(e+a)/2,_=(r+f)/2,E=new at(M,_);v(E),function(D,b,T,C,O,L){let B=T-O,j=C-L;return Math.abs((C-b)*B-(T-D)*j)/Math.hypot(B,j)}(E.x,E.y,c.x,c.y,p.x,p.y)>=w?(d(o,e,r,M,_,c,E,v,w),d(o,M,_,a,f,E,p,v,w)):o.push(p)}function m(o,e,r){let a=o[0],f=a.x,c=a.y;e(a);let p=[a];for(let v=1;v<o.length;v++){let w=o[v],{x:M,y:_}=w;e(w),d(p,f,c,M,_,a,w,e,r),f=M,c=_,a=w}return p}function y(o,e,r,a){if(a(e,r)){let f=e.add(r)._mult(.5);y(o,e,f,a),y(o,f,r,a)}else o.push(r)}function x(o,e){let r=o[0],a=[r];for(let f=1;f<o.length;f++){let c=o[f];y(a,r,c,e),r=c}return a}let S=Math.pow(2,14)-1,A=-S-1;function R(o,e){let r=Math.round(o.x*e),a=Math.round(o.y*e);return o.x=Yt(r,A,S),o.y=Yt(a,A,S),(r<o.x||r>o.x+1||a<o.y||a>o.y+1)&&qt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function P(o,e,r){let a=o.loadGeometry(),f=o.extent,c=ct/f;if(e&&r&&r.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:v,x:w,y:M,projection:_}=r,E=D=>{let b=Pi((e.x+D.x/f)/p),T=jr((e.y+D.y/f)/p),C=_.project(b,T);D.x=(C.x*v-w)*f,D.y=(C.y*v-M)*f};for(let D=0;D<a.length;D++)if(o.type!==1)a[D]=m(a[D],E,1);else{let b=[];for(let T of a[D])T.x<0||T.x>=f||T.y<0||T.y>=f||(E(T),b.push(T));a[D]=b}}for(let p of a)for(let v of p)R(v,c);return a}function k(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?P(o):[]}}function N(o,e,r,a,f){o.emplaceBack(2*e+(a+1)/2,2*r+(f+1)/2)}function V(o,e,r){o.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Z{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new hs,this.indexArray=new Vr,this.segments=new ur,this.programConfigurations=new qs(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(e,r){}populate(e,r,a,f){let c=this.layers[0],p=[],v=null;c.type==="circle"&&(v=c.layout.get("circle-sort-key"));for(let{feature:M,id:_,index:E,sourceLayerIndex:D}of e){let b=this.layers[0]._featureFilter.needGeometry,T=k(M,b);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),T,a))continue;let C=v?v.evaluate(T,{},a):void 0,O={id:_,properties:M.properties,type:M.type,sourceLayerIndex:D,index:E,geometry:b?T.geometry:P(M,a,f),patterns:{},sortKey:C};p.push(O)}v&&p.sort((M,_)=>M.sortKey-_.sortKey);let w=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new Vc,w=f.projection);for(let M of p){let{geometry:_,index:E,sourceLayerIndex:D}=M,b=e[E].feature;this.addFeature(M,_,E,r.availableImages,a,w,r.brightness),r.featureIndex.insert(b,_,E,D,this.index)}}update(e,r,a,f,c,p,v){this.programConfigurations.updatePaintArrays(e,r,c,a,f,p,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,x0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,b0.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,f,c,p,v){for(let w of r)for(let M of w){let _=M.x,E=M.y;if(_<0||_>=ct||E<0||E>=ct)continue;if(p){let T=p.projectTilePoint(_,E,c),C=p.upVector(c,_,E),O=this.globeExtVertexArray;V(O,T,C),V(O,T,C),V(O,T,C),V(O,T,C)}let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),b=D.vertexLength;N(this.layoutVertexArray,_,E,-1,-1),N(this.layoutVertexArray,_,E,1,-1),N(this.layoutVertexArray,_,E,1,1),N(this.layoutVertexArray,_,E,-1,1),this.indexArray.emplaceBack(b,b+1,b+2),this.indexArray.emplaceBack(b,b+2,b+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},f,c,v)}}function G(o,e){for(let r=0;r<o.length;r++)if(le(e,o[r]))return!0;for(let r=0;r<e.length;r++)if(le(o,e[r]))return!0;return!!se(o,e)}function Y(o,e,r){return!!le(o,e)||!!fe(e,o,r)}function X(o,e){if(o.length===1)return he(e,o[0]);for(let r=0;r<e.length;r++){let a=e[r];for(let f=0;f<a.length;f++)if(le(o,a[f]))return!0}for(let r=0;r<o.length;r++)if(he(e,o[r]))return!0;for(let r=0;r<e.length;r++)if(se(o,e[r]))return!0;return!1}function ee(o,e,r){if(o.length>1){if(se(o,e))return!0;for(let a=0;a<e.length;a++)if(fe(e[a],o,r))return!0}for(let a=0;a<o.length;a++)if(fe(o[a],e,r))return!0;return!1}function se(o,e){if(o.length===0||e.length===0)return!1;for(let r=0;r<o.length-1;r++){let a=o[r],f=o[r+1];for(let c=0;c<e.length-1;c++)if(oe(a,f,e[c],e[c+1]))return!0}return!1}function oe(o,e,r,a){return Do(o,r,a)!==Do(e,r,a)&&Do(o,e,r)!==Do(o,e,a)}function fe(o,e,r){let a=r*r;if(e.length===1)return o.distSqr(e[0])<a;for(let f=1;f<e.length;f++)if(ce(o,e[f-1],e[f])<a)return!0;return!1}function ce(o,e,r){let a=e.distSqr(r);if(a===0)return o.distSqr(e);let f=((o.x-e.x)*(r.x-e.x)+(o.y-e.y)*(r.y-e.y))/a;return o.distSqr(f<0?e:f>1?r:r.sub(e)._mult(f)._add(e))}function he(o,e){let r,a,f,c=!1;for(let p=0;p<o.length;p++){r=o[p];for(let v=0,w=r.length-1;v<r.length;w=v++)a=r[v],f=r[w],a.y>e.y!=f.y>e.y&&e.x<(f.x-a.x)*(e.y-a.y)/(f.y-a.y)+a.x&&(c=!c)}return c}function le(o,e){let r=!1;for(let a=0,f=o.length-1;a<o.length;f=a++){let c=o[a],p=o[f];c.y>e.y!=p.y>e.y&&e.x<(p.x-c.x)*(e.y-c.y)/(p.y-c.y)+c.x&&(r=!r)}return r}function ge(o,e,r,a,f){for(let p of o)if(e<=p.x&&r<=p.y&&a>=p.x&&f>=p.y)return!0;let c=[new at(e,r),new at(e,f),new at(a,f),new at(a,r)];if(o.length>2){for(let p of c)if(le(o,p))return!0}for(let p=0;p<o.length-1;p++)if(we(o[p],o[p+1],c))return!0;return!1}function we(o,e,r){let a=r[0],f=r[2];if(o.x<a.x&&e.x<a.x||o.x>f.x&&e.x>f.x||o.y<a.y&&e.y<a.y||o.y>f.y&&e.y>f.y)return!1;let c=Do(o,e,r[0]);return c!==Do(o,e,r[1])||c!==Do(o,e,r[2])||c!==Do(o,e,r[3])}function Be(o,e,r,a,f,c){let p=e.y-o.y,v=o.x-e.x;if(c=c||0){let w=p*p+v*v;if(w===0)return!0;let M=Math.sqrt(w);p/=M,v/=M}return!((r.x-o.x)*p+(r.y-o.y)*v-c<0||(a.x-o.x)*p+(a.y-o.y)*v-c<0||(f.x-o.x)*p+(f.y-o.y)*v-c<0)}function Re(o,e,r,a,f,c,p){return!(Be(o,e,a,f,c,p)||Be(e,r,a,f,c,p)||Be(r,o,a,f,c,p)||Be(a,f,o,e,r,p)||Be(f,c,o,e,r,p)||Be(c,a,o,e,r,p))}function Ge(o,e,r){let a=e.paint.get(o).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(o)}function He(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Me(o,e,r,a,f){if(!e[0]&&!e[1])return o;let c=at.convert(e)._mult(f);r==="viewport"&&c._rotate(-a);let p=[];for(let v=0;v<o.length;v++)p.push(o[v].sub(c));return p}function Ve(o,e,r,a){let f=at.convert(o)._mult(a);return e==="viewport"&&f._rotate(-r),f}let Qe,De;_t(Z,"CircleBucket",{omit:["layers"]});var We,je={exports:{}},it=(We||(We=1,function(o,e){(function(r){function a(c,p,v){var w=f(256*c,256*(p=Math.pow(2,v)-p-1),v),M=f(256*(c+1),256*(p+1),v);return w[0]+","+w[1]+","+M[0]+","+M[1]}function f(c,p,v){var w=2*Math.PI*6378137/256/Math.pow(2,v);return[c*w-2*Math.PI*6378137/2,p*w-2*Math.PI*6378137/2]}r.getURL=function(c,p,v,w,M,_){return _=_||{},c+"?"+["bbox="+a(v,w,M),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+p].join("&")},r.getTileBBox=a,r.getMercCoords=f,Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,je.exports)),je.exports);class Ye{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=rt(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){let a=it.getTileBBox(this.x,this.y,this.z),f=function(c,p,v){let w,M="";for(let _=c;_>0;_--)w=1<<_-1,M+=(p&w?1:0)+(v&w?2:0);return M}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qe{constructor(e,r){this.wrap=e,this.canonical=r,this.key=rt(e,r.z,r.z,r.x,r.y)}}class et{constructor(e,r,a,f,c){this.overscaledZ=e,this.wrap=r,this.canonical=new Ye(a,+f,+c),this.key=r===0&&e===a?this.canonical.key:rt(r,e,a,f,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let r=this.canonical.z-e;return e>this.canonical.z?new et(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new et(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return rt(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return rt(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new et(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,a=2*this.canonical.x,f=2*this.canonical.y;return[new et(r,this.wrap,r,a,f),new et(r,this.wrap,r,a+1,f),new et(r,this.wrap,r,a,f+1),new et(r,this.wrap,r,a+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new et(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new et(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qe(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function rt(o,e,r,a,f){let c=1<<Math.min(r,22),p=c*(f%c)+a%c;return o&&r<22&&(p+=c*c*((o<0?-2*o-1:2*o)%(1<<2*(22-r)))),16*(32*p+r)+(e-r)}let dt=[o=>{let e=o.canonical.x-1,r=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,r--),new et(o.overscaledZ,r,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,r=o.wrap;return e===1<<o.canonical.z&&(e=0,r++),new et(o.overscaledZ,r,o.canonical.z,e,o.canonical.y)},o=>new et(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new et(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];_t(Ye,"CanonicalTileID"),_t(et,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let gt=xn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Pt}=gt,Et=xn([{name:"a_pos_3",components:3,type:"Int16"}]);var St=xn([{name:"a_pos",type:"Int16",components:2}]);class Nt{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){let f=Ee.vec3.dot(r,this.dir);if(Math.abs(f)<1e-6)return!1;let c=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/f;return a[0]=this.pos[0]+this.dir[0]*c,a[1]=this.pos[1]+this.dir[1]*c,a[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,r,a){if(Ee.vec3.equals(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;let[f,c,p]=this.dir,v=this.pos[0]-e[0],w=this.pos[1]-e[1],M=this.pos[2]-e[2],_=f*f+c*c+p*p,E=2*(v*f+w*c+M*p),D=E*E-4*_*(v*v+w*w+M*M-r*r);if(D<0){let b=Math.max(-E/2,0),T=v+f*b,C=w+c*b,O=M+p*b,L=Math.hypot(T,C,O);return a[0]=T*r/L,a[1]=C*r/L,a[2]=O*r/L,!1}{let b=(-E-Math.sqrt(D))/(2*_);if(b<0){let T=Math.hypot(v,w,M);return a[0]=v*r/T,a[1]=w*r/T,a[2]=M*r/T,!1}return a[0]=v+f*b,a[1]=w+c*b,a[2]=M+p*b,!0}}}class an{constructor(e,r,a,f,c){this.TL=e,this.TR=r,this.BR=a,this.BL=f,this.horizon=c}static fromInvProjectionMatrix(e,r,a){let f=[-1,1,1],c=[1,1,1],p=[1,-1,1],v=[-1,-1,1],w=Ee.vec3.transformMat4(f,f,e),M=Ee.vec3.transformMat4(c,c,e),_=Ee.vec3.transformMat4(p,p,e),E=Ee.vec3.transformMat4(v,v,e);return new an(w,M,_,E,r/a)}}function An(o,e,r){let a=1/0,f=-1/0,c=[];for(let p of o){Ee.vec3.sub(c,p,e);let v=Ee.vec3.dot(c,r);a=Math.min(a,v),f=Math.max(f,v)}return[a,f]}function ir(o,e){let r=!0;for(let a=0;a<o.planes.length;a++){let f=o.planes[a],c=0;for(let p=0;p<e.length;p++)c+=Ee.vec3.dot(f,e[p])+f[3]>=0;if(c===0)return 0;c!==e.length&&(r=!1)}return r?2:1}function Wn(o,e){for(let r of o.projections){let a=An(e,o.points[0],r.axis);if(r.projection[1]<a[0]||r.projection[0]>a[1])return 0}return 1}function jt(o,e){let r=0,a=[0,0,0,0];for(let f=0;f<o.length;f++)a[0]=o[f][0],a[1]=o[f][1],a[2]=o[f][2],a[3]=1,Ee.vec4.dot(a,e)>=0&&r++;return r}class fn{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=wt.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ee.vec3.sub([],this.points[2],this.points[3]),Ee.vec3.sub([],this.points[0],this.points[3]),Ee.vec3.sub([],this.points[4],this.points[0]),Ee.vec3.sub([],this.points[5],this.points[1]),Ee.vec3.sub([],this.points[6],this.points[2]),Ee.vec3.sub([],this.points[7],this.points[3])];for(let a of this.frustumEdges){let f=[0,-a[2],a[1]],c=[a[2],0,-a[0]];this.projections.push({axis:f,projection:An(this.points,this.points[0],f)}),this.projections.push({axis:c,projection:An(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(e,r,a,f){let c=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{let _=Ee.vec4.transformMat4([],M,e),E=1/_[3]/r*c;return Ee.vec4.mul(_,_,[E,E,f?1/_[3]:E,E])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{let _=Ee.vec3.sub([],p[M[0]],p[M[1]]),E=Ee.vec3.sub([],p[M[2]],p[M[1]]),D=Ee.vec3.normalize([],Ee.vec3.cross([],_,E)),b=-Ee.vec3.dot(D,p[M[1]]);return D.concat(b)}),w=[];for(let M=0;M<p.length;M++)w.push([p[M][0],p[M][1],p[M][2]]);return new fn(w,v)}intersectsPrecise(e,r,a){for(let f=0;f<r.length;f++)if(!jt(e,r[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!jt(e,this.planes[f]))return 0;for(let f of a)for(let c of this.frustumEdges){let p=Ee.vec3.cross([],f,c),v=Ee.vec3.length(p);if(v===0)continue;Ee.vec3.scale(p,p,1/v);let w=An(this.points,this.points[0],p),M=An(e,this.points[0],p);if(w[0]>M[1]||M[0]>w[1])return 0}return 1}containsPoint(e){for(let r of this.planes){let a=r[3];if(Ee.vec3.dot([r[0],r[1],r[2]],e)+a<0)return!1}return!0}}class wt{static fromPoints(e){let r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let f of e)Ee.vec3.min(r,r,f),Ee.vec3.max(a,a,f);return new wt(r,a)}static fromTileIdAndHeight(e,r,a){let f=1<<e.canonical.z,c=e.canonical.x,p=e.canonical.y;return new wt([c/f,p/f,r],[(c+1)/f,(p+1)/f,a])}static applyTransform(e,r){let a=e.getCorners();for(let f=0;f<a.length;++f)Ee.vec3.transformMat4(a[f],a[f],r);return wt.fromPoints(a)}static applyTransformFast(e,r){let a=[r[12],r[13],r[14]],f=[...a];for(let c=0;c<3;c++)for(let p=0;p<3;p++){let v=r[4*p+c],w=v*e.min[p],M=v*e.max[p];a[c]+=Math.min(w,M),f[c]+=Math.max(w,M)}return new wt(a,f)}static projectAabbCorners(e,r){let a=e.getCorners();for(let f=0;f<a.length;++f)Ee.vec3.transformMat4(a[f],a[f],r);return a}constructor(e,r){this.min=e,this.max=r,this.center=Ee.vec3.scale([],Ee.vec3.add([],this.min,this.max),.5)}quadrant(e){let r=[e%2==0,e<2],a=Ee.vec3.clone(this.min),f=Ee.vec3.clone(this.max);for(let c=0;c<r.length;c++)a[c]=r[c]?this.min[c]:this.center[c],f[c]=r[c]?this.center[c]:this.max[c];return f[2]=this.max[2],new wt(a,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?ir(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?ir(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?Wn(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?Wn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function on(o){return o*ui/Ma}_t(wt,"Aabb");let yn=[new wt([Vi,Vi,Vi],[ji,ji,ji]),new wt([Vi,Vi,Vi],[0,0,ji]),new wt([0,Vi,Vi],[ji,0,ji]),new wt([Vi,0,Vi],[0,ji,ji]),new wt([0,0,Vi],[ji,ji,ji])];function bn(o,e,r,a=!0){let f=Ee.vec3.scale([],o._camera.position,o.worldSize),c=[e,r,1,1];Ee.vec4.transformMat4(c,c,o.pixelMatrixInverse),Ee.vec4.scale(c,c,1/c[3]);let p=Ee.vec3.sub([],c,f),v=Ee.vec3.normalize([],p),w=o.globeMatrix,M=[w[12],w[13],w[14]],_=Ee.vec3.sub([],M,f),E=Ee.vec3.length(_),D=Ee.vec3.normalize([],_),b=o.worldSize/(2*Math.PI),T=Ee.vec3.dot(D,v),C=Math.asin(b/E);if(C<Math.acos(T)){if(!a)return null;let pe=[],ie=[];Ee.vec3.scale(pe,v,E/T),Ee.vec3.normalize(ie,Ee.vec3.sub(ie,pe,_)),Ee.vec3.normalize(v,Ee.vec3.add(v,_,Ee.vec3.scale(v,ie,Math.tan(C)*E)))}let O=[];new Nt(f,v).closestPointOnSphere(M,b,O);let L=Ee.vec3.normalize([],dl(w,0)),B=Ee.vec3.normalize([],dl(w,1)),j=Ee.vec3.normalize([],dl(w,2)),z=Ee.vec3.dot(L,O),U=Ee.vec3.dot(B,O),q=Ee.vec3.dot(j,O),K=Fr(Math.asin(-U/b)),re=Fr(Math.atan2(z,q));re=o.center.lng+function(pe,ie){let me=(ie-pe+180)%360-180;return me<-180?me+360:me}(o.center.lng,re);let ne=zo(re),te=Yt(po(K),0,1);return new i(ne,te)}class tr{constructor(e,r,a){this.a=Ee.vec3.sub([],e,a),this.b=Ee.vec3.sub([],r,a),this.center=a;let f=Ee.vec3.normalize([],this.a),c=Ee.vec3.normalize([],this.b);this.angle=Math.acos(Ee.vec3.dot(f,c))}}function Rr(o,e){if(o.angle===0)return null;let r;return r=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),r<0||r>1?null:function(a,f,c,p){let v=Math.sin(c);return a*(Math.sin((1-p)*c)/v)+f*(Math.sin(p*c)/v)}(o.a[e],o.b[e],o.angle,Yt(r,0,1))+o.center[e]}function Er(o){if(o.z<=1)return yn[o.z+2*o.y+o.x];let e=Un(nr(o));return wt.fromPoints(e)}function Tr(o,e,r){return Ee.vec3.scale(o,o,1-r),Ee.vec3.scaleAndAdd(o,o,e,r)}function Ui(o,e,r){for(let a of o)Ee.vec3.transformMat4(a,a,e),Ee.vec3.scale(a,a,r)}function Kr(o,e,r,a){let f=e/o.worldSize,c=o.globeMatrix;if(r.z<=1){let ne=Er(r).getCorners();return Ui(ne,c,f),wt.fromPoints(ne)}let p=nr(r,a),v=Un(p,ui+on(o._tileCoverLift));Ui(v,c,f);let w=Number.MAX_VALUE,M=[-w,-w,-w],_=[w,w,w];if(p.contains(o.center)){for(let pe of v)Ee.vec3.min(_,_,pe),Ee.vec3.max(M,M,pe);M[2]=0;let ne=o.point,te=[ne.x*f,ne.y*f,0];return Ee.vec3.min(_,_,te),Ee.vec3.max(M,M,te),new wt(_,M)}if(o._tileCoverLift>0){for(let ne of v)Ee.vec3.min(_,_,ne),Ee.vec3.max(M,M,ne);return new wt(_,M)}let E=[c[12]*f,c[13]*f,c[14]*f],D=p.getCenter(),b=Yt(o.center.lat,-hr,hr),T=Yt(D.lat,-hr,hr),C=zo(o.center.lng),O=po(b),L=C-zo(D.lng),B=O-po(T);L>.5?L-=1:L<-.5&&(L+=1);let j=0;if(Math.abs(L)>Math.abs(B))j=L>=0?1:3;else{j=B>=0?0:2;let ne=[c[4]*f,c[5]*f,c[6]*f],te=-Math.sin(ln(B>=0?p.getSouth():p.getNorth()))*ui;Ee.vec3.scaleAndAdd(E,E,ne,te)}let z=v[j],U=v[(j+1)%4],q=new tr(z,U,E),K=[Rr(q,0)||z[0],Rr(q,1)||z[1],Rr(q,2)||z[2]],re=wi(o.zoom);if(re>0){let ne=function({x:pe,y:ie,z:me},ye,_e,be,Se){let Ae=1/(1<<me),Ie=pe*Ae,$e=Ie+Ae,Ke=ie*Ae,Ue=Ke+Ae,ut=0,lt=(Ie+$e)/2-be;return lt>.5?ut=-1:lt<-.5&&(ut=1),Ie=((Ie+ut)*ye-(be*=ye))*_e+be,$e=(($e+ut)*ye-be)*_e+be,Ke=(Ke*ye-(Se*=ye))*_e+Se,Ue=(Ue*ye-Se)*_e+Se,[[Ie,Ue,0],[$e,Ue,0],[$e,Ke,0],[Ie,Ke,0]]}(r,e,o._pixelsPerMercatorPixel,C,O);for(let pe=0;pe<v.length;pe++)Tr(v[pe],ne[pe],re);let te=Ee.vec3.add([],ne[j],ne[(j+1)%4]);Ee.vec3.scale(te,te,.5),Tr(K,te,re)}for(let ne of v)Ee.vec3.min(_,_,ne),Ee.vec3.max(M,M,ne);return _[2]=Math.min(z[2],U[2]),Ee.vec3.min(_,_,K),Ee.vec3.max(M,M,K),new wt(_,M)}function nr({x:o,y:e,z:r},a=!1){let f=1/(1<<r),c=new mn(Pi(o*f),e===(1<<r)-1&&a?-90:jr((e+1)*f)),p=new mn(Pi((o+1)*f),e===0&&a?90:jr(e*f));return new Ws(c,p)}function Un(o,e=ui){let r=ln(o.getNorth()),a=ln(o.getSouth()),f=Math.cos(r),c=Math.cos(a),p=Math.sin(r),v=Math.sin(a),w=o.getWest(),M=o.getEast();return[Nl(c,v,w,e),Nl(c,v,M,e),Nl(f,p,M,e),Nl(f,p,w,e)]}function zn(o,e,r,a){let f=1<<r.z,c=(o/ct+r.x)/f;return Da(jr((e/ct+r.y)/f),Pi(c),a)}function un({min:o,max:e}){return $g/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}let mr=new Float64Array(16);function Pr(o){let e=un(o),r=Ee.mat4.fromScaling(mr,[e,e,e]);return Ee.mat4.translate(r,r,Ee.vec3.negate([],o.min))}function Vn(o){let e=Ee.mat4.fromTranslation(mr,o.min),r=1/un(o);return Ee.mat4.scale(e,e,[r,r,r])}function Jr(o){let e=ct/(2*Math.PI);return o/(2*Math.PI)/e}function Qi(o,e){return ct/(512*Math.pow(2,o))*un(Er(e))}function Oi(o,e,r,a,f){let c=Jr(r),p=[o,e,-r/(2*Math.PI)],v=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.translate(v,v,p),Ee.mat4.scale(v,v,[c,c,c]),Ee.mat4.rotateX(v,v,ln(-f)),Ee.mat4.rotateY(v,v,ln(-a)),v}function wi(o){return So(kl,Ug,o)}function Bo(o,e){let r=Da(e.lat,e.lng),a=function(c){let p=Da(c._center.lat,c._center.lng),v=Ee.vec3.fromValues(0,1,0),w=Ee.vec3.cross([],v,p),M=Ee.mat4.fromRotation([],-c.angle,p);w=Ee.vec3.transformMat4(w,w,M),Ee.mat4.fromRotation(M,-c._pitch,w);let _=Ee.vec3.normalize([],p);return Ee.vec3.scale(_,_,on(c.cameraToCenterDistance/c.pixelsPerMeter)),Ee.vec3.transformMat4(_,_,M),Ee.vec3.add([],p,_)}(o),f=Ee.vec3.subtract([],a,r);return Ee.vec3.angle(f,r)}function eo(o,e){return Bo(o,e)>Math.PI/2*1.01}let $i=ln(85),Ca=Math.cos($i),Vo=Math.sin($i),Aa=Ee.mat4.create(),Bl=o=>{let e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Oh(o,e,r,a,f,c,p,v,w){if(c&&o.queryGeometry.isAboveHorizon)return!1;c&&(w*=o.pixelToTileUnitsFactor);let M=o.tileID.canonical,_=r.projection.upVectorScale(M,r.center.lat,r.worldSize).metersToTile;for(let E of e)for(let D of E){let b=D.add(v),T=f&&r.elevation?r.elevation.exaggeration()*f.getElevationAt(b.x,b.y,!0):0,C=r.projection.projectTilePoint(b.x,b.y,M);if(T>0){let j=r.projection.upVector(M,b.x,b.y);C.x+=j[0]*_*T,C.y+=j[1]*_*T,C.z+=j[2]*_*T}let O=c?b:hp(C.x,C.y,C.z,a),L=c?o.tilespaceRays.map(j=>TR(j,T)):o.queryGeometry.screenGeometry,B=Ee.vec4.transformMat4([],[C.x,C.y,C.z,1],a);if(!p&&c?w*=B[3]/r.cameraToCenterDistance:p&&!c&&(w*=r.cameraToCenterDistance/B[3]),c){let j=jr((D.y/ct+M.y)/(1<<M.z));w/=r.projection.pixelsPerMeter(j,1)/hi(1,j)}if(Y(L,O,w))return!0}return!1}function hp(o,e,r,a){let f=Ee.vec4.transformMat4([],[o,e,r,1],a);return new at(f[0]/f[3],f[1]/f[3])}let EE=Ee.vec3.fromValues(0,0,0),ER=Ee.vec3.fromValues(0,0,1);function TR(o,e){let r=Ee.vec3.create();return EE[2]=e,o.intersectsPlane(EE,ER,r),new at(r[0],r[1])}class TE extends Z{}let IE,SE,DE,ME;function CE(o,{width:e,height:r},a,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*r*a)throw new RangeError("mismatched image size")}else f=new Uint8Array(e*r*a);return o.width=e,o.height=r,o.data=f,o}function AE(o,e,r){let{width:a,height:f}=e;a===o.width&&f===o.height||(C0(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,a),height:Math.min(o.height,f)},r,null),o.width=a,o.height=f,o.data=e.data)}function C0(o,e,r,a,f,c,p,v){if(f.width===0||f.height===0)return e;if(f.width>o.width||f.height>o.height||r.x>o.width-f.width||r.y>o.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||a.x>e.width-f.width||a.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");let w=o.data,M=e.data,_=c===4&&v;for(let E=0;E<f.height;E++){let D=((r.y+E)*o.width+r.x)*c,b=((a.y+E)*e.width+a.x)*c;if(_)for(let T=0;T<f.width;T++){let C=D+T*c+3,O=b+T*c;M[O+0]=255,M[O+1]=255,M[O+2]=255,M[O+3]=w[C]}else if(p)for(let T=0;T<f.width;T++){let C=D+T*c,O=b+T*c,L=w[C+3],B=new vn(w[C+0]/255*L,w[C+1]/255*L,w[C+2]/255*L,L).toRenderColor(p).toArray();M[O+0]=B[0],M[O+1]=B[1],M[O+2]=B[2],M[O+3]=B[3]}else for(let T=0;T<f.width*c;T++)M[b+T]=w[D+T]}return e}_t(TE,"HeatmapBucket",{omit:["layers"]});class Vl{constructor(e,r){CE(this,e,1,r)}resize(e){AE(this,new Vl(e),1)}clone(){return new Vl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,f,c){C0(e,r,a,f,c,1,null)}}class qr{constructor(e,r){CE(this,e,4,r)}resize(e){AE(this,new qr(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,f,c,p,v){C0(e,r,a,f,c,4,p,v)}}class RE{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function dp(o){let e={},r=o.resolution||256,a=o.clips?o.clips.length:1,f=o.image||new qr({width:r,height:a}),c=(p,v,w)=>{e[o.evaluationKey]=w;let M=o.expression.evaluate(e);M&&(f.data[p+v+0]=Math.floor(255*M.r/M.a),f.data[p+v+1]=Math.floor(255*M.g/M.a),f.data[p+v+2]=Math.floor(255*M.b/M.a),f.data[p+v+3]=Math.floor(255*M.a))};if(o.clips)for(let p=0,v=0;p<a;++p,v+=4*r)for(let w=0,M=0;w<r;w++,M+=4){let _=w/(r-1),{start:E,end:D}=o.clips[p];c(v,M,E*(1-_)+D*_)}else for(let p=0,v=0;p<r;p++,v+=4)c(0,v,p/(r-1));return f}_t(Vl,"AlphaImage"),_t(qr,"RGBAImage");let IR=xn([{name:"a_pos",components:2,type:"Int16"}],4),{members:SR}=IR;function fp(o,e,r=2){let a=e&&e.length,f=a?e[0]*r:o.length,c=PE(o,0,f,r,!0),p=[];if(!c||c.next===c.prev)return p;let v,w,M;if(a&&(c=function(_,E,D,b){let T=[];for(let C=0,O=E.length;C<O;C++){let L=PE(_,E[C]*b,C<O-1?E[C+1]*b:_.length,b,!1);L===L.next&&(L.steiner=!0),T.push(LR(L))}T.sort(RR);for(let C=0;C<T.length;C++)D=PR(T[C],D);return D}(o,e,c,r)),o.length>80*r){v=1/0,w=1/0;let _=-1/0,E=-1/0;for(let D=r;D<f;D+=r){let b=o[D],T=o[D+1];b<v&&(v=b),T<w&&(w=T),b>_&&(_=b),T>E&&(E=T)}M=Math.max(_-v,E-w),M=M!==0?32767/M:0}return pp(c,p,r,v,w,M,0),p}function PE(o,e,r,a,f){let c;if(f===function(p,v,w,M){let _=0;for(let E=v,D=w-M;E<w;E+=M)_+=(p[D]-p[E])*(p[E+1]+p[D+1]),D=E;return _}(o,e,r,a)>0)for(let p=e;p<r;p+=a)c=kE(p/a|0,o[p],o[p+1],c);else for(let p=r-a;p>=e;p-=a)c=kE(p/a|0,o[p],o[p+1],c);return c&&Gg(c,c.next)&&(gp(c),c=c.next),c}function Qc(o,e){if(!o)return o;e||(e=o);let r,a=o;do if(r=!1,a.steiner||!Gg(a,a.next)&&Or(a.prev,a,a.next)!==0)a=a.next;else{if(gp(a),a=e=a.prev,a===a.next)break;r=!0}while(r||a!==e);return e}function pp(o,e,r,a,f,c,p){if(!o)return;!p&&c&&function(w,M,_,E){let D=w;do D.z===0&&(D.z=A0(D.x,D.y,M,_,E)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==w);D.prevZ.nextZ=null,D.prevZ=null,function(b){let T,C=1;do{let O,L=b;b=null;let B=null;for(T=0;L;){T++;let j=L,z=0;for(let q=0;q<C&&(z++,j=j.nextZ,j);q++);let U=C;for(;z>0||U>0&&j;)z!==0&&(U===0||!j||L.z<=j.z)?(O=L,L=L.nextZ,z--):(O=j,j=j.nextZ,U--),B?B.nextZ=O:b=O,O.prevZ=B,B=O;L=j}B.nextZ=null,C*=2}while(T>1)}(D)}(o,a,f,c);let v=o;for(;o.prev!==o.next;){let w=o.prev,M=o.next;if(c?MR(o,a,f,c):DR(o))e.push(w.i,o.i,M.i),gp(o),o=M.next,v=M.next;else if((o=M)===v){p?p===1?pp(o=CR(Qc(o),e),e,r,a,f,c,2):p===2&&AR(o,e,r,a,f,c):pp(Qc(o),e,r,a,f,c,1);break}}}function DR(o){let e=o.prev,r=o,a=o.next;if(Or(e,r,a)>=0)return!1;let f=e.x,c=r.x,p=a.x,v=e.y,w=r.y,M=a.y,_=f<c?f<p?f:p:c<p?c:p,E=v<w?v<M?v:M:w<M?w:M,D=f>c?f>p?f:p:c>p?c:p,b=v>w?v>M?v:M:w>M?w:M,T=a.next;for(;T!==e;){if(T.x>=_&&T.x<=D&&T.y>=E&&T.y<=b&&Lh(f,v,c,w,p,M,T.x,T.y)&&Or(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function MR(o,e,r,a){let f=o.prev,c=o,p=o.next;if(Or(f,c,p)>=0)return!1;let v=f.x,w=c.x,M=p.x,_=f.y,E=c.y,D=p.y,b=v<w?v<M?v:M:w<M?w:M,T=_<E?_<D?_:D:E<D?E:D,C=v>w?v>M?v:M:w>M?w:M,O=_>E?_>D?_:D:E>D?E:D,L=A0(b,T,e,r,a),B=A0(C,O,e,r,a),j=o.prevZ,z=o.nextZ;for(;j&&j.z>=L&&z&&z.z<=B;){if(j.x>=b&&j.x<=C&&j.y>=T&&j.y<=O&&j!==f&&j!==p&&Lh(v,_,w,E,M,D,j.x,j.y)&&Or(j.prev,j,j.next)>=0||(j=j.prevZ,z.x>=b&&z.x<=C&&z.y>=T&&z.y<=O&&z!==f&&z!==p&&Lh(v,_,w,E,M,D,z.x,z.y)&&Or(z.prev,z,z.next)>=0))return!1;z=z.nextZ}for(;j&&j.z>=L;){if(j.x>=b&&j.x<=C&&j.y>=T&&j.y<=O&&j!==f&&j!==p&&Lh(v,_,w,E,M,D,j.x,j.y)&&Or(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;z&&z.z<=B;){if(z.x>=b&&z.x<=C&&z.y>=T&&z.y<=O&&z!==f&&z!==p&&Lh(v,_,w,E,M,D,z.x,z.y)&&Or(z.prev,z,z.next)>=0)return!1;z=z.nextZ}return!0}function CR(o,e){let r=o;do{let a=r.prev,f=r.next.next;!Gg(a,f)&&OE(a,r,r.next,f)&&mp(a,f)&&mp(f,a)&&(e.push(a.i,r.i,f.i),gp(r),gp(r.next),r=o=f),r=r.next}while(r!==o);return Qc(r)}function AR(o,e,r,a,f,c){let p=o;do{let v=p.next.next;for(;v!==p.prev;){if(p.i!==v.i&&kR(p,v)){let w=LE(p,v);return p=Qc(p,p.next),w=Qc(w,w.next),pp(p,e,r,a,f,c,0),void pp(w,e,r,a,f,c,0)}v=v.next}p=p.next}while(p!==o)}function RR(o,e){return o.x-e.x}function PR(o,e){let r=function(f,c){let p=c,v=f.x,w=f.y,M,_=-1/0;do{if(w<=p.y&&w>=p.next.y&&p.next.y!==p.y){let C=p.x+(w-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(C<=v&&C>_&&(_=C,M=p.x<p.next.x?p:p.next,C===v))return M}p=p.next}while(p!==c);if(!M)return null;let E=M,D=M.x,b=M.y,T=1/0;p=M;do{if(v>=p.x&&p.x>=D&&v!==p.x&&Lh(w<b?v:_,w,D,b,w<b?_:v,w,p.x,p.y)){let C=Math.abs(w-p.y)/(v-p.x);mp(p,f)&&(C<T||C===T&&(p.x>M.x||p.x===M.x&&OR(M,p)))&&(M=p,T=C)}p=p.next}while(p!==E);return M}(o,e);if(!r)return e;let a=LE(r,o);return Qc(a,a.next),Qc(r,r.next)}function OR(o,e){return Or(o.prev,o,e.prev)<0&&Or(e.next,o,o.next)<0}function A0(o,e,r,a,f){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-r)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function LR(o){let e=o,r=o;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==o);return r}function Lh(o,e,r,a,f,c,p,v){return(f-p)*(e-v)>=(o-p)*(c-v)&&(o-p)*(a-v)>=(r-p)*(e-v)&&(r-p)*(c-v)>=(f-p)*(a-v)}function kR(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(r,a){let f=r;do{if(f.i!==r.i&&f.next.i!==r.i&&f.i!==a.i&&f.next.i!==a.i&&OE(f,f.next,r,a))return!0;f=f.next}while(f!==r);return!1}(o,e)&&(mp(o,e)&&mp(e,o)&&function(r,a){let f=r,c=!1,p=(r.x+a.x)/2,v=(r.y+a.y)/2;do f.y>v!=f.next.y>v&&f.next.y!==f.y&&p<(f.next.x-f.x)*(v-f.y)/(f.next.y-f.y)+f.x&&(c=!c),f=f.next;while(f!==r);return c}(o,e)&&(Or(o.prev,o,e.prev)||Or(o,e.prev,e))||Gg(o,e)&&Or(o.prev,o,o.next)>0&&Or(e.prev,e,e.next)>0)}function Or(o,e,r){return(e.y-o.y)*(r.x-e.x)-(e.x-o.x)*(r.y-e.y)}function Gg(o,e){return o.x===e.x&&o.y===e.y}function OE(o,e,r,a){let f=Wg(Or(o,e,r)),c=Wg(Or(o,e,a)),p=Wg(Or(r,a,o)),v=Wg(Or(r,a,e));return f!==c&&p!==v||!(f!==0||!qg(o,r,e))||!(c!==0||!qg(o,a,e))||!(p!==0||!qg(r,o,a))||!(v!==0||!qg(r,e,a))}function qg(o,e,r){return e.x<=Math.max(o.x,r.x)&&e.x>=Math.min(o.x,r.x)&&e.y<=Math.max(o.y,r.y)&&e.y>=Math.min(o.y,r.y)}function Wg(o){return o>0?1:o<0?-1:0}function mp(o,e){return Or(o.prev,o,o.next)<0?Or(o,e,o.next)>=0&&Or(o,o.prev,e)>=0:Or(o,e,o.prev)<0||Or(o,o.next,e)<0}function LE(o,e){let r=R0(o.i,o.x,o.y),a=R0(e.i,e.x,e.y),f=o.next,c=e.prev;return o.next=e,e.prev=o,r.next=f,f.prev=r,a.next=r,r.prev=a,c.next=a,a.prev=c,a}function kE(o,e,r,a){let f=R0(o,e,r);return a?(f.next=a.next,f.prev=a,a.next.prev=f,a.next=f):(f.prev=f,f.next=f),f}function gp(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function R0(o,e,r){return{i:o,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Zg(o,e){let r=o.length;if(r<=1)return[o];let a=[],f,c;for(let p=0;p<r;p++){let v=Nu(o[p]);v!==0&&(o[p].area=Math.abs(v),c===void 0&&(c=v<0),c===v<0?(f&&a.push(f),f=[o[p]]):f.push(o[p]))}if(f&&a.push(f),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(gc(a[p],e,1,a[p].length-1,FR),a[p]=a[p].slice(0,e));return a}function FR(o,e){return e.area-o.area}function FE(o,e,r=1){if(!o)return null;let a=typeof o=="string"?o:o.getPrimary().id;e[a]||(e[a]=[]);let f=Hr.from(a).getPrimary().scaleSelf(r);return e[a].push(f),f.serialize()}function P0(o,e,r,a){let f=a.patternDependencies,c=!1;for(let p of e){let v=p.paint.get(`${o}-pattern`);v.isConstant()||(c=!0),FE(v.constantOr(null),f,r)&&(c=!0)}return c}function O0(o,e,r,a,f,c){let p=c.patternDependencies;for(let v of e){let w=v.paint.get(`${o}-pattern`).value;if(w.kind!=="constant"){let M=w.evaluate({zoom:a},r,{},c.availableImages);M=M&&M.name?M.name:M;let _=FE(M,p,f);_&&(r.patterns[v.id]=_)}}return r}class L0{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new hs,this.indexArray=new Vr,this.indexArray2=new $s,this.programConfigurations=new qs(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new ur,this.segments2=new ur,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}updateFootprints(e,r){}populate(e,r,a,f){this.hasPattern=P0("fill",this.layers,this.pixelRatio,r);let c=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:v,id:w,index:M,sourceLayerIndex:_}of e){let E=this.layers[0]._featureFilter.needGeometry,D=k(v,E);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),D,a))continue;let b=c?c.evaluate(D,{},a,r.availableImages):void 0,T={id:w,properties:v.properties,type:v.type,sourceLayerIndex:_,index:M,geometry:E?D.geometry:P(v,a,f),patterns:{},sortKey:b};p.push(T)}c&&p.sort((v,w)=>v.sortKey-w.sortKey);for(let v of p){let{geometry:w,index:M,sourceLayerIndex:_}=v;if(this.hasPattern){let E=O0("fill",this.layers,v,this.zoom,this.pixelRatio,r);this.patternFeatures.push(E)}else this.addFeature(v,w,M,a,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(e[M].feature,w,M,_,this.index)}}update(e,r,a,f,c,p,v){this.programConfigurations.updatePaintArrays(e,r,c,a,f,p,v)}addFeatures(e,r,a,f,c,p){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,a,f,p,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,SR),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,f,c,p=[],v,w){for(let M of Zg(r,500)){let _=0;for(let O of M)_+=O.length;let E=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),D=E.vertexLength,b=[],T=[];for(let O of M){if(O.length===0)continue;O!==M[0]&&T.push(b.length/2);let L=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),B=L.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(B+O.length-1,B),b.push(O[0].x),b.push(O[0].y);for(let j=1;j<O.length;j++)this.layoutVertexArray.emplaceBack(O[j].x,O[j].y),this.indexArray2.emplaceBack(B+j-1,B+j),b.push(O[j].x),b.push(O[j].y);L.vertexLength+=O.length,L.primitiveLength+=O.length}let C=fp(b,T);for(let O=0;O<C.length;O+=3)this.indexArray.emplaceBack(D+C[O],D+C[O+1],D+C[O+2]);E.vertexLength+=_,E.primitiveLength+=C.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,c,p,f,v)}}let NE,zE,BE,VE;_t(L0,"FillBucket",{omit:["layers","patternFeatures"]});class k0{constructor(e,r,a,f){if(this.triangleCount=r.length/3,this.min=new at(0,0),this.max=new at(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[c,p]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){let D=e[E];c.x=Math.min(c.x,D.x),c.y=Math.min(c.y,D.y),p.x=Math.max(p.x,D.x),p.y=Math.max(p.y,D.y)}if(f){let E=Math.ceil(Math.max(p.x-c.x,p.y-c.y)/f);a=Math.max(a,E)}if(a===0)return;this.min=c,this.max=p;let v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);let w=Math.max(v.x,v.y)/a;this.cellsX=Math.max(1,Math.ceil(v.x/w)),this.cellsY=Math.max(1,Math.ceil(v.y/w)),this.xScale=1/w,this.yScale=1/w;let M=[];for(let E=0;E<this.triangleCount;E++){let D=e[r[3*E+0]].sub(this.min),b=e[r[3*E+1]].sub(this.min),T=e[r[3*E+2]].sub(this.min),C=Zs(Math.floor(Math.min(D.x,b.x,T.x)),this.xScale,this.cellsX),O=Zs(Math.floor(Math.max(D.x,b.x,T.x)),this.xScale,this.cellsX),L=Zs(Math.floor(Math.min(D.y,b.y,T.y)),this.yScale,this.cellsY),B=Zs(Math.floor(Math.max(D.y,b.y,T.y)),this.yScale,this.cellsY),j=new at(0,0),z=new at(0,0),U=new at(0,0),q=new at(0,0);for(let K=L;K<=B;++K){j.y=z.y=K*w,U.y=q.y=(K+1)*w;for(let re=C;re<=O;++re)j.x=U.x=re*w,z.x=q.x=(re+1)*w,(Re(D,b,T,j,z,q)||Re(D,b,T,j,q,U))&&M.push({cellIdx:K*this.cellsX+re,triIdx:E})}}if(M.length===0)return;M.sort((E,D)=>E.cellIdx-D.cellIdx||E.triIdx-D.triIdx);let _=0;for(;_<M.length;){let E=M[_].cellIdx,D={start:this.payload.length,len:0};for(;_<M.length&&M[_].cellIdx===E;)++D.len,this.payload.push(M[_++].triIdx);this.cells[E]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let a=Zs(e.x-this.min.x,this.xScale,this.cellsX),f=Zs(e.y-this.min.y,this.yScale,this.cellsY),c=this.cells[f*this.cellsX+a];if(c){this._lazyInitLookup();for(let p=0;p<c.len;p++){let v=this.payload[c.start+p],w=Math.floor(v/8),M=1<<v%8;if(!(this.lookup[w]&M)&&(this.lookup[w]|=M,r.push(v),r.length===this.triangleCount))return}}}query(e,r,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();let f=Zs(e.x-this.min.x,this.xScale,this.cellsX),c=Zs(r.x-this.min.x,this.xScale,this.cellsX),p=Zs(e.y-this.min.y,this.yScale,this.cellsY),v=Zs(r.y-this.min.y,this.yScale,this.cellsY);for(let w=p;w<=v;w++)for(let M=f;M<=c;M++){let _=this.cells[w*this.cellsX+M];if(_)for(let E=0;E<_.len;E++){let D=this.payload[_.start+E],b=Math.floor(D/8),T=1<<D%8;if(!(this.lookup[b]&T)&&(this.lookup[b]|=T,a.push(D),a.length===this.triangleCount))return}}}}function Zs(o,e,r){return Math.max(0,Math.min(r-1,Math.floor(o*e)))}_t(k0,"TriangleGridIndex");class jE{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(e,r){for(let a of this.footprints)r.push({footprint:a,id:e})}populate(e,r,a,f){let c=[];for(let{feature:p,id:v,index:w,sourceLayerIndex:M}of e){let _=this.layers[0]._featureFilter.needGeometry,E=k(p,_);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),E,a))continue;let D={id:v,properties:p.properties,type:p.type,sourceLayerIndex:M,index:w,geometry:_?E.geometry:P(p,a,f),patterns:{}};c.push(D)}for(let p of c){let{geometry:v,index:w,sourceLayerIndex:M}=p;this.addFeature(p,v,w,a,{},r.availableImages,r.brightness),r.featureIndex.insert(e[w].feature,v,w,M,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,a,f,c,p,v){}destroy(){}addFeature(e,r,a,f,c,p=[],v){for(let w of Zg(r,2)){let M=[],_=[],E=[],D=new at(1/0,1/0),b=new at(-1/0,-1/0);for(let O of w)if(O.length!==0){O!==w[0]&&E.push(_.length/2);for(let L=0;L<O.length;L++)_.push(O[L].x),_.push(O[L].y),M.push(O[L]),D.x=Math.min(D.x,O[L].x),D.y=Math.min(D.y,O[L].y),b.x=Math.max(b.x,O[L].x),b.y=Math.max(b.y,O[L].y)}let T=fp(_,E),C=new k0(M,T,8,256);this.footprints.push({vertices:M,indices:T,grid:C,min:D,max:b})}}}_t(jE,"ClipBucket",{omit:["layers"]});let NR=xn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zR=xn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),BR=xn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),VR=xn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),jR=xn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),UR=xn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:$R}=NR;var F0,UE,N0,$E,z0,HE,GE,Xg={};function qE(){if(UE)return F0;UE=1;var o=ra();function e(f,c,p,v,w){this.properties={},this.extent=p,this.type=0,this._pbf=f,this._geometry=-1,this._keys=v,this._values=w,f.readFields(r,this,c)}function r(f,c,p){f==1?c.id=p.readVarint():f==2?function(v,w){for(var M=v.readVarint()+v.pos;v.pos<M;){var _=w._keys[v.readVarint()],E=w._values[v.readVarint()];w.properties[_]=E}}(p,c):f==3?c.type=p.readVarint():f==4&&(c._geometry=p.pos)}function a(f){for(var c,p,v=0,w=0,M=f.length,_=M-1;w<M;_=w++)v+=((p=f[_]).x-(c=f[w]).x)*(c.y+p.y);return v}return F0=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var c,p=f.readVarint()+f.pos,v=1,w=0,M=0,_=0,E=[];f.pos<p;){if(w<=0){var D=f.readVarint();v=7&D,w=D>>3}if(w--,v===1||v===2)M+=f.readSVarint(),_+=f.readSVarint(),v===1&&(c&&E.push(c),c=[]),c.push(new o(M,_));else{if(v!==7)throw new Error("unknown command "+v);c&&c.push(c[0].clone())}}return c&&E.push(c),E},e.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var c=f.readVarint()+f.pos,p=1,v=0,w=0,M=0,_=1/0,E=-1/0,D=1/0,b=-1/0;f.pos<c;){if(v<=0){var T=f.readVarint();p=7&T,v=T>>3}if(v--,p===1||p===2)(w+=f.readSVarint())<_&&(_=w),w>E&&(E=w),(M+=f.readSVarint())<D&&(D=M),M>b&&(b=M);else if(p!==7)throw new Error("unknown command "+p)}return[_,D,E,b]},e.prototype.toGeoJSON=function(f,c,p){var v,w,M=this.extent*Math.pow(2,p),_=this.extent*f,E=this.extent*c,D=this.loadGeometry(),b=e.types[this.type];function T(L){for(var B=0;B<L.length;B++){var j=L[B];L[B]=[360*(j.x+_)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+E)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(v=0;v<D.length;v++)C[v]=D[v][0];T(D=C);break;case 2:for(v=0;v<D.length;v++)T(D[v]);break;case 3:for(D=function(L){var B=L.length;if(B<=1)return[L];for(var j,z,U=[],q=0;q<B;q++){var K=a(L[q]);K!==0&&(z===void 0&&(z=K<0),z===K<0?(j&&U.push(j),j=[L[q]]):j.push(L[q]))}return j&&U.push(j),U}(D),v=0;v<D.length;v++)for(w=0;w<D[v].length;w++)T(D[v][w])}D.length===1?D=D[0]:b="Multi"+b;var O={type:"Feature",geometry:{type:b,coordinates:D},properties:this.properties};return"id"in this&&(O.id=this.id),O},F0}function WE(){if($E)return N0;$E=1;var o=qE();function e(a,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(r,this,f),this.length=this._features.length}function r(a,f,c){a===15?f.version=c.readVarint():a===1?f.name=c.readString():a===5?f.extent=c.readVarint():a===2?f._features.push(c.pos):a===3?f._keys.push(c.readString()):a===4&&f._values.push(function(p){for(var v=null,w=p.readVarint()+p.pos;p.pos<w;){var M=p.readVarint()>>3;v=M===1?p.readString():M===2?p.readFloat():M===3?p.readDouble():M===4?p.readVarint64():M===5?p.readVarint():M===6?p.readSVarint():M===7?p.readBoolean():null}return v}(c))}return N0=e,e.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var f=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,f,this.extent,this._keys,this._values)},N0}function ZE(){return GE||(GE=1,Xg.VectorTile=function(){if(HE)return z0;HE=1;var o=WE();function e(r,a,f){if(r===3){var c=new o(f,f.readVarint()+f.pos);c.length&&(a[c.name]=c)}}return z0=function(r,a){this.layers=r.readFields(e,{},a)},z0}(),Xg.VectorTileFeature=qE(),Xg.VectorTileLayer=WE()),Xg}var kh=ZE();class eu extends at{constructor(e,r,a){super(e,r),this.z=a}}class XE extends eu{constructor(e,r,a,f){super(e,r,a),this.w=f}}function Yg(o,e,r,a){let f=[],c=a===0?(p,v,w,M,_,E)=>{p.push(new at(E,w+(E-v)/(M-v)*(_-w)))}:(p,v,w,M,_,E)=>{p.push(new at(v+(E-w)/(_-w)*(M-v),E))};for(let p of o){let v=[];for(let w of p){if(w.length<=2)continue;let M=[];for(let D=0;D<w.length-1;D++){let b=w[D].x,T=w[D].y,C=w[D+1].x,O=w[D+1].y,L=a===0?b:T,B=a===0?C:O;L<e?B>e&&c(M,b,T,C,O,e):L>r?B<r&&c(M,b,T,C,O,r):M.push(w[D]),B<e&&L>=e&&c(M,b,T,C,O,e),B>r&&L<=r&&c(M,b,T,C,O,r)}let _=w[w.length-1],E=a===0?_.x:_.y;E>=e&&E<=r&&M.push(_),M.length&&(_=M[M.length-1],M[0].x===_.x&&M[0].y===_.y||M.push(M[0]),v.push(M))}v.length&&f.push(v)}return f}function YE(o,e,r,a){let f=r==="x"?"y":"x",c=(a-o[r])/(e[r]-o[r]);o[f]=o[f]+(e[f]-o[f])*c,o[r]=a,o.hasOwnProperty("z")&&(o.z=At(o.z,e.z,c)),o.hasOwnProperty("w")&&(o.w=At(o.w,e.w,c))}function KE(o,e,r,a){let f=r,c=a;for(let p of["x","y"]){let v=o,w=e;v[p]>=w[p]&&(v=e,w=o),v[p]<f&&w[p]>f&&YE(v,w,p,f),v[p]<c&&w[p]>c&&YE(w,v,p,c)}}let Kg=Number.MAX_SAFE_INTEGER;function JE(o,e,r,a){return o.order<e||o.order===Kg||!(o.clipMask&r)||function(f,c){return c.length!==0&&c.find(p=>p===f)===void 0}(a,o.clipScope)}function Jg(o,e){return o.x-e.x||o.y-e.y}function QE(o,e){return Jg(o.min,e.min)===0&&Jg(o.max,e.max)===0}function B0(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function V0(o,e){if(o.length!==e.length)return!1;for(let r=0;r<o.length;r++)if(o[r].sourceId!==e[r].sourceId||!QE(o[r],e[r])||o[r].order!==e[r].order||o[r].clipMask!==e[r].clipMask||!si(o[r].clipScope,e[r].clipScope))return!1;return!0}function eT(o,e,r){let a=1/ct,f=1/(1<<r.canonical.z),c=(e.x*a+r.canonical.x)*f+r.wrap,p=(e.y*a+r.canonical.y)*f;return{min:new at((o.x*a+r.canonical.x)*f+r.wrap,(o.y*a+r.canonical.y)*f),max:new at(c,p)}}function HR(o,e,r){let a=1<<r.canonical.z,f=((e.x-r.wrap)*a-r.canonical.x)*ct,c=(e.y*a-r.canonical.y)*ct;return{min:new at(((o.x-r.wrap)*a-r.canonical.x)*ct,(o.y*a-r.canonical.y)*ct),max:new at(f,c)}}function tT(o,e,r,a,f,c,p){let v=o.indices,w=o.vertices,M=[];for(let _=a;_<a+f;_+=3){let E=e[r[_+0]+c],D=e[r[_+1]+c],b=e[r[_+2]+c],T=Math.min(E.x,D.x,b.x),C=Math.max(E.x,D.x,b.x),O=Math.min(E.y,D.y,b.y),L=Math.max(E.y,D.y,b.y);M.length=0,o.grid.query(new at(T,O),new at(C,L),M);for(let B=0;B<M.length;B++){let j=M[B];if(Re(w[v[3*j+0]],w[v[3*j+1]],w[v[3*j+2]],E,D,b,p))return!0}}return!1}function nT(o,e,r,a){if(!o||!r)return!1;let f=o.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(r.vertices.length<o.vertices.length)return nT(r,a,o,e);let c=e.canonical,p=a.canonical,v=Math.pow(2,p.z-c.z);f=o.vertices.map(w=>new at((w.x+c.x*ct)*v-p.x*ct,(w.y+c.y*ct)*v-p.y*ct))}return tT(r,f,o.indices,0,o.indices.length,0,0)}function rT(o,e,r,a){let f=Math.pow(2,a.z-r.z);return new at((o+r.x*ct)*f-a.x*ct,(e+r.y*ct)*f-a.y*ct)}function iT(o,e){let r=[];e.grid.queryPoint(o,r);let a=e.indices,f=e.vertices;for(let c=0;c<r.length;c++){let p=r[c];if(le([f[a[3*p+0]],f[a[3*p+1]],f[a[3*p+2]]],o))return!0}return!1}let j0=[new at(0,0),new at(ct,0),new at(ct,ct),new at(0,ct)];function oT(o,e){let r=[],a=[];if(!e||o.length<2)return[o];if(o.length===2)return we(o[0],o[1],j0)?[o]:[];for(let f=0;f<o.length+2;f++){let c=o[f%o.length],p=o[(f+1)%o.length],v=we(f===0?o[o.length-1]:o[(f-1)%o.length],c,j0),w=we(c,p,j0),M=v||w;M&&a.push(c),M&&w||a.length>0&&(a.length>1&&r.push(a),a=[])}return a.length>1&&r.push(a),r}let U0=kh.VectorTileFeature.types,GR=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],qR=["fill-extrusion-flood-light-ground-radius"],WR=Math.pow(2,13),ZR=Math.pow(2,15)-1,sT=new at(0,1),jl=2147483648;function _p(o,e,r,a,f,c,p,v){o.emplaceBack((e<<1)+p,(r<<1)+c,(Math.floor(a*WR)<<1)+f,Math.round(v))}function yp(o,e,r){o.emplaceBack(e.x*ct,e.y*ct,r?1:0)}function Qg(o,e,r,a,f,c){o.emplaceBack(e.x,e.y,(r.x<<1)+a,(r.y<<1)+f,c)}function vp(o,e,r){o.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class aT{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class lT{constructor(){this.centroidXY=new at(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new at(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new at(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new at(this.max.x-this.min.x,this.max.y-this.min.y)}}class cT{constructor(){this.acc=new at(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,a){this.accCount++,this.acc._add(r);let f=!!this.borders;r.x<e.min.x?(e.min.x=r.x,f=!0):r.x>e.max.x&&(e.max.x=r.x,f=!0),r.y<e.min.y?(e.min.y=r.y,f=!0):r.y>e.max.y&&(e.max.y=r.y,f=!0),((r.x===0||r.x===ct)&&r.x===a.x)!=((r.y===0||r.y===ct)&&r.y===a.y)&&this.processBorderOverlap(r,a),f&&this.checkBorderIntersection(r,a)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,At(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>ct!=e.x>ct&&this.addBorderIntersection(1,At(r.y,e.y,(ct-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,At(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>ct!=e.y>ct&&this.addBorderIntersection(3,At(r.x,e.x,(ct-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new at(0,0):new at(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function uT(o,e){let r=o.add(e)._unit(),a=Yt(o.x*r.x+o.y*r.y,-1,1);var f,c,p;return p=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(p)))/4*ZR*((f=o).x*(c=e).y-f.y*c.x<0?-1:1)}let XR=[o=>o.x<0,o=>o.x>ct,o=>o.y<0,o=>o.y>ct];function YR(o,e,r,a){let f=[4];if(a===0)return f;r._mult(a);let c=o.sub(r),p=e.sub(r),v=[o,e,c,p];for(let w=0;w<4;w++)for(let M of v)if(XR[w](M)){f.push(w);break}return f}class hT{constructor(e){this.vertexArray=new wh,this.indexArray=new Vr,this.programConfigurations=new qs(e.layers,{zoom:e.zoom,lut:e.lut},r=>qR.includes(r)),this._segments=new ur,this.hiddenByLandmarkVertexArray=new Dh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ur}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,a,f=!1){let c=e.length;if(c>2){let p=Math.max(0,this._segments.get().length-1),v=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),w;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let M=e[0],_=e[1];w=uT(M.sub(e[c-1])._perp()._unit(),_.sub(M)._perp()._unit())}for(let M=0;M<c;M++){let _=M===c-1?0:M+1,E=e[M],D=e[_],b=e[_===c-1?0:_+1],T=D.sub(E)._perp()._unit(),C=uT(T,b.sub(D)._perp()._unit()),O=w,L=C;if($0(E,D,r)||f&&pT(E,r)&&pT(D,r)){w=C;continue}let B=v.vertexLength;Qg(this.vertexArray,E,D,1,1,O),Qg(this.vertexArray,E,D,1,0,O),Qg(this.vertexArray,E,D,0,1,L),Qg(this.vertexArray,E,D,0,0,L),v.vertexLength+=4;let j=YR(E,D,T,a);for(let z of j)this._segmentToGroundQuads[p].push({id:B,region:z}),this._segmentToRegionTriCounts[p][z]+=2,v.primitiveLength+=2;w=C}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),r=e.length;for(let a=0;a<r;a++)this._segmentToGroundQuads[a].sort((f,c)=>f.region-c.region);for(let a=0;a<r;a++){let f=this._segmentToGroundQuads[a],c=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((w,M)=>w+M,0);let v=0;for(let w=0;w<=4;w++){let M=p[w];if(M!==0){let _=this.regionSegments[w];_||(_=this.regionSegments[w]=new ur);let E={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+v,vertexLength:c.vertexLength,primitiveLength:M};_.get().push(E)}v+=M}for(let w=0;w<f.length;w++){let M=f[w].id;this.indexArray.emplaceBack(M,M+1,M+3),this.indexArray.emplaceBack(M,M+3,M+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,a,f,c,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,a,f,c,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,zR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,a,f,c,p,v){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,a,f,c,p,v)}updateHiddenByLandmark(e){if(!this.hasData())return;let r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let a=e.flags&jl?1:0;for(let f=e.groundVertexArrayOffset;f<r;++f)this.hiddenByLandmarkVertexArray.emplace(f,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,jR.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let r=this.regionSegments[e];r&&r.destroy()}}}}class e_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Vr,this.footprintVertices=new hs,this.footprintSegments=[],this.layoutVertexArray=new ds,this.centroidVertexArray=new Ri,this.wallVertexArray=new Ng,this.indexArray=new Vr,this.programConfigurations=new qs(e.layers,{zoom:e.zoom,lut:e.lut},r=>GR.includes(r)),this.segments=new ur,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new hT(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,r){}populate(e,r,a,f){this.features=[],this.hasPattern=P0("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=t(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:c,id:p,index:v,sourceLayerIndex:w}of e){let M=this.layers[0]._featureFilter.needGeometry,_=k(c,M);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),_,a))continue;let E={id:p,sourceLayerIndex:w,index:v,geometry:M?_.geometry:P(c,a,f),properties:c.properties,type:c.type,patterns:{}},D=this.layoutVertexArray.length,b=U0[E.type]==="Polygon";if(this.hasPattern)this.features.push(O0("fill-extrusion",this.layers,E,this.zoom,this.pixelRatio,r));else if(this.wallMode)for(let T of E.geometry)for(let C of oT(T,b))this.addFeature(E,[C],v,a,{},r.availableImages,f,r.brightness);else this.addFeature(E,E.geometry,v,a,{},r.availableImages,f,r.brightness);r.featureIndex.insert(c,E.geometry,v,w,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,a,f,c,p){for(let v of this.features){let w=U0[v.type]==="Polygon",{geometry:M}=v;if(this.wallMode)for(let _ of M)for(let E of oT(_,w))this.addFeature(v,[E],v.index,r,a,f,c,p);else this.addFeature(v,M,v.index,r,a,f,c,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,a,f,c,p,v){this.programConfigurations.updatePaintArrays(e,r,c,a,f,p,v),this.groundEffect.update(e,r,c,a,f,p,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$R),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,VR.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,UR.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,BR.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,f,c,p,v,w){let M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,_=[new at(0,0),new at(ct,ct)],E=v.projection,D=E.name==="globe",b=this.wallMode||U0[e.type]==="Polygon",T=new cT;T.centroidDataIndex=this.centroidData.length;let C=new lT,O=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},f)<=0,L=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},f),B;if(C.height=L,C.vertexArrayOffset=this.layoutVertexArray.length,C.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vc),this.wallMode){if(D)return void qt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;B=function(te){let pe=te[0].x===te[te.length-1].x&&te[0].y===te[te.length-1].y;(function(tt){let Je=0,xt=tt.length;for(let ht=0;ht<xt;ht++)Je+=(tt[(ht+1)%xt].x-tt[ht].x)*(tt[(ht+1)%xt].y+tt[ht].y);return Je>=0})(te)||(te=te.reverse());let me={geometry:[],joinNormals:[],indices:[]},ye=[],_e=[],be=[],Se=te.length;for(;Se>=2&&te[Se-1].equals(te[Se-2]);)Se--;if(Se<(pe?3:2))return me;let Ae,Ie,$e,Ke,Ue,ut=0;for(;ut<Se-1&&te[ut].equals(te[ut+1]);)ut++;pe&&(Ae=te[Se-2],Ue=te[ut].sub(Ae)._unit()._perp());for(let tt=ut;tt<Se;tt++){if($e=tt===Se-1?pe?te[ut+1]:void 0:te[tt+1],$e&&te[tt].equals($e))continue;Ue&&(Ke=Ue),Ae&&(Ie=Ae),Ae=te[tt],Ue=$e?$e.sub(Ae)._unit()._perp():Ke,Ke=Ke||Ue;let Je=Ke.add(Ue);Je.x===0&&Je.y===0||Je._unit();let xt=Je.x*Ue.x+Je.y*Ue.y,ht=xt!==0?1/xt:1/0,mt=Ke.x*Ue.y-Ke.y*Ue.x>0,Lt="miter",Ht=2;Lt==="miter"&&ht>Ht&&(Lt="bevel"),Lt==="bevel"&&(ht>100&&(Lt="flipbevel"),ht<Ht&&(Lt="miter"));let Wt=(Zt,en,rn,$n)=>{let On=new at(Zt.x,Zt.y),zt=new at(Zt.x,Zt.y);On.x+=en.x*$n,On.y+=en.y*$n,zt.x-=en.x*Math.max(rn,1),zt.y-=en.y*Math.max(rn,1),be.push(en),ye.push(On),_e.push(zt)};if(Lt==="miter")Je._mult(ht),Wt(Ae,Je,0,0);else if(Lt==="flipbevel")Je=Ue.mult(-1),Wt(Ae,Je,0,0),Wt(Ae,Je.mult(-1),0,0);else{let Zt=-Math.sqrt(ht*ht-1),en=mt?Zt:0,rn=mt?0:Zt;Ie&&Wt(Ae,Ke,en,rn),$e&&Wt(Ae,Ue,en,rn)}}me.geometry=[...ye,..._e.reverse(),ye[0]],me.joinNormals=[...be,...be.reverse(),be[be.length-1]];let lt=me.geometry.length-1;for(let tt=0;tt<lt/2;tt++)if(tt+1<lt/2){let Je=tt,xt=tt+1,ht=lt-1-tt,mt=lt-2-tt;Je=Je===0?lt-1:Je-1,xt=xt===0?lt-1:xt-1,ht=ht===0?lt-1:ht-1,mt=mt===0?lt-1:mt-1,me.indices.push(ht),me.indices.push(xt),me.indices.push(Je),me.indices.push(ht),me.indices.push(mt),me.indices.push(xt)}return me}(r[0]),r=[B.geometry]}let j=(te,pe)=>te<(pe.length-1)/2||te===pe.length-1,z=this.wallMode?[r]:Zg(r,500);for(let te=z.length-1;te>=0;te--){let pe=z[te];(pe.length===0||(U=pe[0]).every(ie=>ie.x<=0)||U.every(ie=>ie.x>=ct)||U.every(ie=>ie.y<=0)||U.every(ie=>ie.y>=ct))&&z.splice(te,1)}var U;let q;if(D)q=yT(z,_,f);else{q=[];for(let te of z)q.push({polygon:te,bounds:_})}let K=b?this.edgeRadius:0,re=K>0&&this.zoom<17,ne=(te,pe)=>{if(te.length===0)return!1;let ie=te[te.length-1];return pe.x===ie.x&&pe.y===ie.y};for(let{polygon:te,bounds:pe}of q){let ie=0,me=0;for(let Se of te)b&&!Se[0].equals(Se[Se.length-1])&&Se.push(Se[0]),me+=b?Se.length-1:Se.length;let ye=this.segments.prepareSegment((b?5:4)*me,this.layoutVertexArray,this.indexArray);C.footprintSegIdx<0&&(C.footprintSegIdx=this.footprintSegments.length),C.polygonSegIdx<0&&(C.polygonSegIdx=this.polygonSegments.length);let _e={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},be=new aT;if(be.vertexOffset=this.footprintVertices.length,be.indexOffset=3*this.footprintIndices.length,be.ringIndices=[],b){let Se=[],Ae=[];ie=ye.vertexLength;for(let $e=0;$e<te.length;$e++){let Ke=te[$e];Ke.length&&$e!==0&&Ae.push(Se.length/2);let Ue=[],ut,lt;ut=Ke[1].sub(Ke[0])._perp()._unit(),be.ringIndices.push(Ke.length-1);for(let tt=1;tt<Ke.length;tt++){let Je=Ke[tt],xt=Ke[tt===Ke.length-1?1:tt+1],ht=Je.clone();if(K){lt=xt.sub(Je)._perp()._unit();let mt=ut.add(lt)._unit(),Lt=K*Math.min(4,1/(ut.x*mt.x+ut.y*mt.y));ht.x+=Lt*mt.x,ht.y+=Lt*mt.y,ht.x=Math.round(ht.x),ht.y=Math.round(ht.y),ut=lt}if(!O||K!==0&&!re||ne(Ue,ht)||Ue.push(ht),_p(this.layoutVertexArray,ht.x,ht.y,0,0,1,1,0),this.wallMode){let mt=j(tt,Ke);yp(this.wallVertexArray,B.joinNormals[tt],!mt)}ye.vertexLength++,this.footprintVertices.emplaceBack(Je.x,Je.y),Se.push(Je.x,Je.y),D&&vp(this.layoutVertexExtArray,E.projectTilePoint(ht.x,ht.y,f),E.upVector(f,ht.x,ht.y))}O&&(K===0||re)&&(Ue.length!==0&&ne(Ue,Ue[0])&&Ue.pop(),this.groundEffect.addData(Ue,pe,M))}let Ie=this.wallMode?B.indices:fp(Se,Ae);for(let $e=0;$e<Ie.length;$e+=3)this.footprintIndices.emplaceBack(be.vertexOffset+Ie[$e+0],be.vertexOffset+Ie[$e+1],be.vertexOffset+Ie[$e+2]),this.indexArray.emplaceBack(ie+Ie[$e],ie+Ie[$e+2],ie+Ie[$e+1]),ye.primitiveLength++;be.indexCount+=Ie.length,be.vertexCount+=this.footprintVertices.length-be.vertexOffset}for(let Se=0;Se<te.length;Se++){let Ae=te[Se];T.startRing(C,Ae[0]);let Ie=Ae.length>4&&mT(Ae[Ae.length-2],Ae[0],Ae[1]),$e=K?KR(Ae[Ae.length-2],Ae[0],Ae[1],K):0,Ke=[],Ue,ut,lt;ut=Ae[1].sub(Ae[0])._perp()._unit();let tt=!0;for(let Je=1,xt=0;Je<Ae.length;Je++){let ht=Ae[Je-1],mt=Ae[Je],Lt=Ae[Je===Ae.length-1?1:Je+1];if(T.appendEdge(C,mt,ht),$0(mt,ht,pe)){K&&(ut=Lt.sub(mt)._perp()._unit(),tt=!tt);continue}let Ht=mt.sub(ht)._perp(),Wt=Ht.x/(Math.abs(Ht.x)+Math.abs(Ht.y)),Zt=Ht.y>0?1:0,en=ht.dist(mt);if(xt+en>32768&&(xt=0),K){lt=Lt.sub(mt)._perp()._unit();let zt=fT(ht,mt,Lt,dT(ut,lt),K);isNaN(zt)&&(zt=0);let In=mt.sub(ht)._unit();ht=ht.add(In.mult($e))._round(),mt=mt.add(In.mult(-zt))._round(),$e=zt,ut=lt,O&&this.zoom>=17&&(ne(Ke,ht)||Ke.push(ht),ne(Ke,mt)||Ke.push(mt))}let rn=ye.vertexLength,$n=Ae.length>4&&mT(ht,mt,Lt),On=gT(xt,Ie,tt);if(_p(this.layoutVertexArray,ht.x,ht.y,Wt,Zt,0,0,On),_p(this.layoutVertexArray,ht.x,ht.y,Wt,Zt,0,1,On),this.wallMode){let zt=j(Je-1,Ae),In=B.joinNormals[Je-1];yp(this.wallVertexArray,In,zt),yp(this.wallVertexArray,In,zt)}if(xt+=en,On=gT(xt,$n,!tt),Ie=$n,_p(this.layoutVertexArray,mt.x,mt.y,Wt,Zt,0,0,On),_p(this.layoutVertexArray,mt.x,mt.y,Wt,Zt,0,1,On),this.wallMode){let zt=j(Je,Ae),In=B.joinNormals[Je];yp(this.wallVertexArray,In,zt),yp(this.wallVertexArray,In,zt)}if(ye.vertexLength+=4,this.indexArray.emplaceBack(rn+0,rn+1,rn+2),this.indexArray.emplaceBack(rn+1,rn+3,rn+2),ye.primitiveLength+=2,K){let zt=ie+(Je===1?Ae.length-2:Je-2),In=Je===1?ie:zt+1;if(this.indexArray.emplaceBack(rn+1,zt,rn+3),this.indexArray.emplaceBack(zt,In,rn+3),ye.primitiveLength+=2,Ue===void 0&&(Ue=rn),!$0(Lt,Ae[Je],pe)){let Rn=Je===Ae.length-1?Ue:ye.vertexLength;this.indexArray.emplaceBack(rn+2,rn+3,Rn),this.indexArray.emplaceBack(rn+3,Rn+1,Rn),this.indexArray.emplaceBack(rn+3,In,Rn+1),ye.primitiveLength+=3}tt=!tt}if(D){let zt=this.layoutVertexExtArray,In=E.projectTilePoint(ht.x,ht.y,f),Rn=E.projectTilePoint(mt.x,mt.y,f),Yn=E.upVector(f,ht.x,ht.y),gr=E.upVector(f,mt.x,mt.y);vp(zt,In,Yn),vp(zt,In,Yn),vp(zt,Rn,gr),vp(zt,Rn,gr)}}b&&(ie+=Ae.length-1),O&&K&&this.zoom>=17&&(Ke.length!==0&&ne(Ke,Ke[0])&&Ke.pop(),this.groundEffect.addData(Ke,pe,M,K>0))}this.footprintSegments.push(be),_e.triangleCount=this.indexArray.length-_e.triangleArrayOffset,this.polygonSegments.push(_e),++C.footprintSegLen,++C.polygonSegLen}if(C.vertexCount=this.layoutVertexArray.length-C.vertexArrayOffset,C.groundVertexCount=this.groundEffect.vertexArray.length-C.groundVertexArrayOffset,C.vertexCount!==0){if(C.centroidXY=T.borders?sT:this.encodeCentroid(T,C),this.centroidData.push(C),T.borders){this.featuresOnBorder.push(T);let te=this.featuresOnBorder.length-1;for(let pe=0;pe<T.borders.length;pe++)T.borders[pe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[pe].push(te)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,c,p,f,w),this.groundEffect.addPaintPropertiesData(e,a,c,p,f,w),this.maxHeight=Math.max(this.maxHeight,L)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){let e=[];for(let v=0;v<this.centroidData.length;v++){let w=this.centroidData[v],M=+(w.min.y+w.max.y>ct),_=2*M+(+(w.min.x+w.max.x>ct)^M);for(let E=0;E<w.polygonSegLen;E++){let D=w.polygonSegIdx+E;e.push({centroidIdx:v,subtile:_,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let r=new Vr;e.sort((v,w)=>v.triangleSegmentIdx===w.triangleSegmentIdx?v.subtile-w.subtile:v.triangleSegmentIdx-w.triangleSegmentIdx);let a=0,f=0,c=0;for(let v of e){if(v.triangleSegmentIdx!==a)break;c++}let p=e.length;for(;f!==e.length;){a=e[f].triangleSegmentIdx;let v=0,w=f,M=f;for(let _=w;_<c&&e[_].subtile===v;_++)M++;for(;w!==c;){let _=e[w];v=_.subtile;let E=this.centroidData[_.centroidIdx].min.clone(),D=this.centroidData[_.centroidIdx].max.clone(),b={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let T=w;T<M;T++){let C=e[T],O=this.polygonSegments[C.polygonSegmentIdx],L=this.centroidData[C.centroidIdx].min,B=this.centroidData[C.centroidIdx].max,j=this.indexArray.uint16;for(let z=O.triangleArrayOffset;z<O.triangleArrayOffset+O.triangleCount;z++)r.emplaceBack(j[3*z],j[3*z+1],j[3*z+2]);b.primitiveLength+=O.triangleCount,E.x=Math.min(E.x,L.x),E.y=Math.min(E.y,L.y),D.x=Math.max(D.x,B.x),D.y=Math.max(D.y,B.y)}b.primitiveLength>0&&this.triangleSubSegments.push({segment:b,min:E,max:D}),w=M;for(let T=w;T<c&&e[T].subtile===e[w].subtile;T++)M++}f=c;for(let _=f;_<p&&e[_].triangleSegmentIdx===e[f].triangleSegmentIdx;_++)c++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,a){let f=new ur;if(this.wallMode){for(let C of this.triangleSubSegments)f.segments.push(C.segment);return f}let c=0,p=0,v=1<<e.canonical.z;if(r){let C=r.getMinMaxForTile(e);C&&(c=C.min,p=C.max)}p+=this.maxHeight;let w=e.toUnwrapped(),M,_=[w.canonical.x/v+w.wrap,w.canonical.y/v],E=[(w.canonical.x+1)/v+w.wrap,(w.canonical.y+1)/v],D=(C,O,L)=>[C[0]*(1-L[0])+O[0]*L[0],C[1]*(1-L[1])+O[1]*L[1]],b=[],T=[];for(let C of this.triangleSubSegments){b[0]=C.min.x/ct,b[1]=C.min.y/ct,T[0]=C.max.x/ct,T[1]=C.max.y/ct;let O=D(_,E,b),L=D(_,E,T);if(new wt([O[0],O[1],c],[L[0],L[1],p]).intersectsPrecise(a)===0){M&&(f.segments.push(M),M=void 0);continue}let B=C.segment;M&&M.vertexOffset!==B.vertexOffset&&(f.segments.push(M),M=void 0),M?(M.vertexLength+=B.vertexLength,M.primitiveLength+=B.primitiveLength):M={vertexOffset:B.vertexOffset,primitiveLength:B.primitiveLength,vertexLength:B.vertexLength,primitiveOffset:B.primitiveOffset,sortKey:void 0,vaos:{}}}return M&&f.segments.push(M),f}encodeCentroid(e,r){let a=e.centroid(),f=r.span(),c=Math.min(7,Math.round(f.x*this.tileToMeter/10)),p=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new at(Yt(a.x,1,ct-1)<<3|c,Yt(a.y,1,ct-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new at(0,0);let r=e.borders,a=Number.MAX_VALUE;if(r[0][0]!==a||r[1][0]!==a){let f=r[0][0]!==a?0:1;return new at(6|(r[0][0]!==a?0:65528),(r[f][0]+r[f][1])/2<<3|6)}{let f=r[2][0]!==a?2:3;return new at((r[f][0]+r[f][1])/2<<3|6,6|(r[2][0]!==a?0:65528))}}showCentroid(e){let r=this.centroidData[e.centroidDataIndex];r.flags&=jl,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let r=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,f=e.flags&jl?sT:e.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==f.y||c!==f.x){for(let p=r;p<a;++p)this.centroidVertexArray.emplace(p,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,a){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;let f=r.getReplacementRegionsForTile(e.toUnwrapped());if(V0(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let p of this.centroidData)p.flags&=2147483647;let c=[];for(let p of this.activeReplacements){if(p.order<a)continue;let v=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(let w of this.centroidData)if(!(w.flags&jl||p.min.x>w.max.x||w.min.x>p.max.x||p.min.y>w.max.y||w.min.y>p.max.y))for(let M=0;M<w.footprintSegLen;M++){let _=this.footprintSegments[w.footprintSegIdx+M];if(c.length=0,JR(this.footprintVertices,_.vertexOffset,_.vertexCount,p.footprintTileId.canonical,e.canonical,c),tT(p.footprint,c,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-v)){w.flags|=jl;break}}}for(let p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,a){let f=!1;for(let c=0;c<a.footprintSegLen;c++){let p=this.footprintSegments[a.footprintSegIdx+c],v=0;for(let w of p.ringIndices){for(let M=v,_=w+v-1;M<w+v;_=M++){let E=this.footprintVertices.int16[2*(M+p.vertexOffset)+0],D=this.footprintVertices.int16[2*(M+p.vertexOffset)+1],b=this.footprintVertices.int16[2*(_+p.vertexOffset)+1];D>r!=b>r&&e<(this.footprintVertices.int16[2*(_+p.vertexOffset)+0]-E)*(r-D)/(b-D)+E&&(f=!f)}v=w}}return f}getHeightAtTileCoord(e,r){let a=Number.NEGATIVE_INFINITY,f=!0,c=4*(e+ct)*ct+(r+ct);if(this.partLookup.hasOwnProperty(c)){let p=this.partLookup[c];return p?{height:p.height,hidden:!!(p.flags&jl)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||r>p.max.y||p.min.y>r||this.footprintContainsPoint(e,r,p)&&p&&p.height>a&&(a=p.height,this.partLookup[c]=p,f=!!(p.flags&jl));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:f};this.partLookup[c]=void 0}}function dT(o,e){let r=o.add(e)._unit();return o.x*r.x+o.y*r.y}function KR(o,e,r,a){let f=e.sub(o)._perp()._unit(),c=r.sub(e)._perp()._unit();return fT(o,e,r,dT(f,c),a)}function fT(o,e,r,a,f){let c=Math.sqrt(1-a*a);return Math.min(o.dist(e)/3,e.dist(r)/3,f*c/a)}function $0(o,e,r){return o.x<r[0].x&&e.x<r[0].x||o.x>r[1].x&&e.x>r[1].x||o.y<r[0].y&&e.y<r[0].y||o.y>r[1].y&&e.y>r[1].y}function pT(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function mT(o,e,r){if(o.x<0||o.x>=ct||e.x<0||e.x>=ct||r.x<0||r.x>=ct)return!1;let a=r.sub(e),f=a.perp(),c=o.sub(e);return(a.x*c.x+a.y*c.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(c.x*c.x+c.y*c.y))>-.866&&f.x*c.x+f.y*c.y<0}function gT(o,e,r){let a=e?2|o:-3&o;return r?1|a:-2&a}function _T(){let o=Math.PI/32,e=Math.tan(o),r=Ma;return r*Math.sqrt(1+2*e*e)-r}function yT(o,e,r){let a=1<<r.z,f=Pi(r.x/a),c=Pi((r.x+1)/a),p=jr(r.y/a),v=jr((r.y+1)/a);return function(w,M,_,E,D=0,b){let T=[];if(!w.length||!_||!E)return T;let C=(q,K)=>{for(let re of q)T.push({polygon:re,bounds:K})},O=Math.ceil(Math.log2(_)),L=Math.ceil(Math.log2(E)),B=O-L,j=[];for(let q=0;q<Math.abs(B);q++)j.push(B>0?0:1);for(let q=0;q<Math.min(O,L);q++)j.push(0),j.push(1);let z=w;if(z=Yg(z,M[0].y-D,M[1].y+D,1),z=Yg(z,M[0].x-D,M[1].x+D,0),!z.length)return T;let U=[];for(j.length?U.push({polygons:z,bounds:M,depth:0}):C(z,M);U.length;){let q=U.pop(),K=q.depth,re=j[K],ne=q.bounds[0],te=q.bounds[1],pe=re===0?ne.x:ne.y,ie=re===0?te.x:te.y,me=b?b(re,pe,ie):.5*(pe+ie),ye=Yg(q.polygons,pe-D,me+D,re),_e=Yg(q.polygons,me-D,ie+D,re);if(ye.length){let be=[ne,new at(re===0?me:te.x,re===1?me:te.y)];j.length>K+1?U.push({polygons:ye,bounds:be,depth:K+1}):C(ye,be)}if(_e.length){let be=[new at(re===0?me:ne.x,re===1?me:ne.y),te];j.length>K+1?U.push({polygons:_e,bounds:be,depth:K+1}):C(_e,be)}}return T}(o,e,Math.ceil((c-f)/11.25),Math.ceil((p-v)/11.25),1,(w,M,_)=>{if(w===0)return .5*(M+_);{let E=jr((r.y+M/ct)/a);return(po(.5*(jr((r.y+_/ct)/a)+E))*a-r.y)*ct}})}function JR(o,e,r,a,f,c){let p=Math.pow(2,a.z-f.z);for(let v=0;v<r;v++){let w=o.int16[2*(v+e)+0],M=o.int16[2*(v+e)+1];w=(w+f.x*ct)*p-a.x*ct,M=(M+f.y*ct)*p-a.y*ct,c.push(new at(w,M))}}let vT,xT;function xp(o,e){return o.x*e.x+o.y*e.y}function bT(o,e){if(o.length===1){let r=0,a=e[r++],f;for(;!f||a.equals(f);)if(f=e[r++],!f)return 1/0;for(;r<e.length;r++){let c=e[r],p=o[0],v=f.sub(a),w=c.sub(a),M=p.sub(a),_=xp(v,v),E=xp(v,w),D=xp(w,w),b=xp(M,v),T=xp(M,w),C=_*D-E*E,O=(D*b-E*T)/C,L=(_*T-E*b)/C,B=a.z*(1-O-L)+f.z*O+c.z*L;if(isFinite(B))return B}return 1/0}{let r=1/0;for(let a of e)r=Math.min(r,a.z);return r}}function wT(o,e,r,a,f,c,p,v){let w=p*f.getElevationAt(o,e,!0,!0),M=c[0]!==0,_=M?c[1]===0?p*(c[0]/7-450):p*function(E,D,b){let T=Math.floor(D[0]/8),C=Math.floor(D[1]/8),O=10*(D[0]-8*T),L=10*(D[1]-8*C),B=E.getElevationAt(T,C,!0,!0),j=E.getMeterToDEM(b),z=Math.floor(.5*(O*j-1)),U=Math.floor(.5*(L*j-1)),q=E.tileCoordToPixel(T,C),K=2*z+1,re=2*U+1,ne=function(_e,be,Se,Ae,Ie){return[_e.getElevationAtPixel(be,Se,!0),_e.getElevationAtPixel(be+Ie,Se,!0),_e.getElevationAtPixel(be,Se+Ie,!0),_e.getElevationAtPixel(be+Ae,Se+Ie,!0)]}(E,q.x-z,q.y-U,K,re),te=Math.abs(ne[0]-ne[1]),pe=Math.abs(ne[2]-ne[3]),ie=Math.abs(ne[0]-ne[2])+Math.abs(ne[1]-ne[3]),me=Math.min(.25,.5*j*(te+pe)/K),ye=Math.min(.25,.5*j*ie/re);return B+Math.max(me*O,ye*L)}(f,c,v):w;return{base:w+(r===0?-1:r),top:M?Math.max(_+a,w+r+2):w+a}}_t(e_,"FillExtrusionBucket",{omit:["layers","features"]}),_t(lT,"PartData"),_t(aT,"FootprintSegment"),_t(cT,"BorderCentroidData"),_t(hT,"GroundEffect");let QR=xn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),eP=xn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:tP}=QR,nP=xn([{name:"a_packed",components:3,type:"Float32"}]),{members:rP}=nP,iP=xn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:oP}=iP;class ET{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Vl({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){let a=this.getKey(e,r);return this.positions[a]}trim(){let e=this.width,r=this.height=sl(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){let f=[],c=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,v=!0;f.push({left:c,right:p,isDash:v,zeroLength:e[0]===0});let w=e[0];for(let M=1;M<e.length;M++){v=!v;let _=e[M];c=w*a,w+=_,p=w*a,f.push({left:c,right:p,isDash:v,zeroLength:_===0})}return f}addRoundDash(e,r,a){let f=r/2;for(let c=-a;c<=a;c++){let p=this.width*(this.nextRow+a+c),v=0,w=e[v];for(let M=0;M<this.width;M++){M/w.right>1&&(w=e[++v]);let _=Math.abs(M-w.left),E=Math.abs(M-w.right),D=Math.min(_,E),b,T=c/a*(f+1);if(w.isDash){let C=f-Math.abs(T);b=Math.sqrt(D*D+C*C)}else b=f-Math.sqrt(D*D+T*T);this.image.data[p+M]=Math.max(0,Math.min(255,b+128))}}}addRegularDash(e,r){for(let w=e.length-1;w>=0;--w){let M=e[w],_=e[w+1];M.zeroLength?e.splice(w,1):_&&_.isDash===M.isDash&&(_.left=M.left,e.splice(w,1))}let a=e[0],f=e[e.length-1];a.isDash===f.isDash&&(a.left=f.left-this.width,f.right=a.right+this.width);let c=this.width*this.nextRow,p=0,v=e[p];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++p]);let M=Math.abs(w-v.left),_=Math.abs(w-v.right),E=Math.min(M,_);this.image.data[c+w]=Math.max(0,Math.min(255,(v.isDash?E:-E)+r+128))}}addDash(e,r){let a=this.getKey(e,r);if(this.positions[a])return this.positions[a];let f=r==="round",c=f?7:0,p=2*c+1;if(this.nextRow+p>this.height)return qt("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let _=0;_<e.length;_++)e[_]<0&&(qt("Negative value is found in line dasharray, replacing values with 0"),e[_]=0),v+=e[_];if(v!==0){let _=this.width/v,E=this.getDashRanges(e,this.width,_);f?this.addRoundDash(E,_,c):this.addRegularDash(E,r==="square"?.5*_:0)}let w=this.nextRow+c;this.nextRow+=p;let M={tl:[w,c],br:[v,0]};return this.positions[a]=M,M}}_t(ET,"LineAtlas");let sP=kh.VectorTileFeature.types,aP=Math.cos(Math.PI/180*37.5),lP=Math.cos(Math.PI/180*5);class H0{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Bc,this.layoutVertexArray2=new ko,this.patternVertexArray=new ko,this.indexArray=new Vr,this.programConfigurations=new qs(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new ur,this.maxLineLength=0,this.zOffsetVertexArray=new ko,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:ct/64}updateFootprints(e,r){}populate(e,r,a,f){this.hasPattern=P0("line",this.layers,this.pixelRatio,r);let c=this.layers[0].layout.get("line-sort-key");this.tileToMeter=t(a);let p=this.layers[0].layout.get("line-z-offset"),v=p.isConstant()&&!p.constantOr(0),w=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=w==="sea"||w==="ground"||!v&&w==="none",this.hasZOffset&&w==="none"&&qt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);let M=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&M!==void 0;let _=[];for(let{feature:T,id:C,index:O,sourceLayerIndex:L}of e){let B=this.layers[0]._featureFilter.needGeometry,j=k(T,B);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),j,a))continue;let z=c?c.evaluate(j,{},a):void 0,U={id:C,properties:T.properties,type:T.type,sourceLayerIndex:L,index:O,geometry:B?j.geometry:P(T,a,f),patterns:{},sortKey:z};_.push(U)}c&&_.sort((T,C)=>T.sortKey-C.sortKey);let{lineAtlas:E,featureIndex:D}=r,b=this.addConstantDashes(E);for(let T of _){let{geometry:C,index:O,sourceLayerIndex:L}=T;if(b&&this.addFeatureDashes(T,E),this.hasPattern){let B=O0("line",this.layers,T,this.zoom,this.pixelRatio,r);this.patternFeatures.push(B)}else this.addFeature(T,C,O,a,E.positions,r.availableImages,r.brightness);D.insert(e[O].feature,C,O,L,this.index)}}addConstantDashes(e){let r=!1;for(let a of this.layers){let f=a.paint.get("line-dasharray").value,c=a.layout.get("line-cap").value;if(f.kind!=="constant"||c.kind!=="constant")r=!0;else{let p=c.value,v=f.value;if(!v)continue;e.addDash(v,p)}}return r}addFeatureDashes(e,r){let a=this.zoom;for(let f of this.layers){let c=f.paint.get("line-dasharray").value,p=f.layout.get("line-cap").value;if(c.kind==="constant"&&p.kind==="constant")continue;let v,w;if(c.kind==="constant"){if(v=c.value,!v)continue}else v=c.evaluate({zoom:a},e);w=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),r.addDash(v,w),e.patterns[f.id]=r.getKey(v,w)}}update(e,r,a,f,c,p,v){this.programConfigurations.updatePaintArrays(e,r,c,a,f,p,v)}addFeatures(e,r,a,f,c,p){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,a,f,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,rP)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,oP)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,eP.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tP),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,f,c,p,v){let w=this.layers[0].layout,M=w.get("line-join").evaluate(e,{}),_=w.get("line-cap").evaluate(e,{}),E=w.get("line-miter-limit"),D=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=w.get("line-z-offset").value;let b=this.layers[0].paint.get("line-width").value;b.kind!=="constant"&&b.isLineProgressConstant===!1&&(this.variableWidthValue=b);for(let T of r)this.addLine(T,e,f,M,_,E,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,c,p,f,v)}addLine(e,r,a,f,c,p,v){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;let w=f==="none";if(this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let j=0;j<e.length-1;j++)this.totalDistance+=e[j].dist(e[j+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let M=sP[r.type]==="Polygon",_=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let E=0;for(;E<_-1&&e[E].equals(e[E+1]);)E++;if(_<(M?3:2))return;f==="bevel"&&(p=1.05);let D=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray),b,T,C,O,L,B;this.e1=this.e2=-1,M&&(b=e[_-2],L=e[E].sub(b)._unit()._perp());for(let j=E;j<_;j++){if(C=j===_-1?M?e[E+1]:void 0:e[j+1],C&&e[j].equals(C))continue;L&&(O=L),b&&(T=b),b=e[j],B=this.evaluateLineProgressFeatures(T?T.dist(b):0),L=C?C.sub(b)._unit()._perp():O,O=O||L;let z=T&&C,U=z?f:M||w?"butt":c,q=O.x*L.x+O.y*L.y;if(w){let ye=function(_e){if(_e.patternJoinNone){let be=_e.segmentPoints.length/2,Se=_e.lineSoFar-_e.segmentStart;for(let Ae=0;Ae<be;++Ae){let Ie=_e.segmentPoints[2*Ae+1],$e=Math.round(_e.segmentPoints[2*Ae])+.5+.25*Ie;_e.patternVertexArray.emplaceBack($e,Se,_e.segmentStart),_e.patternVertexArray.emplaceBack($e,Se,_e.segmentStart)}_e.segmentPoints.length=0}_e.e1=_e.e2=-1};if(z&&q<lP){this.updateDistance(T,b),this.addCurrentVertex(b,O,1,1,D,B),ye(this),this.addCurrentVertex(b,L,-1,-1,D,B);continue}if(T){if(!C){this.updateDistance(T,b),this.addCurrentVertex(b,O,1,1,D,B),ye(this);continue}U="miter"}}let K=O.add(L);K.x===0&&K.y===0||K._unit();let re=K.x*L.x+K.y*L.y,ne=re!==0?1/re:1/0,te=2*Math.sqrt(2-2*re),pe=re<aP&&T&&C,ie=O.x*L.y-O.y*L.x>0,me=this.overscaling<=16?15*ct/(512*this.overscaling):0;if(z&&U==="round"){if(ne<v)U="miter";else if(ne<=2){let ye=G0(b,-10,ct+10);U=this.hasZOffset&&(ye||this.hasCrossSlope)?"miter":"fakeround"}}if(U==="miter"&&ne>p&&(U="bevel"),U==="bevel"&&(ne>2&&(U="flipbevel"),ne<p&&(U="miter")),T&&!(U==="miter"&&pe)&&this.updateDistance(T,b),U==="miter")if(pe){let ye=b.dist(T);if(ye>2*me){let be=b.sub(b.sub(T)._mult(me/ye)._round());this.updateDistance(T,be),this.addCurrentVertex(be,O,0,0,D,B),T=be}this.updateDistance(T,b),K._mult(ne),this.addCurrentVertex(b,K,0,0,D,B);let _e=b.dist(C);if(_e>2*me){let be=b.add(C.sub(b)._mult(me/_e)._round());this.updateDistance(b,be),this.addCurrentVertex(be,L,0,0,D,B),b=be}}else K._mult(ne),this.addCurrentVertex(b,K,0,0,D,B);else if(U==="flipbevel"){if(ne>100)K=L.mult(-1);else{let ye=ne*O.add(L).mag()/O.sub(L).mag();K._perp()._mult(ye*(ie?-1:1))}this.addCurrentVertex(b,K,0,0,D,B),this.addCurrentVertex(b,K.mult(-1),0,0,D,B)}else if(U==="bevel"||U==="fakeround"){B!=null&&T&&this.addCurrentVertex(b,O,-1,-1,D,B);let ye=b.dist(T)<=2*me&&U!=="bevel",_e=K.mult(ie?1:-1);_e._mult(ne);let be=L.mult(ie?-1:1),Se=O.mult(ie?-1:1),Ae=this.evaluateLineProgressFeatures(this.distance);if(B==null&&(this.addHalfVertex(b,_e.x,_e.y,!1,!ie,0,D,Ae),ye||this.addHalfVertex(b,_e.x+2*Se.x,_e.y+2*Se.y,!1,ie,0,D,Ae)),U==="fakeround"){let Ie=Math.round(180*te/Math.PI/20);this.addHalfVertex(b,Se.x,Se.y,!1,ie,0,D,Ae);for(let $e=0;$e<Ie;$e++){let Ke=$e/Ie;if(Ke!==.5){let ut=Ke-.5;Ke+=Ke*ut*(Ke-1)*((1.0904+q*(q*(3.55645-1.43519*q)-3.2452))*ut*ut+(.848013+q*(.215638*q-1.06021)))}let Ue=be.sub(Se)._mult(Ke)._add(Se)._unit();this.addHalfVertex(b,Ue.x,Ue.y,!1,ie,0,D,Ae)}this.addHalfVertex(b,be.x,be.y,!1,ie,0,D,Ae)}ye||B!=null||this.addHalfVertex(b,_e.x+2*be.x,_e.y+2*be.y,!1,ie,0,D,Ae),B!=null&&C&&this.addCurrentVertex(b,L,1,1,D,B)}else U==="butt"?this.addCurrentVertex(b,K,0,0,D,B):U==="square"?(T||this.addCurrentVertex(b,K,-1,-1,D,B),this.addCurrentVertex(b,K,0,0,D,B),T&&this.addCurrentVertex(b,K,1,1,D,B)):U==="round"&&(T&&(this.addCurrentVertex(b,O,0,0,D,B),this.addCurrentVertex(b,O,1,1,D,B,!0)),C&&(this.addCurrentVertex(b,L,-1,-1,D,B,!0),this.addCurrentVertex(b,L,0,0,D,B)))}}addVerticesTo(e,r,a,f,c,p,v,w,M,_){let E=(r.w-e.w)/this.tessellationStep|0,D=0,b=this.scaledDistance;if(E>1){this.lineSoFar=e.w;let C=(r.x-e.x)/E,O=(r.y-e.y)/E,L=(r.z-e.z)/E,B=(r.w-e.w)/E;for(let j=1;j<E;++j){e.x+=C,e.y+=O,e.z+=L,this.lineSoFar+=B,D+=B;let z=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(e,a,f,_,!1,v,M,z),this.addHalfVertex(e,c,p,_,!0,-w,M,z)}}this.lineSoFar=r.w,this.scaledDistance=b;let T=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,a,f,_,!1,v,M,T),this.addHalfVertex(r,c,p,_,!0,-w,M,T)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):qt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}:{zOffset:0,variableWidth:r}}addCurrentVertex(e,r,a,f,c,p,v=!1){let w=r.x+r.y*a,M=r.y-r.x*a,_=r.y*f-r.x,E=-r.y-r.x*f;if(p!=null){let D=this.hasZOffset,b=-10,T=ct+10,C=p.zOffset,O=new XE(e.x,e.y,C,this.lineSoFar),L=!!D&&G0(e,b,T),B=this.lineSoFar,j=this.distance;if(this.currentVertex)if(L){let z=this.currentVertexIsOutside,U=this.currentVertex,q=new XE(e.x,e.y,C,this.lineSoFar);if(KE(U,q,b,T),!G0(q,b,T)){if(z){this.e1=this.e2=-1,this.distance-=U.dist(O),this.lineSoFar=U.w;let K=this.evaluateLineProgressFeatures(U.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(U,w,M,v,!1,a,c,K),this.addHalfVertex(U,_,E,v,!0,-f,c,K),this.prevDistance=this.distance}this.distance=this.prevDistance+U.dist(q),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(U,q,w,M,_,E,a,f,c,v),this.distance=j,this.scaledDistance=this.distance/this.totalDistance}}else{let z=this.currentVertex;if(this.currentVertexIsOutside){KE(z,O,b,T),this.e1=this.e2=-1,this.distance-=z.dist(O),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=z.w;let U=this.evaluateLineProgressFeatures(z.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(z,w,M,v,!1,a,c,U),this.addHalfVertex(z,_,E,v,!0,-f,c,U),this.prevDistance=this.distance,this.distance=j,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(z,O,w,M,_,E,a,f,c,v)}else L||(this.addHalfVertex(e,w,M,v,!1,a,c,p),this.addHalfVertex(e,_,E,v,!0,-f,c,p));this.currentVertex=O,this.currentVertexIsOutside=L,this.lineSoFar=B}else this.addHalfVertex(e,w,M,v,!1,a,c,p),this.addHalfVertex(e,_,E,v,!0,-f,c,p)}addHalfVertex({x:e,y:r},a,f,c,p,v,w,M){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(r<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*f)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){let E=At(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,E)}let _=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),w.primitiveLength++),p?this.e2=_:this.e1=_,M!=null&&this.zOffsetVertexArray.emplaceBack(M.zOffset,M.variableWidth,M.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function G0(o,e,r){return o.x<e||o.x>r||o.y<e||o.y>r}let TT,IT;function ST(o,e,r){return e*(ct/(o.tileSize*Math.pow(2,r-o.tileID.overscaledZ)))}_t(H0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let DT=(o,e,r)=>(1-r)*o+r*e;function MT(o,e){return 1/ST(o,1,e.tileZoom)}function CT(o,e,r,a){return o.translatePosMatrix(a||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}let AT=o=>{let e=[];RT(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let r=o.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let a=o.layout.get("line-join").constantOr("miter")==="none",f=!!o.paint.get("line-pattern").constantOr(1);return a&&f&&e.push("LINE_JOIN_NONE"),e};function RT(o){let e=o.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let q0,PT=()=>q0||(q0={layout:TT||(TT=new er({"line-cap":new ft(Pe.layout_line["line-cap"]),"line-join":new ft(Pe.layout_line["line-join"]),"line-miter-limit":new nt(Pe.layout_line["line-miter-limit"]),"line-round-limit":new nt(Pe.layout_line["line-round-limit"]),"line-sort-key":new ft(Pe.layout_line["line-sort-key"]),"line-z-offset":new ft(Pe.layout_line["line-z-offset"]),"line-elevation-reference":new nt(Pe.layout_line["line-elevation-reference"]),"line-cross-slope":new nt(Pe.layout_line["line-cross-slope"]),visibility:new nt(Pe.layout_line.visibility),"line-width-unit":new nt(Pe.layout_line["line-width-unit"])})),paint:IT||(IT=new er({"line-opacity":new ft(Pe.paint_line["line-opacity"]),"line-color":new ft(Pe.paint_line["line-color"]),"line-translate":new nt(Pe.paint_line["line-translate"]),"line-translate-anchor":new nt(Pe.paint_line["line-translate-anchor"]),"line-width":new ft(Pe.paint_line["line-width"]),"line-gap-width":new ft(Pe.paint_line["line-gap-width"]),"line-offset":new ft(Pe.paint_line["line-offset"]),"line-blur":new ft(Pe.paint_line["line-blur"]),"line-dasharray":new ft(Pe.paint_line["line-dasharray"]),"line-pattern":new ft(Pe.paint_line["line-pattern"]),"line-gradient":new Al(Pe.paint_line["line-gradient"]),"line-trim-offset":new nt(Pe.paint_line["line-trim-offset"]),"line-trim-fade-range":new nt(Pe.paint_line["line-trim-fade-range"]),"line-trim-color":new nt(Pe.paint_line["line-trim-color"]),"line-emissive-strength":new nt(Pe.paint_line["line-emissive-strength"]),"line-border-width":new ft(Pe.paint_line["line-border-width"]),"line-border-color":new ft(Pe.paint_line["line-border-color"]),"line-occlusion-opacity":new nt(Pe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},q0);class cP extends ft{possiblyEvaluate(e,r){return r=new Gn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,f){return r=ai({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,f)}}let bp;function OT(o,e){return e>0?e+2*o:o}let uP=xn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hP=xn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),dP=xn([{name:"a_projected_pos",components:4,type:"Float32"}],4);xn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let fP=xn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),pP=xn([{name:"a_texb",components:2,type:"Uint16"}]),mP=xn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),gP=xn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);xn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let LT=xn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_P=xn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xn([{name:"triangle",components:3,type:"Uint16"}]),xn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),xn([{type:"Float32",name:"offsetX"}]),xn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Qr=24;let ps=128;function W0(o,e,r,a,f){if(o.kind==="camera")return o.maxSize;if(o.kind==="composite"){let c=e.possiblyEvaluate(new Gn(o.maxZoom),r).evaluate(f,{},r),p=e.possiblyEvaluate(new Gn(o.minZoom),r).evaluate(f,{},r);return Math.max(c,p)}return e.possiblyEvaluate(new Gn(a)).evaluate(f,{},r)}function Z0(o,e){let{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Gn(o+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:f}=r,c=0;for(;c<a.length&&a[c]<=o;)c++;c=Math.max(0,c-1);let p=c;for(;p<a.length&&a[p]<o+1;)p++;p=Math.min(a.length-1,p);let v=a[c],w=a[p];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:f}:{kind:"camera",minZoom:v,maxZoom:w,minSize:r.evaluate(new Gn(v)),maxSize:r.evaluate(new Gn(w)),interpolationType:f}}}function t_(o,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:f}){return o.kind==="source"?a/ps:o.kind==="composite"?At(a/ps,f/ps,r):e}function Fh(o,e,r=1){let a=0,f=0;if(o.kind==="constant")f=o.layoutSize*r;else if(o.kind!=="source"){let{interpolationType:c,minZoom:p,maxZoom:v}=o,w=c?Yt(Ci.interpolationFactor(c,e,p,v),0,1):0;o.kind==="camera"?f=At(o.minSize,o.maxSize,w)*r:a=w*r}return{uSizeT:a,uSize:f}}var yP=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ps,evaluateSizeForFeature:t_,evaluateSizeForZoom:Fh,getRasterizedIconSize:W0,getSizeData:Z0});function vP(o,e,r){return o.sections.forEach(a=>{a.text=function(f,c,p){let v=c.layout.get("text-transform").evaluate(p,{});return v==="uppercase"?f=f.toLocaleUpperCase():v==="lowercase"&&(f=f.toLocaleLowerCase()),Bi.applyArabicShaping&&(f=Bi.applyArabicShaping(f)),f}(a.text,e,r)}),o}let wp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function xP(o){return o==="\uFE36"||o==="\uFE48"||o==="\uFE38"||o==="\uFE44"||o==="\uFE42"||o==="\uFE3E"||o==="\uFE3C"||o==="\uFE3A"||o==="\uFE18"||o==="\uFE40"||o==="\uFE10"||o==="\uFE13"||o==="\uFE14"||o==="\uFF40"||o==="\uFFE3"||o==="\uFE11"||o==="\uFE12"}function bP(o){return o==="\uFE35"||o==="\uFE47"||o==="\uFE37"||o==="\uFE43"||o==="\uFE41"||o==="\uFE3D"||o==="\uFE3B"||o==="\uFE39"||o==="\uFE17"||o==="\uFE3F"}var kT,X0,FT,Y0={};function wP(){return kT||(kT=1,Y0.read=function(o,e,r,a,f){var c,p,v=8*f-a-1,w=(1<<v)-1,M=w>>1,_=-7,E=r?f-1:0,D=r?-1:1,b=o[e+E];for(E+=D,c=b&(1<<-_)-1,b>>=-_,_+=v;_>0;c=256*c+o[e+E],E+=D,_-=8);for(p=c&(1<<-_)-1,c>>=-_,_+=a;_>0;p=256*p+o[e+E],E+=D,_-=8);if(c===0)c=1-M;else{if(c===w)return p?NaN:1/0*(b?-1:1);p+=Math.pow(2,a),c-=M}return(b?-1:1)*p*Math.pow(2,c-a)},Y0.write=function(o,e,r,a,f,c){var p,v,w,M=8*c-f-1,_=(1<<M)-1,E=_>>1,D=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=a?0:c-1,T=a?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,p=_):(p=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-p))<1&&(p--,w*=2),(e+=p+E>=1?D/w:D*Math.pow(2,1-E))*w>=2&&(p++,w/=2),p+E>=_?(v=0,p=_):p+E>=1?(v=(e*w-1)*Math.pow(2,f),p+=E):(v=e*Math.pow(2,E-1)*Math.pow(2,f),p=0));f>=8;o[r+b]=255&v,b+=T,v/=256,f-=8);for(p=p<<f|v,M+=f;M>0;o[r+b]=255&p,b+=T,p/=256,M-=8);o[r+b-T]|=128*C}),Y0}function NT(){if(FT)return X0;FT=1,X0=e;var o=wP();function e(z){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(z)?z:new Uint8Array(z||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,a=1/r,f=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function c(z){return z.type===e.Bytes?z.readVarint()+z.pos:z.pos+1}function p(z,U,q){return q?4294967296*U+(z>>>0):4294967296*(U>>>0)+(z>>>0)}function v(z,U,q){var K=U<=16383?1:U<=2097151?2:U<=268435455?3:Math.floor(Math.log(U)/(7*Math.LN2));q.realloc(K);for(var re=q.pos-1;re>=z;re--)q.buf[re+K]=q.buf[re]}function w(z,U){for(var q=0;q<z.length;q++)U.writeVarint(z[q])}function M(z,U){for(var q=0;q<z.length;q++)U.writeSVarint(z[q])}function _(z,U){for(var q=0;q<z.length;q++)U.writeFloat(z[q])}function E(z,U){for(var q=0;q<z.length;q++)U.writeDouble(z[q])}function D(z,U){for(var q=0;q<z.length;q++)U.writeBoolean(z[q])}function b(z,U){for(var q=0;q<z.length;q++)U.writeFixed32(z[q])}function T(z,U){for(var q=0;q<z.length;q++)U.writeSFixed32(z[q])}function C(z,U){for(var q=0;q<z.length;q++)U.writeFixed64(z[q])}function O(z,U){for(var q=0;q<z.length;q++)U.writeSFixed64(z[q])}function L(z,U){return(z[U]|z[U+1]<<8|z[U+2]<<16)+16777216*z[U+3]}function B(z,U,q){z[q]=U,z[q+1]=U>>>8,z[q+2]=U>>>16,z[q+3]=U>>>24}function j(z,U){return(z[U]|z[U+1]<<8|z[U+2]<<16)+(z[U+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(z,U,q){for(q=q||this.length;this.pos<q;){var K=this.readVarint(),re=K>>3,ne=this.pos;this.type=7&K,z(re,U,this),this.pos===ne&&this.skip(K)}return U},readMessage:function(z,U){return this.readFields(z,U,this.readVarint()+this.pos)},readFixed32:function(){var z=L(this.buf,this.pos);return this.pos+=4,z},readSFixed32:function(){var z=j(this.buf,this.pos);return this.pos+=4,z},readFixed64:function(){var z=L(this.buf,this.pos)+L(this.buf,this.pos+4)*r;return this.pos+=8,z},readSFixed64:function(){var z=L(this.buf,this.pos)+j(this.buf,this.pos+4)*r;return this.pos+=8,z},readFloat:function(){var z=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,z},readDouble:function(){var z=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,z},readVarint:function(z){var U,q,K=this.buf;return U=127&(q=K[this.pos++]),q<128?U:(U|=(127&(q=K[this.pos++]))<<7,q<128?U:(U|=(127&(q=K[this.pos++]))<<14,q<128?U:(U|=(127&(q=K[this.pos++]))<<21,q<128?U:function(re,ne,te){var pe,ie,me=te.buf;if(pe=(112&(ie=me[te.pos++]))>>4,ie<128||(pe|=(127&(ie=me[te.pos++]))<<3,ie<128)||(pe|=(127&(ie=me[te.pos++]))<<10,ie<128)||(pe|=(127&(ie=me[te.pos++]))<<17,ie<128)||(pe|=(127&(ie=me[te.pos++]))<<24,ie<128)||(pe|=(1&(ie=me[te.pos++]))<<31,ie<128))return p(re,pe,ne);throw new Error("Expected varint not more than 10 bytes")}(U|=(15&(q=K[this.pos]))<<28,z,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var z=this.readVarint();return z%2==1?(z+1)/-2:z/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var z=this.readVarint()+this.pos,U=this.pos;return this.pos=z,z-U>=12&&f?function(q,K,re){return f.decode(q.subarray(K,re))}(this.buf,U,z):function(q,K,re){for(var ne="",te=K;te<re;){var pe,ie,me,ye=q[te],_e=null,be=ye>239?4:ye>223?3:ye>191?2:1;if(te+be>re)break;be===1?ye<128&&(_e=ye):be===2?(192&(pe=q[te+1]))==128&&(_e=(31&ye)<<6|63&pe)<=127&&(_e=null):be===3?(ie=q[te+2],(192&(pe=q[te+1]))==128&&(192&ie)==128&&((_e=(15&ye)<<12|(63&pe)<<6|63&ie)<=2047||_e>=55296&&_e<=57343)&&(_e=null)):be===4&&(ie=q[te+2],me=q[te+3],(192&(pe=q[te+1]))==128&&(192&ie)==128&&(192&me)==128&&((_e=(15&ye)<<18|(63&pe)<<12|(63&ie)<<6|63&me)<=65535||_e>=1114112)&&(_e=null)),_e===null?(_e=65533,be=1):_e>65535&&(_e-=65536,ne+=String.fromCharCode(_e>>>10&1023|55296),_e=56320|1023&_e),ne+=String.fromCharCode(_e),te+=be}return ne}(this.buf,U,z)},readBytes:function(){var z=this.readVarint()+this.pos,U=this.buf.subarray(this.pos,z);return this.pos=z,U},readPackedVarint:function(z,U){if(this.type!==e.Bytes)return z.push(this.readVarint(U));var q=c(this);for(z=z||[];this.pos<q;)z.push(this.readVarint(U));return z},readPackedSVarint:function(z){if(this.type!==e.Bytes)return z.push(this.readSVarint());var U=c(this);for(z=z||[];this.pos<U;)z.push(this.readSVarint());return z},readPackedBoolean:function(z){if(this.type!==e.Bytes)return z.push(this.readBoolean());var U=c(this);for(z=z||[];this.pos<U;)z.push(this.readBoolean());return z},readPackedFloat:function(z){if(this.type!==e.Bytes)return z.push(this.readFloat());var U=c(this);for(z=z||[];this.pos<U;)z.push(this.readFloat());return z},readPackedDouble:function(z){if(this.type!==e.Bytes)return z.push(this.readDouble());var U=c(this);for(z=z||[];this.pos<U;)z.push(this.readDouble());return z},readPackedFixed32:function(z){if(this.type!==e.Bytes)return z.push(this.readFixed32());var U=c(this);for(z=z||[];this.pos<U;)z.push(this.readFixed32());return z},readPackedSFixed32:function(z){if(this.type!==e.Bytes)return z.push(this.readSFixed32());var U=c(this);for(z=z||[];this.pos<U;)z.push(this.readSFixed32());return z},readPackedFixed64:function(z){if(this.type!==e.Bytes)return z.push(this.readFixed64());var U=c(this);for(z=z||[];this.pos<U;)z.push(this.readFixed64());return z},readPackedSFixed64:function(z){if(this.type!==e.Bytes)return z.push(this.readSFixed64());var U=c(this);for(z=z||[];this.pos<U;)z.push(this.readSFixed64());return z},skip:function(z){var U=7&z;if(U===e.Varint)for(;this.buf[this.pos++]>127;);else if(U===e.Bytes)this.pos=this.readVarint()+this.pos;else if(U===e.Fixed32)this.pos+=4;else{if(U!==e.Fixed64)throw new Error("Unimplemented type: "+U);this.pos+=8}},writeTag:function(z,U){this.writeVarint(z<<3|U)},realloc:function(z){for(var U=this.length||16;U<this.pos+z;)U*=2;if(U!==this.length){var q=new Uint8Array(U);q.set(this.buf),this.buf=q,this.length=U}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(z){this.realloc(4),B(this.buf,z,this.pos),this.pos+=4},writeSFixed32:function(z){this.realloc(4),B(this.buf,z,this.pos),this.pos+=4},writeFixed64:function(z){this.realloc(8),B(this.buf,-1&z,this.pos),B(this.buf,Math.floor(z*a),this.pos+4),this.pos+=8},writeSFixed64:function(z){this.realloc(8),B(this.buf,-1&z,this.pos),B(this.buf,Math.floor(z*a),this.pos+4),this.pos+=8},writeVarint:function(z){(z=+z||0)>268435455||z<0?function(U,q){var K,re;if(U>=0?(K=U%4294967296|0,re=U/4294967296|0):(re=~(-U/4294967296),4294967295^(K=~(-U%4294967296))?K=K+1|0:(K=0,re=re+1|0)),U>=18446744073709552e3||U<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");q.realloc(10),function(ne,te,pe){pe.buf[pe.pos++]=127&ne|128,ne>>>=7,pe.buf[pe.pos++]=127&ne|128,ne>>>=7,pe.buf[pe.pos++]=127&ne|128,ne>>>=7,pe.buf[pe.pos++]=127&ne|128,pe.buf[pe.pos]=127&(ne>>>=7)}(K,0,q),function(ne,te){var pe=(7&ne)<<4;te.buf[te.pos++]|=pe|((ne>>>=3)?128:0),ne&&(te.buf[te.pos++]=127&ne|((ne>>>=7)?128:0),ne&&(te.buf[te.pos++]=127&ne|((ne>>>=7)?128:0),ne&&(te.buf[te.pos++]=127&ne|((ne>>>=7)?128:0),ne&&(te.buf[te.pos++]=127&ne|((ne>>>=7)?128:0),ne&&(te.buf[te.pos++]=127&ne)))))}(re,q)}(z,this):(this.realloc(4),this.buf[this.pos++]=127&z|(z>127?128:0),z<=127||(this.buf[this.pos++]=127&(z>>>=7)|(z>127?128:0),z<=127||(this.buf[this.pos++]=127&(z>>>=7)|(z>127?128:0),z<=127||(this.buf[this.pos++]=z>>>7&127))))},writeSVarint:function(z){this.writeVarint(z<0?2*-z-1:2*z)},writeBoolean:function(z){this.writeVarint(!!z)},writeString:function(z){z=String(z),this.realloc(4*z.length),this.pos++;var U=this.pos;this.pos=function(K,re,ne){for(var te,pe,ie=0;ie<re.length;ie++){if((te=re.charCodeAt(ie))>55295&&te<57344){if(!pe){te>56319||ie+1===re.length?(K[ne++]=239,K[ne++]=191,K[ne++]=189):pe=te;continue}if(te<56320){K[ne++]=239,K[ne++]=191,K[ne++]=189,pe=te;continue}te=pe-55296<<10|te-56320|65536,pe=null}else pe&&(K[ne++]=239,K[ne++]=191,K[ne++]=189,pe=null);te<128?K[ne++]=te:(te<2048?K[ne++]=te>>6|192:(te<65536?K[ne++]=te>>12|224:(K[ne++]=te>>18|240,K[ne++]=te>>12&63|128),K[ne++]=te>>6&63|128),K[ne++]=63&te|128)}return ne}(this.buf,z,this.pos);var q=this.pos-U;q>=128&&v(U,q,this),this.pos=U-1,this.writeVarint(q),this.pos+=q},writeFloat:function(z){this.realloc(4),o.write(this.buf,z,this.pos,!0,23,4),this.pos+=4},writeDouble:function(z){this.realloc(8),o.write(this.buf,z,this.pos,!0,52,8),this.pos+=8},writeBytes:function(z){var U=z.length;this.writeVarint(U),this.realloc(U);for(var q=0;q<U;q++)this.buf[this.pos++]=z[q]},writeRawMessage:function(z,U){this.pos++;var q=this.pos;z(U,this);var K=this.pos-q;K>=128&&v(q,K,this),this.pos=q-1,this.writeVarint(K),this.pos+=K},writeMessage:function(z,U,q){this.writeTag(z,e.Bytes),this.writeRawMessage(U,q)},writePackedVarint:function(z,U){U.length&&this.writeMessage(z,w,U)},writePackedSVarint:function(z,U){U.length&&this.writeMessage(z,M,U)},writePackedBoolean:function(z,U){U.length&&this.writeMessage(z,D,U)},writePackedFloat:function(z,U){U.length&&this.writeMessage(z,_,U)},writePackedDouble:function(z,U){U.length&&this.writeMessage(z,E,U)},writePackedFixed32:function(z,U){U.length&&this.writeMessage(z,b,U)},writePackedSFixed32:function(z,U){U.length&&this.writeMessage(z,T,U)},writePackedFixed64:function(z,U){U.length&&this.writeMessage(z,C,U)},writePackedSFixed64:function(z,U){U.length&&this.writeMessage(z,O,U)},writeBytesField:function(z,U){this.writeTag(z,e.Bytes),this.writeBytes(U)},writeFixed32Field:function(z,U){this.writeTag(z,e.Fixed32),this.writeFixed32(U)},writeSFixed32Field:function(z,U){this.writeTag(z,e.Fixed32),this.writeSFixed32(U)},writeFixed64Field:function(z,U){this.writeTag(z,e.Fixed64),this.writeFixed64(U)},writeSFixed64Field:function(z,U){this.writeTag(z,e.Fixed64),this.writeSFixed64(U)},writeVarintField:function(z,U){this.writeTag(z,e.Varint),this.writeVarint(U)},writeSVarintField:function(z,U){this.writeTag(z,e.Varint),this.writeSVarint(U)},writeStringField:function(z,U){this.writeTag(z,e.Bytes),this.writeString(U)},writeFloatField:function(z,U){this.writeTag(z,e.Fixed32),this.writeFloat(U)},writeDoubleField:function(z,U){this.writeTag(z,e.Fixed64),this.writeDouble(U)},writeBooleanField:function(z,U){this.writeVarintField(z,!!U)}},X0}var n_=F(NT());let K0=3;function EP(o,e,r){e.glyphs=[],o===1&&r.readMessage(TP,e)}function TP(o,e,r){if(o===3){let{id:a,bitmap:f,width:c,height:p,left:v,top:w,advance:M}=r.readMessage(IP,{});e.glyphs.push({id:a,bitmap:new Vl({width:c+2*K0,height:p+2*K0},f),metrics:{width:c,height:p,left:v,top:w,advance:M}})}else o===4?e.ascender=r.readSVarint():o===5&&(e.descender=r.readSVarint())}function IP(o,e,r){o===1?e.id=r.readVarint():o===2?e.bitmap=r.readBytes():o===3?e.width=r.readVarint():o===4?e.height=r.readVarint():o===5?e.left=r.readSVarint():o===6?e.top=r.readSVarint():o===7&&(e.advance=r.readVarint())}let zT=K0,mo={horizontal:1,vertical:2,horizontalOnly:3};class Ep{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,r){let a=new Ep;return a.scale=e||1,a.fontStack=r,a}static forImage(e){let r=new Ep;return r.image=e,r}}class Nh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){let a=new Nh;for(let f=0;f<e.sections.length;f++){let c=e.sections[f];c.image?a.addImageSection(c):a.addTextSection(c,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,a){let f="";for(let c=0;c<r.length;c++){let p=r.charCodeAt(c+1)||null,v=r.charCodeAt(c-1)||null;f+=!a&&(p&&Nf(p)&&!wp[r[c+1]]||v&&Nf(v)&&!wp[r[c-1]])||!wp[r[c]]?r[c]:wp[r[c]]}return f}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&r_[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&r_[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){let a=new Nh;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Ep.forText(e.scale,e.fontStack||r));let a=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(a)}addImageSection(e){let r=e.image&&e.image.namePrimary?e.image.getPrimary():null;if(!r)return void qt("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Ep.forImage(r)),this.sectionIndex.push(this.sections.length-1)):qt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function J0(o,e,r,a,f,c,p,v,w,M,_,E,D,b,T){let C=Nh.fromFeature(o,f);E===mo.vertical&&C.verticalizePunctuation(D);let O=[],L=function(q,K,re,ne,te,pe){if(!q)return[];let ie=[],me=function(Se,Ae,Ie,$e,Ke,Ue){let ut=0;for(let lt=0;lt<Se.length();lt++){let tt=Se.getSection(lt);ut+=BT(Se.getCodePoint(lt),tt,$e,Ke,Ae,Ue)}return ut/Math.max(1,Math.ceil(ut/Ie))}(q,K,re,ne,te,pe),ye=q.text.indexOf("\u200B")>=0,_e=0;for(let Se=0;Se<q.length();Se++){let Ae=q.getSection(Se),Ie=q.getCodePoint(Se);if(r_[Ie]||(_e+=BT(Ie,Ae,ne,te,K,pe)),Se<q.length()-1){let $e=!((be=Ie)<11904||!(bt["Bopomofo Extended"](be)||bt.Bopomofo(be)||bt["CJK Compatibility Forms"](be)||bt["CJK Compatibility Ideographs"](be)||bt["CJK Compatibility"](be)||bt["CJK Radicals Supplement"](be)||bt["CJK Strokes"](be)||bt["CJK Symbols and Punctuation"](be)||bt["CJK Unified Ideographs Extension A"](be)||bt["CJK Unified Ideographs"](be)||bt["Enclosed CJK Letters and Months"](be)||bt["Halfwidth and Fullwidth Forms"](be)||bt.Hiragana(be)||bt["Ideographic Description Characters"](be)||bt["Kangxi Radicals"](be)||bt["Katakana Phonetic Extensions"](be)||bt.Katakana(be)||bt["Vertical Forms"](be)||bt["Yi Radicals"](be)||bt["Yi Syllables"](be)));(SP[Ie]||$e||Ae.image)&&ie.push(jT(Se+1,_e,me,ie,DP(Ie,q.getCodePoint(Se+1),$e&&ye),!1))}}var be;return UT(jT(q.length(),_e,me,ie,0,!0))}(C,M,c,e,a,b),{processBidirectionalText:B,processStyledBidirectionalText:j}=Bi;if(B&&C.sections.length===1){let q=B(C.toString(),L);for(let K of q){let re=new Nh;re.text=K,re.sections=C.sections;for(let ne=0;ne<K.length;ne++)re.sectionIndex.push(0);O.push(re)}}else if(j){let q=j(C.text,C.sectionIndex,L);for(let K of q){let re=new Nh;re.text=K[0],re.sectionIndex=K[1],re.sections=C.sections,O.push(re)}}else O=function(q,K){let re=[],ne=q.text,te=0;for(let pe of K)re.push(q.substring(te,pe)),te=pe;return te<ne.length&&re.push(q.substring(te,ne.length)),re}(C,L);let z=[],U={positionedLines:z,text:C.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(q,K,re,ne,te,pe,ie,me,ye,_e,be,Se){let Ae=0,Ie=0,$e=0,Ke=me==="right"?1:me==="left"?0:.5,Ue=!1;for(let ht of te){let mt=ht.getSections();for(let Lt of mt){if(Lt.image)continue;let Ht=K[Lt.fontStack];if(Ht&&(Ue=Ht.ascender!==void 0&&Ht.descender!==void 0,!Ue))break}if(!Ue)break}let ut=0;for(let ht of te){ht.trim();let mt=ht.getMaxScale(),Lt=(mt-1)*Qr,Ht={positionedGlyphs:[],lineOffset:0};q.positionedLines[ut]=Ht;let Wt=Ht.positionedGlyphs,Zt=0;if(!ht.length()){Ie+=pe,++ut;continue}let en=0,rn=0;for(let On=0;On<ht.length();On++){let zt=ht.getSection(On),In=ht.getSectionIndex(On),Rn=ht.getCodePoint(On),Yn=zt.scale,gr=null,Sr=null,_r=null,ar=Qr,br=0,Cr=!(ye===mo.horizontal||!be&&!fh(Rn)||be&&(r_[Rn]||(lt=Rn,bt.Arabic(lt)||bt["Arabic Supplement"](lt)||bt["Arabic Extended-A"](lt)||bt["Arabic Presentation Forms-A"](lt)||bt["Arabic Presentation Forms-B"](lt))));if(zt.image){let ei=ne[zt.image.serialize()];if(!ei)continue;_r=zt.image.id,q.iconsInText=q.iconsInText||!0,Sr=ei.paddedRect;let Zn=ei.displaySize;Yn=Yn*Qr/Se,gr={width:Zn[0],height:Zn[1],left:0,top:-zT,advance:Cr?Zn[1]:Zn[0],localGlyph:!1},br=Ue?-gr.height*Yn:mt*Qr-17-Zn[1]*Yn,ar=gr.advance;let Hi=(Cr?Zn[0]:Zn[1])*Yn-Qr*mt;Hi>0&&Hi>Zt&&(Zt=Hi)}else{let ei=re[zt.fontStack];if(!ei)continue;ei[Rn]&&(Sr=ei[Rn]);let Zn=K[zt.fontStack];if(!Zn)continue;let Hi=Zn.glyphs[Rn];if(!Hi)continue;if(gr=Hi.metrics,ar=Rn!==8203?Qr:0,Ue){let vs=Zn.ascender!==void 0?Math.abs(Zn.ascender):0,Uo=Zn.descender!==void 0?Math.abs(Zn.descender):0,$o=(vs+Uo)*Yn;en<$o&&(en=$o,rn=(vs-Uo)/2*Yn),br=-vs*Yn}else br=(mt-Yn)*Qr-17}Cr?(q.verticalizable=!0,Wt.push({glyph:Rn,imageName:_r,x:Ae,y:Ie+br,vertical:Cr,scale:Yn,localGlyph:gr.localGlyph,fontStack:zt.fontStack,sectionIndex:In,metrics:gr,rect:Sr}),Ae+=ar*Yn+_e):(Wt.push({glyph:Rn,imageName:_r,x:Ae,y:Ie+br,vertical:Cr,scale:Yn,localGlyph:gr.localGlyph,fontStack:zt.fontStack,sectionIndex:In,metrics:gr,rect:Sr}),Ae+=gr.advance*Yn+_e)}Wt.length!==0&&($e=Math.max(Ae-_e,$e),Ue?$T(Wt,Ke,Zt,rn,pe*mt/2):$T(Wt,Ke,Zt,0,pe/2)),Ae=0;let $n=pe*mt+Zt;Ht.lineOffset=Math.max(Zt,Lt),Ie+=$n,++ut}var lt;let tt=Ie,{horizontalAlign:Je,verticalAlign:xt}=Q0(ie);(function(ht,mt,Lt,Ht,Wt,Zt){let en=(mt-Lt)*Wt,rn=-Zt*Ht;for(let $n of ht)for(let On of $n.positionedGlyphs)On.x+=en,On.y+=rn})(q.positionedLines,Ke,Je,xt,$e,tt),q.top+=-xt*tt,q.bottom=q.top+tt,q.left+=-Je*$e,q.right=q.left+$e,q.hasBaseline=Ue}(U,e,r,a,O,p,v,w,E,M,D,T),!function(q){for(let K of q)if(K.positionedGlyphs.length!==0)return!1;return!0}(z)&&U}let r_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},SP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function BT(o,e,r,a,f,c){if(e.image){let p=a[e.image.serialize()];return p?p.displaySize[0]*e.scale*Qr/c+f:0}{let p=r[e.fontStack],v=p&&p.glyphs[o];return v?v.metrics.advance*e.scale+f:0}}function VT(o,e,r,a){let f=Math.pow(o-e,2);return a?o<e?f/2:2*f:f+Math.abs(r)*r}function DP(o,e,r){let a=0;return o===10&&(a-=1e4),r&&(a+=150),o!==40&&o!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function jT(o,e,r,a,f,c){let p=null,v=VT(e,r,f,c);for(let w of a){let M=VT(e-w.x,r,f,c)+w.badness;M<=v&&(p=w,v=M)}return{index:o,x:e,priorBreak:p,badness:v}}function UT(o){return o?UT(o.priorBreak).concat(o.index):[]}function Q0(o){let e=.5,r=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function $T(o,e,r,a,f){if(!(e||r||a||f))return;let c=o.length-1,p=o[c],v=(p.x+p.metrics.advance*p.scale)*e;for(let w=0;w<=c;w++)o[w].x-=v,o[w].y+=r+a+f}function MP(o,e,r,a){let{horizontalAlign:f,verticalAlign:c}=Q0(a),p=r[0]-o.displaySize[0]*f,v=r[1]-o.displaySize[1]*c;return{imagePrimary:o,imageSecondary:e,top:v,bottom:v+o.displaySize[1],left:p,right:p+o.displaySize[0]}}function HT(o,e,r,a,f,c){let p=o.imagePrimary,v;if(p.content){let O=p.content,L=p.pixelRatio||1;v=[O[0]/L,O[1]/L,p.displaySize[0]-O[2]/L,p.displaySize[1]-O[3]/L]}let w=e.left*c,M=e.right*c,_,E,D,b;r==="width"||r==="both"?(b=f[0]+w-a[3],E=f[0]+M+a[1]):(b=f[0]+(w+M-p.displaySize[0])/2,E=b+p.displaySize[0]);let T=e.top*c,C=e.bottom*c;return r==="height"||r==="both"?(_=f[1]+T-a[0],D=f[1]+C+a[2]):(_=f[1]+(T+C-p.displaySize[1])/2,D=_+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:_,right:E,bottom:D,left:b,collisionPadding:v}}class Ra extends at{constructor(e,r,a,f,c){super(e,r),this.angle=f,this.z=a,c!==void 0&&(this.segment=c)}clone(){return new Ra(this.x,this.y,this.z,this.angle,this.segment)}}function GT(o,e,r,a,f){if(e.segment===void 0)return!0;let c=e,p=e.segment+1,v=0;for(;v>-r/2;){if(p--,p<0)return!1;v-=o[p].dist(c),c=o[p]}v+=o[p].dist(o[p+1]),p++;let w=[],M=0;for(;v<r/2;){let _=o[p],E=o[p+1];if(!E)return!1;let D=o[p-1].angleTo(_)-_.angleTo(E);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:D}),M+=D;v-w[0].distance>a;)M-=w.shift().angleDelta;if(M>f)return!1;p++,v+=_.dist(E)}return!0}function qT(o){let e=0;for(let r=0;r<o.length-1;r++)e+=o[r].dist(o[r+1]);return e}function WT(o,e,r){return o?.6*e*r:0}function ZT(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function CP(o,e,r,a,f,c){let p=WT(r,f,c),v=ZT(r,a)*c,w=0,M=qT(o)/2;for(let _=0;_<o.length-1;_++){let E=o[_],D=o[_+1],b=E.dist(D);if(w+b>M){let T=(M-w)/b,C=At(E.x,D.x,T),O=At(E.y,D.y,T),L=new Ra(C,O,0,D.angleTo(E),_);return!p||GT(o,L,v,p,e)?L:void 0}w+=b}}function AP(o,e,r,a,f,c,p,v,w){let M=WT(a,c,p),_=ZT(a,f),E=_*p,D=o[0].x===0||o[0].x===w||o[0].y===0||o[0].y===w;return e-E<e/4&&(e=E+e/4),XT(o,D?e/2*v%e:(_/2+2*c)*p*v%e,e,M,r,E,D,!1,w)}function XT(o,e,r,a,f,c,p,v,w){let M=c/2,_=qT(o),E=0,D=e-r,b=[];for(let T=0;T<o.length-1;T++){let C=o[T],O=o[T+1],L=C.dist(O),B=O.angleTo(C);for(;D+r<E+L;){D+=r;let j=(D-E)/L,z=At(C.x,O.x,j),U=At(C.y,O.y,j);if(z>=0&&z<w&&U>=0&&U<w&&D-M>=0&&D+M<=_){let q=new Ra(z,U,0,B,T);a&&!GT(o,q,c,a,f)||b.push(q)}}E+=L}return v||b.length||p||(b=XT(o,E/2,r,a,f,c,p,!0,w)),b}function YT(o,e,r,a,f){let c=[];for(let p=0;p<o.length;p++){let v=o[p],w;for(let M=0;M<v.length-1;M++){let _=v[M],E=v[M+1];_.x<e&&E.x<e||(_.x<e?_=new at(e,_.y+(e-_.x)/(E.x-_.x)*(E.y-_.y))._round():E.x<e&&(E=new at(e,_.y+(e-_.x)/(E.x-_.x)*(E.y-_.y))._round()),_.y<r&&E.y<r||(_.y<r?_=new at(_.x+(r-_.y)/(E.y-_.y)*(E.x-_.x),r)._round():E.y<r&&(E=new at(_.x+(r-_.y)/(E.y-_.y)*(E.x-_.x),r)._round()),_.x>=a&&E.x>=a||(_.x>=a?_=new at(a,_.y+(a-_.x)/(E.x-_.x)*(E.y-_.y))._round():E.x>=a&&(E=new at(a,_.y+(a-_.x)/(E.x-_.x)*(E.y-_.y))._round()),_.y>=f&&E.y>=f||(_.y>=f?_=new at(_.x+(f-_.y)/(E.y-_.y)*(E.x-_.x),f)._round():E.y>=f&&(E=new at(_.x+(f-_.y)/(E.y-_.y)*(E.x-_.x),f)._round()),w&&_.equals(w[w.length-1])||(w=[_],c.push(w)),w.push(E)))))}}return c}function KT(o){let e=0,r=0;for(let p of o)e+=p.w*p.h,r=Math.max(r,p.w);o.sort((p,v)=>v.h-p.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],f=0,c=0;for(let p of o)for(let v=a.length-1;v>=0;v--){let w=a[v];if(!(p.w>w.w||p.h>w.h)){if(p.x=w.x,p.y=w.y,c=Math.max(c,p.y+p.h),f=Math.max(f,p.x+p.w),p.w===w.w&&p.h===w.h){let M=a.pop();v<a.length&&(a[v]=M)}else p.h===w.h?(w.x+=p.w,w.w-=p.w):p.w===w.w?(w.y+=p.h,w.h-=p.h):(a.push({x:w.x+p.w,y:w.y,w:w.w-p.w,h:p.h}),w.y+=p.h,w.h-=p.h);break}}return{w:f,h:c,fill:e/(f*c)||0}}_t(Ra,"Anchor");let Tp=1;class Ip{static getImagePositionScale(e,r,a){return r&&e&&e.options&&e.options.transform?{x:e.options.transform.a,y:e.options.transform.d}:{x:a,y:a}}constructor(e,{pixelRatio:r,version:a,stretchX:f,stretchY:c,content:p,sdf:v,usvg:w},M,_){this.paddedRect=e,this.pixelRatio=r,this.stretchX=f,this.stretchY=c,this.content=p,this.version=a,this.padding=M,this.sdf=v,this.scale=Ip.getImagePositionScale(_,w,r)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class JT{constructor(e,r,a){let f={},c={};this.haveRenderCallbacks=[];let p=[];this.addImages(e,f,Tp,p),this.addImages(r,c,2,p);let{w:v,h:w}=KT(p),M=new qr({width:v||1,height:w||1});for(let _ in e){let E=e[_],D=f[_].paddedRect;qr.copy(E.data,M,{x:0,y:0},{x:D.x+Tp,y:D.y+Tp},E.data,a,E.sdf)}for(let _ in r){let E=r[_],D=c[_].paddedRect,b=c[_].padding,T=D.x+b,C=D.y+b,O=E.data.width,L=E.data.height;b=b>1?b-1:b,qr.copy(E.data,M,{x:0,y:0},{x:T,y:C},E.data,a),qr.copy(E.data,M,{x:0,y:L-b},{x:T,y:C-b},{width:O,height:b},a),qr.copy(E.data,M,{x:0,y:0},{x:T,y:C+L},{width:O,height:b},a),qr.copy(E.data,M,{x:O-b,y:0},{x:T-b,y:C},{width:b,height:L},a),qr.copy(E.data,M,{x:0,y:0},{x:T+O,y:C},{width:b,height:L},a),qr.copy(E.data,M,{x:O-b,y:L-b},{x:T-b,y:C-b},{width:b,height:b},a),qr.copy(E.data,M,{x:0,y:L-b},{x:T+O,y:C-b},{width:b,height:b},a),qr.copy(E.data,M,{x:0,y:0},{x:T+O,y:C+L},{width:b,height:b},a),qr.copy(E.data,M,{x:O-b,y:0},{x:T-b,y:C+L},{width:b,height:b},a)}this.lut=a,this.image=M,this.iconPositions=f,this.patternPositions=c}addImages(e,r,a,f){for(let c in e){let p=e[c],v={x:0,y:0,w:p.data.width+2*a,h:p.data.height+2*a};f.push(v);let w=Oo.deserializeFromString(c);r[c]=new Ip(v,p,a,w),p.hasRenderCallback&&this.haveRenderCallbacks.push(w.id)}}patchUpdatedImages(e,r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>e.hasImage(f,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(let f in e.getUpdatedImages(a)){for(let c of Object.keys(this.iconPositions))Oo.deserializeId(c)===f&&this.patchUpdatedImage(this.iconPositions[c],e.getImage(f,a),r);for(let c of Object.keys(this.patternPositions))Oo.deserializeId(c)===f&&this.patchUpdatedImage(this.patternPositions[c],e.getImage(f,a),r)}}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;let[f,c]=e.tl,p=e.sdf;if(this.lut||p){let v={width:r.data.width,height:r.data.height},w=new qr(v);qr.copy(r.data,w,{x:0,y:0},{x:0,y:0},v,this.lut,p),a.update(w,{position:{x:f,y:c}})}else a.update(r.data,{position:{x:f,y:c}})}}_t(Ip,"ImagePosition"),_t(JT,"ImageAtlas");let Sp=1e20;function QT(o,e,r,a,f,c,p,v,w){for(let M=e;M<e+a;M++)eI(o,r*c+M,c,f,p,v,w);for(let M=r;M<r+f;M++)eI(o,M*c+e,1,a,p,v,w)}function eI(o,e,r,a,f,c,p){c[0]=0,p[0]=-Sp,p[1]=Sp,f[0]=o[e];for(let v=1,w=0,M=0;v<a;v++){f[v]=o[e+v*r];let _=v*v;do{let E=c[w];M=(f[v]-f[E]+_-E*E)/(v-E)/2}while(M<=p[w]&&--w>-1);w++,c[w]=v,p[w]=M,p[w+1]=Sp}for(let v=0,w=0;v<a;v++){for(;p[w+1]<v;)w++;let M=c[w],_=v-M;o[e+v*r]=f[M]+_*_}}let ms=2,ex={none:0,ideographs:1,all:2};class zh{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,a){let f=[],c=this.urls[r]||Dr.GLYPHS_URL;for(let p in e)for(let v of e[p])f.push({stack:p,id:v});Os(f,({stack:p,id:v},w)=>{let M=this.entries[p];M||(M=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=M.glyphs[v];if(_!==void 0)return void w(null,{stack:p,id:v,glyph:_});if(_=this._tinySDF(M,p,v),_)return M.glyphs[v]=_,void w(null,{stack:p,id:v,glyph:_});let E=Math.floor(v/256);if(256*E>65535)return qt("glyphs > 65535 not supported"),void w(null,{stack:p,id:v,glyph:_});if(M.ranges[E])return void w(null,{stack:p,id:v,glyph:_});let D=M.requests[E];D||(D=M.requests[E]=[],zh.loadGlyphRange(p,E,c,this.requestManager,(b,T)=>{if(T){M.ascender=T.ascender,M.descender=T.descender;for(let C in T.glyphs)this._doesCharSupportLocalGlyph(+C)||(M.glyphs[+C]=T.glyphs[+C]);M.ranges[E]=!0}for(let C of D)C(b,T);delete M.requests[E]})),D.push((b,T)=>{b?w(b):T&&w(null,{stack:p,id:v,glyph:T.glyphs[v]||null})})},(p,v)=>{if(p)a(p);else if(v){let w={};for(let{stack:M,id:_,glyph:E}of v)w[M]===void 0&&(w[M]={}),w[M].glyphs===void 0&&(w[M].glyphs={}),w[M].glyphs[_]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},w[M].ascender=this.entries[M].ascender,w[M].descender=this.entries[M].descender;a(null,w)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ex.none&&(this.localGlyphMode===ex.all?!!this.localFontFamily:!!this.localFontFamily&&(bt["CJK Unified Ideographs"](e)||bt["Hangul Syllables"](e)||bt.Hiragana(e)||bt.Katakana(e)||bt["CJK Symbols and Punctuation"](e)||bt["CJK Unified Ideographs Extension A"](e)||bt["CJK Unified Ideographs Extension B"](e)||bt.Osage(e)))}_tinySDF(e,r,a){let f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(a))return;let c=e.tinySDF;if(!c){let C="400";/bold/i.test(r)?C="900":/medium/i.test(r)?C="500":/light/i.test(r)&&(C="200"),c=e.tinySDF=new zh.TinySDF({fontFamily:f,fontWeight:C,fontSize:24*ms,buffer:3*ms,radius:8*ms}),c.fontWeight=C}if(this.localGlyphs[c.fontWeight][a])return this.localGlyphs[c.fontWeight][a];let p=String.fromCodePoint(a),{data:v,width:w,height:M,glyphWidth:_,glyphHeight:E,glyphLeft:D,glyphTop:b,glyphAdvance:T}=c.draw(p);return this.localGlyphs[c.fontWeight][a]={id:a,bitmap:new Vl({width:w,height:M},v),metrics:{width:_/ms,height:E/ms,left:D/ms,top:b/ms-27,advance:T/ms,localGlyph:!0}}}}zh.loadGlyphRange=function(o,e,r,a,f){let c=256*e,p=c+255,v=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",o).replace("{range}",`${c}-${p}`),_n.Glyphs);Ar(v,(w,M)=>{if(w)f(w);else if(M){let _={},E=function(D){return new n_(D).readFields(EP,{})}(M);for(let D of E.glyphs)_[D.id]=D;f(null,{glyphs:_,ascender:E.ascender,descender:E.descender})}})},zh.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:f="sans-serif",fontWeight:c="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;let v=this.size=o+4*e,w=this._createCanvas(v),M=this.ctx=w.getContext("2d",{willReadFrequently:!0});M.font=`${p} ${c} ${o}px ${f}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(o){let e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){let{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:f,actualBoundingBoxRight:c}=this.ctx.measureText(o),p=Math.ceil(r),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-f))),w=Math.min(this.size-this.buffer,p+Math.ceil(a)),M=v+2*this.buffer,_=w+2*this.buffer,E=Math.max(M*_,0),D=new Uint8ClampedArray(E),b={data:D,width:M,height:_,glyphWidth:v,glyphHeight:w,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(v===0||w===0)return b;let{ctx:T,buffer:C,gridInner:O,gridOuter:L}=this;T.clearRect(C,C,v,w),T.fillText(o,C,C+p);let B=T.getImageData(C,C,v,w);L.fill(Sp,0,E),O.fill(0,0,E);for(let j=0;j<w;j++)for(let z=0;z<v;z++){let U=B.data[4*(j*v+z)+3]/255;if(U===0)continue;let q=(j+C)*M+z+C;if(U===1)L[q]=0,O[q]=Sp;else{let K=.5-U;L[q]=K>0?K*K:0,O[q]=K<0?K*K:0}}QT(L,0,0,M,_,M,this.f,this.v,this.z),QT(O,C,C,v,w,M,this.f,this.v,this.z);for(let j=0;j<E;j++){let z=Math.sqrt(L[j])-Math.sqrt(O[j]);D[j]=Math.round(255-255*(z/this.radius+this.cutoff))}return b}};let Ul=Tp;function tI(o,e){return o+e[1]-e[0]}function nI(o,e,r,a,f=1){let c=[],p=o.imagePrimary,v=p.pixelRatio,w=p.paddedRect.w-2*Ul,M=p.paddedRect.h-2*Ul,_=(o.right-o.left)*f,E=(o.bottom-o.top)*f,D=p.stretchX||[[0,w]],b=p.stretchY||[[0,M]],T=D.reduce(tI,0),C=b.reduce(tI,0),O=w-T,L=M-C,B=0,j=T,z=0,U=C,q=0,K=O,re=0,ne=L;if(p.content&&a){let pe=p.content;B=i_(D,0,pe[0]),z=i_(b,0,pe[1]),j=i_(D,pe[0],pe[2]),U=i_(b,pe[1],pe[3]),q=pe[0]-B,re=pe[1]-z,K=pe[2]-pe[0]-j,ne=pe[3]-pe[1]-U}let te=(pe,ie,me,ye)=>{let _e=o_(pe.stretch-B,j,_,o.left*f),be=s_(pe.fixed-q,K,pe.stretch,T),Se=o_(ie.stretch-z,U,E,o.top*f),Ae=s_(ie.fixed-re,ne,ie.stretch,C),Ie=o_(me.stretch-B,j,_,o.left*f),$e=s_(me.fixed-q,K,me.stretch,T),Ke=o_(ye.stretch-z,U,E,o.top*f),Ue=s_(ye.fixed-re,ne,ye.stretch,C),ut=new at(_e,Se),lt=new at(Ie,Se),tt=new at(Ie,Ke),Je=new at(_e,Ke),xt=new at(be/v,Ae/v),ht=new at($e/v,Ue/v),mt=e*Math.PI/180;if(mt){let rn=Math.sin(mt),$n=Math.cos(mt),On=[$n,-rn,rn,$n];ut._matMult(On),lt._matMult(On),Je._matMult(On),tt._matMult(On)}let Lt=pe.stretch+pe.fixed,Ht=me.stretch+me.fixed,Wt=ie.stretch+ie.fixed,Zt=ye.stretch+ye.fixed,en=o.imageSecondary;return{tl:ut,tr:lt,bl:Je,br:tt,texPrimary:{x:p.paddedRect.x+Ul+Lt,y:p.paddedRect.y+Ul+Wt,w:Ht-Lt,h:Zt-Wt},texSecondary:en?{x:en.paddedRect.x+Ul+Lt,y:en.paddedRect.y+Ul+Wt,w:Ht-Lt,h:Zt-Wt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xt,pixelOffsetBR:ht,minFontScaleX:K/v/_,minFontScaleY:ne/v/E,isSDF:r}};if(a&&(p.stretchX||p.stretchY)){let pe=rI(D,O,T),ie=rI(b,L,C);for(let me=0;me<pe.length-1;me++){let ye=pe[me],_e=pe[me+1];for(let be=0;be<ie.length-1;be++)c.push(te(ye,ie[be],_e,ie[be+1]))}}else c.push(te({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:M+1}));return c}function i_(o,e,r){let a=0;for(let f of o)a+=Math.max(e,Math.min(r,f[1]))-Math.max(e,Math.min(r,f[0]));return a}function rI(o,e,r){let a=[{fixed:-Ul,stretch:0}];for(let[f,c]of o){let p=a[a.length-1];a.push({fixed:f-p.stretch,stretch:p.stretch}),a.push({fixed:f-p.stretch,stretch:p.stretch+(c-f)})}return a.push({fixed:e+Ul,stretch:r}),a}function o_(o,e,r,a){return o/e*r+a}function s_(o,e,r,a){return o-e*r/a}function RP(o,e,r,a){let f=e+o.positionedLines[a].lineOffset;return a===0?r+f/2:r+(f+(e+o.positionedLines[a-1].lineOffset))/2}function PP(o,e=1,r=!1){let a=1/0,f=1/0,c=-1/0,p=-1/0,v=o[0];for(let b=0;b<v.length;b++){let T=v[b];(!b||T.x<a)&&(a=T.x),(!b||T.y<f)&&(f=T.y),(!b||T.x>c)&&(c=T.x),(!b||T.y>p)&&(p=T.y)}let w=Math.min(c-a,p-f),M=w/2,_=new Gr([],OP);if(w===0)return new at(a,f);for(let b=a;b<c;b+=w)for(let T=f;T<p;T+=w)_.push(new Bh(b+M,T+M,M,o));let E=function(b){let T=0,C=0,O=0,L=b[0];for(let B=0,j=L.length,z=j-1;B<j;z=B++){let U=L[B],q=L[z],K=U.x*q.y-q.x*U.y;C+=(U.x+q.x)*K,O+=(U.y+q.y)*K,T+=3*K}return new Bh(C/T,O/T,0,b)}(o),D=_.length;for(;_.length;){let b=_.pop();(b.d>E.d||!E.d)&&(E=b,r&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,D)),b.max-E.d<=e||(M=b.h/2,_.push(new Bh(b.p.x-M,b.p.y-M,M,o)),_.push(new Bh(b.p.x+M,b.p.y-M,M,o)),_.push(new Bh(b.p.x-M,b.p.y+M,M,o)),_.push(new Bh(b.p.x+M,b.p.y+M,M,o)),D+=4)}return r&&(console.log(`num probes: ${D}`),console.log(`best distance: ${E.d}`)),E.p}function OP(o,e){return e.max-o.max}class Bh{constructor(e,r,a,f){this.p=new at(e,r),this.h=a,this.d=function(c,p){let v=!1,w=1/0;for(let M=0;M<p.length;M++){let _=p[M];for(let E=0,D=_.length,b=D-1;E<D;b=E++){let T=_[E],C=_[b];T.y>c.y!=C.y>c.y&&c.x<(C.x-T.x)*(c.y-T.y)/(C.y-T.y)+T.x&&(v=!v),w=Math.min(w,ce(c,T,C))}}return(v?1:-1)*Math.sqrt(w)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}let tx=Number.POSITIVE_INFINITY,LP=Math.sqrt(2);function iI(o,[e,r]){let a=0,f=0;if(r===tx){e<0&&(e=0);let c=e/LP;switch(o){case"top-right":case"top-left":f=c-7;break;case"bottom-right":case"bottom-left":f=7-c;break;case"bottom":f=7-e;break;case"top":f=e-7}switch(o){case"top-right":case"bottom-right":a=-c;break;case"top-left":case"bottom-left":a=c;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),o){case"top-right":case"top-left":case"top":f=r-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-r}switch(o){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,f]}function nx(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kP(o,e,r,a,f,c,p,v,w,M,_,E,D,b,T){let C=c.textMaxSize.evaluate(e,{},E);C===void 0?C=p*c.textScaleFactor:C*=c.textScaleFactor;let O=o.layers[0].layout,L=O.get("icon-offset").evaluate(e,{},E),B=sI(r.horizontal)||r.vertical,j=D.name==="globe",z=Qr,U=p*c.textScaleFactor/z,q=o.tilePixelRatio*C/z,K=(_e=o.overscaling,o.zoom>18&&_e>2&&(_e>>=1),Math.max(ct/(512*_e),1)*O.get("symbol-spacing")),re=O.get("text-padding")*o.tilePixelRatio,ne=O.get("icon-padding")*o.tilePixelRatio,te=ln(O.get("text-max-angle")),pe=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",ie=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",me=O.get("symbol-placement"),ye=K/2;var _e;let be=O.get("icon-text-fit").evaluate(e,{},E),Se=O.get("icon-text-fit-padding").evaluate(e,{},E),Ae=be!=="none",Ie;o.hasAnyIconTextFit===!1&&Ae&&(o.hasAnyIconTextFit=!0),a&&Ae&&(o.allowVerticalPlacement&&r.vertical&&(Ie=HT(a,r.vertical,be,Se,L,U)),B&&(a=HT(a,B,be,Se,L,U)));let $e=(Ke,Ue,ut)=>{if(Ue.x<0||Ue.x>=ct||Ue.y<0||Ue.y>=ct)return;let lt=null;if(j){let{x:tt,y:Je,z:xt}=D.projectTilePoint(Ue.x,Ue.y,ut);lt={anchor:new Ra(tt,Je,xt,0,void 0),up:D.upVector(ut,Ue.x,Ue.y)}}(function(tt,Je,xt,ht,mt,Lt,Ht,Wt,Zt,en,rn,$n,On,zt,In,Rn,Yn,gr,Sr,_r,ar,br,Cr,ei,Zn,Hi,vs){let Uo=tt.addToLineVertexArray(Je,ht),$o,iu,Wl,ou,Gp,VS,jS,US=0,$S=0,HS=0,GS=0,Nx=-1,zx=-1,Xs={},qS=co(""),su=xt?xt.anchor:Je,Bx=Zt.layout.get("icon-text-fit").evaluate(ar,{},Zn)!=="none",Vx=0,jx=0;if(Zt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Vx,jx]=Zt.layout.get("text-offset").evaluate(ar,{},Zn).map(_o=>_o*Qr):(Vx=Zt.layout.get("text-radial-offset").evaluate(ar,{},Zn)*Qr,jx=tx),tt.allowVerticalPlacement&&mt.vertical){let _o=mt.vertical;if(In)VS=rx(_o),Wt&&(jS=rx(Wt));else{let Gi=Zt.layout.get("text-rotate").evaluate(ar,{},Zn)+90;Wl=a_(en,su,Je,rn,$n,On,_o,zt,Gi,Rn),Wt&&(ou=a_(en,su,Je,rn,$n,On,Wt,gr,Gi))}}if(Lt){let _o=tt.iconSizeData,Gi=Zt.layout.get("icon-rotate").evaluate(ar,{},Zn),qp=nI(Lt,Gi,Cr,Bx,br.iconScaleFactor),$x=Wt?nI(Wt,Gi,Cr,Bx,br.iconScaleFactor):void 0;iu=a_(en,su,Je,rn,$n,On,Lt,gr,Gi,null),US=4*qp.length;let au=null;_o.kind==="source"?(au=[ps*Zt.layout.get("icon-size").evaluate(ar,{},Zn)*br.iconScaleFactor],au[0]>$l&&qt(`${tt.layerIds[0]}: Value for "icon-size" is >= ${Dp}. Reduce your "icon-size".`)):_o.kind==="composite"&&(au=[ps*br.compositeIconSizes[0].evaluate(ar,{},Zn)*br.iconScaleFactor,ps*br.compositeIconSizes[1].evaluate(ar,{},Zn)*br.iconScaleFactor],(au[0]>$l||au[1]>$l)&&qt(`${tt.layerIds[0]}: Value for "icon-size" is >= ${Dp}. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,qp,au,_r,Sr,ar,!1,xt,Je,Uo.lineStartIndex,Uo.lineLength,-1,ei,Zn,Hi,vs),Nx=tt.icon.placedSymbolArray.length-1,$x&&($S=4*$x.length,tt.addSymbols(tt.icon,$x,au,_r,Sr,ar,mo.vertical,xt,Je,Uo.lineStartIndex,Uo.lineLength,-1,ei,Zn,Hi,vs),zx=tt.icon.placedSymbolArray.length-1)}for(let _o in mt.horizontal){let Gi=mt.horizontal[_o];$o||(qS=co(Gi.text),In?Gp=rx(Gi):$o=a_(en,su,Je,rn,$n,On,Gi,zt,Zt.layout.get("text-rotate").evaluate(ar,{},Zn),Rn));let qp=Gi.positionedLines.length===1;if(HS+=oI(tt,xt,Je,Gi,Ht,Zt,In,ar,Rn,Uo,mt.vertical?mo.horizontal:mo.horizontalOnly,qp?Object.keys(mt.horizontal):[_o],Xs,Nx,br,ei,Zn,Hi),qp)break}mt.vertical&&(GS+=oI(tt,xt,Je,mt.vertical,Ht,Zt,In,ar,Rn,Uo,mo.vertical,["vertical"],Xs,zx,br,ei,Zn,Hi));let Zl=-1,Ux=(_o,Gi)=>_o?Math.max(_o,Gi):Gi;Zl=Ux(Gp,Zl),Zl=Ux(VS,Zl),Zl=Ux(jS,Zl);let pL=Zl>-1?1:0;tt.glyphOffsetArray.length>=65535&&qt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ar.sortKey!==void 0&&tt.addToSortKeyRanges(tt.symbolInstances.length,ar.sortKey),tt.symbolInstances.emplaceBack(Je.x,Je.y,su.x,su.y,su.z,Xs.right>=0?Xs.right:-1,Xs.center>=0?Xs.center:-1,Xs.left>=0?Xs.left:-1,Xs.vertical>=0?Xs.vertical:-1,Nx,zx,qS,$o!==void 0?$o:tt.collisionBoxArray.length,$o!==void 0?$o+1:tt.collisionBoxArray.length,Wl!==void 0?Wl:tt.collisionBoxArray.length,Wl!==void 0?Wl+1:tt.collisionBoxArray.length,iu!==void 0?iu:tt.collisionBoxArray.length,iu!==void 0?iu+1:tt.collisionBoxArray.length,ou||tt.collisionBoxArray.length,ou?ou+1:tt.collisionBoxArray.length,rn,HS,GS,US,$S,pL,0,Vx,jx,Zl,0,Bx?1:0)})(o,Ue,lt,Ke,r,a,f,Ie,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,re,pe,w,0,ne,ie,L,e,c,M,_,E,b,T)};if(me==="line")for(let Ke of YT(e.geometry,0,0,ct,ct)){let Ue=AP(Ke,K,te,r.vertical||B,a,z,q,o.overscaling,ct);for(let ut of Ue)B&&FP(o,B.text,ye,ut)||$e(Ke,ut,E)}else if(me==="line-center"){for(let Ke of e.geometry)if(Ke.length>1){let Ue=CP(Ke,te,r.vertical||B,a,z,q);Ue&&$e(Ke,Ue,E)}}else if(e.type==="Polygon")for(let Ke of Zg(e.geometry,0)){let Ue=PP(Ke,16);$e(Ke[0],new Ra(Ue.x,Ue.y,0,0,void 0),E)}else if(e.type==="LineString")for(let Ke of e.geometry)$e(Ke,new Ra(Ke[0].x,Ke[0].y,0,0,void 0),E);else if(e.type==="Point")for(let Ke of e.geometry)for(let Ue of Ke)$e([Ue],new Ra(Ue.x,Ue.y,0,0,void 0),E)}let Dp=255,$l=Dp*ps;function oI(o,e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O,L){let B=function(U,q,K,re,ne,te,pe,ie){let me=[];if(q.positionedLines.length===0)return me;let ye=re.layout.get("text-rotate").evaluate(te,{})*Math.PI/180,_e=function($e){let Ke=$e[0],Ue=$e[1],ut=Ke*Ue;return ut>0?[Ke,-Ue]:ut<0?[-Ke,Ue]:Ke===0?[Ue,Ke]:[Ue,-Ke]}(K),be=Math.abs(q.top-q.bottom);for(let $e of q.positionedLines)be-=$e.lineOffset;let Se=q.positionedLines.length,Ae=be/Se,Ie=q.top-K[1];for(let $e=0;$e<Se;++$e){let Ke=q.positionedLines[$e];Ie=RP(q,Ae,Ie,$e);for(let Ue of Ke.positionedGlyphs){if(!Ue.rect)continue;let ut=Ue.rect||{},lt=zT+1,tt=!0,Je=1,xt=0;if(Ue.imageName){let _r=pe[Hr.build(Ue.imageName).getSerializedPrimary()];if(!_r)continue;if(_r.sdf){qt("SDF images are not supported in formatted text and will be ignored.");continue}tt=!1,Je=_r.pixelRatio,lt=Tp/Je}let ht=(ne||ie)&&Ue.vertical,mt=Ue.metrics.advance*Ue.scale/2,Lt=Ue.metrics,Ht=Ue.rect;if(Ht===null)continue;ie&&q.verticalizable&&(xt=Ue.imageName?mt-Ue.metrics.width*Ue.scale/2:0);let Wt=ne?[Ue.x+mt,Ue.y]:[0,0],Zt=[0,0],en=[0,0],rn=!1;ne||(ht?(en=[Ue.x+mt+_e[0],Ue.y+_e[1]-xt],rn=!0):Zt=[Ue.x+mt+K[0],Ue.y+K[1]-xt]);let $n=Ht.w*Ue.scale/(Je*(Ue.localGlyph?ms:1)),On=Ht.h*Ue.scale/(Je*(Ue.localGlyph?ms:1)),zt,In,Rn,Yn;if(ht){let _r=Ue.y-Ie,ar=new at(-mt,mt-_r),br=-Math.PI/2,Cr=new at(...en);zt=new at(-mt+Zt[0],Zt[1]),zt._rotateAround(br,ar)._add(Cr),zt.x+=-_r+mt,zt.y-=(Lt.left-lt)*Ue.scale;let ei=Ue.imageName?Lt.advance*Ue.scale:Qr*Ue.scale,Zn=String.fromCodePoint(Ue.glyph);xP(Zn)?zt.x+=(1-lt)*Ue.scale:bP(Zn)?zt.x+=ei-Lt.height*Ue.scale+(-lt-1)*Ue.scale:zt.x+=Ue.imageName||Lt.width+2*lt===Ht.w&&Lt.height+2*lt===Ht.h?(ei-On)/2:(ei-(Lt.height+2*lt)*Ue.scale)/2,In=new at(zt.x,zt.y-$n),Rn=new at(zt.x+On,zt.y),Yn=new at(zt.x+On,zt.y-$n)}else{let _r=(Lt.left-lt)*Ue.scale-mt+Zt[0],ar=(-Lt.top-lt)*Ue.scale+Zt[1],br=_r+$n,Cr=ar+On;zt=new at(_r,ar),In=new at(br,ar),Rn=new at(_r,Cr),Yn=new at(br,Cr)}if(ye){let _r;_r=ne?new at(0,0):rn?new at(_e[0],_e[1]):new at(K[0],K[1]),zt._rotateAround(ye,_r),In._rotateAround(ye,_r),Rn._rotateAround(ye,_r),Yn._rotateAround(ye,_r)}let gr=new at(0,0),Sr=new at(0,0);me.push({tl:zt,tr:In,bl:Rn,br:Yn,texPrimary:ut,texSecondary:void 0,writingMode:q.writingMode,glyphOffset:Wt,sectionIndex:Ue.sectionIndex,isSDF:tt,pixelOffsetTL:gr,pixelOffsetBR:Sr,minFontScaleX:0,minFontScaleY:0})}}return me}(0,a,w,c,p,v,f,o.allowVerticalPlacement),j=o.textSizeData,z=null;j.kind==="source"?(z=[ps*c.layout.get("text-size").evaluate(v,{},O)*T.textScaleFactor],z[0]>$l&&qt(`${o.layerIds[0]}: Value for "text-size" is >= ${Dp}. Reduce your "text-size".`)):j.kind==="composite"&&(z=[ps*T.compositeTextSizes[0].evaluate(v,{},O)*T.textScaleFactor,ps*T.compositeTextSizes[1].evaluate(v,{},O)*T.textScaleFactor],(z[0]>$l||z[1]>$l)&&qt(`${o.layerIds[0]}: Value for "text-size" is >= ${Dp}. Reduce your "text-size".`)),o.addSymbols(o.text,B,z,w,p,v,_,e,r,M.lineStartIndex,M.lineLength,b,C,O,L,!1);for(let U of E)D[U]=o.text.placedSymbolArray.length-1;return 4*B.length}function sI(o){for(let e in o)return o[e];return null}function a_(o,e,r,a,f,c,p,v,w,M){let _=p.top,E=p.bottom,D=p.left,b=p.right,T=p.collisionPadding;if(T&&(D-=T[0],_-=T[1],b+=T[2],E+=T[3]),w){let C=new at(D,_),O=new at(b,_),L=new at(D,E),B=new at(b,E),j=ln(w),z=new at(0,0);M&&(z=new at(M[0],M[1])),C._rotateAround(j,z),O._rotateAround(j,z),L._rotateAround(j,z),B._rotateAround(j,z),D=Math.min(C.x,O.x,L.x,B.x),b=Math.max(C.x,O.x,L.x,B.x),_=Math.min(C.y,O.y,L.y,B.y),E=Math.max(C.y,O.y,L.y,B.y)}return o.emplaceBack(e.x,e.y,e.z,r.x,r.y,D,_,b,E,v,a,f,c),o.length-1}function rx(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);let e=o.bottom-o.top;return e>0?Math.max(10,e):null}function FP(o,e,r,a){let f=o.compareText;if(e in f){let c=f[e];for(let p=c.length-1;p>=0;p--)if(a.dist(c[p])<r)return!0}else f[e]=[];return f[e].push(a),!1}function aI(o,e){let r=o.fovAboveCenter,a=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,f=(o._camera.position[2]*o.worldSize-a)/Math.cos(o._pitch),c=Math.sin(r)*f/Math.sin(Math.max(Math.PI/2-o._pitch-r,.01)),p=Math.sin(o._pitch)*c+f,v=f*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let w=Math.max(o.zoom-17,0);o.isOrthographic&&(w/=10),p*=1+w}return Math.min(1.01*p,v)}function Mp(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};let r=Math.pow(2,-o.z),a=o.x*r,f=(o.x+1)*r,c=o.y*r,p=(o.y+1)*r,v=Pi(a),w=Pi(f),M=jr(c),_=jr(p),E=e.project(v,M),D=e.project(w,M),b=e.project(w,_),T=e.project(v,_),C=Math.min(E.x,D.x,b.x,T.x),O=Math.min(E.y,D.y,b.y,T.y),L=Math.max(E.x,D.x,b.x,T.x),B=Math.max(E.y,D.y,b.y,T.y),j=r/16;function z(q,K,re,ne,te,pe){let ie=(re+te)/2,me=(ne+pe)/2,ye=e.project(Pi(ie),jr(me)),_e=Math.max(0,C-ye.x,O-ye.y,ye.x-L,ye.y-B);C=Math.min(C,ye.x),L=Math.max(L,ye.x),O=Math.min(O,ye.y),B=Math.max(B,ye.y),_e>j&&(z(q,ye,re,ne,ie,me),z(ye,K,ie,me,te,pe))}z(E,D,a,c,f,c),z(D,b,f,c,f,p),z(b,T,f,p,a,p),z(T,E,a,p,a,c),C-=j,O-=j,L+=j,B+=j;let U=1/Math.max(L-C,B-O);return{scale:U,x:C*U,y:O*U,x2:L*U,y2:B*U,projection:e}}function lI(o,{x:e,y:r},a=0){return new at(((e-a)*o.scale-o.x)*ct,(r*o.scale-o.y)*ct)}let NP=Ee.mat4.identity(new Float32Array(16));class Hl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new mn(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a=!0){return e._coordinatePoint(e.locationCoordinate(r),a)}pixelsPerMeter(e,r){return hi(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return aI(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,f){let c=e.horizonLineFromTop(!1),p=new at(r,Math.max(c,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,f))}pointCoordinate3D(e,r,a){let f=new at(r,a);if(e.elevation)return e.elevation.pointCoordinate(f);{let c=this.pointCoordinate(e,f.x,f.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);let a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return NP}createTileMatrix(e,r,a){let f,c,p,v=a.canonical,w=Ee.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let M=Mp(v,this);f=1,c=M.x+a.wrap*M.scale,p=M.y,Ee.mat4.scale(w,w,[f/M.scale,f/M.scale,e.pixelsPerMeter/r])}else f=r/e.zoomScale(v.z),c=(v.x+Math.pow(2,v.z)*a.wrap)*f,p=v.y*f;return Ee.mat4.translate(w,w,[c,p,0]),Ee.mat4.scale(w,w,[f/ct,f/ct,1]),w}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class zP extends Hl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[r,a]=this.parallels=e.parallels||[29.5,45.5],f=Math.sin(ln(r));this.n=(f+Math.sin(ln(a)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(e,r){let{n:a,c:f,r0:c}=this,p=ln(e-this.center[0]),v=ln(r),w=Math.sqrt(f-2*a*Math.sin(v))/a;return{x:w*Math.sin(p*a),y:w*Math.cos(p*a)-c,z:0}}unproject(e,r){let{n:a,c:f,r0:c}=this,p=c+r,v=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(v-=Math.PI*Math.sign(e)*Math.sign(p));let w=ln(this.center[0])*a;v=ao(v,-Math.PI-w,Math.PI-w);let M=Yt(Fr(v/a)+this.center[0],-180,180),_=Math.asin(Yt((f-(e*e+p*p)*a*a)/(2*a),-1,1)),E=Yt(Fr(_),-hr,hr);return new mn(M,E)}}let Cp=1.340264,Ap=-.081106,Rp=893e-6,Pp=.003796,l_=Math.sqrt(3)/2;class BP extends Hl{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(l_*Math.sin(r)),f=a*a,c=f*f*f;return{x:.5*(e*Math.cos(a)/(l_*(Cp+3*Ap*f+c*(7*Rp+9*Pp*f)))/Math.PI+.5),y:1-.5*(a*(Cp+Ap*f+c*(Rp+Pp*f))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,f=a*a,c=f*f*f;for(let _,E,D,b=0;b<12&&(E=a*(Cp+Ap*f+c*(Rp+Pp*f))-r,D=Cp+3*Ap*f+c*(7*Rp+9*Pp*f),_=E/D,a=Yt(a-_,-Math.PI/3,Math.PI/3),f=a*a,c=f*f*f,!(Math.abs(_)<1e-12));++b);let p=l_*e*(Cp+3*Ap*f+c*(7*Rp+9*Pp*f))/Math.cos(a),v=Math.asin(Math.sin(a)/l_),w=Yt(180*p/Math.PI,-180,180),M=Yt(180*v/Math.PI,-hr,hr);return new mn(w,M)}}class VP extends Hl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){let a=360*(e-.5),f=Yt(360*(.5-r),-hr,hr);return new mn(a,f)}}let Vh=Math.PI/2;function c_(o){return Math.tan((Vh+o)/2)}class jP extends Hl{constructor(e){super(e),this.center=e.center||[0,30];let[r,a]=this.parallels=e.parallels||[30,30],f=ln(r),c=ln(a);this.southernCenter=f+c<0,this.southernCenter&&(f=-f,c=-c);let p=Math.cos(f),v=c_(f);this.n=f===c?Math.sin(f):Math.log(p/Math.cos(c))/Math.log(c_(c)/v),this.f=p*Math.pow(c_(f),this.n)/this.n}project(e,r){r=ln(r),this.southernCenter&&(r=-r),e=ln(e-this.center[0]);let a=1e-6,{n:f,f:c}=this;c>0?r<-Vh+a&&(r=-Vh+a):r>Vh-a&&(r=Vh-a);let p=c/Math.pow(c_(r),f),v=p*Math.sin(f*e),w=c-p*Math.cos(f*e);return v=.5*(v/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:v,y:this.southernCenter?w:1-w,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;let{n:a,f}=this,c=f-r,p=Math.sign(c),v=Math.sign(a)*Math.sqrt(e*e+c*c),w=Math.atan2(e,Math.abs(c))*p;c*a<0&&(w-=Math.PI*Math.sign(e)*p);let M=Yt(Fr(w/a)+this.center[0],-180,180),_=Yt(Fr(2*Math.atan(Math.pow(f/v,1/a))-Vh),-hr,hr);return new mn(M,this.southernCenter?-_:_)}}class cI extends Hl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:zo(e),y:po(r),z:0}}unproject(e,r){let a=Pi(e),f=jr(r);return new mn(a,f)}}let uI=ln(hr);class UP extends Hl{project(e,r){let a=(r=ln(r))*r,f=a*a;return{x:.5*((e=ln(e))*(.8707-.131979*a+f*(f*(.003971*a-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+f*(.028874*a-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,f=25,c=0,p=a*a;do{p=a*a;let M=p*p;c=(a*(1.007226+p*(.015085+M*(.028874*p-.044475-.005916*M)))-r)/(1.007226+p*(.045255+M*(.259866*p-.311325-.005916*11*M))),a=Yt(a-c,-uI,uI)}while(Math.abs(c)>1e-6&&--f>0);p=a*a;let v=Yt(Fr(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),w=Fr(a);return new mn(v,w)}}let hI=ln(hr);class $P extends Hl{project(e,r){r=ln(r),e=ln(e);let a=Math.cos(r),f=2/Math.PI,c=Math.acos(a*Math.cos(e/2)),p=Math.sin(c)/c,v=.5*(e*f+2*a*Math.sin(e/2)/p)||0,w=.5*(r+Math.sin(r)/p)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,f=r=(2*(1-r)-1)*Math.PI,c=25,p=1e-6,v=0,w=0;do{let M=Math.cos(f),_=Math.sin(f),E=2*_*M,D=_*_,b=M*M,T=Math.cos(a/2),C=Math.sin(a/2),O=2*T*C,L=C*C,B=1-b*T*T,j=B?1/B:0,z=B?Math.acos(M*T)*Math.sqrt(1/B):0,U=.5*(2*z*M*C+2*a/Math.PI)-e,q=.5*(z*_+f)-r,K=.5*j*(b*L+z*M*T*D)+1/Math.PI,re=j*(O*E/4-z*_*C),ne=.125*j*(E*C-z*_*b*O),te=.5*j*(D*T+z*L*M)+.5,pe=re*ne-te*K;v=(q*re-U*te)/pe,w=(U*ne-q*K)/pe,a=Yt(a-v,-Math.PI,Math.PI),f=Yt(f-w,-hI,hI)}while((Math.abs(v)>p||Math.abs(w)>p)&&--c>0);return new mn(Fr(a),Fr(f))}}class dI extends Hl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ln(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){let{scale:a,cosPhi:f}=this;return{x:ln(e)*f*a+.5,y:-Math.sin(ln(r))/f*a+.5,z:0}}unproject(e,r){let{scale:a,cosPhi:f}=this,c=-(r-.5)/a,p=Yt(Fr((e-.5)/a)/f,-180,180),v=Math.asin(Yt(c*f,-1,1)),w=Yt(Fr(v),-hr,hr);return new mn(p,w)}}class HP extends cI{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){let f=zn(e,r,a),c=Pr(Er(a));return Ee.vec3.transformMat4(f,f,c),{x:f[0],y:f[1],z:f[2]}}locationPoint(e,r){let a=Da(r.lat,r.lng),f=Ee.vec3.normalize([],a),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,p=hi(1,0)*ct*c;Ee.vec3.scaleAndAdd(a,a,f,p);let v=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.multiply(v,e.pixelMatrix,e.globeMatrix),Ee.vec3.transformMat4(a,a,v),new at(a[0],a[1])}pixelsPerMeter(e,r){return hi(1,0)*r}pixelSpaceConversion(e,r,a){let f=hi(1,e)*r,c=At(hi(1,45)*r,f,a);return this.pixelsPerMeter(e,r)/c}createTileMatrix(e,r,a){let f=Vn(Er(a.canonical));return Ee.mat4.multiply(new Float64Array(16),e.globeMatrix,f)}createInversionMatrix(e,r){let{center:a}=e,f=Pr(Er(r));return Ee.mat4.rotateY(f,f,ln(a.lng)),Ee.mat4.rotateX(f,f,ln(a.lat)),Ee.mat4.scale(f,f,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(e,r,a,f){return bn(e,r,a,!0)||new i(0,0)}pointCoordinate3D(e,r,a){let f=this.pointCoordinate(e,r,a,0);return[f.x,f.y,f.z]}isPointAboveHorizon(e,r){return!bn(e,r.x,r.y,!1)}farthestPixelDistance(e){let r=function(f,c){let p=f.cameraToCenterDistance,v=f._centerAltitude*c,w=f._camera,M=f._camera.forward(),_=Ee.vec3.add([],Ee.vec3.scale([],M,-p),[0,0,v]),E=f.worldSize/(2*Math.PI),D=[0,0,-E],b=f.width/f.height,T=Math.tan(f.fovAboveCenter),C=Ee.vec3.scale([],w.up(),T),O=Ee.vec3.scale([],w.right(),T*b),L=Ee.vec3.normalize([],Ee.vec3.add([],Ee.vec3.add([],M,C),O)),B=[],j;if(new Nt(_,L).closestPointOnSphere(D,E,B)){let z=Ee.vec3.add([],B,D),U=Ee.vec3.sub([],z,_);j=Math.cos(f.fovAboveCenter)*Ee.vec3.length(U)}else{let z=Ee.vec3.sub([],_,D),U=Ee.vec3.sub([],D,_);Ee.vec3.normalize(U,U);let q=Ee.vec3.length(z)-E;j=Math.sqrt(q*(q+2*E));let K=Math.acos(j/(E+q))-Math.acos(Ee.vec3.dot(M,U));j*=Math.cos(K)}return 1.01*j}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=wi(e.zoom);if(a>0){let f=aI(e,hi(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return At(r,f+c*(1-Math.cos(p)),Math.pow(a,10))}return r}upVector(e,r,a){return zn(r,a,e,1)}upVectorScale(e){return{metersToTile:on(un(Er(e)))}}}function fI(o){let e=o.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new cI(o);case"equirectangular":return new VP(o);case"naturalEarth":return new UP(o);case"equalEarth":return new BP(o);case"winkelTripel":return new $P(o);case"albers":return r?new dI(o):new zP(o);case"lambertConformalConic":return r?new dI(o):new jP(o);case"globe":return new HP(o)}throw new Error(`Invalid projection name: ${o.name}`)}let GP=kh.VectorTileFeature.types,qP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function u_(o,e,r,a,f,c,p,v,w,M,_,E,D){let b=v?Math.min($l,Math.round(v[0])):0,T=v?Math.min($l,Math.round(v[1])):0;o.emplaceBack(e,r,Math.round(32*a),Math.round(32*f),c,p,(b<<1)+(w?1:0),T,16*M,16*_,256*E,256*D)}function h_(o,e,r){o.emplaceBack(e,r)}function d_(o,e,r,a,f,c,p){o.emplaceBack(e,r,a,f,c,p)}function f_(o,e,r,a,f){o.emplaceBack(e,r,a,f),o.emplaceBack(e,r,a,f),o.emplaceBack(e,r,a,f),o.emplaceBack(e,r,a,f)}function WP(o){for(let e of o.sections)if(Bf(e.text))return!0;return!1}class ix{constructor(e){this.layoutVertexArray=new Wf,this.indexArray=new Vr,this.programConfigurations=e,this.segments=new ur,this.dynamicLayoutVertexArray=new Ea,this.opacityVertexArray=new Xf,this.placedSymbolArray=new Pg,this.iconTransitioningVertexArray=new $s,this.globeExtVertexArray=new Zf,this.zOffsetVertexArray=new jc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,a,f,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,dP.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,qP,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,pP.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,hP.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,fP.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}_t(ix,"SymbolBuffers");class ox{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new ur,this.collisionVertexArray=new Jf,this.collisionVertexArrayExt=new Ea}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,mP.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,gP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}_t(ox,"CollisionBuffers");class p_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ee.mat4.identity([]),this.placementViewportMatrix=Ee.mat4.identity([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Z0(this.zoom,r["text-size"]),this.iconSizeData=Z0(this.zoom,r["icon-size"]);let a=this.layers[0].layout,f=a.get("symbol-sort-key"),c=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>mo[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new ix(new qs(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new ix(new qs(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new kg,this.lineVertexArray=new Fg,this.symbolInstances=new Lg}calculateGlyphDependencies(e,r,a,f,c){for(let p of e){let v=p.codePointAt(0);if(v===void 0)break;if(r[v]=!0,f&&c&&v<=65535){let w=wp[p];w&&(r[w.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;let a=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!V0(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,r,a,f){let c=this.layers[0],p=c.layout,v=this.projection.name==="globe",w=p.get("text-font"),M=p.get("text-field"),_=p.get("icon-image"),[E,D]=p.get("icon-size-scale-range"),b=Yt(r.scaleFactor||1,E,D),T=(M.value.kind!=="constant"||M.value.value instanceof Xr&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),C=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,O=p.get("symbol-sort-key");if(this.features=[],!T&&!C)return;let L=r.iconDependencies,B=r.glyphDependencies,j=r.availableImages,z=new Gn(this.zoom);for(let{feature:U,id:q,index:K,sourceLayerIndex:re}of e){let ne=c._featureFilter.needGeometry,te=k(U,ne);if(!c._featureFilter.filter(z,te,a))continue;if(ne||(te.geometry=P(U,a,f)),v&&U.type!==1&&a.z<=5){let _e=te.geometry,be=.98078528056,Se=(Ae,Ie)=>{let $e=zn(Ae.x,Ae.y,a,1),Ke=zn(Ie.x,Ie.y,a,1);return Ee.vec3.dot($e,Ke)<be};for(let Ae=0;Ae<_e.length;Ae++)_e[Ae]=x(_e[Ae],Se)}let pe,ie;if(T){let _e=c.getValueAndResolveTokens("text-field",te,a,j),be=Xr.factory(_e);WP(be)&&(this.hasRTLText=!0),(!this.hasRTLText||gh()==="unavailable"||this.hasRTLText&&Bi.isParsed())&&(pe=vP(be,c,te))}if(C){let _e=c.getValueAndResolveTokens("icon-image",te,a,j);ie=_e instanceof Hr?_e:Hr.build(_e)}if(!pe&&!ie)continue;let me=this.sortFeaturesByKey?O.evaluate(te,{},a):void 0,ye={id:q,text:pe,icon:ie,index:K,sourceLayerIndex:re,geometry:te.geometry,properties:U.properties,type:GP[U.type],sortKey:me};if(this.features.push(ye),ie){let _e=W0(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],a,this.zoom,ye)*b*this.pixelRatio,be=ie.getPrimary().scaleSelf(_e);if(L[be.id]=L[be.id]||[],L[be.id].push(be),ie.nameSecondary){let Se=ie.getSecondary().scaleSelf(_e);L[Se.id]=L[Se.id]||[],L[Se.id].push(Se)}}if(pe){let _e=w.evaluate(te,{},a).join(","),be=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(mo.vertical)>=0;for(let Se of pe.sections)if(Se.image){let Ae=Se.image.getPrimary().scaleSelf(this.pixelRatio);L[Ae.id]=L[Ae.id]||[],L[Ae.id].push(Ae)}else{let Ae=Ff(pe.toString()),Ie=Se.fontStack||_e,$e=B[Ie]=B[Ie]||{};this.calculateGlyphDependencies(Se.text,$e,be,this.allowVerticalPlacement,Ae)}}}p.get("symbol-placement")==="line"&&(this.features=function(U){let q={},K={},re=[],ne=0;function te(ye){re.push(U[ye]),ne++}function pe(ye,_e,be){let Se=K[ye];return delete K[ye],K[_e]=Se,re[Se].geometry[0].pop(),re[Se].geometry[0]=re[Se].geometry[0].concat(be[0]),Se}function ie(ye,_e,be){let Se=q[_e];return delete q[_e],q[ye]=Se,re[Se].geometry[0].shift(),re[Se].geometry[0]=be[0].concat(re[Se].geometry[0]),Se}function me(ye,_e,be){let Se=be?_e[0][_e[0].length-1]:_e[0][0];return`${ye}:${Se.x}:${Se.y}`}for(let ye=0;ye<U.length;ye++){let _e=U[ye],be=_e.geometry,Se=_e.text?_e.text.toString():null;if(!Se){te(ye);continue}let Ae=me(Se,be),Ie=me(Se,be,!0);if(Ae in K&&Ie in q&&K[Ae]!==q[Ie]){let $e=ie(Ae,Ie,be),Ke=pe(Ae,Ie,re[$e].geometry);delete q[Ae],delete K[Ie],K[me(Se,re[Ke].geometry,!0)]=Ke,re[$e].geometry=null}else Ae in K?pe(Ae,Ie,be):Ie in q?ie(Ae,Ie,be):(te(ye),q[Ae]=ne-1,K[Ie]=ne-1)}return re.filter(ye=>ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((U,q)=>U.sortKey-q.sortKey)}update(e,r,a,f,c,p,v){this.text.programConfigurations.updatePaintArrays(e,r,c,a,f,p,v),this.icon.programConfigurations.updatePaintArrays(e,r,c,a,f,p,v)}updateZOffset(){let e=(c,p,v)=>{a+=p,a>c.length&&c.resize(a);for(let w=-p;w<0;w++)c.emplace(w+a,v)},r=(c,p,v)=>{f+=p,f>c.length&&c.resize(f);for(let w=-p;w<0;w++)c.emplace(w+f,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,f=0;for(let c=0;c<this.symbolInstances.length;c++){let p=this.symbolInstances.get(c),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:w,numIconVertices:M}=p,_=p.zOffset,E=M>0;if((v>0||w>0)&&(e(this.text.zOffsetVertexArray,v,_),e(this.text.zOffsetVertexArray,w,_)),E){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:b}=p;D>=0&&r(this.icon.zOffsetVertexArray,M,_),b>=0&&r(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=fI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:f,y:c}of r)this.lineVertexArray.emplaceBack(f,c);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,f,c,p,v,w,M,_,E,D,b,T,C,O){let L=e.indexArray,B=e.layoutVertexArray,j=e.globeExtVertexArray,z=e.segments.prepareSegment(4*r.length,B,L,this.canOverlap?p.sortKey:void 0),U=this.glyphOffsetArray.length,q=z.vertexLength,K=this.allowVerticalPlacement&&v===mo.vertical?Math.PI/2:0,re=p.text&&p.text.sections;for(let te=0;te<r.length;te++){let{tl:pe,tr:ie,bl:me,br:ye,texPrimary:_e,texSecondary:be,pixelOffsetTL:Se,pixelOffsetBR:Ae,minFontScaleX:Ie,minFontScaleY:$e,glyphOffset:Ke,isSDF:Ue,sectionIndex:ut}=r[te],lt=z.vertexLength,tt=Ke[1];if(u_(B,M.x,M.y,pe.x,tt+pe.y,_e.x,_e.y,a,Ue,Se.x,Se.y,Ie,$e),u_(B,M.x,M.y,ie.x,tt+ie.y,_e.x+_e.w,_e.y,a,Ue,Ae.x,Se.y,Ie,$e),u_(B,M.x,M.y,me.x,tt+me.y,_e.x,_e.y+_e.h,a,Ue,Se.x,Ae.y,Ie,$e),u_(B,M.x,M.y,ye.x,tt+ye.y,_e.x+_e.w,_e.y+_e.h,a,Ue,Ae.x,Ae.y,Ie,$e),w){let{x:Je,y:xt,z:ht}=w.anchor,[mt,Lt,Ht]=w.up;d_(j,Je,xt,ht,mt,Lt,Ht),d_(j,Je,xt,ht,mt,Lt,Ht),d_(j,Je,xt,ht,mt,Lt,Ht),d_(j,Je,xt,ht,mt,Lt,Ht),f_(e.dynamicLayoutVertexArray,Je,xt,ht,K)}else f_(e.dynamicLayoutVertexArray,M.x,M.y,M.z,K);if(O){let Je=be||_e;h_(e.iconTransitioningVertexArray,Je.x,Je.y),h_(e.iconTransitioningVertexArray,Je.x+Je.w,Je.y),h_(e.iconTransitioningVertexArray,Je.x,Je.y+Je.h),h_(e.iconTransitioningVertexArray,Je.x+Je.w,Je.y+Je.h)}L.emplaceBack(lt,lt+1,lt+2),L.emplaceBack(lt+1,lt+2,lt+3),z.vertexLength+=4,z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ke[0]),te!==r.length-1&&ut===r[te+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,p,p.index,{},b,T,C,re&&re[ut])}let ne=w?w.anchor:M;e.placedSymbolArray.emplaceBack(ne.x,ne.y,ne.z,M.x,M.y,U,this.glyphOffsetArray.length-U,q,_,E,M.segment,a?a[0]:0,a?a[1]:0,f[0],f[1],v,0,!1,0,D,0)}_commitLayoutVertex(e,r,a,f,c,p,v){e.emplaceBack(r,a,f,c,p,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,r,a,f,c,p,v){let w=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),M=w.vertexLength,_=v.tileAnchorX,E=v.tileAnchorY;for(let b=0;b<4;b++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,r,e.padding,v.zOffset),this._commitLayoutVertex(a.layoutVertexArray,f,c,p,_,E,new at(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,f,c,p,_,E,new at(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,f,c,p,_,E,new at(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,f,c,p,_,E,new at(e.x1,e.y2)),w.vertexLength+=4;let D=a.indexArray;D.emplaceBack(M,M+1),D.emplaceBack(M+1,M+2),D.emplaceBack(M+2,M+3),D.emplaceBack(M+3,M),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,f,c,p){for(let v=f;v<c;v++){let w=a.get(v),M=this.getSymbolInstanceTextSize(e,p,r,v);this._addCollisionDebugVertices(w,M,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,r,a,f,c,p){for(let v=f;v<c;v++){let w=a.get(v),M=this.getSymbolInstanceIconSize(e,r,p.placedIconSymbolIndex);this._addCollisionDebugVertices(w,M,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ox(Th,LT.members,$s),this.iconCollisionBox=new ox(Th,LT.members,$s);let f=Fh(this.iconSizeData,e),c=Fh(this.textSizeData,e,a);for(let p=0;p<this.symbolInstances.length;p++){let v=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(c,e,r,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(c,e,r,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(f,e,r,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(f,e,r,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,r,a,f){let c=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:f),p=t_(this.textSizeData,e,c)/Qr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,r,a){let f=this.icon.placedSymbolArray.get(a),c=t_(this.iconSizeData,e,f);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,r,a,f){e.emplaceBack(r,-a,-a,f),e.emplaceBack(r,a,-a,f),e.emplaceBack(r,a,a,f),e.emplaceBack(r,-a,a,f)}_updateTextDebugCollisionBoxes(e,r,a,f,c,p,v){for(let w=f;w<c;w++){let M=a.get(w),_=this.getSymbolInstanceTextSize(e,p,r,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,M.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,r,a,f,c,p,v){for(let w=f;w<c;w++){let M=a.get(w),_=this.getSymbolInstanceIconSize(e,r,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,M.padding,p.zOffset)}}updateCollisionDebugBuffers(e,r,a,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let c=Fh(this.iconSizeData,e,f),p=Fh(this.textSizeData,e,a);for(let v=0;v<this.symbolInstances.length;v++){let w=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(p,e,r,w.textBoxStartIndex,w.textBoxEndIndex,w,a),this._updateTextDebugCollisionBoxes(p,e,r,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,a),this._updateIconDebugCollisionBoxes(c,e,r,w.iconBoxStartIndex,w.iconBoxEndIndex,w,f),this._updateIconDebugCollisionBoxes(c,e,r,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,f,c,p,v,w,M){let _={};if(r<a){let{x1:E,y1:D,x2:b,y2:T,padding:C,projectedAnchorX:O,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:z,featureIndex:U}=e.get(r);_.textBox={x1:E,y1:D,x2:b,y2:T,padding:C,projectedAnchorX:O,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:z},_.textFeatureIndex=U}if(f<c){let{x1:E,y1:D,x2:b,y2:T,padding:C,projectedAnchorX:O,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:z,featureIndex:U}=e.get(f);_.verticalTextBox={x1:E,y1:D,x2:b,y2:T,padding:C,projectedAnchorX:O,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:z},_.verticalTextFeatureIndex=U}if(p<v){let{x1:E,y1:D,x2:b,y2:T,padding:C,projectedAnchorX:O,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:z,featureIndex:U}=e.get(p);_.iconBox={x1:E,y1:D,x2:b,y2:T,padding:C,projectedAnchorX:O,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:z},_.iconFeatureIndex=U}if(w<M){let{x1:E,y1:D,x2:b,y2:T,padding:C,projectedAnchorX:O,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:z,featureIndex:U}=e.get(w);_.verticalIconBox={x1:E,y1:D,x2:b,y2:T,padding:C,projectedAnchorX:O,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:j,tileAnchorY:z},_.verticalIconFeatureIndex=U}return _}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){let a=e.placedSymbolArray.get(r),f=a.vertexStartIndex+4*a.numGlyphs;for(let c=a.vertexStartIndex;c<f;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(e),a=Math.cos(e),f=[],c=[],p=[];for(let v=0;v<this.symbolInstances.length;++v){p.push(v);let w=this.symbolInstances.get(v);f.push(0|Math.round(r*w.tileAnchorX+a*w.tileAnchorY)),c.push(w.featureIndex)}return p.sort((v,w)=>f[v]-f[w]||c[w]-c[v]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:M}=a;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),c>=0&&c!==f&&this.addIndicesForPlacedSymbol(this.text,c),p>=0&&p!==c&&p!==f&&this.addIndicesForPlacedSymbol(this.text,p),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let pI,mI,sx;_t(p_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),p_.addDynamicAttributes=f_;class gI{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:la,this.defaultValue=e}evaluate(e){if(e.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_t(gI,"FormatSectionOverride",{omit:["defaultValue"]});let ax=()=>sx||(sx={layout:pI||(pI=new er({"symbol-placement":new nt(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new nt(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nt(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ft(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nt(Pe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new nt(Pe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new nt(Pe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new nt(Pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new nt(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new nt(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nt(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ft(Pe.layout_symbol["icon-size"]),"icon-size-scale-range":new nt(Pe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ft(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ft(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ft(Pe.layout_symbol["icon-image"]),"icon-rotate":new ft(Pe.layout_symbol["icon-rotate"]),"icon-padding":new nt(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new nt(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new ft(Pe.layout_symbol["icon-offset"]),"icon-anchor":new ft(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nt(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nt(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nt(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new ft(Pe.layout_symbol["text-field"]),"text-font":new ft(Pe.layout_symbol["text-font"]),"text-size":new ft(Pe.layout_symbol["text-size"]),"text-size-scale-range":new nt(Pe.layout_symbol["text-size-scale-range"]),"text-max-width":new ft(Pe.layout_symbol["text-max-width"]),"text-line-height":new ft(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new ft(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new ft(Pe.layout_symbol["text-justify"]),"text-radial-offset":new ft(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nt(Pe.layout_symbol["text-variable-anchor"]),"text-anchor":new ft(Pe.layout_symbol["text-anchor"]),"text-max-angle":new nt(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new nt(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new ft(Pe.layout_symbol["text-rotate"]),"text-padding":new nt(Pe.layout_symbol["text-padding"]),"text-keep-upright":new nt(Pe.layout_symbol["text-keep-upright"]),"text-transform":new ft(Pe.layout_symbol["text-transform"]),"text-offset":new ft(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new nt(Pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new nt(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new nt(Pe.layout_symbol["text-optional"]),visibility:new nt(Pe.layout_symbol.visibility)})),paint:mI||(mI=new er({"icon-opacity":new ft(Pe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ft(Pe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ft(Pe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ft(Pe.paint_symbol["text-emissive-strength"]),"icon-color":new ft(Pe.paint_symbol["icon-color"]),"icon-halo-color":new ft(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ft(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ft(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new nt(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new nt(Pe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ft(Pe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ft(Pe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ft(Pe.paint_symbol["text-occlusion-opacity"]),"text-color":new ft(Pe.paint_symbol["text-color"],{runtimeType:Zr,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new ft(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new ft(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new ft(Pe.paint_symbol["text-halo-blur"]),"text-translate":new nt(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new nt(Pe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new nt(Pe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new nt(Pe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new nt(Pe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new nt(Pe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ft(Pe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},sx);class m_ extends kr{constructor(e,r,a,f){super(e,ax(),r,a,f),this._colorAdjustmentMatrix=Ee.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let f=[];for(let c of a)f.indexOf(c)<0&&f.push(c);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,a,f){return this._saturation===e&&this._contrast===r&&this._brightnessMin===a&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(c,p,v,w){c=Vu(c),p=Bu(p);let M=Ee.mat4.create(),_=c/3,E=1-2*_,D=[E,_,_,0,_,E,_,0,_,_,E,0,0,0,0,1],b=.5-.5*p,T=w-v;return Ee.mat4.multiply(M,[T,0,0,0,0,T,0,0,0,0,T,0,v,v,v,1],[p,0,0,0,0,p,0,0,0,0,p,0,b,b,b,1]),Ee.mat4.multiply(M,M,D),M}(e,r,a,f),this._saturation=e,this._contrast=r,this._brightnessMin=a,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,a,f){let c=this.layout.get(e).evaluate(r,{},a,f),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Tl(p.value)||!c?c:function(v,w){return w.replace(/{([^{}]+)}/g,(M,_)=>_ in v?String(v[_]):"")}(r.properties,c)}createBucket(e){return new p_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of ax().paint.overridableProperties){if(!m_.hasPaintOverride(this.layout,e))continue;let r=this.paint.get(e),a=new gI(r),f=new uh(a,r.property.specification,this.scope,this.options),c=null;c=r.value.kind==="constant"||r.value.kind==="source"?new hh("source",f):new Rc("composite",f,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Ml(r.property,c,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&m_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){let a=e.get("text-field"),f=ax().paint.properties[r],c=!1,p=v=>{for(let w of v)if(f.overrides&&f.overrides.hasOverride(w))return void(c=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Xr)p(a.value.value.sections);else if(a.value.kind==="source"){let v=M=>{c||(M instanceof zr&&sr(M.value)===Po?p(M.value.sections):M instanceof ca?p(M.sections):M.eachChild(v))},w=a.value;w._styleExpression&&v(w._styleExpression.expression)}return c}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,a){return{config:new Sa(this,{zoom:r,lut:a}),overrideFog:!1}}}let _I,yI,vI,xI;var lx=xn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function cx(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function ux(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class hx{constructor(e,r,a,f){this.context=e,this.format=a,this.useMipmap=f&&f.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:f&&f.premultiply})}update(e,r){let a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,f=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:c}=this,{gl:p}=c,{x:v,y:w}=r&&r.position?r.position:{x:0,y:0},M=v+a,_=w+f;!this.size||this.size[0]===M&&this.size[1]===_||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!r||r.premultiply!==!1));let E=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&M>0&&_>0){let D=this.useMipmap?Math.floor(Math.log2(Math.max(M,_)))+1:1;p.texStorage2D(p.TEXTURE_2D,D,this.format,M,_),this.size=[M,_]}if(this.size)if(E)p.texSubImage2D(p.TEXTURE_2D,0,v,w,cx(this.format),ux(this.format),e);else{let D=e.data;D&&p.texSubImage2D(p.TEXTURE_2D,0,v,w,a,f,cx(this.format),ux(this.format),D)}this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,r,a=!1){let{context:f}=this,{gl:c}=f;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,a,f){let{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),f!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,f),this.wrapT=f)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class g_{constructor(e,r){this.context=e,this.texture=r}bind(e,r){let{context:a}=this,{gl:f}=a;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,r),this.wrapS=r)}}function __(o,e,r,a,f,c,p,v){let w=[o,e,1,r,a,1,f,c,1],M=[p,v,1],_=Ee.mat3.adjoint([],w),[E,D,b]=Ee.vec3.transformMat3(M,M,_);return Ee.mat3.multiply(w,w,[E,0,0,0,D,0,0,0,b])}function bI(o,e,r,a,f,c,p,v){let w=function(M,_,E,D,b,T,C,O){let L=__(0,0,1,0,1,1,0,1),B=__(M,_,E,D,b,T,C,O),j=Ee.mat3.adjoint([],L);return Ee.mat3.multiply(B,B,j)}(o,e,r,a,f,c,p,v);return[w[2]/w[8]/ct,w[5]/w[8]/ct]}function y_(o){return[o[0],Math.min(Math.max(o[1],-hr),hr)]}class wI extends ks{constructor(e,r,a,f){super(),this.id=e,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new Ro("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Wd(this.map._requestManager.transformRequest(this.url,_n.Image),(a,f)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Uu(a)):f&&(this.image=f instanceof HTMLImageElement?ue.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new g_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ro("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof g_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],a=e[0][1];for(let c of e)c[1]>a&&(a=c[1]),c[1]<r&&(r=c[1]);let f=(a+r)/2;if(f>hr?this.onNorthPole=!0:f<-hr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let c=e.map(i.fromLngLat);this.tileID=function(p){let v=1/0,w=1/0,M=-1/0,_=-1/0;for(let C of p)v=Math.min(v,C.x),w=Math.min(w,C.y),M=Math.max(M,C.x),_=Math.max(_,C.y);let E=Math.max(M-v,_-w),D=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),b=Math.pow(2,D),T=Math.floor((v+M)/2*b);return T>1&&(T-=1),new Ye(D,T,Math.floor((w+_)/2*b))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ro("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let L in this.tiles){let B=this.tiles[L];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let r=Mp(new Ye(0,0,0),this.map.transform.projection),a=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(L){let B=L[1].x-L[0].x,j=L[1].y-L[0].y,z=L[2].x-L[1].x,U=L[2].y-L[1].y,q=L[3].x-L[2].x,K=L[3].y-L[2].y,re=L[0].x-L[3].x,ne=L[0].y-L[3].y,te=B*U-z*j,pe=z*K-q*U,ie=q*ne-re*K,me=re*j-B*ne;return te>0&&pe>0&&ie>0&&me>0||te<0&&pe<0&&ie<0&&me<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let f=Mp(this.tileID,this.map.transform.projection),[c,p,v,w]=this.coordinates.map(L=>{let B=f.projection.project(L[0],L[1]);return lI(f,B)._round()});this.perspectiveTransform=bI(c.x,c.y,p.x,p.y,v.x,v.y,w.x,w.y);let M=this._boundsArray=new ds;M.emplaceBack(c.x,c.y,0,0),M.emplaceBack(p.x,p.y,ct,0),M.emplaceBack(w.x,w.y,0,ct),M.emplaceBack(v.x,v.y,ct,ct),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(M,lx.members),this.boundsSegments=ur.simpleSegment(0,0,4,2);let _=[],E=[y_((D=this.coordinates)[0]),y_(D[1]),y_(D[2]),y_(D[3])];var D;let[b,T,C,O]=function(L){let B=L[0][0],j=B,z=L[0][1],U=z;for(let q=1;q<L.length;q++)L[q][0]<B?B=L[q][0]:L[q][0]>j&&(j=L[q][0]),L[q][1]<z?z=L[q][1]:L[q][1]>U&&(U=L[q][1]);return[B,z,j-B,U-z]}(E);{let L=new ds,[B,j,z,U]=function(Se){let Ae=Se[0].x,Ie=Ae,$e=Se[0].y,Ke=$e;for(let Ue=1;Ue<Se.length;Ue++)Se[Ue].x<Ae?Ae=Se[Ue].x:Se[Ue].x>Ie&&(Ie=Se[Ue].x),Se[Ue].y<$e?$e=Se[Ue].y:Se[Ue].y>Ke&&(Ke=Se[Ue].y);return[Ae,$e,Ie-Ae,Ke-$e]}(a),q=Se=>[(Se.x-B)/z,(Se.y-j)/U],[K,re,ne,te]=a.map(q),pe=function(Se,Ae,Ie,$e,Ke,Ue,ut,lt){let tt=__(0,0,1,0,1,1,0,1),Je=__(Se,Ae,Ie,$e,Ke,Ue,ut,lt),xt=Ee.mat3.adjoint([],Je);return Ee.mat3.multiply(tt,tt,xt)}(K[0],K[1],re[0],re[1],ne[0],ne[1],te[0],te[1]);this.elevatedGlobePerspectiveTransform=bI(K[0],K[1],re[0],re[1],ne[0],ne[1],te[0],te[1]);let ie=(Se,Ae)=>{_.push(Se.lng);let Ie=Math.round((Se.lng-b)/C*ct),$e=Math.round((Se.lat-T)/O*ct),Ke=q(Ae),Ue=Ee.vec3.transformMat3([],[Ke[0],Ke[1],1],pe),ut=Math.round(Ue[0]/Ue[2]*ct),lt=Math.round(Ue[1]/Ue[2]*ct);L.emplaceBack(Ie,$e,ut,lt)},me=a[3].x-a[0].x,ye=a[3].y-a[0].y,_e=a[2].x-a[1].x,be=a[2].y-a[1].y;for(let Se=0;Se<65;Se++){let Ae=Se/64,Ie=[a[0].x+Ae*me,a[0].y+Ae*ye],$e=[a[1].x+Ae*_e,a[1].y+Ae*be],Ke=$e[0]-Ie[0],Ue=$e[1]-Ie[1];for(let ut=0;ut<65;ut++){let lt=ut/64,tt={x:Ie[0]+Ke*lt,y:Ie[1]+Ue*lt,z:0};ie(r.projection.unproject(tt.x,tt.y),tt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(L,lx.members)}{this.maxLongitudeTriangleSize=0;let L=[],B=new Vr,j=(z,U,q)=>{B.emplaceBack(z,U,q);let K=_[z],re=_[U],ne=_[q],te=Math.min(Math.min(K,re),ne),pe=Math.max(Math.max(K,re),ne)-te;pe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=pe),L.push(te+pe/2)};for(let z=0;z<64;z++)for(let U=0;U<64;U++){let q=65*z+U,K=q+1,re=q+65,ne=re+1;j(q,re,K),j(K,re,ne)}[L,B]=function(z,U){let q=Array.from({length:z.length},(ne,te)=>te);q.sort((ne,te)=>z[ne]-z[te]);let K=[],re=new Vr;for(let ne=0;ne<q.length;ne++){let te=q[ne];K.push(z[te]);let pe=3*te,ie=pe+1;re.emplaceBack(U.uint16[pe],U.uint16[ie],U.uint16[ie+1])}return[K,re]}(L,B),this.elevatedGlobeTrianglesCenterLongitudes=L,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(B)}this.elevatedGlobeSegments=ur.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,C/ct,0,O/ct,0,0,T,b,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let r=this.map.painter.context,a=r.gl;!this._dirty||this.texture instanceof g_||(this.texture?this.texture.update(this.image):(this.texture=new hx(r,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;let a=this.elevatedGlobeTrianglesCenterLongitudes,f=(c=e+180)+360*Math.round((a[0]-c)/360);var c;let p=new ur,v=(E,D)=>{p.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:r.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-f)<=w){let E=fl(a,0,a.length,f+w);return E===a.length||v(E,zu(a,E+1,a.length,f+360-w)-E),p}f<a[0]&&(f+=360);let M=zu(a,0,a.length,f-w);if(M===a.length)return v(0,a.length),p;v(0,M-0);let _=fl(a,M+1,a.length,f+w);return _!==a.length&&v(_,a.length-_),p}}let ZP=(Math.pow(256,2)-1)/16907520;class EI extends kr{constructor(e,r,a,f){super(e,{layout:vI||(vI=new er({visibility:new nt(Pe.layout_raster.visibility)})),paint:xI||(xI=new er({"raster-opacity":new nt(Pe.paint_raster["raster-opacity"]),"raster-color":new Al(Pe.paint_raster["raster-color"]),"raster-color-mix":new nt(Pe.paint_raster["raster-color-mix"]),"raster-color-range":new nt(Pe.paint_raster["raster-color-range"]),"raster-hue-rotate":new nt(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nt(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nt(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new nt(Pe.paint_raster["raster-saturation"]),"raster-contrast":new nt(Pe.paint_raster["raster-contrast"]),"raster-resampling":new nt(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new nt(Pe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new nt(Pe.paint_raster["raster-emissive-strength"]),"raster-array-band":new nt(Pe.paint_raster["raster-array-band"]),"raster-elevation":new nt(Pe.paint_raster["raster-elevation"]),"raster-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},r,a,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof wI&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let r=this._transitionablePaint._values["raster-color"].value.expression,[a,f]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(f)||a===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=dp({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,f])}}let TI,II,SI,DI,MI;class CI extends kr{constructor(e,r,a,f){super(e,{layout:TI||(TI=new er({visibility:new nt(Pe["layout_raster-particle"].visibility)})),paint:II||(II=new er({"raster-particle-array-band":new nt(Pe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new nt(Pe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Al(Pe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new nt(Pe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new nt(Pe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new nt(Pe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new nt(Pe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new nt(Pe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},r,a,f),this._updateColorRamp(),this.lastInvalidatedAt=ue.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=dp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ue.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class XP extends kr{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function dx(o,e,r){let a=[0,0,1],f=Ee.quat.identity([]);return Ee.quat.rotateY(f,f,r?-ln(o)+Math.PI:ln(o)),Ee.quat.rotateX(f,f,-ln(e)),Ee.vec3.transformQuat(a,a,f),Ee.vec3.normalize(a,a)}function AI(o,e){let r=v_(o.projection,o.zoom,o.width,o.height),a=function(c,p,v,w,M){let _=new mn(v.lng-180*Gl,v.lat),E=new mn(v.lng+180*Gl,v.lat),D=c.project(_.lng,_.lat),b=c.project(E.lng,E.lat),T=-Math.atan2(b.y-D.y,b.x-D.x),C=i.fromLngLat(v);C.y=Yt(C.y,-1+Gl,1-Gl);let O=C.toLngLat(),L=c.project(O.lng,O.lat),B=i.fromLngLat(O);B.x+=Gl;let j=B.toLngLat(),z=c.project(j.lng,j.lat),U=PI(z.x-L.x,z.y-L.y,T),q=i.fromLngLat(O);q.y+=Gl;let K=q.toLngLat(),re=c.project(K.lng,K.lat),ne=PI(re.x-L.x,re.y-L.y,T),te=Math.abs(U.x)/Math.abs(ne.y),pe=Ee.mat4.identity([]);Ee.mat4.rotateZ(pe,pe,-T*(1-(M?0:w)));let ie=Ee.mat4.identity([]);return Ee.mat4.scale(ie,ie,[1,1-(1-te)*w,1]),ie[4]=-ne.x/ne.y*w,Ee.mat4.rotateZ(ie,ie,T),Ee.mat4.multiply(ie,pe,ie),ie}(o.projection,0,o.center,r,e),f=RI(o);return Ee.mat4.scale(a,a,[f,f,1]),a}function RI(o){let e=o.projection,r=v_(o.projection,o.zoom,o.width,o.height),a=fx(e,o.center),f=fx(e,mn.convert(e.center));return Math.pow(2,a*r+(1-r)*f)}function v_(o,e,r,a,f=1/0){let c=o.range;if(!c)return 0;let p=Math.min(f,Math.max(r,a)),v=Math.log(p/1024)/Math.LN2;return So(c[0]+v,c[1]+v,e)}let Gl=1/4e4;function fx(o,e){let r=Yt(e.lat,-hr,hr),a=new mn(e.lng-180*Gl,r),f=new mn(e.lng+180*Gl,r),c=o.project(a.lng,r),p=o.project(f.lng,r),v=i.fromLngLat(a),w=i.fromLngLat(f),M=p.x-c.x,_=p.y-c.y,E=w.x-v.x,D=w.y-v.y,b=Math.sqrt((E*E+D*D)/(M*M+_*_));return Math.log(b)/Math.LN2}function PI(o,e,r){let a=Math.cos(r),f=Math.sin(r);return{x:o*a-e*f,y:o*f+e*a}}function OI(o,e,r){Ee.mat4.identity(o),Ee.mat4.rotateZ(o,o,ln(e[2])),Ee.mat4.rotateX(o,o,ln(e[0])),Ee.mat4.rotateY(o,o,ln(e[1])),Ee.mat4.scale(o,o,r),Ee.mat4.multiply(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function x_(o,e,r,a,f,c,p,v){let w=[r[0]-e[0],r[1]-e[1],0],M=[a[0]-e[0],a[1]-e[1],0];if(Ee.vec3.length(w)<1e-12||Ee.vec3.length(M)<1e-12)return Ee.quat.identity(o);let _=Ee.vec3.cross([],w,M);Ee.vec3.normalize(_,_),Ee.vec3.subtract(M,a,e),w[2]=(c-f)*v,M[2]=(p-f)*v;let E=w;return Ee.vec3.cross(E,w,M),Ee.vec3.normalize(E,E),Ee.quat.rotationTo(o,_,E)}function px(o,e,r=!1){let a=wi(e.zoom),f=function(c,p,v){let w=p.worldSize,M=[c[12],c[13],c[14]],_=jr(M[1]/w),E=Pi(M[0]/w),D=Ee.mat4.identity([]),b=hi(1,_)*w,T=hi(1,0)*w*zl(_,p.zoom),C=1/Jr(w),O=T*C;if(v){let z=v_(p.projection,p.zoom,p.width,p.height,1024);O=C*p.projection.pixelSpaceConversion(p.center.lat,w,z)}let L=Da(_,E);Ee.vec3.add(L,L,Ee.vec3.scale([],Ee.vec3.normalize([],L),b*O*M[2]));let B=function(z){let U=[z[0],z[1],z[2]],q=[0,1,0],K=Ee.vec3.cross([],q,U);return Ee.vec3.cross(q,U,K),Ee.vec3.squaredLength(q)===0&&(q=[0,1,0],Ee.vec3.cross(K,U,q)),Ee.vec3.normalize(K,K),Ee.vec3.normalize(q,q),Ee.vec3.normalize(U,U),[K[0],K[1],K[2],0,q[0],q[1],q[2],0,U[0],U[1],U[2],0,z[0],z[1],z[2],1]}(L);Ee.mat4.scale(D,D,[O,O,O*b]),Ee.mat4.translate(D,D,[-M[0],-M[1],-M[2]]);let j=Ee.mat4.multiply([],p.globeMatrix,B);return Ee.mat4.multiply(j,j,D),Ee.mat4.multiply(j,j,c),j}(o,e,r);if(a>0){let c=function(p,v){let w=v.worldSize,M=hi(1,0)*w*zl(v.center.lat,v.zoom)/Jr(w),_=hi(1,v.center.lat)*w,E=Ee.mat4.identity([]);return Ee.mat4.rotateY(E,E,ln(v.center.lng)),Ee.mat4.rotateX(E,E,ln(v.center.lat)),Ee.mat4.translate(E,E,[0,0,ui]),Ee.mat4.scale(E,E,[M,M,M*_]),Ee.mat4.translate(E,E,[v.point.x-.5*w,v.point.y-.5*w,0]),Ee.mat4.multiply(E,E,p),Ee.mat4.multiply(E,v.globeMatrix,E)}(o,e);return function(p,v,w){let M=(T,C,O)=>{let L=Ee.vec3.length(T),B=Ee.vec3.length(C),j=Tr(T,C,O);return Ee.vec3.scale(j,j,1/Ee.vec3.length(j)*At(L,B,O))},_=M([p[0],p[1],p[2]],[v[0],v[1],v[2]],w),E=M([p[4],p[5],p[6]],[v[4],v[5],v[6]],w),D=M([p[8],p[9],p[10]],[v[8],v[9],v[10]],w),b=Tr([p[12],p[13],p[14]],[v[12],v[13],v[14]],w);return[_[0],_[1],_[2],0,E[0],E[1],E[2],0,D[0],D[1],D[2],0,b[0],b[1],b[2],1]}(f,c,a)}return f}function LI(o,e,r,a){let f=wt.projectAabbCorners(a,r),c=Number.MAX_VALUE,p=-1;for(let M=0;M<f.length;++M){let _=f[M];_[0]=(.5*_[0]+.5)*e.width,_[1]=(.5-.5*_[1])*e.height,_[2]<c&&(p=M,c=_[2])}let v=M=>new at(f[M][0],f[M][1]),w;switch(p){case 0:case 6:w=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:w=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:w=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:w=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(G(o,w))return c}let YP=xn([{name:"a_pos_3f",components:3,type:"Float32"}]),KP=xn([{name:"a_color_3f",components:3,type:"Float32"}]),JP=xn([{name:"a_color_4f",components:4,type:"Float32"}]),QP=xn([{name:"a_uv_2f",components:2,type:"Float32"}]),eO=xn([{name:"a_normal_3f",components:3,type:"Float32"}]),tO=xn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),nO=xn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),kI={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class b_{constructor(e,r,a,f){this.message=(e?`${e}: `:"")+a,f&&(this.identifier=f),r!=null&&r.__line__&&(this.line=r.__line__)}}function FI(o,e){let r=o.indexOf("://")===-1;try{return new URL(o,r&&e?"http://example.com":void 0),!0}catch{return!1}}class NI{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class zI{constructor(){this.instancedDataArray=new Uc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class mx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,r){}populate(e,r,a,f){this.tileToMeter=t(a);let c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:v,index:w,sourceLayerIndex:M}of e){let _=v??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),E=k(p,c);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),E,a))continue;let D={id:_,sourceLayerIndex:M,index:w,geometry:c?E.geometry:P(p,a,f),properties:p.properties,type:p.type,patterns:{}},b=this.addFeature(D,D.geometry,E);b&&r.featureIndex.insert(p,D.geometry,w,M,this.index,this.instancesPerModel[b].instancedDataArray.length,ct/32)}this.lookup=null}update(e,r,a,f){for(let c in this.instancesPerModel){let p=this.instancesPerModel[c];for(let v in e)p.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(p.features[p.idToFeaturesIndex[v]],e[v],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let r in this.instancesPerModel){let a=this.instancesPerModel[r];for(let f of a.features){let c=this.layers[0],p=f.feature,v=this.canonical,w=c.paint.get("model-rotation").evaluate(p,{},v),M=c.paint.get("model-scale").evaluate(p,{},v),_=c.paint.get("model-translation").evaluate(p,{},v);Ee.vec3.exactEquals(f.rotation,w)&&Ee.vec3.exactEquals(f.scale,M)&&Ee.vec3.exactEquals(f.translation,_)||(this.evaluate(f,f.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,r,a,f){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;let c=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(V0(this.activeReplacements,c))return!1;this.activeReplacements=c;let p=!1;for(let v in this.instancesPerModel){let w=this.instancesPerModel[v],M=w.instancedDataArray;for(let _ of w.features){let E=_.instancedDataOffset,D=_.instancedDataCount;for(let b=0;b<D;b++){let T=16*(b+E),C=M.float32[T+0],O=C>ct;C=O?C-ct:C;let L=Math.floor(C),B=M.float32[T+1],j=!1;for(let z of this.activeReplacements)if(!JE(z,a,kI.Model,f)&&!(z.min.x>L||L>z.max.x||z.min.y>B||B>z.max.y)&&(j=iT(rT(L,B,e.canonical,z.footprintTileId.canonical),z.footprint),j))break;M.float32[T]=j?C+ct:C,p=p||j!==O}}}return p}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let r in this.instancesPerModel){let a=this.instancesPerModel[r];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,tO.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let r in this.instancesPerModel){let a=this.instancesPerModel[r];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let r of this.modelUris)e.removeModel(r,"")}addFeature(e,r,a){let f=this.layers[0],c=f.layout.get("model-id").evaluate(a,{},this.canonical);if(!c)return qt(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),c;FI(c,!1)&&(this.modelUris.includes(c)||this.modelUris.push(c)),this.instancesPerModel[c]||(this.instancesPerModel[c]=new zI);let p=this.instancesPerModel[c],v=p.instancedDataArray,w=new NI(a,v.length);for(let M of r)for(let _ of M){if(_.x<0||_.x>=ct||_.y<0||_.y>=ct)continue;let E=(this.lookupDim-1)/ct,D=this.lookupDim*(_.y*E|0)+_.x*E|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;let b=v.length;v.resize(b+1),p.instancesEvaluatedElevation.push(0),v.float32[16*b]=_.x,v.float32[16*b+1]=_.y}return w.instancedDataCount=p.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(w),this.evaluate(w,{},p,!1)),c}getModelUris(){return this.modelUris}evaluate(e,r,a,f){let c=this.layers[0],p=e.feature,v=this.canonical,w=e.rotation=c.paint.get("model-rotation").evaluate(p,r,v),M=e.scale=c.paint.get("model-scale").evaluate(p,r,v),_=e.translation=c.paint.get("model-translation").evaluate(p,r,v),E=c.paint.get("model-color").evaluate(p,r,v);E.a=c.paint.get("model-color-mix-intensity").evaluate(p,r,v);let D=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,M[0]),Math.max(M[1],M[2])),OI(D,w,M);let b=Math.round(100*E.a)+E.b/1.05;for(let T=0;T<e.instancedDataCount;++T){let C=e.instancedDataOffset+T,O=16*C,L=a.instancedDataArray.float32,B=0;f&&(B=L[O+6]-a.instancesEvaluatedElevation[C]);let j=0|L[O+1];L[O]=(0|L[O])+E.r/1.05,L[O+1]=j+E.g/1.05,L[O+2]=b,L[O+3]=1/(v.z>10?this.tileToMeter:t(v,j)),L[O+4]=_[0],L[O+5]=_[1],L[O+6]=_[2]+B,L[O+7]=D[0],L[O+8]=D[1],L[O+9]=D[2],L[O+10]=D[4],L[O+11]=D[5],L[O+12]=D[6],L[O+13]=D[8],L[O+14]=D[9],L[O+15]=D[10],a.instancesEvaluatedElevation[C]=_[2]}}}let BI,VI;_t(mx,"ModelBucket",{omit:["layers"]}),_t(zI,"PerModelAttributes"),_t(NI,"ModelFeature");let tu=64,jh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function jI(o,e,r,a,f,c,p,v,w,M=!1){let _=r.zoom,E=r.project(a),D=zl(a.lat,_),b=1/D;Ee.mat4.identity(o),Ee.mat4.translate(o,o,[E.x+p[0]*b,E.y+p[1]*b,p[2]]);let T=1,C=1,O=r.worldSize;if(M){if(r.projection.name==="mercator"){let z=0;r.elevation&&(z=r.elevation.getAtPointOrZero(new i(E.x/O,E.y/O),0));let U=Ee.vec4.transformMat4([],[E.x,E.y,z,1],r.projMatrix)[3]/r.cameraToCenterDistance;T=U,C=U*zl(r.center.lat,_)}else if(r.projection.name==="globe"){let z=px(o,r),U=Ee.mat4.multiply([],r.projMatrix,z),q=[0,0,0,1];Ee.vec4.transformMat4(q,q,U);let K=q[3]/r.cameraToCenterDistance,re=wi(_),ne=r.projection.pixelsPerMeter(a.lat,O)*zl(a.lat,_),te=r.projection.pixelsPerMeter(r.center.lat,O)*zl(r.center.lat,_);T=K/At(ne,up(r.center.lat),re),C=K*D/ne,T*=te,C*=te}}else T=b;Ee.mat4.scale(o,o,[T,T,C]);let L=[...o],B=e.orientation,j=[];if(OI(j,[B[0]+f[0],B[1]+f[1],B[2]+f[2]],c),Ee.mat4.multiply(o,L,j),v&&r.elevation){let z=0,U=[];if(w&&r.elevation){z=function(re,ne,te,pe,ie){let me=ne.elevation;if(!me)return 0;let ye=wt.projectAabbCorners(te,pe),_e=hi(1,ie.lat)*ne.worldSize,be=function(xt,ht){let mt=[0,0,1],Lt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Ht of Lt){let Wt=xt[Ht.corners[0]],Zt=xt[Ht.corners[1]],en=xt[Ht.corners[2]],rn=[Zt[0]-Wt[0],Zt[1]-Wt[1],ht*(Zt[2]-Wt[2])],$n=Ee.vec3.cross(rn,rn,[en[0]-Wt[0],en[1]-Wt[1],ht*(en[2]-Wt[2])]);Ee.vec3.normalize($n,$n),Ht.dotProductWithUp=Ee.vec3.dot($n,mt)}return Lt.sort((Ht,Wt)=>Ht.dotProductWithUp-Wt.dotProductWithUp),Lt[0].corners}(ye,_e),Se=ye[be[0]],Ae=ye[be[1]],Ie=ye[be[2]],$e=ye[be[3]],Ke=me.getAtPointOrZero(new i(Se[0]/ne.worldSize,Se[1]/ne.worldSize),0),Ue=me.getAtPointOrZero(new i(Ae[0]/ne.worldSize,Ae[1]/ne.worldSize),0),ut=me.getAtPointOrZero(new i(Ie[0]/ne.worldSize,Ie[1]/ne.worldSize),0),lt=me.getAtPointOrZero(new i($e[0]/ne.worldSize,$e[1]/ne.worldSize),0),tt=(Ke+lt)/2,Je=(Ue+ut)/2;return tt>Je?Ue<ut?x_(re,Ae,$e,Se,Ue,lt,Ke,_e):x_(re,Ie,Se,$e,ut,Ke,lt,_e):Ke<lt?x_(re,Se,Ae,Ie,Ke,Ue,ut,_e):x_(re,$e,Ie,Ae,lt,ut,Ue,_e),Math.max(tt,Je)}(U,r,e.aabb,o,a);let q=Ee.mat4.fromQuat([],U),K=Ee.mat4.multiply([],q,j);Ee.mat4.multiply(o,L,K)}else z=r.elevation.getAtPointOrZero(new i(E.x/O,E.y/O),0);z!==0&&(o[14]+=z)}}function Op(o,e,r=!1){o.uploaded||(o.gfxTexture=new hx(e,o.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function rO(o,e,r){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,YP.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,eO.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,QP.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?KP:JP).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,nO.members,!0)),o.segments=ur.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);let a=o.material;a.pbrMetallicRoughness.baseColorTexture&&Op(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Op(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Op(a.normalTexture,e),a.occlusionTexture&&Op(a.occlusionTexture,e,r),a.emissionTexture&&Op(a.emissionTexture,e)}function gx(o,e,r){if(o.meshes)for(let a of o.meshes)rO(a,e,r);if(o.children)for(let a of o.children)gx(a,e,r)}function w_(o){if(o.meshes)for(let e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(let e of o.children)w_(e)}function _x(o){if(o.meshes)for(let r of o.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(let r of o.children)_x(r)}class Uh{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){let f=a||e.findDEMTileFor(r);if(!f||!f.dem)return;let c=f.dem,p=f.tileID,v=1<<r.canonical.z-p.canonical.z;return new Uh(f,c.dim/ct/v,[(r.canonical.x/v-p.canonical.x)*c.dim,(r.canonical.y/v-p.canonical.y)*c.dim])}tileCoordToPixel(e,r){let a=r*this._scale+this._offset[1],f=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(a);return new at(f,c)}getElevationAt(e,r,a,f){let c=e*this._scale+this._offset[0],p=r*this._scale+this._offset[1],v=Math.floor(c),w=Math.floor(p),M=this._dem;return f=!!f,a?At(At(M.get(v,w,f),M.get(v,w+1,f),p-w),At(M.get(v+1,w,f),M.get(v+1,w+1,f),p-w),c-v):M.get(v,w,f)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*hi(1,e)*this._dem.stride}}let yx=new Float32Array(262144),nu=new Uint8Array(262144);function UI(o){let e=0;if(o.meshes)for(let r of o.meshes)e=Math.max(e,r.aabb.max[2]);if(o.children)for(let r of o.children)e=Math.max(e,UI(r));return e}function $I(o,e,r){if(o.meshes)for(let a of o.meshes){if(a.aabb.min[0]===1/0)continue;let f=wt.applyTransform(a.aabb,o.matrix);r.insert(e,f.min[0],f.min[1],f.max[0],f.max[1])}if(o.children)for(let a of o.children)$I(a,e,r)}let HI=["","wall","door","roof","window","lamp","logo"];class GI{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:UI(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new wt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,r=new wt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=wt.applyTransformFast(a.aabb,this.node.matrix),r.encapsulate(a.transformedAabb)),e++;this.aabb=r}return this.aabb}}class E_{constructor(e,r,a,f,c,p,v){this.id=a,this.layers=e,this.layerIds=this.layers.map(w=>w.fqid),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.modelTraits|=jh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=jh.HasMapboxMeshFeatures),c&&(this.modelTraits|=jh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let w of r)this.nodesInfo.push(new GI(w)),$I(w,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,r){for(let a of this.getNodesInfo()){let f=a.node;f.footprint&&r.push({footprint:f.footprint,id:e})}}update(e){let r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;let a=r?this.stateDependentLayers:this.layers;if(!si(e,this.states))for(let f of a)this.evaluate(f,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let r=this.getNodesInfo();for(let a of r){let f=a.node;this.uploaded?this.updatePbrBuffer(f):gx(f,e,!0)}for(let a of r)w_(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(let a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),r=!0);return r}needsReEvaluation(e,r,a){let f=e.transform.projectionOptions,c=e.style.getBrightness(),p=this.brightness!==c;if(!this.uploaded||this.dirty||f.name!==this.projection.name||Lp(a.paint.get("model-color").value,p)||Lp(a.paint.get("model-color-mix-intensity").value,p)||Lp(a.paint.get("model-roughness").value,p)||Lp(a.paint.get("model-emissive-strength").value,p)||Lp(a.paint.get("model-height-based-emissive-strength-multiplier").value,p)){this.projection=f,this.brightness=c;let v=this.getNodesInfo();for(let w of v)w.state=null;return!0}return!1}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let a=this.getNodesInfo(),f=this.id.canonical;for(let c of a){let p=c.feature;c.evaluatedScale=r.paint.get("model-scale").evaluate(p,{},f)}}evaluate(e,r){let a=this.getNodesInfo();for(let f of a){if(!f.node.meshes)continue;let c=f.feature,p=r&&r[c.id];if(si(p,f.state))continue;f.state=structuredClone(p);let v=f.node.meshes&&f.node.meshes[0].featureData,w=f.evaluatedColor[2],M=f.evaluatedRMEA[2],_=this.id.canonical;if(f.hasTranslucentParts=!1,v){for(let E=0;E<HI.length;E++){let D=HI[E];D.length&&(c.properties.part=D);let b=e.paint.get("model-color").evaluate(c,p,_).toRenderColor(null),T=e.paint.get("model-color-mix-intensity").evaluate(c,p,_);f.evaluatedColor[E]=[b.r,b.g,b.b,T],f.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(c,p,_),f.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(c,p,_),f.evaluatedRMEA[E][3]=b.a,f.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,p,_),!f.hasTranslucentParts&&b.a<1&&(f.hasTranslucentParts=!0)}delete c.properties.part,oO(f,w!==f.evaluatedColor[2]||M!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,p,_);f.evaluatedScale=e.paint.get("model-scale").evaluate(c,p,_),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,a,f){let c=e.findDEMTileFor(a);if(c&&(c.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;let p=Uh.create(e,a,c);if(!p)return;this.modelTraits&jh.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,f);for(let v of this.getNodesInfo()){let w=v.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;let M=w.footprint.vertices,_=p.getElevationAt(M[0].x,M[0].y,!0,!0);for(let E=1;E<M.length;E++)_=Math.min(_,p.getElevationAt(M[E].x,M[E].y,!0,!0));w.elevation=_}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,a,f){let c=r._dem._modifiedForSources[f];if(c===void 0&&(r._dem._modifiedForSources[f]=[],c=r._dem._modifiedForSources[f]),c.includes(a.canonical))return;let p=r._dem.dim;c.push(a.canonical);let v=!1;for(let w of this.getNodesInfo()){let M=w.node;if(!M.footprint||!M.footprint.grid)continue;let _=M.footprint.grid,E=r.tileCoordToPixel(_.min.x,_.min.y),D=r.tileCoordToPixel(_.max.x,_.max.y),b=Math.min(Math.min(p-D.y,E.x),Math.min(E.y,p-D.x));if(b<0)continue;let T=Yt(b,2,5),C=Math.max(0,E.x-T),O=Math.max(0,E.y-T),L=Math.min(D.x+T,p-1),B=Math.min(D.y+T,p-1);for(let q=O;q<=B;++q)for(let K=C;K<=L;++K)nu[q*p+K]=255;let j=0,z=0;for(let q=0;q<_.cellsY;++q)for(let K=0;K<_.cellsX;++K){if(!_.cells[q*_.cellsX+K])continue;let re=r.tileCoordToPixel(_.min.x+K/_.xScale,_.min.y+q/_.yScale),ne=r.tileCoordToPixel(_.min.x+(K+1)/_.xScale,_.min.y+(q+1)/_.yScale);for(let te=re.y;te<=Math.min(ne.y+1,p-1);++te)for(let pe=re.x;pe<=Math.min(ne.x+1,p-1);++pe)nu[te*p+pe]===255&&(nu[te*p+pe]=0,j+=r.getElevationAtPixel(pe,te),z++)}let U=j/z;C=Math.max(1,E.x-T),O=Math.max(1,E.y-T),L=Math.min(D.x+T,p-2),B=Math.min(D.y+T,p-2),v=!0;for(let q=O;q<=B;++q)for(let K=C;K<=L;++K)nu[q*p+K]===0&&(yx[q*p+K]=r._dem.set(K,q,U));for(let q=1;q<T;++q){C=Math.max(1,E.x-q),O=Math.max(1,E.y-q),L=Math.min(D.x+q,p-2),B=Math.min(D.y+q,p-2);for(let K=O;K<=B;++K)for(let re=C;re<=L;++re){let ne=K*p+re;if(nu[ne]===255){let te=0,pe=0,ie=-1,me=-1;for(let ye=-1;ye<=1;++ye)for(let _e=-1;_e<=1;++_e){let be=(K+ye)*p+re+_e;if(nu[be]>=q)continue;let Se=yx[be],Ae=Math.abs(Se);Ae>pe&&(te=Se,pe=Ae,ie=_e,me=ye)}if(pe>.1){let ye=1-(q+.5*Math.abs(ie*me))/T,_e=r._dem.get(re,K)+te*ye,be=r._dem.get(re+ie,K+me),Se=r._dem.get(re-ie,K-me,!0);(_e-be)*(_e-Se)>0&&(_e=(be+Se)/2),yx[ne]=r._dem.set(re,K,_e),nu[ne]=q}}}}}v&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=ue.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let r of e)w_(r.node),_x(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;let a=r.getReplacementRegionsForTile(e.toUnwrapped()),f=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){let p=f[c].node;f[c].hiddenByReplacement=!!p.footprint&&!a.find(v=>v.footprint===p.footprint)}}getHeightAtTileCoord(e,r){let a=this.getNodesInfo(),f=[],c=[0,0,0],p=Ee.mat4.identity([]);for(let v=0;v<this.nodesInfo.length;v++){let w=a[v],M=w.node.meshes[0],_=M.transformedAabb;if(e<_.min[0]||r<_.min[1]||e>_.max[0]||r>_.max[1])continue;if(w.node.hidden===!0)return{height:1/0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};Ee.mat4.invert(p,w.node.matrix),c[0]=e,c[1]=r,Ee.vec3.transformMat4(c,c,p);let E=(c[0]-M.aabb.min[0])/(M.aabb.max[0]-M.aabb.min[0])*tu|0,D=Math.min(63,(c[1]-M.aabb.min[1])/(M.aabb.max[1]-M.aabb.min[1])*tu|0)*tu+Math.min(63,E),b=M.heightmap[D];if(!(b<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:b,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new at(e,r),new at(e,r),f),f.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function Lp(o,e){return!o.isLightConstant&&e}function iO(o,e,r,a,f,c,p,v){let w=(61440&e|(61440&e)>>4)>>8,M=(3840&e|(3840&e)>>4)>>4,_=240&e|(240&e)>>4;r[3]>0&&(w=At(w,255*r[0],r[3]),M=At(M,255*r[1],r[3]),_=At(_,255*r[2],r[3]));let E=w<<8|M,D=_<<8|Math.floor(255*a[3]),b=function(q){let K=Yt(q,0,2);return Math.min(Math.round(.5*K*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],T=Yt(f[0],0,1),C=Yt(f[1],0,1),O=Yt(f[2],0,1),L=Yt(f[3],0,1),B,j,z,U;if(T!==C&&p!==c&&C!==T){let q=p-c;j=1/(q*(C-T)),z=-(c+q*T)/(q*(C-T));let K=Yt(f[4],-1,1);U=Math.pow(10,K),B=255*O<<8|255*L}else B=65535,j=0,z=1,U=1;if(o.emplaceBack(E,D,b,B,j,z,U),v){let q=v.length;v.clear();for(let K=0;K<q;K++)v.emplaceBack(E,D,b,B,j,z,U)}}function oO(o,e,r){let a=o.node,f=0,c=r&jh.HasMeshoptCompression;for(let p of a.meshes){if(a.lights&&a.lightMeshIndex===f||!p.featureData)continue;p.featureArray=new $c,p.featureArray.reserve(p.featureData.length);let v=e;for(let w of p.featureData){let M=c?65535&w:w>>16&65535,_=c?w>>16&65535:65535&w,E=(15&_)<8?15&_:0,D=o.evaluatedRMEA[E],b=o.evaluatedColor[E],T=o.emissionHeightBasedParams[E],C;if(v&&E===2&&a.lights&&(C=new $c,C.resize(10*a.lights.length)),iO(p.featureArray,M,b,D,T,p.aabb.min[2],p.aabb.max[2],C),C&&v){v=!1;let O=a.meshes[a.lightMeshIndex];O.featureArray=C,O.featureArray._trim()}}p.featureArray._trim(),f++}}function qI(o,e,r,a){let f=1<<o.z;e.lat=jr((a/ct+o.y)/f),e.lng=Pi((r/ct+o.x)/f)}_t(E_,"Tiled3dModelBucket",{omit:["layers"]}),_t(GI,"Tiled3dModelFeature");let sO={circle:class extends kr{constructor(o,e,r,a){super(o,{layout:Qe||(Qe=new er({"circle-sort-key":new ft(Pe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new nt(Pe.layout_circle["circle-elevation-reference"]),visibility:new nt(Pe.layout_circle.visibility)})),paint:De||(De=new er({"circle-radius":new ft(Pe.paint_circle["circle-radius"]),"circle-color":new ft(Pe.paint_circle["circle-color"]),"circle-blur":new ft(Pe.paint_circle["circle-blur"]),"circle-opacity":new ft(Pe.paint_circle["circle-opacity"]),"circle-translate":new nt(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new nt(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nt(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nt(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ft(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ft(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ft(Pe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new nt(Pe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}createBucket(o){return new Z(o)}queryRadius(o){let e=o;return Ge("circle-radius",this,e)+Ge("circle-stroke-width",this,e)+He(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,r,a,f,c,p,v){let w=Ve(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Oh(o,a,c,p,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,M)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,r){let a=Bl(this);return{config:new Sa(this,{zoom:e,lut:r}),defines:a,overrideFog:!1}}},heatmap:class extends kr{createBucket(o){return new TE(o)}constructor(o,e,r,a){super(o,{layout:IE||(IE=new er({visibility:new nt(Pe.layout_heatmap.visibility)})),paint:SE||(SE=new er({"heatmap-radius":new ft(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ft(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nt(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Al(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nt(Pe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Ge("heatmap-radius",this,o)}queryIntersectsFeature(o,e,r,a,f,c,p,v){let w=this.paint.get("heatmap-radius").evaluate(e,r);return Oh(o,a,c,p,v,!0,!0,new at(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,r){return o==="heatmap"?{config:new Sa(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends kr{constructor(o,e,r,a){super(o,{layout:DE||(DE=new er({visibility:new nt(Pe.layout_hillshade.visibility)})),paint:ME||(ME=new er({"hillshade-illumination-direction":new nt(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nt(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nt(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nt(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nt(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nt(Pe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new nt(Pe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,r){return{overrideFog:!1}}},fill:class extends kr{constructor(o,e,r,a){super(o,{layout:NE||(NE=new er({"fill-sort-key":new ft(Pe.layout_fill["fill-sort-key"]),visibility:new nt(Pe.layout_fill.visibility),"fill-elevation-reference":new nt(Pe.layout_fill["fill-elevation-reference"])})),paint:zE||(zE=new er({"fill-antialias":new nt(Pe.paint_fill["fill-antialias"]),"fill-opacity":new ft(Pe.paint_fill["fill-opacity"]),"fill-color":new ft(Pe.paint_fill["fill-color"]),"fill-outline-color":new ft(Pe.paint_fill["fill-outline-color"]),"fill-translate":new nt(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new nt(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ft(Pe.paint_fill["fill-pattern"]),"fill-emissive-strength":new nt(Pe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ft(Pe.paint_fill["fill-z-offset"]),"fill-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}getProgramIds(){let o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(o,e,r){return{config:new Sa(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);let r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new L0(o)}queryRadius(){return He(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,r,a,f,c){return!o.queryGeometry.isAboveHorizon&&X(Me(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends kr{constructor(o,e,r,a){super(o,{layout:vT||(vT=new er({visibility:new nt(Pe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new nt(Pe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:xT||(xT=new er({"fill-extrusion-opacity":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new nt(Pe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new e_(o)}queryRadius(){return He(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,r,a,f,c,p,v,w){let M=Ve(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(e,r),E=this.paint.get("fill-extrusion-base").evaluate(e,r),D=[0,0],b=v&&c.elevation,T=c.elevation?c.elevation.exaggeration():1,C=o.tile.getBucket(this);if(b&&C instanceof e_){let z=C.centroidVertexArray,U=w+1;U<z.length&&(D[0]=z.geta_centroid_pos0(U),D[1]=z.geta_centroid_pos1(U))}if(D[0]===0&&D[1]===1)return!1;c.projection.name==="globe"&&(a=yT([a],[new at(0,0),new at(ct,ct)],o.tileID.canonical).map(z=>z.polygon).flat());let O=b?v:null,[L,B]=function(z,U,q,K,re,ne,te,pe,ie,me,ye){return z.projection.name==="globe"?function(_e,be,Se,Ae,Ie,$e,Ke,Ue,ut,lt,tt){let Je=[],xt=[],ht=_e.projection.upVectorScale(tt,_e.center.lat,_e.worldSize).metersToTile,mt=[0,0,0,1],Lt=[0,0,0,1],Ht=(Zt,en,rn,$n)=>{Zt[0]=en,Zt[1]=rn,Zt[2]=$n,Zt[3]=1},Wt=_T();Se>0&&(Se+=Wt),Ae+=Wt;for(let Zt of be){let en=[],rn=[];for(let $n of Zt){let On=$n.x+Ie.x,zt=$n.y+Ie.y,In=_e.projection.projectTilePoint(On,zt,tt),Rn=_e.projection.upVector(tt,$n.x,$n.y),Yn=Se,gr=Ae;if(Ke){let Sr=wT(On,zt,Se,Ae,Ke,Ue,ut,lt);Yn+=Sr.base,gr+=Sr.top}Se!==0?Ht(mt,In.x+Rn[0]*ht*Yn,In.y+Rn[1]*ht*Yn,In.z+Rn[2]*ht*Yn):Ht(mt,In.x,In.y,In.z),Ht(Lt,In.x+Rn[0]*ht*gr,In.y+Rn[1]*ht*gr,In.z+Rn[2]*ht*gr),Ee.vec3.transformMat4(mt,mt,$e),Ee.vec3.transformMat4(Lt,Lt,$e),en.push(new eu(mt[0],mt[1],mt[2])),rn.push(new eu(Lt[0],Lt[1],Lt[2]))}Je.push(en),xt.push(rn)}return[Je,xt]}(z,U,q,K,re,ne,te,pe,ie,me,ye):te?function(_e,be,Se,Ae,Ie,$e,Ke,Ue,ut){let lt=[],tt=[],Je=[0,0,0,1];for(let xt of _e){let ht=[],mt=[];for(let Lt of xt){let Ht=Lt.x+Ae.x,Wt=Lt.y+Ae.y,Zt=wT(Ht,Wt,be,Se,$e,Ke,Ue,ut);Je[0]=Ht,Je[1]=Wt,Je[2]=Zt.base,Je[3]=1,Ee.vec4.transformMat4(Je,Je,Ie),Je[3]=Math.max(Je[3],1e-5);let en=new eu(Je[0]/Je[3],Je[1]/Je[3],Je[2]/Je[3]);Je[0]=Ht,Je[1]=Wt,Je[2]=Zt.top,Je[3]=1,Ee.vec4.transformMat4(Je,Je,Ie),Je[3]=Math.max(Je[3],1e-5);let rn=new eu(Je[0]/Je[3],Je[1]/Je[3],Je[2]/Je[3]);ht.push(en),mt.push(rn)}lt.push(ht),tt.push(mt)}return[lt,tt]}(U,q,K,re,ne,te,pe,ie,me):function(_e,be,Se,Ae,Ie){let $e=[],Ke=[],Ue=Ie[8]*be,ut=Ie[9]*be,lt=Ie[10]*be,tt=Ie[11]*be,Je=Ie[8]*Se,xt=Ie[9]*Se,ht=Ie[10]*Se,mt=Ie[11]*Se;for(let Lt of _e){let Ht=[],Wt=[];for(let Zt of Lt){let en=Zt.x+Ae.x,rn=Zt.y+Ae.y,$n=Ie[0]*en+Ie[4]*rn+Ie[12],On=Ie[1]*en+Ie[5]*rn+Ie[13],zt=Ie[2]*en+Ie[6]*rn+Ie[14],In=Ie[3]*en+Ie[7]*rn+Ie[15],Rn=$n+Ue,Yn=On+ut,gr=zt+lt,Sr=Math.max(In+tt,1e-5),_r=$n+Je,ar=On+xt,br=zt+ht,Cr=Math.max(In+mt,1e-5);Ht.push(new eu(Rn/Sr,Yn/Sr,gr/Sr)),Wt.push(new eu(_r/Cr,ar/Cr,br/Cr))}$e.push(Ht),Ke.push(Wt)}return[$e,Ke]}(U,q,K,re,ne)}(c,a,E,_,M,p,O,D,T,c.center.lat,o.tileID.canonical),j=o.queryGeometry;return function(z,U,q){let K=1/0;X(q,U)&&(K=bT(q,U[0]));for(let re=0;re<U.length;re++){let ne=U[re],te=z[re];for(let pe=0;pe<ne.length-1;pe++){let ie=ne[pe],me=[ie,ne[pe+1],te[pe+1],te[pe],ie];G(q,me)&&(K=Math.min(K,bT(q,me)))}}return K!==1/0&&K}(L,B,j.isPointQuery()?j.screenBounds:j.screenGeometry)}},line:class extends kr{constructor(o,e,r,a){let f=PT();super(o,f,e,r,a),f.layout&&(this.layout=new Cl(f.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof vl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(bp)return bp;let r=PT();return bp=new cP(r.paint.properties["line-width"].specification),bp.useIntegerZoom=!0,bp})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new H0(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,r){let a=AT(this);return{config:new Sa(this,{zoom:e,lut:r}),defines:a,overrideFog:!1}}queryRadius(o){let e=o,r=OT(Ge("line-width",this,e),Ge("line-gap-width",this,e)),a=Ge("line-offset",this,e);return r/2+Math.abs(a)+He(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,r,a,f,c){if(o.queryGeometry.isAboveHorizon)return!1;let p=Me(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),v=o.pixelToTileUnitsFactor/2*OT(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),w=this.paint.get("line-offset").evaluate(e,r);return w&&(a=function(M,_){let E=[],D=new at(0,0);for(let b=0;b<M.length;b++){let T=M[b],C=[];for(let O=0;O<T.length;O++){let L=T[O],B=T[O+1],j=O===0?D:L.sub(T[O-1])._unit()._perp(),z=O===T.length-1?D:B.sub(L)._unit()._perp(),U=j._add(z)._unit();U._mult(1/(U.x*z.x+U.y*z.y)),C.push(U._mult(_)._add(L))}E.push(C)}return E}(a,w*o.pixelToTileUnitsFactor)),function(M,_,E){for(let D=0;D<_.length;D++){let b=_[D];if(M.length>=3){for(let T=0;T<b.length;T++)if(le(M,b[T]))return!0}if(ee(M,b,E))return!0}return!1}(p,a,v)}isTileClipped(){return!0}isDraped(o){return!this.hasElevatedBuckets}},symbol:m_,background:class extends kr{constructor(o,e,r,a){super(o,{layout:_I||(_I=new er({visibility:new nt(Pe.layout_background.visibility)})),paint:yI||(yI=new er({"background-pitch-alignment":new nt(Pe.paint_background["background-pitch-alignment"]),"background-color":new nt(Pe.paint_background["background-color"]),"background-pattern":new nt(Pe.paint_background["background-pattern"]),"background-opacity":new nt(Pe.paint_background["background-opacity"]),"background-emissive-strength":new nt(Pe.paint_background["background-emissive-strength"]),"background-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,r){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:EI,"raster-particle":CI,sky:class extends kr{constructor(o,e,r,a){super(o,{layout:SI||(SI=new er({visibility:new nt(Pe.layout_sky.visibility)})),paint:DI||(DI=new er({"sky-type":new nt(Pe.paint_sky["sky-type"]),"sky-atmosphere-sun":new nt(Pe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new nt(Pe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new nt(Pe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new nt(Pe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Al(Pe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new nt(Pe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new nt(Pe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new nt(Pe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=dp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),f=!a,c=o.style.light,p=c.properties.get("position");return f&&c.properties.get("anchor")==="viewport"&&qt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?dx(p.azimuthal,90-p.polar,e):dx(a[0],90-a[1],e)}let r=this.paint.get("sky-gradient-center");return dx(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends kr{constructor(o,e,r,a){super(o,{paint:MI||(MI=new er({}))},e,null)}},model:class extends kr{constructor(o,e,r,a){super(o,{layout:BI||(BI=new er({visibility:new nt(Pe.layout_model.visibility),"model-id":new ft(Pe.layout_model["model-id"])})),paint:VI||(VI=new er({"model-opacity":new ft(Pe.paint_model["model-opacity"]),"model-rotation":new ft(Pe.paint_model["model-rotation"]),"model-scale":new ft(Pe.paint_model["model-scale"]),"model-translation":new ft(Pe.paint_model["model-translation"]),"model-color":new ft(Pe.paint_model["model-color"]),"model-color-mix-intensity":new ft(Pe.paint_model["model-color-mix-intensity"]),"model-type":new nt(Pe.paint_model["model-type"]),"model-cast-shadows":new nt(Pe.paint_model["model-cast-shadows"]),"model-receive-shadows":new nt(Pe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new nt(Pe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ft(Pe.paint_model["model-emissive-strength"]),"model-roughness":new ft(Pe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ft(Pe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new nt(Pe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new nt(Pe.paint_model["model-front-cutoff"]),"model-color-use-theme":new ft({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new mx(o)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof E_?ct-1:0}queryIntersectsFeature(o,e,r,a,f,c){if(!this.modelManager)return!1;let p=this.modelManager,v=o.tile.getBucket(this);if(!(v&&v instanceof mx))return!1;for(let w in v.instancesPerModel){let M=v.instancesPerModel[w],_=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(_)){let E=M.features[M.idToFeaturesIndex[_]],D=p.getModel(w,this.scope);if(!D)return!1;let b=Ee.mat4.create(),T=new mn(0,0),C=v.canonical,O=Number.MAX_VALUE;for(let L=0;L<E.instancedDataCount;++L){let B=16*(E.instancedDataOffset+L),j=M.instancedDataArray.float32,z=[j[B+4],j[B+5],j[B+6]];qI(C,T,j[B],0|j[B+1]),jI(b,D,c,T,E.rotation,E.scale,z,!1,!1,!1),c.projection.name==="globe"&&(b=px(b,c));let U=Ee.mat4.multiply([],c.projMatrix,b),q=o.queryGeometry,K=LI(q.isPointQuery()?q.screenBounds:q.screenGeometry,c,U,D.aabb);K!=null&&(O=Math.min(K,O))}return O!==Number.MAX_VALUE&&O}}return!1}_handleOverridablePaintPropertyUpdate(o,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){let e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Rc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends kr{constructor(o,e,r,a){super(o,{layout:BE||(BE=new er({"clip-layer-types":new nt(Pe.layout_clip["clip-layer-types"]),"clip-layer-scope":new nt(Pe.layout_clip["clip-layer-scope"])})),paint:VE||(VE=new er({}))},e,r,a)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new jE(o)}isTileClipped(){return!0}is3D(){return!0}}};class aO{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class lO{constructor(){this.tasks={},this.taskQueue=[],al(["process"],this),this.invoker=new aO(this.process),this.nextId=0}add(e,r){let a=this.nextId++,f=function({type:c,isSymbolTile:p,zoom:v}){return v=v||0,c==="message"?0:c!=="maybePrepare"||p?c!=="parseTile"||p?c==="parseTile"&&p?300-v:c==="maybePrepare"&&p?400-v:500:200-v:100-v}(r);if(f===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:r,priority:f,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let f=0;f<this.taskQueue.length;f++){let c=this.tasks[this.taskQueue[f]];c.priority<r&&(r=c.priority,e=f)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class WI{constructor(e,r,a){this.target=e,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},al(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new lO}send(e,r,a,f,c=!1,p){let v=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[v]=a);let w=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!a,targetMapId:f,mustQueue:c,sourceMapId:this.mapId,data:Vs(r,w)},w),{cancel:()=>{a&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(e){let r=e.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){let f=this.cancelCallbacks[a];delete this.cancelCallbacks[a],f&&f.cancel()}else if(r.mustQueue||ns()){let f=this.callbacks[a],c=this.scheduler.add(()=>this.processTask(a,r),f&&f.metadata||{type:"message"});c&&(this.cancelCallbacks[a]=c)}else this.processTask(a,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){let a=this.callbacks[e];delete this.callbacks[e],a&&(r.error?a(ba(r.error)):a(null,ba(r.data)))}else{let a=new Set,f=r.hasCallback?(p,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?Vs(p):null,data:Vs(v,a)},a)}:()=>{},c=ba(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,c,f);else if(this.parent.getWorkerSource){let p=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,p[0],c.source,c.scope)[p[1]](c,f)}else f(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var kp={workerUrl:"",workerClass:null,workerParams:void 0};let vx="mapboxgl_preloaded_worker_pool",T_=(()=>{class o{constructor(){this.active={}}acquire(r,a=o.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(kp.workerClass!=null?new kp.workerClass:new self.Worker(kp.workerUrl,kp.workerParams));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[vx]}numActive(){return Object.keys(this.active).length}}return o.workerCount=2,o})();class $h{constructor(e,r,a="Worker",f=T_.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=sa();let c=this.workerPool.acquire(this.id,f);for(let p=0;p<c.length;p++){let v=new $h.Actor(c[p],r,this.id);v.name=`${a} ${p}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,a){Os(this.actors,(f,c)=>{f.send(e,r,c)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Fp,xx;function I_(){return Fp||(Fp=new T_),Fp}$h.Actor=WI;let bx=new vn(0,0,0);var wx=(o=>(o[o.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",o[o.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",o[o.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",o))(wx||{}),S_=(o=>(o[o.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",o[o.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",o[o.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",o[o.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",o))(S_||{}),Np=(o=>(o[o.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",o[o.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",o[o.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",o[o.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",o[o.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",o))(Np||{}),ZI=(o=>(o[o.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",o[o.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",o[o.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",o))(ZI||{}),Hh=(o=>(o[o.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",o[o.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",o[o.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",o[o.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",o[o.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",o[o.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",o))(Hh||{}),XI=(o=>(o[o.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",o[o.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",o[o.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",o))(XI||{});function cO(o,e,r){o===1&&e.icons.push(function(a,f){return function(c){if(c.usvg_tree.height||(c.usvg_tree.height=c.usvg_tree.width),!c.metadata)return c;let{metadata:p}=c;if(p.content_area){let{content_area:v}=p;v.top==null&&(v.top=v.left),v.width==null&&(v.width=c.usvg_tree.width),v.height==null&&(v.height=v.width)}return p.stretch_x&&p.stretch_x.length&&YI(p,"x"),p.stretch_y&&p.stretch_y.length&&YI(p,"y"),c}(a.readFields(uO,{name:void 0},f))}(r,r.readVarint()+r.pos))}function YI(o,e){let r=[],a=o[`stretch_${e}`],f=null;for(let c=0;c<a.length;c++)f===null?f=r.length===0?a[0]:r[r.length-1][1]+a[c]:(r.push([f,f+a[c]]),f=null);o[`stretch_${e}_areas`]=r}function uO(o,e,r){o===1?e.name=r.readString():o===2?e.metadata=function(a,f){return a.readFields(hO,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},f)}(r,r.readVarint()+r.pos):o===3&&(e.usvg_tree=function(a,f){return a.readFields(pO,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},f)}(r,r.readVarint()+r.pos),e.data="usvg_tree")}function hO(o,e,r){o===1?e.stretch_x=r.readPackedVarint():o===2?e.stretch_y=r.readPackedVarint():o===3?e.content_area=function(a,f){return a.readFields(dO,{left:0},f)}(r,r.readVarint()+r.pos):o===4&&e.variables.push(function(a,f){return a.readFields(fO,{name:void 0},f)}(r,r.readVarint()+r.pos))}function dO(o,e,r){o===1?e.left=r.readVarint():o===2?e.width=r.readVarint():o===3?e.top=r.readVarint():o===4&&(e.height=r.readVarint())}function fO(o,e,r){o===1?e.name=r.readString():o===2&&(e.rgb_color=C_(r.readVarint()),e.value="rgb_color")}function pO(o,e,r){o===1?e.width=e.height=r.readVarint():o===2?e.height=r.readVarint():o===3?e.children.push(D_(r,r.readVarint()+r.pos)):o===4?e.linear_gradients.push(function(a,f){return a.readFields(bO,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},f)}(r,r.readVarint()+r.pos)):o===5?e.radial_gradients.push(function(a,f){return a.readFields(EO,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},f)}(r,r.readVarint()+r.pos)):o===7?e.clip_paths.push(function(a,f){return a.readFields(TO,{children:[]},f)}(r,r.readVarint()+r.pos)):o===8&&e.masks.push(function(a,f){let c=a.readFields(IO,{left:0,width:20,mask_type:1,children:[]},f);return c.height==null&&(c.height=c.width),c.top==null&&(c.top=c.left),c}(r,r.readVarint()+r.pos))}function D_(o,e){return o.readFields(mO,{},e)}function mO(o,e,r){o===1?(e.group=function(a,f){return a.readFields(gO,{opacity:255,children:[]},f)}(r,r.readVarint()+r.pos),e.node="group"):o===2&&(e.path=function(a,f){return a.readFields(yO,{paint_order:1,commands:[],step:1,diffs:[],rule:1},f)}(r,r.readVarint()+r.pos),e.node="path")}function gO(o,e,r){o===1?e.transform=M_(r,r.readVarint()+r.pos):o===2?e.opacity=r.readVarint():o===5?e.clip_path_idx=r.readVarint():o===6?e.mask_idx=r.readVarint():o===7&&e.children.push(D_(r,r.readVarint()+r.pos))}function M_(o,e){return o.readFields(_O,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function _O(o,e,r){o===1?e.sx=r.readFloat():o===2?e.ky=r.readFloat():o===3?e.kx=r.readFloat():o===4?e.sy=r.readFloat():o===5?e.tx=r.readFloat():o===6&&(e.ty=r.readFloat())}function yO(o,e,r){o===1?e.fill=function(a,f){return a.readFields(vO,{rgb_color:bx,paint:"rgb_color",opacity:255},f)}(r,r.readVarint()+r.pos):o===2?e.stroke=function(a,f){return a.readFields(xO,{rgb_color:bx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},f)}(r,r.readVarint()+r.pos):o===3?e.paint_order=r.readVarint():o===5?r.readPackedVarint(e.commands):o===6?e.step=r.readFloat():o===7?r.readPackedSVarint(e.diffs):o===8&&(e.rule=r.readVarint())}function vO(o,e,r){o===1?(e.rgb_color=C_(r.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=r.readVarint())}function C_(o){return new vn((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function xO(o,e,r){o===1?(e.rgb_color=C_(r.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):o===5?r.readPackedFloat(e.dasharray):o===6?e.dashoffset=r.readFloat():o===7?e.miterlimit=r.readFloat():o===8?e.opacity=r.readVarint():o===9?e.width=r.readFloat():o===10?e.linecap=r.readVarint():o===11&&(e.linejoin=r.readVarint())}function bO(o,e,r){o===1?e.transform=M_(r,r.readVarint()+r.pos):o===2?e.spread_method=r.readVarint():o===3?e.stops.push(KI(r,r.readVarint()+r.pos)):o===4?e.x1=r.readFloat():o===5?e.y1=r.readFloat():o===6?e.x2=r.readFloat():o===7&&(e.y2=r.readFloat())}function KI(o,e){return o.readFields(wO,{offset:0,opacity:255,rgb_color:bx},e)}function wO(o,e,r){o===1?e.offset=r.readFloat():o===2?e.opacity=r.readVarint():o===3&&(e.rgb_color=C_(r.readVarint()))}function EO(o,e,r){o===1?e.transform=M_(r,r.readVarint()+r.pos):o===2?e.spread_method=r.readVarint():o===3?e.stops.push(KI(r,r.readVarint()+r.pos)):o===4?e.cx=r.readFloat():o===5?e.cy=r.readFloat():o===6?e.r=r.readFloat():o===7?e.fx=r.readFloat():o===8?e.fy=r.readFloat():o===9&&(e.fr=r.readFloat())}function TO(o,e,r){o===1?e.transform=M_(r,r.readVarint()+r.pos):o===2?e.clip_path_idx=r.readVarint():o===3&&e.children.push(D_(r,r.readVarint()+r.pos))}function IO(o,e,r){o===1?e.left=e.top=r.readFloat():o===2?e.width=e.height=r.readFloat():o===3?e.top=r.readFloat():o===4?e.height=r.readFloat():o===5?e.mask_type=r.readVarint():o===6?e.mask_idx=r.readVarint():o===7&&e.children.push(D_(r,r.readVarint()+r.pos))}class SO{static calculate(e,r){let a=new Map,f=new Map;if(Object.keys(e).length===0)return a;r.forEach(c=>{f.set(c.name,c.rgb_color||new vn(0,0,0))});for(let[c,p]of Object.entries(e))f.has(c)?a.set(f.get(c).toStringPremultipliedAlpha(),p):console.warn(`Ignoring unknown image variable "${c}"`);return a}}function Gh(o,e=255,r){let a=e/255,f=o.toStringPremultipliedAlpha(),c=r.has(f)?r.get(f).clone():o.clone();return c.a=a,c.toString()}function zp(o,e){if(!Q()){let r=document.createElement("canvas");return r.width=o,r.height=e,r}return new OffscreenCanvas(o,e)}function DO(o,e){let r=SO.calculate(e.params,o.metadata?o.metadata.variables:[]),a=o.usvg_tree,f=a.width,c=a.height,p=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(f*p.a)),w=Math.max(1,Math.round(c*p.d)),M=new DOMMatrix([v/f,0,0,w/c,0,0]),_=zp(v,w).getContext("2d");return Ex(_,M,a,a,r),_.getImageData(0,0,v,w)}function Ex(o,e,r,a,f){for(let c of a.children)JI(o,e,r,c,f)}function JI(o,e,r,a,f){a.group?(o.save(),function(c,p,v,w,M){let _=w.mask_idx!=null?v.masks[w.mask_idx]:null,E=w.clip_path_idx!=null?v.clip_paths[w.clip_path_idx]:null;if(w.transform&&(p=A_(w.transform).preMultiplySelf(p)),!function(T,C,O){return T.opacity!==255||C||O}(w,E!=null,_!=null))return void Ex(c,p,v,w,M);let D=zp(c.canvas.width,c.canvas.height),b=D.getContext("2d");Ex(b,p,v,w,M),E&&oS(b,p,v,E),_&&sS(b,p,v,_,M),c.globalAlpha=w.opacity/255,c.drawImage(D,0,0)}(o,e,r,a.group,f),o.restore()):a.path&&(o.save(),function(c,p,v,w,M){let _=aS(w);c.setTransform(p),w.paint_order===ZI.PAINT_ORDER_FILL_AND_STROKE?(QI(c,v,w,_,M),tS(c,v,w,_,M)):(tS(c,v,w,_,M),QI(c,v,w,_,M))}(o,e,r,a.path,f),o.restore())}function QI(o,e,r,a,f){let c=r.fill;if(!c)return;let p=c.opacity/255;switch(c.paint){case"rgb_color":o.fillStyle=Gh(c.rgb_color,c.opacity,f);break;case"linear_gradient_idx":o.fillStyle=nS(o,e.linear_gradients[c.linear_gradient_idx],p,f);break;case"radial_gradient_idx":o.fillStyle=rS(o,e.radial_gradients[c.radial_gradient_idx],p,f)}o.fill(a,eS(r))}function eS(o){return o.rule===wx.PATH_RULE_NON_ZERO?"nonzero":o.rule===wx.PATH_RULE_EVEN_ODD?"evenodd":void 0}function tS(o,e,r,a,f){let c=r.stroke;if(!c)return;o.lineWidth=c.width,o.miterLimit=c.miterlimit,o.setLineDash(c.dasharray),o.lineDashOffset=c.dashoffset;let p=c.opacity/255;switch(c.paint){case"rgb_color":o.strokeStyle=Gh(c.rgb_color,c.opacity,f);break;case"linear_gradient_idx":o.strokeStyle=nS(o,e.linear_gradients[c.linear_gradient_idx],p,f);break;case"radial_gradient_idx":o.strokeStyle=rS(o,e.radial_gradients[c.radial_gradient_idx],p,f)}switch(c.linejoin){case Np.LINE_JOIN_MITER_CLIP:case Np.LINE_JOIN_MITER:o.lineJoin="miter";break;case Np.LINE_JOIN_ROUND:o.lineJoin="round";break;case Np.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(c.linecap){case S_.LINE_CAP_BUTT:o.lineCap="butt";break;case S_.LINE_CAP_ROUND:o.lineCap="round";break;case S_.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(a)}function nS(o,e,r,a){if(e.stops.length===1){let D=e.stops[0];return Gh(D.rgb_color,D.opacity*r,a)}let f=A_(e.transform),{x1:c,y1:p,x2:v,y2:w}=e,M=f.transformPoint(new DOMPoint(c,p)),_=f.transformPoint(new DOMPoint(v,w)),E=o.createLinearGradient(M.x,M.y,_.x,_.y);for(let D of e.stops)E.addColorStop(D.offset,Gh(D.rgb_color,D.opacity*r,a));return E}function rS(o,e,r,a){if(e.stops.length===1){let D=e.stops[0];return Gh(D.rgb_color,D.opacity*r,a)}let f=A_(e.transform),{fx:c,fy:p,cx:v,cy:w}=e,M=f.transformPoint(new DOMPoint(c,p)),_=f.transformPoint(new DOMPoint(v,w)),E=o.createRadialGradient(M.x,M.y,0,_.x,_.y,e.r*((f.a+f.d)/2));for(let D of e.stops)E.addColorStop(D.offset,Gh(D.rgb_color,D.opacity*r,a));return E}function iS(o,e,r,a){let f=a.transform?A_(a.transform).preMultiplySelf(e):e,c=zp(o.canvas.width,o.canvas.height),p=c.getContext("2d");for(let w of a.children)if(w.group)iS(p,f,r,w.group);else if(w.path){let M=w.path,_=new Path2D;_.addPath(aS(M),f),p.fill(_,eS(M))}let v=a.clip_path_idx!=null?r.clip_paths[a.clip_path_idx]:null;v&&oS(p,f,r,v),o.globalCompositeOperation="source-over",o.drawImage(c,0,0)}function oS(o,e,r,a){let f=zp(o.canvas.width,o.canvas.height);iS(f.getContext("2d"),e,r,a),o.globalCompositeOperation="destination-in",o.drawImage(f,0,0)}function sS(o,e,r,a,f){if(a.children.length===0)return;let c=a.mask_idx!=null?r.masks[a.mask_idx]:null;c&&sS(o,e,r,c,f);let p=o.canvas.width,v=o.canvas.height,w=zp(p,v),M=w.getContext("2d"),_=a.width,E=a.height,D=a.left,b=a.top,T=new Path2D,C=new Path2D;C.rect(D,b,_,E),T.addPath(C,e),M.clip(T);for(let B of a.children)JI(M,e,r,B,f);let O=M.getImageData(0,0,p,v),L=O.data;if(a.mask_type===XI.MASK_TYPE_LUMINANCE)for(let B=0;B<L.length;B+=4)L[B+3]=L[B+3]/255*(.2126*L[B]+.7152*L[B+1]+.0722*L[B+2]);M.putImageData(O,0,0),o.globalCompositeOperation="destination-in",o.drawImage(w,0,0)}function A_(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function aS(o){let e=new Path2D,r=o.step,a=o.diffs[0]*r,f=o.diffs[1]*r;e.moveTo(a,f);for(let c=0,p=2;c<o.commands.length;c++)switch(o.commands[c]){case Hh.PATH_COMMAND_MOVE:a+=o.diffs[p++]*r,f+=o.diffs[p++]*r,e.moveTo(a,f);break;case Hh.PATH_COMMAND_LINE:a+=o.diffs[p++]*r,f+=o.diffs[p++]*r,e.lineTo(a,f);break;case Hh.PATH_COMMAND_QUAD:{let v=a+o.diffs[p++]*r,w=f+o.diffs[p++]*r;a=v+o.diffs[p++]*r,f=w+o.diffs[p++]*r,e.quadraticCurveTo(v,w,a,f);break}case Hh.PATH_COMMAND_CUBIC:{let v=a+o.diffs[p++]*r,w=f+o.diffs[p++]*r,M=v+o.diffs[p++]*r,_=w+o.diffs[p++]*r;a=M+o.diffs[p++]*r,f=_+o.diffs[p++]*r,e.bezierCurveTo(v,w,M,_,a,f);break}case Hh.PATH_COMMAND_CLOSE:e.closePath()}return e}class Tx{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}delete(e){this.cache.delete(e)}}class Ix{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new qr(e,e.data)}getFromCache(e,r,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new Tx(150)),this.cacheMap.get(a).get(Lo(e.serialize(),r))}setInCache(e,r,a,f){this.cacheDependenciesMap.has(f)||this.cacheDependenciesMap.set(f,new Map),this.cacheMap.has(f)||this.cacheMap.set(f,new Tx(150));let c=this.cacheDependenciesMap.get(f);c.get(Lo(e.id,a))||c.set(Lo(e.id,a),new Set);let p=this.cacheMap.get(f),v=e.serialize();c.get(Lo(e.id,a)).add(v),p.put(Lo(e.serialize(),a),r)}removeImagesFromCacheByIds(e,r,a=""){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;let f=this.cacheMap.get(a),c=this.cacheDependenciesMap.get(a);for(let p of e)if(c.has(Lo(p,r))){for(let v of c.get(Lo(p,r)))f.delete(v);c.delete(Lo(p,r))}}rasterize(e,r,a,f,c=DO){let p=this.getFromCache(e,a,f);if(p)return p.clone();let v=c(r.icon,e.options),w=Ix._getImage(v);return this.setInCache(e,w,a,f),w.clone()}}class lS{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){let a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function cS(o,e,r,a){let f=0,c=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(r[p]<o[p]||r[p]>e[p])return null}else{let v=1/a[p],w=(o[p]-r[p])*v,M=(e[p]-r[p])*v;if(w>M){let _=w;w=M,M=_}if(w>f&&(f=w),M<c&&(c=M),f>c)return null}return f}function uS(o,e,r,a,f,c,p,v,w,M,_){let E=a-o,D=f-e,b=c-r,T=p-o,C=v-e,O=w-r,L=_[1]*O-_[2]*C,B=_[2]*T-_[0]*O,j=_[0]*C-_[1]*T,z=E*L+D*B+b*j;if(Math.abs(z)<1e-15)return null;let U=1/z,q=M[0]-o,K=M[1]-e,re=M[2]-r,ne=(q*L+K*B+re*j)*U;if(ne<0||ne>1)return null;let te=K*b-re*D,pe=re*E-q*b,ie=q*D-K*E,me=(_[0]*te+_[1]*pe+_[2]*ie)*U;return me<0||ne+me>1?null:(T*te+C*pe+O*ie)*U}function hS(o,e,r){return(o-e)/(r-e)}function dS(o,e,r,a,f,c,p,v,w){let M=1<<r,_=c-a,E=p-f,D=(o+1)/M*_+a,b=(e+0)/M*E+f,T=(e+1)/M*E+f;v[0]=(o+0)/M*_+a,v[1]=b,w[0]=D,w[1]=T}class fS{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let r=function(c){let p=Math.ceil(Math.log2(c.dim/8)),v=[],w=Math.ceil(Math.pow(2,p)),M=1/w,_=(b,T,C,O,L)=>{let B=O?1:0,j=(b+1)*C-B,z=T*C,U=(T+1)*C-B;L[0]=b*C,L[1]=z,L[2]=j,L[3]=U},E=new lS(w),D=[];for(let b=0;b<w*w;b++){_(b%w,Math.floor(b/w),M,!1,D);let T=ql(D[0],D[1],c),C=ql(D[2],D[1],c),O=ql(D[2],D[3],c),L=ql(D[0],D[3],c);E.minimums.push(Math.min(T,C,O,L)),E.maximums.push(Math.max(T,C,O,L)),E.leaves.push(1)}for(v.push(E),w/=2;w>=1;w/=2){let b=v[v.length-1];E=new lS(w);for(let T=0;T<w*w;T++){_(T%w,Math.floor(T/w),2,!0,D);let C=b.getElevation(D[0],D[1]),O=b.getElevation(D[2],D[1]),L=b.getElevation(D[2],D[3]),B=b.getElevation(D[0],D[3]),j=b.isLeaf(D[0],D[1]),z=b.isLeaf(D[2],D[1]),U=b.isLeaf(D[2],D[3]),q=b.isLeaf(D[0],D[3]),K=Math.min(C.min,O.min,L.min,B.min),re=Math.max(C.max,O.max,L.max,B.max),ne=j&&z&&U&&q;E.maximums.push(re),E.minimums.push(K),E.leaves.push(re-K<=5&&ne?1:0)}v.push(E)}return v}(this.dem),a=r.length-1,f=r[a];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,f,c,p,v=1){return cS([e,r,-100],[a,f,this.maximums[0]*v],c,p)}raycast(e,r,a,f,c,p,v=1){if(!this.nodeCount)return null;let w=this.raycastRoot(e,r,a,f,c,p,v);if(w==null)return null;let M=[],_=[],E=[],D=[],b=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;b.length>0;){let{idx:T,t:C,nodex:O,nodey:L,depth:B}=b.pop();if(this.leaves[T]){dS(O,L,B,e,r,a,f,E,D);let z=1<<B,U=(O+0)/z,q=(O+1)/z,K=(L+0)/z,re=(L+1)/z,ne=ql(U,K,this.dem)*v,te=ql(q,K,this.dem)*v,pe=ql(q,re,this.dem)*v,ie=ql(U,re,this.dem)*v,me=uS(E[0],E[1],ne,D[0],E[1],te,D[0],D[1],pe,c,p),ye=uS(D[0],D[1],pe,E[0],D[1],ie,E[0],E[1],ne,c,p),_e=Math.min(me!==null?me:Number.MAX_VALUE,ye!==null?ye:Number.MAX_VALUE);if(_e!==Number.MAX_VALUE)return _e;{let be=Ee.vec3.scaleAndAdd([],c,p,C);if(pS(ne,te,ie,pe,hS(be[0],E[0],D[0]),hS(be[1],E[1],D[1]))>=be[2])return C}continue}let j=0;for(let z=0;z<this._siblingOffset.length;z++){dS((O<<1)+this._siblingOffset[z][0],(L<<1)+this._siblingOffset[z][1],B+1,e,r,a,f,E,D),E[2]=-100,D[2]=this.maximums[this.childOffsets[T]+z]*v;let U=cS(E,D,c,p);if(U!=null){let q=U;M[z]=q;let K=!1;for(let re=0;re<j&&!K;re++)q>=M[_[re]]&&(_.splice(re,0,z),K=!0);K||(_[j]=z),j++}}for(let z=0;z<j;z++){let U=_[z];b.push({idx:this.childOffsets[T]+U,t:M[U],nodex:(O<<1)+this._siblingOffset[U][0],nodey:(L<<1)+this._siblingOffset[U][1],depth:B+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,f,c){if(e[f].isLeaf(r,a)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);let p=f-1,v=e[p],w=0,M=0;for(let _=0;_<this._siblingOffset.length;_++){let E=2*r+this._siblingOffset[_][0],D=2*a+this._siblingOffset[_][1],b=v.getElevation(E,D),T=v.isLeaf(E,D),C=this._addNode(b.min,b.max,T);T&&(w|=1<<_),M||(M=C)}for(let _=0;_<this._siblingOffset.length;_++)w&1<<_||this._construct(e,2*r+this._siblingOffset[_][0],2*a+this._siblingOffset[_][1],p,M+_)}}function pS(o,e,r,a,f,c){return At(At(o,r,c),At(e,a,c),f)}function ql(o,e,r){let a=r.dim,f=Yt(o*a-.5,0,a-1),c=Yt(e*a-.5,0,a-1),p=Math.floor(f),v=Math.floor(c),w=Math.min(p+1,a-1),M=Math.min(v+1,a-1);return pS(r.get(p,v),r.get(w,v),r.get(p,M),r.get(w,M),f-p,c-v)}let MO={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function CO(o,e,r){return(256*o*256+256*e+r)/10-1e4}function AO(o,e,r){return 256*o+e+r/256-32768}class R_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,f=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void qt(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;let c=this.dim=r.height-2,p=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let w=0;w<c;w++)p[this._idx(-1,w)]=p[this._idx(0,w)],p[this._idx(c,w)]=p[this._idx(c-1,w)],p[this._idx(w,-1)]=p[this._idx(w,0)],p[this._idx(w,c)]=p[this._idx(w,c-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(c,-1)]=p[this._idx(c-1,0)],p[this._idx(-1,c)]=p[this._idx(0,c-1)],p[this._idx(c,c)]=p[this._idx(c-1,c-1)]}let v=a==="terrarium"?AO:CO;for(let w=0;w<p.length;++w){let M=4*w;this.floatView[w]=v(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}this._timestamp=ue.now()}_buildQuadTree(){this._tree=new fS(this)}get(e,r,a=!1){a&&(e=Yt(e,-1,this.dim),r=Yt(r,-1,this.dim));let f=this._idx(e,r);return this.floatView[f]}set(e,r,a){let f=this._idx(e,r),c=this.floatView[f];return this.floatView[f]=a,a-c}static getUnpackVector(e){return MO[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){let a=[0,0,0,0],f=R_.getUnpackVector(r),c=Math.floor((e+f[3])/f[2]);return a[2]=c%256,c=Math.floor(c/256),a[1]=c%256,c=Math.floor(c/256),a[0]=c,a}getPixels(){return new RE({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=r*this.dim,c=r*this.dim+this.dim,p=a*this.dim,v=a*this.dim+this.dim;switch(r){case-1:f=c-1;break;case 1:c=f+1}switch(a){case-1:p=v-1;break;case 1:v=p+1}let w=-r*this.dim,M=-a*this.dim;for(let _=p;_<v;_++)for(let E=f;E<c;E++){let D=4*this._idx(E,_),b=4*this._idx(E+w,_+M);this.pixels[D+0]=e.pixels[b+0],this.pixels[D+1]=e.pixels[b+1],this.pixels[D+2]=e.pixels[b+2],this.pixels[D+3]=e.pixels[b+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function RO(o,e,r){o===1?e.headerLength=r.readFixed32():o===2?e.x=r.readVarint():o===3?e.y=r.readVarint():o===4?e.z=r.readVarint():o===5&&e.layers.push(function(a,f){return a.readFields(FO,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)}(r,r.readVarint()+r.pos))}function PO(o,e,r){o===1?(e.delta_filter=function(a,f){return a.readFields(OO,{blockSize:0},f)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):o===2?(r.readVarint(),e.filter="zigzag_filter"):o===3?(r.readVarint(),e.filter="bitshuffle_filter"):o===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function OO(o,e,r){o===1&&(e.blockSize=r.readVarint())}function LO(o,e,r){o===1?(r.readVarint(),e.codec="gzip_data"):o===2?(r.readVarint(),e.codec="jpeg_image"):o===3?(r.readVarint(),e.codec="webp_image"):o===4&&(r.readVarint(),e.codec="png_image")}function kO(o,e,r){let a=0,f=0;o===1?e.firstByte=r.readFixed64():o===2?e.lastByte=r.readFixed64():o===3?e.filters.push(function(c,p){return c.readFields(PO,{},p)}(r,r.readVarint()+r.pos)):o===4?e.codec=function(c,p){return c.readFields(LO,{},p)}(r,r.readVarint()+r.pos):o===5?f=r.readFloat():o===6?a=r.readFloat():o===7?e.bands.push(r.readString()):o===8?e.offset=r.readDouble():o===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=f),e.scale===0&&(e.scale=a)}function FO(o,e,r){o===1?e.version=r.readVarint():o===2?e.name=r.readString():o===3?e.units=r.readString():o===4?e.tileSize=r.readVarint():o===5?e.buffer=r.readVarint():o===6?e.pixelFormat=r.readVarint():o===7&&e.dataIndex.push(function(a,f){return a.readFields(kO,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)}(r,r.readVarint()+r.pos))}function NO(o,e,r){if(o===2)(function(a,f,c){a.readFields(zO,c,f)})(r,r.readVarint()+r.pos,e);else if(o===3)throw new Error("Not implemented")}function zO(o,e,r){if(o===1){let a=0,f=r.readVarint()+r.pos;for(;r.pos<f;)e[a++]=r.readVarint()}}function BO(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let a=2;a>=1;a--){let f=a===1?1:0,c=a===2?1:0;for(let p=0;p<e[0];p++){let v=e[1]*p;for(let w=f;w<e[1];w++){let M=e[2]*(w+v);for(let _=c;_<e[2];_++){let E=e[3]*(_+M);for(let D=0;D<e[3];D++){let b=E+D;o[b]+=o[b-r]}}}}r*=e[a]}return o}function VO(o){for(let e=0,r=o.length;e<r;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function jO(o,e){switch(e){case"uint32":return o;case"uint16":for(let r=0;r<o.length;r+=2){let a=o[r],f=o[r+1];o[r]=(240&a)>>4|(61440&a)>>8|(240&f)<<4|61440&f,o[r+1]=15&a|(3840&a)>>4|(15&f)<<8|(3840&f)<<4}return o;case"uint8":for(let r=0;r<o.length;r+=4){let a=o[r],f=o[r+1],c=o[r+2],p=o[r+3];o[r+0]=(192&a)>>6|(192&f)>>4|(192&c)>>2|192&p,o[r+1]=(48&a)>>4|(48&f)>>2|48&c|(48&p)<<2,o[r+2]=(12&a)>>2|12&f|(12&c)<<2|(12&p)<<4,o[r+3]=3&a|(3&f)<<2|(3&c)<<4|(3&p)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}_t(R_,"DEMData"),_t(fS,"DemMinMaxQuadTree",{omit:["dem"]});var go=Uint8Array,Bp=Uint16Array,UO=Int32Array,mS=new go([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gS=new go([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$O=new go([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_S=function(o,e){for(var r=new Bp(31),a=0;a<31;++a)r[a]=e+=1<<o[a-1];var f=new UO(r[30]);for(a=1;a<30;++a)for(var c=r[a];c<r[a+1];++c)f[c]=c-r[a]<<5|a;return{b:r,r:f}},yS=_S(mS,2),vS=yS.b,HO=yS.r;vS[28]=258,HO[258]=28;for(var GO=_S(gS,0).b,xS=new Bp(32768),Ir=0;Ir<32768;++Ir){var qh=(43690&Ir)>>1|(21845&Ir)<<1;xS[Ir]=((65280&(qh=(61680&(qh=(52428&qh)>>2|(13107&qh)<<2))>>4|(3855&qh)<<4))>>8|(255&qh)<<8)>>1}var Vp=function(o,e,r){for(var a=o.length,f=0,c=new Bp(e);f<a;++f)o[f]&&++c[o[f]-1];var p,v=new Bp(e);for(f=1;f<e;++f)v[f]=v[f-1]+c[f-1]<<1;p=new Bp(1<<e);var w=15-e;for(f=0;f<a;++f)if(o[f])for(var M=f<<4|o[f],_=e-o[f],E=v[o[f]-1]++<<_,D=E|(1<<_)-1;E<=D;++E)p[xS[E]>>w]=M;return p},jp=new go(288);for(Ir=0;Ir<144;++Ir)jp[Ir]=8;for(Ir=144;Ir<256;++Ir)jp[Ir]=9;for(Ir=256;Ir<280;++Ir)jp[Ir]=7;for(Ir=280;Ir<288;++Ir)jp[Ir]=8;var bS=new go(32);for(Ir=0;Ir<32;++Ir)bS[Ir]=5;var qO=Vp(jp,9),WO=Vp(bS,5),Sx=function(o){for(var e=o[0],r=1;r<o.length;++r)o[r]>e&&(e=o[r]);return e},gs=function(o,e,r){var a=e/8|0;return(o[a]|o[a+1]<<8)>>(7&e)&r},Dx=function(o,e){var r=e/8|0;return(o[r]|o[r+1]<<8|o[r+2]<<16)>>(7&e)},ZO=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_s=function(o,e,r){var a=new Error(e||ZO[o]);if(a.code=o,Error.captureStackTrace&&Error.captureStackTrace(a,_s),!r)throw a;return a},XO=new go(0),YO=typeof TextDecoder<"u"&&new TextDecoder;try{YO.decode(XO,{stream:!0})}catch{}let KO={gzip_data:"gzip"};class jo extends Error{constructor(e){super(e),this.name="MRTError"}}let JO={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},wS={uint32:1,uint16:2,uint8:4},QO={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},Mx;class Cx{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){let r=this.layers[e];if(!r)throw new jo(`Layer '${e}' not found`);return r}getHeaderLength(e){let r=new Uint8Array(e),a=new DataView(e);if(r[0]!==13)throw new jo("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){let r=new Uint8Array(e),a=this.getHeaderLength(e);if(r.length<a)throw new jo(`Expected header with length >= ${a} but got buffer of length ${r.length}`);let f=function(c,p){return c.readFields(RO,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Mx(r.subarray(0,a)));if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new jo(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(let c of f.layers)this.layers[c.name]=new eL(c,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let r=[],a=this.getLayer(e.layerName);for(let f of e.blockIndices){let c=a.dataIndex[f],p=c.firstByte-e.firstByte,v=c.lastByte-e.firstByte;if(a._blocksInProgress.has(f))continue;let w={layerName:a.name,firstByte:p,lastByte:v,pixelFormat:a.pixelFormat,blockIndex:f,blockShape:[c.bands.length].concat(a.bandShape),buffer:a.buffer,codec:c.codec.codec,filters:c.filters.map(M=>M.filter)};a._blocksInProgress.add(f),r.push(w)}return new ES(r,()=>{r.forEach(f=>a._blocksInProgress.delete(f.blockIndex))},(f,c)=>{if(r.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),f)throw f;c.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class eL{constructor({version:e,name:r,units:a,tileSize:f,pixelFormat:c,buffer:p,dataIndex:v},w){if(this.version=e,this.version!==1)throw new jo(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=a,this.tileSize=f,this.buffer=p,this.pixelFormat=JO[c],this.dataIndex=v,this.bandShape=[f+2*p,f+2*p,wS[this.pixelFormat]],this._decodedBlocks=new Tx(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return wS[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){let r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(let[a,f]of this.dataIndex.entries()){for(let[c,p]of f.bands.entries())if(p===e)return{bandIndex:r+c,blockIndex:a,blockBandIndex:c};r+=f.bands.length}break;case"number":for(let[a,f]of this.dataIndex.entries()){if(e>=r&&e<r+f.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-r};r+=f.bands.length}break;default:throw new jo(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new jo(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,a=-1/0,f=[],c=new Set;for(let p of e){let{blockIndex:v}=this.getBlockForBand(p);if(v<0)throw new jo(`Invalid band: ${JSON.stringify(p)}`);let w=this.dataIndex[v];f.includes(v)||f.push(v),c.add(v),r=Math.min(r,w.firstByte),a=Math.max(a,w.lastByte)}if(c.size>this.cacheSize)throw new jo(`Number of blocks to decode (${c.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:a,blockIndices:f}}hasBand(e){let{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){let{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){let{blockIndex:r,blockBandIndex:a}=this.getBlockForBand(e),f=this._decodedBlocks.get(r.toString());if(!f)throw new jo(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let c=this.dataIndex[r],p=this.bandShape.reduce((M,_)=>M*_,1),v=a*p,w=f.subarray(v,v+p);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:c.offset,scale:c.scale}}}Cx.setPbf=function(o){Mx=o};class ES{constructor(e,r,a){this.tasks=e,this._onCancel=r,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}Cx.performDecoding=function(o,e){let r=new Uint8Array(o);return Promise.all(e.tasks.map(a=>{let{layerName:f,firstByte:c,lastByte:p,pixelFormat:v,blockShape:w,blockIndex:M,filters:_,codec:E}=a,D=r.subarray(c,p+1),b=new Uint32Array(w[0]*w[1]*w[2]),T;if(E!=="gzip_data")throw new jo(`Unhandled codec: ${E}`);return T=function(C,O){if(!globalThis.DecompressionStream&&O==="gzip_data")return Promise.resolve(((z=function(K){K[0]==31&&K[1]==139&&K[2]==8||_s(6,"invalid gzip data");var re=K[3],ne=10;4&re&&(ne+=2+(K[10]|K[11]<<8));for(var te=(re>>3&1)+(re>>4&1);te>0;te-=!K[ne++]);return ne+(2&re)}(j=C))+8>j.length&&_s(6,"invalid gzip data"),function(K,re,ne,te){var pe=K.length;if(!pe||re.f&&!re.l)return ne||new go(0);var ie=!ne,me=ie||re.i!=2,ye=re.i;ie&&(ne=new go(3*pe));var _e,be,Se=function(Wl){var ou=ne.length;if(Wl>ou){var Gp=new go(Math.max(2*ou,Wl));Gp.set(ne),ne=Gp}},Ae=re.f||0,Ie=re.p||0,$e=re.b||0,Ke=re.l,Ue=re.d,ut=re.m,lt=re.n,tt=8*pe;do{if(!Ke){Ae=gs(K,Ie,1);var Je=gs(K,Ie+1,3);if(Ie+=3,!Je){var xt=K[(zt=4+((Ie+7)/8|0))-4]|K[zt-3]<<8,ht=zt+xt;if(ht>pe){ye&&_s(0);break}me&&Se($e+xt),ne.set(K.subarray(zt,ht),$e),re.b=$e+=xt,re.p=Ie=8*ht,re.f=Ae;continue}if(Je==1)Ke=qO,Ue=WO,ut=9,lt=5;else if(Je==2){var mt=gs(K,Ie,31)+257,Lt=gs(K,Ie+10,15)+4,Ht=mt+gs(K,Ie+5,31)+1;Ie+=14;for(var Wt=new go(Ht),Zt=new go(19),en=0;en<Lt;++en)Zt[$O[en]]=gs(K,Ie+3*en,7);Ie+=3*Lt;var rn=Sx(Zt),$n=(1<<rn)-1,On=Vp(Zt,rn);for(en=0;en<Ht;){var zt,In=On[gs(K,Ie,$n)];if(Ie+=15&In,(zt=In>>4)<16)Wt[en++]=zt;else{var Rn=0,Yn=0;for(zt==16?(Yn=3+gs(K,Ie,3),Ie+=2,Rn=Wt[en-1]):zt==17?(Yn=3+gs(K,Ie,7),Ie+=3):zt==18&&(Yn=11+gs(K,Ie,127),Ie+=7);Yn--;)Wt[en++]=Rn}}var gr=Wt.subarray(0,mt),Sr=Wt.subarray(mt);ut=Sx(gr),lt=Sx(Sr),Ke=Vp(gr,ut),Ue=Vp(Sr,lt)}else _s(1);if(Ie>tt){ye&&_s(0);break}}me&&Se($e+131072);for(var _r=(1<<ut)-1,ar=(1<<lt)-1,br=Ie;;br=Ie){var Cr=(Rn=Ke[Dx(K,Ie)&_r])>>4;if((Ie+=15&Rn)>tt){ye&&_s(0);break}if(Rn||_s(2),Cr<256)ne[$e++]=Cr;else{if(Cr==256){br=Ie,Ke=null;break}var ei=Cr-254;Cr>264&&(ei=gs(K,Ie,(1<<(vs=mS[en=Cr-257]))-1)+vS[en],Ie+=vs);var Zn=Ue[Dx(K,Ie)&ar],Hi=Zn>>4;if(Zn||_s(3),Ie+=15&Zn,Sr=GO[Hi],Hi>3){var vs=gS[Hi];Sr+=Dx(K,Ie)&(1<<vs)-1,Ie+=vs}if(Ie>tt){ye&&_s(0);break}me&&Se($e+131072);var Uo=$e+ei;if($e<Sr){var $o=0-Sr,iu=Math.min(Sr,Uo);for($o+$e<0&&_s(3);$e<iu;++$e)ne[$e]=(void 0)[$o+$e]}for(;$e<Uo;++$e)ne[$e]=ne[$e-Sr]}}re.l=Ke,re.p=br,re.b=$e,re.f=Ae,Ke&&(Ae=1,re.m=ut,re.d=Ue,re.n=lt)}while(!Ae);return $e!=ne.length&&ie?(_e=ne,((be=$e)==null||be>_e.length)&&(be=_e.length),new go(_e.subarray(0,be))):ne.subarray(0,$e)}(j.subarray(z,-8),{i:2},new go(((L=j)[(B=L.length)-4]|L[B-3]<<8|L[B-2]<<16|L[B-1]<<24)>>>0))));var L,B,j,z;let U=KO[O];if(!U)throw new Error(`Unhandled codec: ${O}`);let q=new globalThis.DecompressionStream(U);return new Response(new Blob([C]).stream().pipeThrough(q)).arrayBuffer().then(K=>new Uint8Array(K))}(D,E).then(C=>(function(O,L){O.readFields(NO,L)}(new Mx(C),b),new QO[v](b.buffer))),T.then(C=>{for(let O=_.length-1;O>=0;O--)switch(_[O]){case"delta_filter":BO(C,w);break;case"zigzag_filter":VO(C);break;case"bitshuffle_filter":jO(C,v);break;default:throw new jo(`Unhandled filter "${_[O]}"`)}return{layerName:f,blockIndex:M,data:C}}).catch(C=>{throw C})}))},_t(ES,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let Up,Ax,ys,Wh,Rx,Zh=null;function TS(){return ns()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Ax||Dr.DRACO_URL}function IS(){if(ns()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Wh)return Wh;let o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Wh=WebAssembly.validate(o)?Dr.MESHOPT_SIMD_URL:Dr.MESHOPT_URL,Wh}let P_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},tL={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},$p={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function SS(o,e,r){let a=r.json.bufferViews.length,f=r.buffers.length;e.bufferView=a,r.json.bufferViews[a]={buffer:f,byteLength:o.byteLength},r.buffers[f]=o}let Px="KHR_draco_mesh_compression";function nL(o,e){let r=o.extensions&&o.extensions[Px];if(!r)return;let a=new ys.Decoder,f=AS(e,r.bufferView),c=new ys.Mesh;if(!a.DecodeArrayToMesh(f,f.byteLength,c))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[o.indices],v=P_[p.componentType],w=p.count*v.BYTES_PER_ELEMENT,M=ys._malloc(w);v===Uint16Array?a.GetTrianglesUInt16Array(c,w,M):a.GetTrianglesUInt32Array(c,w,M),SS(ys.memory.buffer.slice(M,M+w),p,e),ys._free(M);for(let _ of Object.keys(r.attributes)){let E=a.GetAttributeByUniqueId(c,r.attributes[_]),D=e.json.accessors[o.attributes[_]],b=tL[D.componentType],T=D.count*$p[D.type]*P_[D.componentType].BYTES_PER_ELEMENT,C=ys._malloc(T);a.GetAttributeDataArrayForAllPoints(c,E,ys[b],T,C),SS(ys.memory.buffer.slice(C,C+T),D,e),ys._free(C)}a.destroy(),c.destroy(),delete o.extensions[Px]}let O_="EXT_meshopt_compression";function rL(o,e){if(!o.extensions||!o.extensions[O_])return;let r=o.extensions[O_],a=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),f=new Uint8Array(r.count*r.byteStride);Rx.decodeGltfBuffer(f,r.count,r.byteStride,a,r.mode,r.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=f.buffer,delete o.extensions[O_]}let DS=1179937895,MS=new TextDecoder("utf8");function CS(o,e){return new URL(o,e).href}function iL(o,e,r,a){return fetch(CS(o.uri,a)).then(f=>f.arrayBuffer()).then(f=>{e.buffers[r]=f})}function AS(o,e){let r=o.json.bufferViews[e];return new Uint8Array(o.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function oL(o,e,r,a){if(o.uri){let f=CS(o.uri,a);return fetch(f).then(c=>c.blob()).then(c=>createImageBitmap(c)).then(c=>{e.images[r]=c})}if(o.bufferView!==void 0){let f=AS(e,o.bufferView),c=new Blob([f],{type:o.mimeType});return createImageBitmap(c).then(p=>{e.images[r]=p})}}function RS(o,e=0,r){let a={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===DS){let _=new Uint32Array(o,e),E=2,D=(_[E++]>>2)-3,b=_[E++]>>2;if(E++,a.json=JSON.parse(MS.decode(_.subarray(E,E+b))),E+=b,E<D){let T=_[E++];E++;let C=e+(E<<2);a.buffers[0]=o.slice(C,C+T)}}else a.json=JSON.parse(MS.decode(new Uint8Array(o,e)));let{buffers:f,images:c,meshes:p,extensionsUsed:v,bufferViews:w}=a.json,M=Promise.resolve();if(f){let _=[];for(let E=0;E<f.length;E++){let D=f[E];D.uri?_.push(iL(D,a,E,r)):a.buffers[E]||(a.buffers[E]=null)}M=Promise.all(_)}return M.then(()=>{let _=[],E=v&&v.includes(Px),D=v&&v.includes(O_);if(E&&_.push(function(){if(!ys)return Up??(Up=function(b){let T,C=null;function O(){T=new Uint8Array(C.buffer)}function L(){throw new Error("Unexpected Draco error.")}let B={a:{a:L,d:function(j,z,U){return T.copyWithin(j,z,z+U)},c:function(j){let z=T.length,U=Math.max(j>>>0,Math.ceil(1.2*z)),q=Math.ceil((U-z)/65536);try{return C.grow(q),O(),!0}catch{return!1}},b:L}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(b,B):b.then(j=>j.arrayBuffer()).then(j=>WebAssembly.instantiate(j,B))).then(j=>{let{Rb:z,Qb:U,P:q,T:K,X:re,Ja:ne,La:te,Qa:pe,Va:ie,Wa:me,eb:ye,jb:_e,f:be,e:Se,yb:Ae,zb:Ie,Ab:$e,Bb:Ke,Db:Ue,Gb:ut}=j.instance.exports;C=Se;let lt=(()=>{let tt=0,Je=0,xt=0,ht=0;return mt=>{xt&&(z(ht),z(tt),Je+=xt,xt=tt=0),tt||(Je+=128,tt=U(Je));let Lt=mt.length+7&-8,Ht=tt;Lt>=Je&&(xt=Lt,Ht=ht=U(Lt));for(let Wt=0;Wt<mt.length;Wt++)T[Ht+Wt]=mt[Wt];return Ht}})();return O(),be(),{memory:Se,_free:z,_malloc:U,Mesh:class{constructor(){this.ptr=q()}destroy(){K(this.ptr)}},Decoder:class{constructor(){this.ptr=ne()}destroy(){_e(this.ptr)}DecodeArrayToMesh(tt,Je,xt){let ht=lt(tt),mt=te(this.ptr,ht,Je,xt.ptr);return!!re(mt)}GetAttributeByUniqueId(tt,Je){return{ptr:pe(this.ptr,tt.ptr,Je)}}GetTrianglesUInt16Array(tt,Je,xt){ie(this.ptr,tt.ptr,Je,xt)}GetTrianglesUInt32Array(tt,Je,xt){me(this.ptr,tt.ptr,Je,xt)}GetAttributeDataArrayForAllPoints(tt,Je,xt,ht,mt){ye(this.ptr,tt.ptr,Je.ptr,xt,ht,mt)}},DT_INT8:Ae(),DT_UINT8:Ie(),DT_INT16:$e(),DT_UINT16:Ke(),DT_UINT32:Ue(),DT_FLOAT32:ut()}})}(fetch(TS())),Up.then(b=>{ys=b,Up=void 0}))}()),D&&_.push(function(){if(Rx)return;let b=function(T){let C,O=WebAssembly.instantiateStreaming(T,{}).then(j=>{C=j.instance,C.exports.__wasm_call_ctors()}),L={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},B={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:O,supported:!0,decodeGltfBuffer(j,z,U,q,K,re){(function(ne,te,pe,ie,me,ye,_e){let be=ne.exports.sbrk,Se=ie+3&-4,Ae=be(Se*me),Ie=be(ye.length),$e=new Uint8Array(ne.exports.memory.buffer);$e.set(ye,Ie);let Ke=te(Ae,ie,me,Ie,ye.length);if(Ke===0&&_e&&_e(Ae,Se,me),pe.set($e.subarray(Ae,Ae+ie*me)),be(Ae-be(0)),Ke!==0)throw new Error(`Malformed buffer data: ${Ke}`)})(C,C.exports[B[K]],j,z,U,q,C.exports[L[re]])}}}(fetch(IS()));return b.ready.then(()=>{Rx=b})}()),c)for(let b=0;b<c.length;b++)_.push(oL(c[b],a,b,r));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(E&&p)for(let{primitives:b}of p)for(let T of b)nL(T,a);if(D&&p&&w)for(let b of w)rL(b,a);return a})})}function ru(o,e){let r=o.json.bufferViews[e.bufferView],a=P_[e.componentType];return new a(o.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==$p[e.type]*a.BYTES_PER_ELEMENT?r.byteStride/a.BYTES_PER_ELEMENT:$p[e.type]))}function Ox(o,e,r,a){let f=P_[e.componentType],c=function(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),p=o.json.bufferViews[e.bufferView],v=p.byteStride?p.byteStride/f.BYTES_PER_ELEMENT:$p[e.type],w=r.float32,M=w.length/r.capacity;for(let _=0,E=0;_<e.count*v;_+=v,E+=M)for(let D=0;D<M;D++)w[E+D]=a[_+D]*c;r._trim()}function sL(o,e,r){let a=o.indices,f=o.attributes,c={};c.indexArray=new Vr;let p=e.json.accessors[a],v=p.count/3;c.indexArray.reserve(v);let w=ru(e,p);for(let D=0;D<v;D++)c.indexArray.emplaceBack(w[3*D],w[3*D+1],w[3*D+2]);c.indexArray._trim(),c.vertexArray=new ko;let M=e.json.accessors[f.POSITION];c.vertexArray.reserve(M.count);let _=ru(e,M);for(let D=0;D<M.count;D++)c.vertexArray.emplaceBack(_[3*D],_[3*D+1],_[3*D+2]);if(c.vertexArray._trim(),c.aabb=new wt(M.min,M.max),c.centroid=function(D,b){let T=[0,0,0],C=D.length;if(C>0){for(let O=0;O<C;O++){let L=3*D[O];T[0]+=b[L],T[1]+=b[L+1],T[2]+=b[L+2]}T[0]/=C,T[1]/=C,T[2]/=C}return T}(w,_),f.COLOR_0!==void 0){let D=e.json.accessors[f.COLOR_0],b=$p[D.type],T=ru(e,D);c.colorArray=b===3?new ko:new Ea,c.colorArray.resize(D.count),Ox(e,D,c.colorArray,T)}if(f.NORMAL!==void 0){c.normalArray=new ko;let D=e.json.accessors[f.NORMAL];c.normalArray.resize(D.count);let b=ru(e,D);Ox(e,D,c.normalArray,b)}if(f.TEXCOORD_0!==void 0&&r.length>0){c.texcoordArray=new Ol;let D=e.json.accessors[f.TEXCOORD_0];c.texcoordArray.resize(D.count);let b=ru(e,D);Ox(e,D,c.texcoordArray,b)}if(f._FEATURE_ID_RGBA4444!==void 0){let D=e.json.accessors[f._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(c.featureData=ru(e,D))}f._FEATURE_RGBA4444!==void 0&&(c.featureData=new Uint32Array(ru(e,e.json.accessors[f._FEATURE_RGBA4444]).buffer));let E=o.material;return c.material=function(D,b){let{emissiveFactor:T=[0,0,0],alphaMode:C="OPAQUE",alphaCutoff:O=.5,normalTexture:L,occlusionTexture:B,emissiveTexture:j,doubleSided:z}=D,{baseColorFactor:U=[1,1,1,1],metallicFactor:q=1,roughnessFactor:K=1,baseColorTexture:re,metallicRoughnessTexture:ne}=D.pbrMetallicRoughness||{},te=B?b[B.index]:void 0;if(B&&B.extensions&&B.extensions.KHR_texture_transform&&te){let pe=B.extensions.KHR_texture_transform;te.offsetScale=[pe.offset[0],pe.offset[1],pe.scale[0],pe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new vn(...U),metallicFactor:q,roughnessFactor:K,baseColorTexture:re?b[re.index]:void 0,metallicRoughnessTexture:ne?b[ne.index]:void 0},doubleSided:z,emissiveFactor:T,alphaMode:C,alphaCutoff:O,normalTexture:L?b[L.index]:void 0,occlusionTexture:te,emissionTexture:j?b[j.index]:void 0,defined:D.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},r),c}function PS(o,e,r){let{matrix:a,rotation:f,translation:c,scale:p,mesh:v,extras:w,children:M}=o,_={};if(_.matrix=a||Ee.mat4.fromRotationTranslationScale([],f||[0,0,0,1],c||[0,0,0],p||[1,1,1]),v!==void 0){_.meshes=r[v];let E=_.anchor=[0,0];for(let D of _.meshes){let{min:b,max:T}=D.aabb;E[0]+=b[0]+T[0],E[1]+=b[1]+T[1]}E[0]=Math.floor(E[0]/_.meshes.length/2),E[1]=Math.floor(E[1]/_.meshes.length/2)}if(w&&(w.id&&(_.id=w.id),w.lights&&(_.lights=function(E){if(!E.length)return[];let D=function(L){let B=atob(L),j=new Uint8Array(B.length);for(let z=0;z<B.length;z++)j[z]=B.codePointAt(z);return j}(E),b=[],T=D.length/24,C=new Uint16Array(D.buffer),O=new Float32Array(D.buffer);for(let L=0;L<T;L++){let B=C[2*L*6]/30,j=C[2*L*6+1]/30,z=C[2*L*6+10]/100,U=O[6*L+1],q=O[6*L+2],K=O[6*L+3],re=O[6*L+4],ne=K-U,te=re-q,pe=Math.hypot(ne,te);b.push({pos:[U+.5*ne,q+.5*te,j],normal:[te/pe,-ne/pe,0],width:pe,height:B,depth:z,points:[U,q,K,re]})}return b}(w.lights))),M){let E=[];for(let D of M)E.push(PS(e.json.nodes[D],e,r));_.children=E}return _}function aL(o){if(o.vertices.length===0||o.indices.length===0)return null;let e=new k0(o.vertices,o.indices,8,256),[r,a]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:r,max:a}}function lL(o){if(!o.extras||!o.extras.ground)return null;let e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;let a=[];for(let p of r){if(!Array.isArray(p)||p.length!==2)continue;let v=p[0],w=p[1];typeof v=="number"&&typeof w=="number"&&a.push(new at(v,w))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let f=0;for(let p=0;p<a.length;p++){let v=a[p],w=a[(p+1)%a.length],M=a[(p+2)%a.length];f+=(v.x-w.x)*(M.y-w.y)-(M.x-w.x)*(v.y-w.y)}f>0&&a.reverse();let c=fp(a.flatMap(p=>[p.x,p.y]),[]);return c.length===0?null:{vertices:a,indices:c}}function cL(o,e){let r=[],a=[],f=0,c=[];for(let p of o){f=r.length;let v=p.vertexArray.float32,w=p.indexArray.uint16;for(let M=0;M<p.vertexArray.length;M++)c[0]=v[3*M+0],c[1]=v[3*M+1],c[2]=v[3*M+2],Ee.vec3.transformMat4(c,c,e),r.push(new at(c[0],c[1]));for(let M=0;M<3*p.indexArray.length;M++)a.push(w[M]+f)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){let v=r[a[p+0]],w=r[a[p+1]],M=r[a[p+2]];(v.x-w.x)*(M.y-w.y)-(M.x-w.x)*(v.y-w.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:r,indices:a}}function OS(o){let e=function(w,M){let _=[],E=WebGL2RenderingContext;if(w.json.textures)for(let D of w.json.textures){let b={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};D.sampler!==void 0&&Object.assign(b,w.json.samplers[D.sampler]),_.push({image:M[D.source],sampler:b,uploaded:!1})}return _}(o,o.images),r=function(w,M){let _=[];for(let E of w.json.meshes){let D=[];for(let b of E.primitives)D.push(sL(b,w,M));_.push(D)}return _}(o,e),{scenes:a,scene:f,nodes:c}=o.json,p=a?a[f||0].nodes:c,v=[];for(let w of p)v.push(PS(c[w],o,r));return function(w,M,_){let E={},D=new Set;for(let b=0;b<w.length;b++){let T=_[M[b]];if(!T.extras)continue;let C=T.extras["mapbox:footprint:version"],O=T.extras["mapbox:footprint:id"];(C||O)&&D.add(b),C==="1.0.0"&&O&&(E[O]=b)}for(let b=0;b<w.length;b++){if(D.has(b))continue;let T=w[b],C=_[M[b]];if(!C.extras)continue;let O=null;T.id in E&&(O=cL(w[E[T.id]].meshes,T.matrix)),O||(O=lL(C)),O&&(T.footprint=aL(O))}if(D.size>0){let b=Array.from(D.values()).sort((T,C)=>T-C);for(let T=b.length-1;T>=0;T--)w.splice(b[T],1)}}(v,p,o.json.nodes),v}function uL(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);let e=o.vertexArray.float32,r=o.aabb.min[0]-1,a=o.aabb.min[1]-1,f=tu/(o.aabb.max[0]-r+2),c=tu/(o.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){let v=e[p+2],w=(e[p+0]-r)*f|0,M=(e[p+1]-a)*c|0;v>o.heightmap[M*tu+w]&&(o.heightmap[M*tu+w]=v)}}function hL(o,e){let r={};r.indexArray=new Vr,r.indexArray.reserve(4*o.length),r.vertexArray=new ko,r.vertexArray.reserve(10*o.length),r.colorArray=new Ea,r.vertexArray.reserve(10*o.length);let a=0;for(let p of o){let v=Math.min(10,Math.max(4,1.3*p.height))*e,w=[-p.normal[1],p.normal[0],0],M=Math.min(.29,.1*p.width/p.depth),_=p.width-2*p.depth*e*(M+.01),E=Ee.vec3.scaleAndAdd([],p.pos,w,_/2),D=Ee.vec3.scaleAndAdd([],p.pos,w,-_/2),b=[E[0],E[1],E[2]+p.height],T=[D[0],D[1],D[2]+p.height],C=Ee.vec3.scaleAndAdd([],p.normal,w,M);Ee.vec3.scale(C,C,v);let O=Ee.vec3.scaleAndAdd([],p.normal,w,-M);Ee.vec3.scale(O,O,v),Ee.vec3.add(C,E,C),Ee.vec3.add(O,D,O),E[2]+=.1,D[2]+=.1,r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(D[0],D[1],D[2]),r.vertexArray.emplaceBack(b[0],b[1],b[2]),r.vertexArray.emplaceBack(T[0],T[1],T[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(D[0],D[1],D[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]);let L=_/v/2;r.colorArray.emplaceBack(-L-M,-1,L,.8),r.colorArray.emplaceBack(L+M,-1,L,.8),r.colorArray.emplaceBack(-L,0,L,1.3),r.colorArray.emplaceBack(L,0,L,1.3),r.colorArray.emplaceBack(L+M,-.8,L,.7),r.colorArray.emplaceBack(L+M,-.8,L,.7),r.colorArray.emplaceBack(0,0,L,1.3),r.colorArray.emplaceBack(0,0,L,1.3),r.colorArray.emplaceBack(L+M,-1.2,L,.8),r.colorArray.emplaceBack(L+M,-1.2,L,.8),r.indexArray.emplaceBack(6+a,4+a,8+a),r.indexArray.emplaceBack(7+a,9+a,5+a),r.indexArray.emplaceBack(0+a,1+a,2+a),r.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}let f={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=vn.white,f.pbrMetallicRoughness=c,r.material=f,r.aabb=new wt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}class LS{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){let a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let dL=["id","tile","layer","source","sourceLayer","state"];class Xh{constructor(e,r,a,f,c){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=f,this.properties=e.properties,this.id=c}clone(){let e=new Xh(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let r of dL)this[r]!==void 0&&(e[r]=this[r]);return e}}class kS{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new xa(ct,16,0),this.featureIndexArray=new qc,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,a,f,c,p=0,v=0){let w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,f,c,p);let M=this.grid;for(let _=0;_<r.length;_++){let E=r[_],D=[1/0,1/0,-1/0,-1/0];for(let b=0;b<E.length;b++){let T=E[b];D[0]=Math.min(D[0],T.x),D[1]=Math.min(D[1],T.y),D[2]=Math.max(D[2],T.x),D[3]=Math.max(D[3],T.y)}v!==0&&(D[0]-=v,D[1]-=v,D[2]+=v,D[3]+=v),D[0]<ct&&D[1]<ct&&D[2]>=0&&D[3]>=0&&M.insert(w,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new kh.VectorTile(new n_(this.rawTileData)).layers,this.sourceLayerCoder=new LS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r){let{tilespaceGeometry:a,transform:f,tileTransform:c,pixelPosMatrix:p,availableImages:v}=r;this.loadVTLayers(),this.serializedLayersCache.clear();let w=a.bufferedTilespaceBounds,M=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(b,T,C,O)=>ge(a.bufferedTilespaceGeometry,b,T,C,O));M.sort(fL);let _=null;f.elevation&&M.length>0&&(_=Uh.create(f.elevation,this.tileID));let E={},D;for(let b=0;b<M.length;b++){let T=M[b];if(T===D)continue;D=T;let C=this.featureIndexArray.get(T),O=null;this.is3DTile?this.loadMatchingModelFeature(E,C,e,a,f):this.loadMatchingFeature(E,C,e,v,(L,B,j,z=0)=>(O||(O=P(L,this.tileID.canonical,c)),B.queryIntersectsFeature(a,L,j,O,this.z,f,p,_,z)))}return E}loadMatchingFeature(e,r,a,f,c){let{featureIndex:p,bucketIndex:v,sourceLayerIndex:w,layoutVertexArrayOffset:M}=r,_=this.bucketLayerIDs[v],E=a.layers,D=Object.keys(E);if(D.length&&!function(L,B){for(let j=0;j<L.length;j++)if(B.indexOf(L[j])>=0)return!0;return!1}(D,_))return;let b=a.sourceCache,T=this.sourceLayerCoder.decode(w),C=this.vtLayers[T].feature(p),O=this.getId(C,T);for(let L=0;L<_.length;L++){let B=_[L];if(!E[B])continue;let{styleLayer:j,targets:z}=E[B],U={};O!==void 0&&(U=b.getFeatureState(j.sourceLayer,O));let q=!c||c(C,j,U,M);if(!q)continue;let K=new Xh(C,this.z,this.x,this.y,O);K.tile=this.tileID.canonical,K.state=U;let re=this.serializedLayersCache.get(B);re||(re=j.serialize(),re.id=B,this.serializedLayersCache.set(B,re)),K.source=re.source,K.sourceLayer=re["source-layer"],K.layer=ai({},re),K.layer.paint=FS(re.paint,j.paint,C,U,f),K.layer.layout=FS(re.layout,j.layout,C,U,f);let ne=!1;for(let te of z){this.updateFeatureProperties(K,te);let{filter:pe}=te;if(pe){if(C.properties=K.properties,pe.needGeometry){let ie=k(C,!0);if(!pe.filter(new Gn(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!pe.filter(new Gn(this.tileID.overscaledZ),C))continue}ne=!0,te.targetId&&this.addFeatureVariant(K,te)}ne&&this.appendToResult(e,B,p,K,q)}}loadMatchingModelFeature(e,r,a,f,c){let p=this.bucketLayerIDs[0][0],v=a.layers;if(!v[p])return;let{styleLayer:w,targets:M}=v[p];if(w.type!=="model")return;let _=f.tile,E=r.featureIndex,D=_.getBucket(w);if(!(D&&D instanceof E_))return;let b=function(re,ne,te,pe){let ie=re.getNodesInfo()[ne];if(ie.hiddenByReplacement||!ie.node.meshes)return;let me=Number.MAX_VALUE,ye=ie.node,_e=te.tile,be=pe.calculatePosMatrix(_e.tileID.toUnwrapped(),pe.worldSize),Se=ie.evaluatedScale,Ae=0;pe.elevation&&ye.elevation&&(Ae=ye.elevation*pe.elevation.exaggeration()),Ee.mat4.translate(be,be,[(ye.anchor?ye.anchor[0]:0)*(Se[0]-1),(ye.anchor?ye.anchor[1]:0)*(Se[1]-1),Ae]),Ee.mat4.scale(be,be,Se);let Ie=te.queryGeometry,$e=Ie.isPointQuery()?Ie.screenBounds:Ie.screenGeometry,Ke=function(ut){let lt=Ee.mat4.multiply([],be,ut.matrix);Ee.mat4.multiply(lt,pe.expandedFarZProjMatrix,lt);for(let tt=0;tt<ut.meshes.length;++tt){let Je=ut.meshes[tt];if(tt===ut.lightMeshIndex)continue;let xt=LI($e,pe,lt,Je.aabb);xt!=null&&(me=Math.min(xt,me))}if(ut.children)for(let tt of ut.children)Ke(tt)};if(Ke(ye),me===Number.MAX_VALUE)return;let Ue=new mn(0,0);return qI(_e.tileID.canonical,Ue,ie.node.anchor[0],ie.node.anchor[1]),{intersectionZ:me,position:Ue,feature:ie.feature}}(D,E,f,c);if(!b)return;let{z:T,x:C,y:O}=_.tileID.canonical,{feature:L,intersectionZ:B,position:j}=b,z={};L.id!==void 0&&(z=a.sourceCache.getFeatureState(w.sourceLayer,L.id));let U=new Xh({},T,C,O,L.id);U.tile=this.tileID.canonical,U.state=z,U.properties=L.properties,U.geometry={type:"Point",coordinates:[j.lng,j.lat]};let q=this.serializedLayersCache.get(p);q||(q=w.serialize(),q.id=p,this.serializedLayersCache.set(p,q)),U.source=q.source,U.sourceLayer=q["source-layer"],U.layer=ai({},q);let K=!1;for(let re of M){this.updateFeatureProperties(U,re);let{filter:ne}=re;if(ne){if(L.properties=U.properties,ne.needGeometry){if(!ne.filter(new Gn(this.tileID.overscaledZ),L,this.tileID.canonical))continue}else if(!ne.filter(new Gn(this.tileID.overscaledZ),L))continue}K=!0,re.targetId&&this.addFeatureVariant(U,re)}K&&this.appendToResult(e,p,E,U,B)}updateFeatureProperties(e,r,a){if(r.properties){let f={};for(let c in r.properties){let p=r.properties[c].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);p!=null&&(f[c]=p)}e.properties=f}}addFeatureVariant(e,r,a){let f={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(f.properties=e.properties),e.variants=e.variants||{},e.variants[r.targetId]=e.variants[r.targetId]||[],e.variants[r.targetId].push(f)}appendToResult(e,r,a,f,c){let p=e[r];p===void 0&&(p=e[r]=[]),p.push({featureIndex:a,feature:f,intersectionZ:c})}lookupSymbolFeatures(e,r,a,f,c){let p={};this.loadVTLayers();for(let v of e)this.loadMatchingFeature(p,{bucketIndex:r,sourceLayerIndex:a,featureIndex:v,layoutVertexArrayOffset:0},f,c);return p}loadFeature(e){let{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();let f=this.sourceLayerCoder.decode(a),c=this.vtFeatures[f];if(c[r])return c[r];let p=this.vtLayers[f].feature(r);return c[r]=p,p}hasLayer(e){for(let r of this.bucketLayerIDs)for(let a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){let f=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(f!=null)if(Array.isArray(f)){if(!this.promoteIdExpression){let c=Il(f);if(c.result!=="success"){let p=c.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void qt(`Failed to create expression for promoteId: ${p}`)}this.promoteIdExpression=c.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new nf),a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[f];typeof a=="boolean"&&(a=Number(a))}return a}}function FS(o,e,r,a,f){return ll(o,(c,p)=>{let v=e instanceof Cl?e.get(p):null;return v&&v.evaluate?v.evaluate(r,a,f):v})}function fL(o,e){return e-o}_t(kS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let NS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Lx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let f=a>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);let c=NS[15&a];if(!c)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new Lx(v,p,c,e)}constructor(e,r=64,a=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let c=NS.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${a}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+v+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return kx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:p,nodeSize:v}=this,w=[0,c.length-1,0],M=[];for(;w.length;){let _=w.pop()||0,E=w.pop()||0,D=w.pop()||0;if(E-D<=v){for(let O=D;O<=E;O++){let L=p[2*O],B=p[2*O+1];L>=e&&L<=a&&B>=r&&B<=f&&M.push(c[O])}continue}let b=D+E>>1,T=p[2*b],C=p[2*b+1];T>=e&&T<=a&&C>=r&&C<=f&&M.push(c[b]),(_===0?e<=T:r<=C)&&(w.push(D),w.push(b-1),w.push(1-_)),(_===0?a>=T:f>=C)&&(w.push(b+1),w.push(E),w.push(1-_))}return M}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:f,coords:c,nodeSize:p}=this,v=[0,f.length-1,0],w=[],M=a*a;for(;v.length;){let _=v.pop()||0,E=v.pop()||0,D=v.pop()||0;if(E-D<=p){for(let O=D;O<=E;O++)BS(c[2*O],c[2*O+1],e,r)<=M&&w.push(f[O]);continue}let b=D+E>>1,T=c[2*b],C=c[2*b+1];BS(T,C,e,r)<=M&&w.push(f[b]),(_===0?e-a<=T:r-a<=C)&&(v.push(D),v.push(b-1),v.push(1-_)),(_===0?e+a>=T:r+a>=C)&&(v.push(b+1),v.push(E),v.push(1-_))}return w}}function kx(o,e,r,a,f,c){if(f-a<=r)return;let p=a+f>>1;zS(o,e,p,a,f,c),kx(o,e,r,a,p-1,1-c),kx(o,e,r,p+1,f,1-c)}function zS(o,e,r,a,f,c){for(;f>a;){if(f-a>600){let M=f-a+1,_=r-a+1,E=Math.log(M),D=.5*Math.exp(2*E/3),b=.5*Math.sqrt(E*D*(M-D)/M)*(_-M/2<0?-1:1);zS(o,e,r,Math.max(a,Math.floor(r-_*D/M+b)),Math.min(f,Math.floor(r+(M-_)*D/M+b)),c)}let p=e[2*r+c],v=a,w=f;for(Hp(o,e,a,r),e[2*f+c]>p&&Hp(o,e,a,f);v<w;){for(Hp(o,e,v,w),v++,w--;e[2*v+c]<p;)v++;for(;e[2*w+c]>p;)w--}e[2*a+c]===p?Hp(o,e,a,w):(w++,Hp(o,e,w,f)),w<=r&&(a=w+1),r<=w&&(f=w-1)}}function Hp(o,e,r,a){Fx(o,r,a),Fx(e,2*r,2*a),Fx(e,2*r+1,2*a+1)}function Fx(o,e,r){let a=o[e];o[e]=o[r],o[r]=a}function BS(o,e,r,a){let f=o-r,c=e-a;return f*f+c*c}n.$=Hf,n.A=Hr,n.B=2,n.C=Ip,n.D=$h,n.E=ks,n.F=KT,n.G=class extends b_{},n.H=ho,n.I=Ix,n.J=Hu,n.K=Tg,n.L=Ac,n.M=Cc,n.N=ch,n.O=Tl,n.P=at,n.Q=vh,n.R=_n,n.S=bg,n.T=hx,n.U=Il,n.V=b_,n.W=Ec,n.X=_a,n.Y=_l,n.Z=xi,n._=Xi,n.a=function(o){return Dr.API_CDN_URL_REGEX.test(o)},n.a$=Xh,n.a0=Rf,n.a1=yg,n.a2=function(o){let e=o.value,r=[];if(!e)return r;let a=ho(e);return a!=="string"?(r=r.concat([new b_(o.key,e,`string expected, "${a}" found`)]),r):(FI(e,!0)||(r=r.concat([new b_(o.key,e,`invalid url "${e}"`)])),r)},n.a3=Pe,n.a4=yh,n.a5=er,n.a6=nt,n.a7=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return Mi(o.expression.evaluate(e))}interpolate(o,e,r){return{x:At(o.x,e.x,r),y:At(o.y,e.y,r),z:At(o.z,e.z,r),azimuthal:At(o.azimuthal,e.azimuthal,r),polar:At(o.polar,e.polar,r)}}},n.a8=Gn,n.a9=Rc,n.aA=po,n.aB=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,r,a){let f=this.entries[o]=this.entries[o]||{callbacks:[]};if(f.result){let[c,p]=f.result;return this.scheduler?this.scheduler.add(()=>{a(c,p)},e):a(c,p),()=>{}}return f.callbacks.push(a),f.cancel||(f.cancel=r((c,p)=>{f.result=[c,p];for(let v of f.callbacks)this.scheduler?this.scheduler.add(()=>{v(c,p)},e):v(c,p);setTimeout(()=>delete this.entries[o],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(c=>c!==a),f.callbacks.length||(f.cancel(),delete this.entries[o]))}}},n.aC=Lo,n.aD=function(o,e,r){let a=JSON.stringify(o.request);return o.data&&(this.deduped.entries[a]={result:[null,o.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},f=>{let c=Ar(o.request,(p,v,w,M)=>{p?f(p):v&&f(null,{vectorTile:r?void 0:new kh.VectorTile(new n_(v)),rawData:v,cacheControl:w,expires:M})});return()=>{c.cancel(),f()}},e)},n.aE=function(o){Tt++,Tt>Le&&(o.getActor().send("enforceCacheSizeLimit",xe),Tt=0)},n.aF=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},n.aG=et,n.aH=EI,n.aI=CI,n.aJ=wI,n.aK=function(o,e){let r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<o.length;a++){let f=document.createElement("source");li(o[a])||(r.crossOrigin="Anonymous"),f.src=o[a],r.appendChild(f)}return{cancel:()=>{}}},n.aL=g_,n.aM=function(o){return fetch(o).then(e=>e.arrayBuffer()).then(e=>RS(e,0,o))},n.aN=OS,n.aO=class{constructor(o,e,r,a){this.id=o,this.position=e!=null?new mn(e[0],e[1]):new mn(0,0),this.orientation=r??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new wt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(Ee.mat4.multiply(o.matrix,e,o.matrix),o.meshes)for(let r of o.meshes){let a=wt.applyTransformFast(r.aabb,o.matrix);this.aabb.encapsulate(a)}if(o.children)for(let r of o.children)this._applyTransformations(r,o.matrix)}computeBoundsAndApplyParent(){let o=Ee.mat4.identity([]);for(let e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,r,a,f,c,p=!1){jI(this.matrix,this,o.transform,this.position,e,r,a,f,c,p)}upload(o){if(!this.uploaded){for(let e of this.nodes)gx(e,o);for(let e of this.nodes)w_(e);this.uploaded=!0}}destroy(){for(let o of this.nodes)_x(o)}},n.aP=al,n.aQ=Mp,n.aR=Pi,n.aS=jr,n.aT=ds,n.aU=Vr,n.aV=sa,n.aW=ip,n.aX=p_,n.aY=function(){Bi.isLoading()||Bi.isLoaded()||gh()!=="deferred"||kc()},n.aZ=Ig,n.a_=k,n.aa=i,n.ab=Ee,n.ac=So,n.ad=Cl,n.ae=wi,n.af=At,n.ag=ct,n.ah=ng,n.ai=ln,n.aj=vn,n.ak=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return function([r,a]){let f=Mi([1,r,a]);return{x:f.x,y:f.y,z:f.z}}(o.expression.evaluate(e))}interpolate(o,e,r){return{x:At(o.x,e.x,r),y:At(o.y,e.y,r),z:At(o.z,e.z,r)}}},n.al=function(o,e,r=0,a=!0){let f=new at(r,r),c=o.sub(f),p=e.add(f),v=[c,new at(p.x,c.y),p,new at(c.x,p.y)];return a&&v.push(c.clone()),v},n.am=function(o,e){let r=[];for(let a=0;a<o.length;a++){let f=ao(a-1,-1,o.length-1),c=ao(a+1,-1,o.length-1),p=o[a],v=o[c],w=o[f].sub(p).unit(),M=v.sub(p).unit(),_=M.angleWithSep(w.x,w.y),E=w.add(M).unit().mult(-1*e/Math.sin(_/2));r.push(p.add(E))}return r},n.an=lI,n.ao=ge,n.ap=function(o,e,r=0){return Ee.vec3.fromValues(((e.x-r)*o.scale-o.x)*ct,(e.y*o.scale-o.y)*ct,Hg(e.z,e.y))},n.aq=Nt,n.ar=ST,n.as=function(o){let e=1/0,r=1/0,a=-1/0,f=-1/0;for(let c of o)e=Math.min(e,c.x),r=Math.min(r,c.y),a=Math.max(a,c.x),f=Math.max(f,c.y);return{min:new at(e,r),max:new at(a,f)}},n.at=zo,n.au=le,n.av=m,n.aw=Yt,n.ax=ui,n.ay=function(o,e){let r={};for(let a=0;a<e.length;a++){let f=e[a];f in o&&(r[f]=o[f])}return r},n.az=Ws,n.b=function(o){return Dr.API_FONTS_REGEX.test(o)},n.b$=v_,n.b0=ul,n.b1=H0,n.b2=L0,n.b3=P,n.b4=hs,n.b5=np,n.b6=St,n.b7=ur,n.b8=fp,n.b9=lx,n.bA=iT,n.bB=nx,n.bC=iI,n.bD=Q0,n.bE=Lx,n.bF=ao,n.bG=dl,n.bH=hi,n.bI=function(o,e,r){o[4*e+0]=r[0],o[4*e+1]=r[1],o[4*e+2]=r[2],o[4*e+3]=r[3]},n.bJ=Jc,n.bK=Ji,n.bL=Ll,n.bM=pr,n.bN=Yc,n.bO=mn,n.bP=fI,n.bQ=qe,n.bR=fn,n.bS=RI,n.bT=Ye,n.bU=Kr,n.bV=function(o,e,r,a,f,c,p,v,w){if(w.name==="globe")return Kr(o,e,new Ye(r,a,f),!1);let M=Mp({z:r,x:a,y:f},w);return new wt([(c+M.x/M.scale)*e,e*(M.y/M.scale),p],[(c+M.x2/M.scale)*e,e*(M.y2/M.scale),v])},n.bW=function(o,e,r){let a=0;for(let f=0;f<2;++f)o[f]>0&&(a+=(o[f]-0)*(o[f]-0)),e[f]<0&&(a+=(0-e[f])*(0-e[f]));return a},n.bX=hr,n.bY=Ug,n.bZ=function(o){let e=Ee.mat4.identity(new Float64Array(16));Ee.mat4.multiply(e,o.pixelMatrix,o.globeMatrix);let r=[0,Vi,0],a=[0,ji,0];return Ee.vec3.transformMat4(r,r,e),Ee.vec3.transformMat4(a,a,e),[r[0]>0&&r[0]<=o.width&&r[1]>0&&r[1]<=o.height&&!eo(o,new mn(o.center.lat,90)),a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!eo(o,new mn(o.center.lat,-90))]},n.b_=function(o,e){let{scale:r}=o.tileTransform,a=r*ct/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return Ee.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},n.ba=function(o,e){let r=wi(e.zoom);if(r===0)return Er(o);let a=nr(o),f=Un(a),c=zo(a.getWest())*e.worldSize,p=zo(a.getEast())*e.worldSize,v=po(a.getNorth())*e.worldSize,w=po(a.getSouth())*e.worldSize,M=[c,v,0],_=[p,v,0],E=[c,w,0],D=[p,w,0],b=Ee.mat4.invert([],e.globeMatrix);return Ee.vec3.transformMat4(M,M,b),Ee.vec3.transformMat4(_,_,b),Ee.vec3.transformMat4(E,E,b),Ee.vec3.transformMat4(D,D,b),f[0]=Tr(f[0],E,r),f[1]=Tr(f[1],D,r),f[2]=Tr(f[2],_,r),f[3]=Tr(f[3],M,r),wt.fromPoints(f)},n.bb=Pr,n.bc=zn,n.bd=Tr,n.be=Pl,n.bf=Et,n.bg=Cx,n.bh=n_,n.bi=Ar,n.bj=function(o){let e=[];for(let r in o)e.push(o[r]);return e},n.bk=function(o,e){let r=[];for(let a in o)a in e||r.push(a);return r},n.bl=Os,n.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bn=si,n.bo=function(o,e){let{x:r,y:a}=o.point,f=Oi(r,a,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Ee.mat4.multiply(f,f,Vn(Er(e)))},n.bp=Fh,n.bq=mo,n.br=t_,n.bs=function(o,e,r,a,f){let c=5*e+2;o.float32[c+0]=r,o.float32[c+1]=a,o.float32[c+2]=f},n.bt=f_,n.bu=YT,n.bv=G,n.bw=Qr,n.bx=JE,n.by=kI,n.bz=rT,n.c=ju,n.c$=(o,e,r,a,f,c,p,v)=>{let w=o.transform,M=w.pitch<15?DT(.07,.7,Yt((14-w.zoom)/5,0,1)):.07,_=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:CT(o,e,r,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:f,u_width_scale:c,u_floor_width_scale:p,u_image:0,u_tile_units_to_pixels:MT(e,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(_?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:t(e.tileID.canonical,0)}},n.c0=AI,n.c1=function(o){let e=AI(o,!0);return Ee.mat2.invert([],[e[0],e[1],e[4],e[5]])},n.c2=an,n.c3=function(o){let{x:e,y:r}=o.point,{lng:a,lat:f}=o._center;return Oi(e,r,o.worldSize,a,f)},n.c4=Fr,n.c5=rt,n.c6=kl,n.c7=function(o){let e=Math.round((o+45+360)%360/90)%4;return Zi[e]},n.c8=45,n.c9=Ph,n.cA=class extends No{constructor(o){super(o),this.current=sp}set(o,e,r){if(this.fetchUniformLocation(o,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},n.cB=Ps,n.cC=function(o,e,r){let a=wi(r.zoom),f=o.style.map._antialias,c=o.terrain&&o.terrain.exaggeration()>0;return a===0&&!f&&!c},n.cD=function(o){let e=o.pixelsPerMeter,r=e/hi(1,o.center.lat),a=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.translate(a,a,[o.point.x,o.point.y,0]),Ee.mat4.scale(a,a,[r,r,e]),Float32Array.from(a)},n.cE=nr,n.cF=function(o){let e=hr-5;o=Yt(o,-e,e)/e*90;let r=Math.pow(Math.abs(Math.sin(ln(o))),3);return Math.round(r*(Rh.length-1))},n.cG=function(o,e,r,a){let f=e.getNorth(),c=e.getSouth(),p=e.getWest(),v=e.getEast(),w=1<<o.z,M=v-p,_=f-c,E=M/Fl,D=-_/Rh[r],b=[0,E,0,D,0,0,f,p,0];if(o.z>0){let T=180/a;Ee.mat3.multiply(b,b,[T/M+1,0,0,0,T/_+1,0,-.5*T/E,.5*T/D,1])}return b[2]=w,b[5]=o.x,b[8]=o.y,b},n.cH=Er,n.cI=function(o,e,r){let a=Ee.mat4.identity(new Float64Array(16)),f=(e/(1<<o)-.5)*Math.PI*2;return Ee.mat4.rotateY(a,r.globeMatrix,f),Float32Array.from(a)},n.cJ=class{isDataAvailableAtPoint(o){let e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;let r=e.getSource().maxzoom,a=1<<r,f=Math.floor(o.x),c=Math.floor((o.x-f)*a),p=Math.floor(o.y*a),v=this.findDEMTileFor(new et(r,f,r,c,p));return!(!v||!v.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||o.y<0||o.y>1)return e;let f=a.getSource().maxzoom,c=1<<f,p=Math.floor(o.x),v=o.x-p,w=new et(f,p,f,Math.floor(v*c),Math.floor(o.y*c)),M=this.findDEMTileFor(w);if(!M||!M.dem)return e;let _=M.dem,E=1<<M.tileID.canonical.z,D=(v*E-M.tileID.canonical.x)*_.dim,b=(o.y*E-M.tileID.canonical.y)*_.dim,T=Math.floor(D),C=Math.floor(b);return(r?this.exaggeration():1)*At(At(_.get(T,C),_.get(T,C+1),b-C),At(_.get(T+1,C),_.get(T+1,C+1),b-C),D-T)}getAtTileOffset(o,e,r){let a=1<<o.canonical.z;return this.getAtPointOrZero(new i(o.wrap+(o.canonical.x+e/ct)/a,(o.canonical.y+r/ct)/a))}getAtTileOffsetFunc(o,e,r,a){return f=>{let c=this.getAtTileOffset(o,f.x,f.y),p=a.upVector(o.canonical,f.x,f.y),v=a.upVectorScale(o.canonical,e,r).metersToTile;return Ee.vec3.scale(p,p,c*v),p}}getForTilePoints(o,e,r,a){if(this.isUsingMockSource())return!1;let f=Uh.create(this,o,a);return!!f&&(e.forEach(c=>{c[2]=this.exaggeration()*f.getElevationAt(c[0],c[1],r)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(o);if(!e||!e.dem)return null;let r=e.dem.tree,a=e.tileID,f=1<<o.canonical.z-a.canonical.z,c=o.canonical.x/f-a.canonical.x,p=o.canonical.y/f-a.canonical.y,v=0;for(let w=0;w<o.canonical.z-a.canonical.z&&!r.leaves[v];w++){c*=2,p*=2;let M=2*Math.floor(p)+Math.floor(c);v=r.childOffsets[v]+M,c%=1,p%=1}return{min:this.exaggeration()*r.minimums[v],max:this.exaggeration()*r.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,r=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let f of o){let c=this.getMinMaxForTile(f.tileID);c&&(r=Math.min(r,c.min),a=Math.max(a,c.max),e=!0)}return e?{min:r,max:a}:null}},n.cK=RE,n.cL=on,n.cM=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},n.cN=Qi,n.cO=Vu,n.cP=Bu,n.cQ=256,n.cR=function(o,e){let r=[0,0,0],a=Pr(Er(e.canonical));return Ee.vec3.transformMat4(r,r,a),Ee.vec3.transformMat4(r,r,o),r},n.cS=o=>({u_camera_to_center_distance:new pr(o),u_extrude_scale:new ap(o),u_device_pixel_ratio:new pr(o),u_matrix:new Jc(o),u_inv_rot_matrix:new Jc(o),u_merc_center:new Ji(o),u_tile_id:new Ll(o),u_zoom_transition:new pr(o),u_up_dir:new Ll(o),u_emissive_strength:new pr(o)}),n.cT=o=>({u_matrix:new Jc(o),u_pixels_to_tile_units:new ap(o),u_device_pixel_ratio:new pr(o),u_width_scale:new pr(o),u_floor_width_scale:new pr(o),u_units_to_pixels:new Ji(o),u_dash_image:new Yc(o),u_gradient_image:new Yc(o),u_image_height:new pr(o),u_texsize:new Ji(o),u_tile_units_to_pixels:new pr(o),u_alpha_discard_threshold:new pr(o),u_trim_offset:new Ji(o),u_trim_fade_range:new Ji(o),u_trim_color:new Kc(o),u_emissive_strength:new pr(o),u_zbias_factor:new pr(o),u_tile_to_meter:new pr(o)}),n.cU=o=>({u_matrix:new Jc(o),u_texsize:new Ji(o),u_pixels_to_tile_units:new ap(o),u_device_pixel_ratio:new pr(o),u_width_scale:new pr(o),u_floor_width_scale:new pr(o),u_image:new Yc(o),u_units_to_pixels:new Ji(o),u_tile_units_to_pixels:new pr(o),u_alpha_discard_threshold:new pr(o),u_trim_offset:new Ji(o),u_trim_fade_range:new Ji(o),u_trim_color:new Kc(o),u_emissive_strength:new pr(o),u_zbias_factor:new pr(o),u_tile_to_meter:new pr(o)}),n.cV=Kf,n.cW=_P,n.cX=yP,n.cY=Bl,n.cZ=(o,e,r,a,f,c)=>{let p=o.transform,v=p.projection.name==="globe",w;if(c.paint.get("circle-pitch-alignment")==="map")if(v){let _=Qi(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;w=Float32Array.from([_,0,0,_])}else w=p.calculatePixelsToTileUnitsMatrix(r);else w=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let M={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(p.projection),u_matrix:o.translatePosMatrix(e.projMatrix,r,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ue.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:Aa,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(v){M.u_inv_rot_matrix=a,M.u_merc_center=f,M.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],M.u_zoom_transition=wi(p.zoom);let _=f[0]*ct,E=f[1]*ct;M.u_up_dir=p.projection.upVector(new Ye(0,0,0),_,E)}return M},n.c_=AT,n.ca=Kc,n.cb=function(o,e,r){let a=Math.sqrt(o*o+e*e+r*r),f=a>0?Math.acos(r/a)*ol:0,c=o!==0||e!==0?Math.atan2(-e,-o)*ol+90:0;return c<0&&(c+=360),[a,c,f]},n.cc=t,n.cd=wt,n.ce=Mi,n.cf=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},n.cg=function(o,e){return o.readFields(cO,{icons:[]},e)},n.ch=function(o){return o({pluginStatus:Ai,pluginURL:js}),Sl.on("pluginStateChange",o),o},n.ci=I_,n.cj=zh,n.ck=ex,n.cl=Co,n.cm=jf,n.cn=ve,n.co=co,n.cp=Ni,n.cq=function(o){let e=o.indexOf(bh);return e>=0?o.slice(0,e):o},n.cr=function(o){return o.indexOf(bh)>=0},n.cs=function(o){let e=o.indexOf(bh);return e>=0?o.slice(e+1):""},n.ct=function(o){let e=[],r=o.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},n.cu=function(o,e,r,a){return o.type==="custom"?new XP(o,e):new sO[o.type](o,e,r,a)},n.cv=cl,n.cw=class extends Xh{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){let o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},n.cx=Sl,n.cy=Mr,n.cz=Bg,n.d=function(o){return Dr.API_TILEJSON_REGEX.test(o)},n.d$=kS,n.d0=(o,e,r,a,f,c,p,v,w)=>{let M=o.transform,_=M.calculatePixelsToTileUnitsMatrix(e),E=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",D=M.pitch<15?DT(.07,.7,Yt((14-M.zoom)/5,0,1)):.07;return{u_matrix:CT(o,e,r,a),u_pixels_to_tile_units:_,u_device_pixel_ratio:c,u_width_scale:p,u_floor_width_scale:v,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:RT(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:MT(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(E?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:t(e.tileID.canonical,0)}},n.d1=sl,n.d2=dp,n.d3=_T,n.d4=dt,n.d5=e_,n.d6=jl,n.d7=450,n.d8=7,n.d9=ZP,n.dA=oa,n.dB=u,n.dC=Da,n.dD=function([o,e,r]){let a=Math.hypot(o,e,r),f=Math.atan2(o,r),c=.5*Math.PI-Math.acos(-e/a);return new mn(Fr(f),Fr(c))},n.dE=fx,n.dF=function(o){let e=o.navigator?o.navigator.userAgent:null;return!!function(r){if(hl==null){let a=r.navigator?r.navigator.userAgent:null;hl=!!r.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return hl}(o)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.dG=function(o,e){xe=o,Le=e},n.dH=eo,n.dI=Bo,n.dJ=function(o){let e=[0,0,0],r=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.multiply(r,o.pixelMatrix,o.globeMatrix),Ee.vec3.transformMat4(e,e,r),new at(e[0],e[1])},n.dK=function(o,e,r=!1){if(Ai===Lc||Ai===ph||Ai===Vf)throw new Error("setRTLTextPlugin cannot be called multiple times.");js=ue.resolveURL(o),Ai=Lc,mh=e,Uf(),r||kc()},n.dL=gh,n.dM=function(){I_().acquire(vx)},n.dN=function(){let o=Fp;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(vx),Fp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.dO=T_,n.dP=function(o){let e=ot();if(!e)return;let r=e.delete(Ce);o&&r.catch(o).then(()=>o())},n.dQ=kp,n.dR=TS,n.dS=function(o){Ax=ue.resolveURL(o),Zh||(Zh=new $h(I_(),new ks)),Zh.broadcast("setDracoUrl",Ax)},n.dT=IS,n.dU=function(o){Wh=ue.resolveURL(o),Zh||(Zh=new $h(I_(),new ks)),Zh.broadcast("setMeshoptUrl",Wh)},n.dV=_t,n.dW=Vl,n.dX=ms,n.dY=kh,n.dZ=class{constructor(o,e){this.pos=o,this.dir=e}intersectsPlane(o,e,r){let a=Ee.vec2.dot(e,this.dir);if(Math.abs(a)<1e-6)return!1;let f=((o[0]-this.pos[0])*e[0]+(o[1]-this.pos[1])*e[1])/a;return r[0]=this.pos[0]+this.dir[0]*f,r[1]=this.pos[1]+this.dir[1]*f,!0}},n.d_=LS,n.da=xn,n.db=rp,n.dc=256,n.dd=Vn,n.de=ko,n.df=Hs,n.dg=Ih,n.dh=function(o,e,r,a,f){return Yt((o-e)/(r-e)*(f-a)+a,a,f)},n.di=ah,n.dj=zl,n.dk=class{constructor(o,e,r,a){this.context=o,this.format=a,this.size=r,this.texture=o.gl.createTexture();let[f,c,p]=this.size,{gl:v}=o;v.bindTexture(v.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),v.texImage3D(v.TEXTURE_3D,0,this.format,f,c,p,0,cx(this.format),ux(this.format),e.data)}bind(o,e){let{context:r}=this,{gl:a}=r;a.bindTexture(a.TEXTURE_3D,this.texture),o!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,o),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},n.dl=px,n.dm=[1,1,1],n.dn=Uh,n.dp=jh,n.dq=$s,n.dr=Ol,n.ds=Ma,n.dt=Sh,n.du=Fo,n.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new at(1/0,1/0),max:new at(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){let r=eT(new at(0,0),new at(ct,ct),o),a=[];if(e&&!B0(r,this._globalClipBounds))return a;for(let f of this._activeRegions){if(f.hiddenByOverlap||!B0(r,f))continue;let c=HR(f.min,f.max,o);a.push({min:c.min,max:c.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return a}setSources(o){this._setSources(o.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let r=[];for(let a of e.cache.getVisibleCoordinates()){let f=e.cache.getTile(a).buckets[e.layer];f&&f.updateFootprints(a.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(o){let e=o.getFootprints();if(e.length===0)return;let r=o.getOrder(),a=o.getClipMask(),f=o.getClipScope();for(let c of e){if(!c.footprint)continue;let p=eT(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:r,clipMask:a,clipScope:f})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||Jg(e.min,r.min)||Jg(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(a,f){let c=(p,v)=>p+v;return a.length-f.length||a.reduce(c,"").localeCompare(f.reduce(c,""))}(e.clipScope,r.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){let r=this._activeRegions[e],a=this._prevRegions[e];o=r.priority!==a.priority||!QE(r,a)||r.order!==a.order||r.clipMask!==a.clipMask||!si(r.clipScope,a.clipScope),++e}}if(o){++this._updateTime;for(let r of this._activeRegions)r.order!==Kg&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));let e=r=>{let a=this._activeRegions;if(r>=a.length)return r;let f=a[r].priority;for(;r<a.length&&a[r].priority===f;)++r;return r};if(this._sourceIds.length>1){let r=0,a=e(r);for(;r!==a;){let f=r,c=r;for(;f!==a;){let p=this._activeRegions[f];p.hiddenByOverlap=!1;for(let v=0;v<c;v++){let w=this._activeRegions[v];if(!w.hiddenByOverlap&&p.order===Kg&&B0(p,w)&&(p.hiddenByOverlap=nT(p.footprint,p.tileId,w.footprint,w.tileId),p.hiddenByOverlap))break}++f}r=a,a=e(r)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},n.dw=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let o of this._poleSegments)o.destroy();for(let o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){let r=new hs,a=new Vr,f=[],c=o+1+2,p=e[0]+1,v=e[0]+1+(1+e.length),w=(M,_,E)=>{let D=M===c-1?M-2:M===0?M:M-1;return D+=E?24575:0,[D,_]};for(let M=0;M<c;++M)r.emplaceBack(...w(M,0,!0));for(let M=0;M<p;++M)for(let _=0;_<c;++_)r.emplaceBack(...w(_,M,(_===0||_===c-1)&&!0));for(let M=0;M<e.length;++M){let _=e[M];for(let E=0;E<c;++E)r.emplaceBack(...w(E,_,!0))}for(let M=0;M<e.length;++M){let _=a.length,E=e[M]+1+2,D=new Vr;for(let C=0;C<E-1;C++){let O=C===E-2,L=O?c*(v-e.length+M-C):c;for(let B=0;B<c-1;B++){let j=C*c+B;C===0||O||B===0||B===c-2?(D.emplaceBack(j+1,j,j+L),D.emplaceBack(j+L,j+L+1,j+1)):(a.emplaceBack(j+1,j,j+L),a.emplaceBack(j+L,j+L+1,j+1))}}let b=ur.simpleSegment(0,_,r.length,a.length-_);for(let C=0;C<D.uint16.length;C+=3)a.emplaceBack(D.uint16[C],D.uint16[C+1],D.uint16[C+2]);let T=ur.simpleSegment(0,_,r.length,a.length-_);f.push({withoutSkirts:b,withSkirts:T})}return{vertices:r,indices:a,segments:f}}_createGrid(o){let e=this._fillGridMeshWithLods(Fl,Rh);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,St.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){let e=new Vr;for(let p=0;p<=Fl;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);let r=new Hs,a=new Hs,f=new Hs,c=new Hs;this._poleSegments=[];for(let p=0,v=0;p<kl;p++){let w=360/(1<<p);r.emplaceBack(0,-ui,0,.5,0),a.emplaceBack(0,-ui,0,.5,1),f.emplaceBack(0,-ui,0,.5,.5),c.emplaceBack(0,-ui,0,.5,.5);for(let M=0;M<=Fl;M++){let _=M/Fl,E=0,D=At(0,w,_),[b,T,C]=Nl(Ca,Vo,D,ui);r.emplaceBack(b,T,C,_,E),a.emplaceBack(b,T,C,_,1-E);let O=ln(D);_=.5+.5*Math.sin(O),E=.5+.5*Math.cos(O),f.emplaceBack(b,T,C,_,E),c.emplaceBack(b,T,C,_,1-E)}this._poleSegments.push(ur.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(r,Pt,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(a,Pt,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(f,Pt,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(c,Pt,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},n.dx=Kg,n.dy=ia,n.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.e=Dr,n.e0=ET,n.e1=ll,n.e2=Oo,n.e3=JT,n.e4=function(o,e,r,a,f,c,p,v,w,M,_=1,E,D){o.createArrays(),o.tilePixelRatio=ct/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;let b=o.layers[0].layout,T=o.layers[0]._unevaluatedLayout._values,C={};C.scaleFactor=_,C.textSizeScaleRange=b.get("text-size-scale-range"),C.iconSizeScaleRange=b.get("icon-size-scale-range");let[O,L]=C.textSizeScaleRange,[B,j]=C.iconSizeScaleRange;if(C.textScaleFactor=Yt(C.scaleFactor,O,L),C.iconScaleFactor=Yt(C.scaleFactor,B,j),o.textSizeData.kind==="composite"){let{minZoom:K,maxZoom:re}=o.textSizeData;C.compositeTextSizes=[T["text-size"].possiblyEvaluate(new Gn(K),v),T["text-size"].possiblyEvaluate(new Gn(re),v)]}if(o.iconSizeData.kind==="composite"){let{minZoom:K,maxZoom:re}=o.iconSizeData;C.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new Gn(K),v),T["icon-size"].possiblyEvaluate(new Gn(re),v)]}C.layoutTextSize=T["text-size"].possiblyEvaluate(new Gn(w+1),v),C.layoutIconSize=T["icon-size"].possiblyEvaluate(new Gn(w+1),v),C.textMaxSize=T["text-size"].possiblyEvaluate(new Gn(18),v);let z=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point",U=b.get("text-size"),q=!1;for(let K of o.features)if(K.icon&&K.icon.nameSecondary){q=!0;break}for(let K of o.features){let re=b.get("text-font").evaluate(K,{},v).join(","),ne=U.evaluate(K,{},v)*C.textScaleFactor,te=C.layoutTextSize.evaluate(K,{},v)*C.textScaleFactor,pe=(C.layoutIconSize.evaluate(K,{},v),{horizontal:{},vertical:void 0}),ie=K.text,me,ye=[0,0];if(ie){let Se=ie.toString(),Ae=b.get("text-letter-spacing").evaluate(K,{},v)*Qr,Ie=b.get("text-line-height").evaluate(K,{},v)*Qr,$e=m0(Se)?Ae:0,Ke=b.get("text-anchor").evaluate(K,{},v),Ue=b.get("text-variable-anchor");if(!Ue){let xt=b.get("text-radial-offset").evaluate(K,{},v);ye=xt?iI(Ke,[xt*Qr,tx]):b.get("text-offset").evaluate(K,{},v).map(ht=>ht*Qr)}let ut=z?"center":b.get("text-justify").evaluate(K,{},v),lt=b.get("symbol-placement")==="point",tt=lt?b.get("text-max-width").evaluate(K,{},v)*Qr:1/0,Je=xt=>{o.allowVerticalPlacement&&Ff(Se)&&(pe.vertical=J0(ie,e,r,f,re,tt,Ie,Ke,xt,$e,ye,mo.vertical,!0,te,ne))};if(!z&&Ue){let xt=ut==="auto"?Ue.map(mt=>nx(mt)):[ut],ht=!1;for(let mt=0;mt<xt.length;mt++){let Lt=xt[mt];if(!pe.horizontal[Lt])if(ht)pe.horizontal[Lt]=pe.horizontal[0];else{let Ht=J0(ie,e,r,f,re,tt,Ie,"center",Lt,$e,ye,mo.horizontal,!1,te,ne);Ht&&(pe.horizontal[Lt]=Ht,ht=Ht.positionedLines.length===1)}}Je("left")}else{if(ut==="auto"&&(ut=nx(Ke)),lt||b.get("text-writing-mode").indexOf("horizontal")>=0||!Ff(Se)){let xt=J0(ie,e,r,f,re,tt,Ie,Ke,ut,$e,ye,mo.horizontal,!1,te,ne);xt&&(pe.horizontal[ut]=xt)}Je(lt?"left":ut)}}let _e=!1;if(K.icon&&K.icon.namePrimary){let Se=W0(o.iconSizeData,T["icon-size"],v,o.zoom,K)*C.iconScaleFactor*E,Ae=K.icon.getPrimary().scaleSelf(Se).serialize(),Ie=a[Ae];Ie&&(me=MP(f[Ae],K.icon.nameSecondary?f[K.icon.getSecondary().scaleSelf(Se).serialize()]:void 0,b.get("icon-offset").evaluate(K,{},v),b.get("icon-anchor").evaluate(K,{},v)),_e=Ie.sdf,o.sdfIcons===void 0?o.sdfIcons=Ie.sdf:o.sdfIcons!==Ie.sdf&&qt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ie.pixelRatio!==o.pixelRatio||b.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}let be=sI(pe.horizontal)||pe.vertical;o.iconsInText||(o.iconsInText=!!be&&be.iconsInText),(be||me)&&kP(o,K,pe,me,a,C,te,0,ye,_e,p,v,M,D,q)}c&&o.generateCollisionDebugBuffers(w,o.collisionBoxArray,C.textScaleFactor)},n.e5=R_,n.e6=ra,n.e7=ZE,n.e8=NT,n.e9=F,n.ea=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==DS){let r=new Uint32Array(o,0,7),[,,a,f,c,p]=r;e=r.byteLength+f+c+p+c,(a!==o.byteLength||e>=o.byteLength)&&qt("Invalid b3dm header information.")}return RS(o,e)},n.eb=function(o,e){let r=OS(o);for(let a of r){for(let f of a.meshes)uL(f);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(hL(a.lights,e)))}return r},n.ec=E_,n.ed=WI,n.ee=Bi,n.ef=function(o){st(),ke?.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-o;a++)e.delete(r[a])})})},n.f=function(o){return o.indexOf("mapbox:")===0},n.g=function(o,e){return Mr(ai(o,{method:"GET"}),e)},n.h=sc,n.i=function(o){return Dr.API_STYLE_REGEX.test(o)&&!ju(o)},n.j=function(o){return decodeURIComponent(atob(o).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.k=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},n.l=ai,n.m=Mt,n.n=function(o,e){return Mr(ai(o,{type:"json"}),e)},n.o=Wd,n.p=function(o,e){return Mr(ai(o,{method:"POST"}),e)},n.q=ue,n.r=qr,n.s=function(o){try{let e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=Q,n.u=function(){return function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()},n.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},n.w=qt,n.x=function(){return xx||(xx=new T_),xx},n.y=Uu,n.z=Ro}),g(["./shared"],function(n){function F(Ne){let W=Ne?Ne.url.toString():void 0;return W?performance.getEntriesByName(W):[]}function H(Ne){if(typeof Ne=="number"||typeof Ne=="boolean"||typeof Ne=="string"||Ne==null)return JSON.stringify(Ne);if(Array.isArray(Ne)){let J="[";for(let Q of Ne)J+=`${H(Q)},`;return`${J}]`}let W="{";for(let J of Object.keys(Ne).sort())W+=`${J}:${H(Ne[J])},`;return`${W}}`}function $(Ne){let W="";for(let J of n.bm)(Ne.type!=="model"||J!=="minzoom"&&J!=="maxzoom")&&(W+=`/${H(Ne[J])}`);return W}class ae{constructor(W){this.keyCache={},this._layers={},this._layerConfigs={},W&&this.replace(W)}replace(W,J){this._layerConfigs={},this._layers={},this.update(W,[],J)}update(W,J,Q){this._options=Q;for(let de of W)this._layerConfigs[de.id]=de,(this._layers[de.id]=n.cu(de,this.scope,null,this._options)).compileFilter(Q),this.keyCache[de.id]&&delete this.keyCache[de.id];for(let de of J)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};let ue=function(de,ve){let Ce={};for(let Le=0;Le<de.length;Le++){let Oe=de[Le],ke=ve&&ve[Oe.id];!ke&&(ke=$(Oe),Oe.type==="line"&&Oe.paint)&&function ot(st){return typeof st=="string"&&st==="line-progress"||(Array.isArray(st)?st.some(ot):!(!st||typeof st!="object")&&Object.values(st).some(ot))}(Oe.paint["line-width"])&&(ke+=`/${H(Oe.paint["line-width"])}`),ve&&(ve[Oe.id]=ke);let Xe=Ce[ke];Xe||(Xe=Ce[ke]=[]),Xe.push(Oe)}let xe=[];for(let Le in Ce)xe.push(Ce[Le]);return xe}(n.bj(this._layerConfigs),this.keyCache);for(let de of ue){let ve=de.map(Xe=>this._layers[Xe.id]),Ce=ve[0];if(Ce.visibility==="none")continue;let xe=Ce.source||"",Le=this.familiesBySource[xe];Le||(Le=this.familiesBySource[xe]={});let Oe=Ce.sourceLayer||"_geojsonTileLayer",ke=Le[Oe];ke||(ke=Le[Oe]=[]),ke.push(ve)}}}let Te=1*n.dX;class Fe{constructor(W){let J={},Q=[];for(let Ce in W){let xe=W[Ce],Le=J[Ce]={};for(let Oe in xe.glyphs){let ke=xe.glyphs[+Oe];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;let Xe=ke.metrics.localGlyph?Te:1,ot={x:0,y:0,w:ke.bitmap.width+2*Xe,h:ke.bitmap.height+2*Xe};Q.push(ot),Le[Oe]=ot}}let{w:ue,h:de}=n.F(Q),ve=new n.dW({width:ue||1,height:de||1});for(let Ce in W){let xe=W[Ce];for(let Le in xe.glyphs){let Oe=xe.glyphs[+Le];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;let ke=J[Ce][Le],Xe=Oe.metrics.localGlyph?Te:1;n.dW.copy(Oe.bitmap,ve,{x:0,y:0},{x:ke.x+Xe,y:ke.y+Xe},Oe.bitmap)}}this.image=ve,this.positions=J}}n.dV(Fe,"GlyphAtlas");let Ze="3d_elevation_id",ze="hd_road_elevation";class pt{constructor(){this._valid=!1}reset(W){return this.feature=W,this._valid=!0,this._geometry=W.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(W,J){return this._valid&&W(J(this._geometry)),this}require(W,J,Q){return this.get(W,!0,J,Q)}optional(W,J,Q){return this.get(W,!1,J,Q)}success(){return this._valid}get(W,J,Q,ue){let de=this.feature.properties.hasOwnProperty(W)?+this.feature.properties[W]:void 0;return this._valid&&de!==void 0?Q(ue?ue(de):de):J&&(this._valid=!1),this}}class vt{constructor(W,J){this.featureFunc=W,this.vertexFunc=J}parseFeature(W,J,Q){return this.featureFunc(W,J,Q)}parseVertex(W,J,Q){return this.vertexFunc(W,J,Q)}}let Cn=new vt((Ne,W,J)=>Ne.reset(W).require(Ze,Q=>{J.id=Q}).optional("fixed_height_relative",Q=>{J.constantHeight=Q},Ft.decodeRelativeHeight).geometry(Q=>{J.bounds=Q},Ft.computeBounds).success(),(Ne,W,J)=>Ne.reset(W).require(Ze,Q=>{J.id=Q}).require("elevation_idx",Q=>{J.idx=Q}).require("extent",Q=>{J.extent=Q}).require("height_relative",Q=>{J.height=Q},Ft.decodeRelativeHeight).geometry(Q=>{J.position=Q},Ft.getPoint).success()),En=new vt((Ne,W,J)=>Ne.reset(W).require(Ze,Q=>{J.id=Q}).optional("fixed_height",Q=>{J.constantHeight=Q},Ft.decodeMetricHeight).geometry(Q=>{J.bounds=Q},Ft.computeBounds).success(),(Ne,W,J)=>Ne.reset(W).require(Ze,Q=>{J.id=Q}).require("elevation_idx",Q=>{J.idx=Q}).require("extent",Q=>{J.extent=Q}).require("height",Q=>{J.height=Q},Ft.decodeMetricHeight).geometry(Q=>{J.position=Q},Ft.getPoint).success());class Ft{static computeBounds(W){let J=new n.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Q=new n.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let ue of W[0])J.x>ue.x&&(J.x=ue.x),J.y>ue.y&&(J.y=ue.y),Q.x<ue.x&&(Q.x=ue.x),Q.y<ue.y&&(Q.y=ue.y);return{min:J,max:Q}}static getPoint(W){return n.ab.vec2.fromValues(W[0][0].x,W[0][0].y)}static decodeRelativeHeight(W){return 1e-4*W*5}static decodeMetricHeight(W){return 1e-4*W}static parse(W){let J=[],Q=[],ue=W.length,de=new pt;for(let Ce=0;Ce<ue;Ce++){let xe=W.feature(Ce),Le=xe.properties.hasOwnProperty("version")?String(xe.properties.version):void 0,Oe=(ve=Le)?ve==="1.0.1"?En:void 0:Cn;if(Oe===void 0){n.w(`Unknown elevation feature version number ${Le||"(unknown)"}`);continue}let ke=xe.properties.hasOwnProperty("type")?xe.properties.type:void 0;if(ke){if(n.dY.VectorTileFeature.types[xe.type]==="Point"&&ke==="curve_point"){let Xe={};Oe.parseVertex(de,xe,Xe)&&J.push(Xe)}else if(n.dY.VectorTileFeature.types[xe.type]==="Polygon"&&ke==="curve_meta"){let Xe={};Oe.parseFeature(de,xe,Xe)&&Q.push(Xe)}}}var ve;return{vertices:J,features:Q}}}class mi{constructor(W,J,Q,ue,de,ve){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=W,this.heightRange={min:Q,max:Q},this.safeArea=J,this.constantHeight=Q,this.constantHeight==null&&(this.constantHeight!=null||ue.length!==0)){this.vertices=ue,this.edges=de,this.edges=this.edges.filter(Ce=>Ce.a<this.vertices.length&&Ce.b<this.vertices.length&&!n.ab.vec2.exactEquals(this.vertices[Ce.a].position,this.vertices[Ce.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(let Ce of this.vertices)this.vertexProps.push({dir:n.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,Ce.height),this.heightRange.max=Math.max(this.heightRange.max,Ce.height);for(let Ce of this.edges){let xe=this.vertices[Ce.a].position,Le=this.vertices[Ce.b].position,Oe=n.ab.vec2.subtract(n.ab.vec2.create(),Le,xe),ke=n.ab.vec2.length(Oe),Xe=n.ab.vec2.scale(n.ab.vec2.create(),Oe,1/ke);this.edgeProps.push({vec:Oe,dir:Xe,len:ke});let ot=this.vertexProps[Ce.a].dir,st=this.vertexProps[Ce.b].dir;n.ab.vec2.add(ot,ot,Xe),n.ab.vec2.add(st,st,Xe)}for(let Ce of this.vertexProps)Ce.dir[0]===0&&Ce.dir[1]===0||n.ab.vec2.normalize(Ce.dir,Ce.dir);this.tessellate(ve)}}pointElevation(W){if(this.constantHeight!=null)return this.constantHeight;let J=this.getClosestEdge(W);if(J==null)return 0;let[Q,ue]=J;return(1-(de=ue))*this.vertices[this.edges[Q].a].height+de*this.vertices[this.edges[Q].b].height;var de}getClosestEdge(W){if(this.edges.length===0)return;let J=0,Q=Number.POSITIVE_INFINITY,ue=0,de=n.ab.vec2.fromValues(W.x,W.y);for(let ve=0;ve<this.edges.length;ve++){let Ce=this.edges[ve],xe=this.edgeProps[ve].dir,Le=new n.dZ(de,this.edgeProps[ve].dir),Oe=this.vertices[Ce.a].position,ke=this.vertices[Ce.b].position,Xe=n.ab.vec2.create(),ot=n.ab.vec2.create(),st=Le.intersectsPlane(Oe,this.vertexProps[Ce.a].dir,Xe),Tt=Le.intersectsPlane(ke,this.vertexProps[Ce.b].dir,ot);if(!st||!Tt)continue;let Mt=n.ab.vec2.subtract(n.ab.vec2.create(),ot,Xe),Ct=n.ab.vec2.subtract(n.ab.vec2.create(),de,Xe),Dt=n.ab.vec2.dot(Mt,Mt),sn=Dt>0?n.ab.vec2.dot(Ct,Mt)/Dt:0,hn=n.aw(sn,0,1),Kt=Math.abs((sn-hn)*this.edgeProps[ve].len),pn=n.ab.vec2.subtract(n.ab.vec2.create(),de,Oe),_n=Kt+Math.abs(n.ab.vec2.dot(pn,n.ab.vec2.fromValues(xe[1],-xe[0])));_n<Q&&(J=ve,Q=_n,ue=hn)}return[J,ue]}tessellate(W){for(let J=this.edges.length-1;J>=0;--J){let Q=this.edges[J].a,ue=this.edges[J].b,{position:de,height:ve,extent:Ce}=this.vertices[Q],{position:xe,height:Le,extent:Oe}=this.vertices[ue],ke=this.vertexProps[Q].dir,Xe=this.vertexProps[ue].dir,ot=n.ab.vec3.fromValues(de[0]/W,de[1]/W,ve),st=n.ab.vec3.fromValues(xe[0]/W,xe[1]/W,Le),Tt=n.ab.vec3.fromValues(ke[1],-ke[0],0);n.ab.vec3.scale(Tt,Tt,Ce);let Mt=n.ab.vec3.fromValues(Xe[1],-Xe[0],0);if(n.ab.vec3.scale(Mt,Mt,Oe),this.distSqLines(n.ab.vec3.fromValues(ot[0]+.5*Tt[0],ot[1]+.5*Tt[1],ot[2]+.5*Tt[2]),n.ab.vec3.fromValues(st[0]-.5*Mt[0],st[1]-.5*Mt[1],st[2]-.5*Mt[2]),n.ab.vec3.fromValues(ot[0]-.5*Tt[0],ot[1]-.5*Tt[1],ot[2]-.5*Tt[2]),n.ab.vec3.fromValues(st[0]+.5*Mt[0],st[1]+.5*Mt[1],st[2]+.5*Mt[2]))<=.05*.05)continue;let Ct=this.vertices.length,Dt=n.ab.vec2.add(n.ab.vec2.create(),de,xe);this.vertices.push({position:n.ab.vec2.scale(Dt,Dt,.5),height:.5*(ve+Le),extent:.5*(Ce+Oe)});let sn=n.ab.vec2.add(n.ab.vec2.create(),ke,Xe);this.vertexProps.push({dir:n.ab.vec2.normalize(sn,sn)}),this.edges.splice(J,1),this.edgeProps.splice(J,1),this.edges.push({a:Q,b:Ct}),this.edges.push({a:Ct,b:ue});let hn=n.ab.vec2.subtract(n.ab.vec2.create(),this.vertices[Ct].position,de),Kt=n.ab.vec2.length(hn),pn={vec:hn,dir:n.ab.vec2.scale(n.ab.vec2.create(),hn,1/Kt),len:Kt};this.edgeProps.push(pn),this.edgeProps.push(pn)}}distSqLines(W,J,Q,ue){let de=n.ab.vec3.subtract(n.ab.vec3.create(),J,W),ve=n.ab.vec3.subtract(n.ab.vec3.create(),ue,Q),Ce=n.ab.vec3.subtract(n.ab.vec3.create(),W,Q),xe=n.ab.vec3.dot(de,de),Le=n.ab.vec3.dot(de,ve),Oe=n.ab.vec3.dot(de,Ce),ke=n.ab.vec3.dot(ve,ve),Xe=n.ab.vec3.dot(ve,Ce),ot=xe*ke-Le*Le;if(ot===0){let Dt=n.ab.vec3.dot(Ce,ve)/n.ab.vec3.dot(ve,ve),sn=n.ab.vec3.lerp(n.ab.vec3.create(),Q,ue,Dt);return n.ab.vec3.squaredDistance(sn,W)}let st=(Le*Xe-Oe*ke)/ot,Tt=(xe*Xe-Le*Oe)/ot,Mt=n.ab.vec3.lerp(n.ab.vec3.create(),W,J,st),Ct=n.ab.vec3.lerp(n.ab.vec3.create(),Q,ue,Tt);return n.ab.vec3.squaredDistance(Mt,Ct)}}class Eo{static parseFrom(W,J){let Q=Ft.parse(W);if(!Q)return[];let{vertices:ue,features:de}=Q,ve=1/n.cc(J);de.sort((Oe,ke)=>Oe.id-ke.id),ue.sort((Oe,ke)=>Oe.id-ke.id||Oe.idx-ke.idx),ue=ue.filter((Oe,ke,Xe)=>ke===Xe.findIndex(ot=>ot.id===Oe.id&&ot.idx===Oe.idx));let Ce=new Array,xe=0,Le=ue.length;for(let Oe of de){if(Oe.constantHeight){Ce.push(new mi(Oe.id,Oe.bounds,Oe.constantHeight));continue}for(;xe!==Le&&ue[xe].id<Oe.id;)xe++;if(xe===Le||ue[xe].id!==Oe.id)continue;let ke=new Array,Xe=new Array,ot=xe;for(;xe!==Le&&ue[xe].id===Oe.id;){let st=ue[xe];if(ke.push({position:st.position,height:st.height,extent:st.extent}),xe!==ot&&ue[xe-1].idx===st.idx-1){let Tt=xe-ot;Xe.push({a:Tt-1,b:Tt})}xe++}Ce.push(new mi(Oe.id,Oe.bounds,void 0,ke,Xe,ve))}return Ce}}n.dV(mi,"ElevationFeature");class Bt{constructor(W){this.tileID=new n.aG(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.lut=W.lut,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.scope=W.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.request&&W.request.collectResourceTiming,this.promoteId=W.promoteId,this.isSymbolTile=W.isSymbolTile,this.tileTransform=n.aQ(W.tileID.canonical,W.projection),this.projection=W.projection,this.worldview=W.worldview,this.localizableLayerIds=W.localizableLayerIds,this.brightness=W.brightness,this.extraShadowCaster=!!W.extraShadowCaster,this.tessellationStep=W.tessellationStep,this.scaleFactor=W.scaleFactor}parse(W,J,Q,ue,de){this.status="parsing",this.data=W,this.collisionBoxArray=new n.aW;let ve=new n.d_(Object.keys(W.layers).sort()),Ce=new n.d$(this.tileID,this.promoteId);Ce.bucketLayerIDs=[];let xe={},Le=new n.e0(256,256),Oe={featureIndex:Ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Le,availableImages:Q,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},ke=J.familiesBySource[this.source];for(let Dt in ke){let sn=W.layers[Dt];if(!sn)continue;let hn=!1,Kt=!1,pn=!1;for(let Mr of ke[Dt])Mr[0].type==="symbol"?hn=!0:Kt=!0,Mr[0].is3D()&&Mr[0].type!=="model"&&(pn=!0);if(this.extraShadowCaster&&!pn||this.isSymbolTile===!0&&!hn||this.isSymbolTile===!1&&!Kt)continue;sn.version===1&&n.w(`Vector tile source "${this.source}" layer "${Dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let _n=ve.encode(Dt),vr=[],Co=!1;for(let Mr=0,Ar=0;Mr<sn.length;Mr++){let li=sn.feature(Mr),lc=Ce.getId(li,Dt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Dt)){let rs=li.properties?li.properties.worldview:null;if(this.worldview&&typeof rs=="string")if(rs==="all")li.properties.$localized=!0;else{if(!rs.split(",").includes(this.worldview))continue;li.properties.$localized=!0,li.properties.worldview=this.worldview}}!Co&&li.properties&&li.properties.hasOwnProperty(Ze)&&(Co=!0),vr.push({feature:li,id:lc,index:Ar,sourceLayerIndex:_n}),Ar++}Co&&W.layers.hasOwnProperty(ze)&&(Oe.elevationFeatures=Eo.parseFrom(W.layers[ze],this.canonical));for(let Mr of ke[Dt]){let Ar=Mr[0];(!this.extraShadowCaster||Ar.is3D()&&Ar.type!=="model")&&(this.isSymbolTile!==void 0&&Ar.type==="symbol"!==this.isSymbolTile||Ar.minzoom&&this.zoom<Math.floor(Ar.minzoom)||Ar.maxzoom&&this.zoom>=Ar.maxzoom||Ar.visibility!=="none"&&(To(Mr,this.zoom,Oe.brightness,Q),(xe[Ar.id]=Ar.createBucket({index:Ce.bucketLayerIDs.length,layers:Mr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_n,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(vr,Oe,this.tileID.canonical,this.tileTransform),Ce.bucketLayerIDs.push(Mr.map(li=>n.aC(li.id,li.scope)))))}}let Xe,ot,st,Tt;Le.trim();let Mt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ct=()=>{if(Xe)return this.status="done",de(Xe);if(this.extraShadowCaster)this.status="done",de(null,{buckets:n.bj(xe).filter(Dt=>!Dt.isEmpty()),featureIndex:Ce,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Oe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ot&&st&&Tt){let Dt=new Fe(ot),sn=new n.e3(st,Tt,this.lut);for(let hn in xe){let Kt=xe[hn];Kt instanceof n.aX?(To(Kt.layers,this.zoom,Oe.brightness,Q),n.e4(Kt,ot,Dt.positions,st,sn.iconPositions,this.showCollisionBoxes,Q,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Kt.hasPattern&&(Kt instanceof n.b1||Kt instanceof n.b2||Kt instanceof n.d5)&&(To(Kt.layers,this.zoom,Oe.brightness,Q),Kt.addFeatures(Oe,this.tileID.canonical,sn.patternPositions,Q,this.tileTransform,this.brightness))}this.status="done",de(null,{buckets:n.bj(xe).filter(hn=>!hn.isEmpty()),featureIndex:Ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Dt.image,lineAtlas:Le,imageAtlas:sn,brightness:Oe.brightness})}};if(!this.extraShadowCaster){let Dt=n.e1(Oe.glyphDependencies,Kt=>Object.keys(Kt).map(Number));Object.keys(Dt).length?ue.send("getGlyphs",{uid:this.uid,stacks:Dt,scope:this.scope},(Kt,pn)=>{Xe||(Xe=Kt,ot=pn,Ct())},void 0,!1,Mt):ot={};let sn=Object.keys(Oe.iconDependencies);sn.length?ue.send("getImages",{icons:sn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Kt,pn)=>{if(Xe)return;Xe=Kt;let _n={};Object.values(pn).some(vr=>vr.usvg)?this.rasterize(ue,_n,pn,Oe.iconDependencies,()=>{st=_n,Ct()}):(this.fillImageMap(_n,Oe.iconDependencies,pn),st=_n,Ct())},void 0,!1,Mt):st={};let hn=Object.keys(Oe.patternDependencies);hn.length?ue.send("getImages",{icons:hn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Kt,pn)=>{if(!Xe){Xe=Kt;let _n={};Object.values(pn).some(vr=>vr.usvg)?this.rasterize(ue,_n,pn,Oe.patternDependencies,()=>{Tt=_n,Ct()}):(this.fillImageMap(_n,Oe.patternDependencies,pn),Tt=_n,Ct())}},void 0,!1,Mt):Tt={}}Ct()}fillImageMap(W,J,Q){for(let ue in Q){let de=J[ue]||[];for(let ve of de)Q[ve.id].usvg||(W[ve.serialize()]=Q[ve.id])}}getImageTaskQueue(W,J,Q){let ue={};for(let de in J){let ve=Q[de]||[];for(let Ce of ve){let xe=Ce.serialize();J[Ce.id].usvg?ue[xe]||(ue[xe]=Ce):W[xe]=J[Ce.id]}}return ue}rasterize(W,J,Q,ue,de){let ve=this.getImageTaskQueue(J,Q,ue);this.rasterizeTask=W.send("rasterizeImages",{scope:this.scope,imageTasks:ve},(Ce,xe)=>{if(!Ce)for(let Le in xe){let{id:Oe}=n.e2.deserializeFromString(Le);J[Le]=Object.assign({},Q[Oe],{data:xe[Le]})}de()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function To(Ne,W,J,Q){let ue=new n.a8(W,{brightness:J});for(let de of Ne)de.recalculate(ue,Q)}class Jo extends n.E{constructor(W,J,Q,ue,de,ve){super(),this.actor=W,this.layerIndex=J,this.availableImages=Q,this.loadVectorData=de||n.aD,this.loading={},this.loaded={},this.deduped=new n.aB(W.scheduler),this.isSpriteLoaded=ue,this.scheduler=W.scheduler,this.brightness=ve}loadTile(W,J){let Q=W.uid,ue=W&&W.request,de=ue&&ue.collectResourceTiming,ve=this.loading[Q]=new Bt(W);ve.abort=this.loadVectorData(W,(Ce,xe)=>{let Le=!this.loading[Q];if(delete this.loading[Q],ve.cancelRasterize(),Le||Ce||!xe)return ve.status="done",Le||(this.loaded[Q]=ve),J(Ce);let Oe=xe.rawData,ke={};xe.expires&&(ke.expires=xe.expires),xe.cacheControl&&(ke.cacheControl=xe.cacheControl),ve.vectorTile=xe.vectorTile||new n.dY.VectorTile(new n.bh(Oe));let Xe=()=>{ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,(ot,st)=>{if(ot||!st)return J(ot);let Tt={};if(de){let Mt=F(ue);Mt.length>0&&(Tt.resourceTiming=JSON.parse(JSON.stringify(Mt)))}J(null,n.l({rawTileData:Oe.slice(0)},st,ke,Tt))})};this.isSpriteLoaded?Xe():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Xe,{type:"parseTile",isSymbolTile:W.isSymbolTile,zoom:W.tileZoom}):Xe()}),this.loaded=this.loaded||{},this.loaded[Q]=ve})}reloadTile(W,J){let Q=this.loaded,ue=W.uid;if(Q&&Q[ue]){let de=Q[ue];de.scaleFactor=W.scaleFactor,de.showCollisionBoxes=W.showCollisionBoxes,de.projection=W.projection,de.brightness=W.brightness,de.tileTransform=n.aQ(W.tileID.canonical,W.projection),de.extraShadowCaster=W.extraShadowCaster,de.lut=W.lut;let ve=(Ce,xe)=>{let Le=de.reloadCallback;Le&&(delete de.reloadCallback,de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,Le)),J(Ce,xe)};de.status==="parsing"?de.reloadCallback=ve:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,ve):ve())}else J(null,void 0)}abortTile(W,J){let Q=W.uid,ue=this.loading[Q];ue&&(ue.abort&&ue.abort(),delete this.loading[Q]),J()}removeTile(W,J){let Q=this.loaded,ue=W.uid;Q&&Q[ue]&&delete Q[ue],J()}}class Vt{loadTile(W,J){let{uid:Q,encoding:ue,rawImageData:de,padding:ve}=W,Ce=ImageBitmap&&de instanceof ImageBitmap?this.getImageData(de,ve):de;J(null,new n.e5(Q,Ce,ue,ve<1))}getImageData(W,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);let Q=this.offscreenCanvasContext.getImageData(-J,-J,W.width+2*J,W.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Q}}n.bg.setPbf(n.bh);class Ut{decodeRasterArray({task:W,buffer:J},Q){n.bg.performDecoding(J,W).then(ue=>{Q(null,ue)},ue=>{Q(ue)})}}let Xa=n.dY.VectorTileFeature.prototype.toGeoJSON;class Ya{constructor(W){this._feature=W,this.extent=n.ag,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){let W=[];for(let J of this._feature.geometry)W.push([new n.P(J[0],J[1])]);return W}{let W=[];for(let J of this._feature.geometry){let Q=[];for(let ue of J)Q.push(new n.P(ue[0],ue[1]));W.push(Q)}return W}}toGeoJSON(W,J,Q){return Xa.call(this,W,J,Q)}}class Fu{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.ag,this.length=W.length,this._features=W}feature(W){return new Ya(this._features[W])}}let Xt=64/4096,gi=128;class Qo{constructor(){this.features=new Map}clear(){this.features.clear()}load(W=[],J){for(let Q of W){let ue=Q.id;if(ue==null)continue;let de=this.features.get(ue);de&&this.updateCache(de,J),Q.geometry?(de=nn(Q),this.updateCache(de,J),this.features.set(ue,de)):this.features.delete(ue),this.updateCache(de,J)}}updateCache(W,J){for(let{canonical:Q,uid:ue}of Object.values(J)){let{z:de,x:ve,y:Ce}=Q;Ka(W,Math.pow(2,de),ve,Ce)&&delete J[ue]}}getTile(W,J,Q){let ue=Math.pow(2,W),de=[];for(let ve of this.features.values())Ka(ve,ue,J,Q)&&de.push(Gt(ve,ue,J,Q));return{features:de}}getFeatures(){return[...this.features.values()]}}function Ka({minX:Ne,minY:W,maxX:J,maxY:Q},ue,de,ve){return Ne<(de+1+Xt)/ue&&W<(ve+1+Xt)/ue&&J>(de-Xt)/ue&&Q>(ve-Xt)/ue}function nn(Ne){let{id:W,geometry:J,properties:Q}=Ne;if(!J)return;if(J.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:ue,coordinates:de}=J,ve={id:W,type:1,geometry:[],tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ce=ve.geometry;if(ue==="Point")es(de,Ce,ve);else if(ue==="MultiPoint")for(let xe of de)es(xe,Ce,ve);else if(ue==="LineString")ve.type=2,Ja(de,Ce,ve);else if(ue==="MultiLineString")ve.type=2,Rs(de,Ce,ve);else if(ue==="Polygon")ve.type=3,Rs(de,Ce,ve,!0);else{if(ue!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ve.type=3;for(let xe of de)Rs(xe,Ce,ve,!0)}return ve}function es([Ne,W],J,Q){let ue=n.at(Ne),de=n.aA(W);de=de<0?0:de>1?1:de,J.push(ue,de),Q.minX=Math.min(Q.minX,ue),Q.minY=Math.min(Q.minY,de),Q.maxX=Math.max(Q.maxX,ue),Q.maxY=Math.max(Q.maxY,de)}function Ja(Ne,W,J,Q=!1,ue=!1){let de=[];for(let ve of Ne)es(ve,de,J);W.push(de),Q&&function(ve,Ce){let xe=0;for(let Le=0,Oe=ve.length,ke=Oe-2;Le<Oe;ke=Le,Le+=2)xe+=(ve[Le]-ve[ke])*(ve[Le+1]+ve[ke+1]);if(xe>0===Ce)for(let Le=0,Oe=ve.length;Le<Oe/2;Le+=2){let ke=ve[Le],Xe=ve[Le+1];ve[Le]=ve[Oe-2-Le],ve[Le+1]=ve[Oe-1-Le],ve[Oe-2-Le]=ke,ve[Oe-1-Le]=Xe}}(de,ue)}function Rs(Ne,W,J,Q=!1){for(let ue=0;ue<Ne.length;ue++)Ja(Ne[ue],W,J,Q,ue===0)}function Gt(Ne,W,J,Q){let{id:ue,type:de,geometry:ve,tags:Ce}=Ne,xe=[];if(de===1)(function(Le,Oe,ke,Xe,ot){for(let st=0;st<Le.length;st+=2){let Tt=Math.round(n.ag*(Le[st+0]*Oe-ke)),Mt=Math.round(n.ag*(Le[st+1]*Oe-Xe));ot.push([Tt,Mt])}})(ve,W,J,Q,xe);else for(let Le of ve)qd(Le,W,J,Q,xe);return{id:ue,type:de,geometry:xe,tags:Ce}}function qd(Ne,W,J,Q,ue){let de=-gi,ve=n.ag+gi,Ce;for(let xe=0;xe<Ne.length-2;xe+=2){let Le=Math.round(n.ag*(Ne[xe+0]*W-J)),Oe=Math.round(n.ag*(Ne[xe+1]*W-Q)),ke=Math.round(n.ag*(Ne[xe+2]*W-J)),Xe=Math.round(n.ag*(Ne[xe+3]*W-Q)),ot=ke-Le,st=Xe-Oe;Le<de&&ke<de||(Le<de?(Oe+=Math.round(st*((de-Le)/ot)),Le=de):ke<de&&(Xe=Oe+Math.round(st*((de-Le)/ot)),ke=de),Oe<de&&Xe<de||(Oe<de?(Le+=Math.round(ot*((de-Oe)/st)),Oe=de):Xe<de&&(ke=Le+Math.round(ot*((de-Oe)/st)),Xe=de),Le>=ve&&ke>=ve||(Le>=ve?(Oe+=Math.round(st*((ve-Le)/ot)),Le=ve):ke>=ve&&(Xe=Oe+Math.round(st*((ve-Le)/ot)),ke=ve),Oe>=ve&&Xe>=ve||(Oe>=ve?(Le+=Math.round(ot*((ve-Oe)/st)),Oe=ve):Xe>=ve&&(ke=Le+Math.round(ot*((ve-Oe)/st)),Xe=ve),Ce&&Le===Ce[Ce.length-1][0]&&Oe===Ce[Ce.length-1][1]||(Ce=[[Le,Oe]],ue.push(Ce)),Ce.push([ke,Xe])))))}}var Qa,el,tl,Io={exports:{}},nl=function(){if(tl)return Io.exports;tl=1;var Ne=n.e8(),W=function(){if(el)return Qa;el=1;var Oe=n.e6(),ke=n.e7().VectorTileFeature;function Xe(st,Tt){this.options=Tt||{},this.features=st,this.length=st.length}function ot(st,Tt){this.id=typeof st.id=="number"?st.id:void 0,this.type=st.type,this.rawGeometry=st.type===1?[st.geometry]:st.geometry,this.properties=st.tags,this.extent=Tt||4096}return Qa=Xe,Xe.prototype.feature=function(st){return new ot(this.features[st],this.options.extent)},ot.prototype.loadGeometry=function(){var st=this.rawGeometry;this.geometry=[];for(var Tt=0;Tt<st.length;Tt++){for(var Mt=st[Tt],Ct=[],Dt=0;Dt<Mt.length;Dt++)Ct.push(new Oe(Mt[Dt][0],Mt[Dt][1]));this.geometry.push(Ct)}return this.geometry},ot.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var st=this.geometry,Tt=1/0,Mt=-1/0,Ct=1/0,Dt=-1/0,sn=0;sn<st.length;sn++)for(var hn=st[sn],Kt=0;Kt<hn.length;Kt++){var pn=hn[Kt];Tt=Math.min(Tt,pn.x),Mt=Math.max(Mt,pn.x),Ct=Math.min(Ct,pn.y),Dt=Math.max(Dt,pn.y)}return[Tt,Ct,Mt,Dt]},ot.prototype.toGeoJSON=ke.prototype.toGeoJSON,Qa}();function J(Oe){var ke=new Ne;return function(Xe,ot){for(var st in Xe.layers)ot.writeMessage(3,Q,Xe.layers[st])}(Oe,ke),ke.finish()}function Q(Oe,ke){var Xe;ke.writeVarintField(15,Oe.version||1),ke.writeStringField(1,Oe.name||""),ke.writeVarintField(5,Oe.extent||4096);var ot={keys:[],values:[],keycache:{},valuecache:{}};for(Xe=0;Xe<Oe.length;Xe++)ot.feature=Oe.feature(Xe),ke.writeMessage(2,ue,ot);var st=ot.keys;for(Xe=0;Xe<st.length;Xe++)ke.writeStringField(3,st[Xe]);var Tt=ot.values;for(Xe=0;Xe<Tt.length;Xe++)ke.writeMessage(4,Le,Tt[Xe])}function ue(Oe,ke){var Xe=Oe.feature;Xe.id!==void 0&&ke.writeVarintField(1,Xe.id),ke.writeMessage(2,de,Oe),ke.writeVarintField(3,Xe.type),ke.writeMessage(4,xe,Xe)}function de(Oe,ke){var Xe=Oe.feature,ot=Oe.keys,st=Oe.values,Tt=Oe.keycache,Mt=Oe.valuecache;for(var Ct in Xe.properties){var Dt=Xe.properties[Ct],sn=Tt[Ct];if(Dt!==null){sn===void 0&&(ot.push(Ct),Tt[Ct]=sn=ot.length-1),ke.writeVarint(sn);var hn=typeof Dt;hn!=="string"&&hn!=="boolean"&&hn!=="number"&&(Dt=JSON.stringify(Dt));var Kt=hn+":"+Dt,pn=Mt[Kt];pn===void 0&&(st.push(Dt),Mt[Kt]=pn=st.length-1),ke.writeVarint(pn)}}}function ve(Oe,ke){return(ke<<3)+(7&Oe)}function Ce(Oe){return Oe<<1^Oe>>31}function xe(Oe,ke){for(var Xe=Oe.loadGeometry(),ot=Oe.type,st=0,Tt=0,Mt=Xe.length,Ct=0;Ct<Mt;Ct++){var Dt=Xe[Ct],sn=1;ot===1&&(sn=Dt.length),ke.writeVarint(ve(1,sn));for(var hn=ot===3?Dt.length-1:Dt.length,Kt=0;Kt<hn;Kt++){Kt===1&&ot!==1&&ke.writeVarint(ve(2,hn-1));var pn=Dt[Kt].x-st,_n=Dt[Kt].y-Tt;ke.writeVarint(Ce(pn)),ke.writeVarint(Ce(_n)),st+=pn,Tt+=_n}ot===3&&ke.writeVarint(ve(7,1))}}function Le(Oe,ke){var Xe=typeof Oe;Xe==="string"?ke.writeStringField(1,Oe):Xe==="boolean"?ke.writeBooleanField(7,Oe):Xe==="number"&&(Oe%1!=0?ke.writeDoubleField(3,Oe):Oe<0?ke.writeSVarintField(6,Oe):ke.writeVarintField(5,Oe))}return Io.exports=J,Io.exports.fromVectorTileJs=J,Io.exports.fromGeojsonVt=function(Oe,ke){ke=ke||{};var Xe={};for(var ot in Oe)Xe[ot]=new W(Oe[ot].features,ke),Xe[ot].name=ot,Xe[ot].version=ke.version,Xe[ot].extent=ke.extent;return J({layers:Xe})},Io.exports.GeoJSONWrapper=W,Io.exports}(),Ee=n.e9(nl);let rl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ne=>Ne},il=Math.fround||(ra=new Float32Array(1),Ne=>(ra[0]=+Ne,ra[0]));var ra;let at=3,si=5,_i=6;class ol{constructor(W){this.options=Object.assign(Object.create(rl),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){let{log:J,minZoom:Q,maxZoom:ue}=this.options;J&&console.time("total time");let de=`prepare ${W.length} points`;J&&console.time(de),this.points=W;let ve=[];for(let xe=0;xe<W.length;xe++){let Le=W[xe];if(!Le.geometry)continue;let[Oe,ke]=Le.geometry.coordinates,Xe=il(Zi(Oe)),ot=il(Ps(ke));ve.push(Xe,ot,1/0,xe,-1,1),this.options.reduce&&ve.push(0)}let Ce=this.trees[ue+1]=this._createTree(ve);J&&console.timeEnd(de);for(let xe=ue;xe>=Q;xe--){let Le=+Date.now();Ce=this.trees[xe]=this._createTree(this._cluster(Ce,xe)),J&&console.log("z%d: %d clusters in %dms",xe,Ce.numItems,+Date.now()-Le)}return J&&console.timeEnd("total time"),this}getClusters(W,J){let Q=((W[0]+180)%360+360)%360-180,ue=Math.max(-90,Math.min(90,W[1])),de=W[2]===180?180:((W[2]+180)%360+360)%360-180,ve=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)Q=-180,de=180;else if(Q>de){let ke=this.getClusters([Q,ue,180,ve],J),Xe=this.getClusters([-180,ue,de,ve],J);return ke.concat(Xe)}let Ce=this.trees[this._limitZoom(J)],xe=Ce.range(Zi(Q),Ps(ve),Zi(de),Ps(ue)),Le=Ce.data,Oe=[];for(let ke of xe){let Xe=this.stride*ke;Oe.push(Le[Xe+si]>1?ln(Le,Xe,this.clusterProps):this.points[Le[Xe+at]])}return Oe}getChildren(W){let J=this._getOriginId(W),Q=this._getOriginZoom(W),ue="No cluster with the specified id.",de=this.trees[Q];if(!de)throw new Error(ue);let ve=de.data;if(J*this.stride>=ve.length)throw new Error(ue);let Ce=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),xe=de.within(ve[J*this.stride],ve[J*this.stride+1],Ce),Le=[];for(let Oe of xe){let ke=Oe*this.stride;ve[ke+4]===W&&Le.push(ve[ke+si]>1?ln(ve,ke,this.clusterProps):this.points[ve[ke+at]])}if(Le.length===0)throw new Error(ue);return Le}getLeaves(W,J,Q){let ue=[];return this._appendLeaves(ue,W,J=J||10,Q=Q||0,0),ue}getTile(W,J,Q){let ue=this.trees[this._limitZoom(W)],de=Math.pow(2,W),{extent:ve,radius:Ce}=this.options,xe=Ce/ve,Le=(Q-xe)/de,Oe=(Q+1+xe)/de,ke={features:[]};return this._addTileFeatures(ue.range((J-xe)/de,Le,(J+1+xe)/de,Oe),ue.data,J,Q,de,ke),J===0&&this._addTileFeatures(ue.range(1-xe/de,Le,1,Oe),ue.data,de,Q,de,ke),J===de-1&&this._addTileFeatures(ue.range(0,Le,xe/de,Oe),ue.data,-1,Q,de,ke),ke.features.length?ke:null}getClusterExpansionZoom(W){let J=this._getOriginZoom(W)-1;for(;J<=this.options.maxZoom;){let Q=this.getChildren(W);if(J++,Q.length!==1)break;W=Q[0].properties.cluster_id}return J}_appendLeaves(W,J,Q,ue,de){let ve=this.getChildren(J);for(let Ce of ve){let xe=Ce.properties;if(xe&&xe.cluster?de+xe.point_count<=ue?de+=xe.point_count:de=this._appendLeaves(W,xe.cluster_id,Q,ue,de):de<ue?de++:W.push(Ce),W.length===Q)break}return de}_createTree(W){let J=new n.bE(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Q=0;Q<W.length;Q+=this.stride)J.add(W[Q],W[Q+1]);return J.finish(),J.data=W,J}_addTileFeatures(W,J,Q,ue,de,ve){for(let Ce of W){let xe=Ce*this.stride,Le=J[xe+si]>1,Oe,ke,Xe;if(Le)Oe=Fr(J,xe,this.clusterProps),ke=J[xe],Xe=J[xe+1];else{let Tt=this.points[J[xe+at]];Oe=Tt.properties;let[Mt,Ct]=Tt.geometry.coordinates;ke=Zi(Mt),Xe=Ps(Ct)}let ot={type:1,geometry:[[Math.round(this.options.extent*(ke*de-Q)),Math.round(this.options.extent*(Xe*de-ue))]],tags:Oe},st;st=Le||this.options.generateId?J[xe+at]:this.points[J[xe+at]].id,st!==void 0&&(ot.id=st),ve.features.push(ot)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,J){let{radius:Q,extent:ue,reduce:de,minPoints:ve}=this.options,Ce=Q/(ue*Math.pow(2,J)),xe=W.data,Le=[],Oe=this.stride;for(let ke=0;ke<xe.length;ke+=Oe){if(xe[ke+2]<=J)continue;xe[ke+2]=J;let Xe=xe[ke],ot=xe[ke+1],st=W.within(xe[ke],xe[ke+1],Ce),Tt=xe[ke+si],Mt=Tt;for(let Ct of st){let Dt=Ct*Oe;xe[Dt+2]>J&&(Mt+=xe[Dt+si])}if(Mt>Tt&&Mt>=ve){let Ct,Dt=Xe*Tt,sn=ot*Tt,hn=-1,Kt=(ke/Oe<<5)+(J+1)+this.points.length;for(let pn of st){let _n=pn*Oe;if(xe[_n+2]<=J)continue;xe[_n+2]=J;let vr=xe[_n+si];Dt+=xe[_n]*vr,sn+=xe[_n+1]*vr,xe[_n+4]=Kt,de&&(Ct||(Ct=this._map(xe,ke,!0),hn=this.clusterProps.length,this.clusterProps.push(Ct)),de(Ct,this._map(xe,_n)))}xe[ke+4]=Kt,Le.push(Dt/Mt,sn/Mt,1/0,Kt,-1,Mt),de&&Le.push(hn)}else{for(let Ct=0;Ct<Oe;Ct++)Le.push(xe[ke+Ct]);if(Mt>1)for(let Ct of st){let Dt=Ct*Oe;if(!(xe[Dt+2]<=J)){xe[Dt+2]=J;for(let sn=0;sn<Oe;sn++)Le.push(xe[Dt+sn])}}}}return Le}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,J,Q){if(W[J+si]>1){let ve=this.clusterProps[W[J+_i]];return Q?Object.assign({},ve):ve}let ue=this.points[W[J+at]].properties,de=this.options.map(ue);return Q&&de===ue?Object.assign({},de):de}}function ln(Ne,W,J){return{type:"Feature",id:Ne[W+at],properties:Fr(Ne,W,J),geometry:{type:"Point",coordinates:[(Q=Ne[W],360*(Q-.5)),ia(Ne[W+1])]}};var Q}function Fr(Ne,W,J){let Q=Ne[W+si],ue=Q>=1e4?`${Math.round(Q/1e3)}k`:Q>=1e3?Math.round(Q/100)/10+"k":Q,de=Ne[W+_i],ve=de===-1?{}:Object.assign({},J[de]);return Object.assign(ve,{cluster:!0,cluster_id:Ne[W+at],point_count:Q,point_count_abbreviated:ue})}function Zi(Ne){return Ne/360+.5}function Ps(Ne){let W=Math.sin(Ne*Math.PI/180),J=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return J<0?0:J>1?1:J}function ia(Ne){let W=(180-360*Ne)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function oa(Ne,W,J,Q){let ue=Q,de=W+(J-W>>1),ve,Ce=J-W,xe=Ne[W],Le=Ne[W+1],Oe=Ne[J],ke=Ne[J+1];for(let Xe=W+3;Xe<J;Xe+=3){let ot=Yt(Ne[Xe],Ne[Xe+1],xe,Le,Oe,ke);if(ot>ue)ve=Xe,ue=ot;else if(ot===ue){let st=Math.abs(Xe-de);st<Ce&&(ve=Xe,Ce=st)}}ue>Q&&(ve-W>3&&oa(Ne,W,ve,Q),Ne[ve+2]=ue,J-ve>3&&oa(Ne,ve,J,Q))}function Yt(Ne,W,J,Q,ue,de){let ve=ue-J,Ce=de-Q;if(ve!==0||Ce!==0){let xe=((Ne-J)*ve+(W-Q)*Ce)/(ve*ve+Ce*Ce);xe>1?(J=ue,Q=de):xe>0&&(J+=ve*xe,Q+=Ce*xe)}return ve=Ne-J,Ce=W-Q,ve*ve+Ce*Ce}function So(Ne,W,J,Q){let ue={id:Ne??null,type:W,geometry:J,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")ao(ue,J);else if(W==="Polygon")ao(ue,J[0]);else if(W==="MultiLineString")for(let de of J)ao(ue,de);else if(W==="MultiPolygon")for(let de of J)ao(ue,de[0]);return ue}function ao(Ne,W){for(let J=0;J<W.length;J+=3)Ne.minX=Math.min(Ne.minX,W[J]),Ne.minY=Math.min(Ne.minY,W[J+1]),Ne.maxX=Math.max(Ne.maxX,W[J]),Ne.maxY=Math.max(Ne.maxY,W[J+1])}function Os(Ne,W,J,Q){if(!W.geometry)return;let ue=W.geometry.coordinates;if(ue&&ue.length===0)return;let de=W.geometry.type,ve=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2),Ce=[],xe=W.id;if(J.promoteId?xe=W.properties[J.promoteId]:J.generateId&&(xe=Q||0),de==="Point")ai(ue,Ce);else if(de==="MultiPoint")for(let Le of ue)ai(Le,Ce);else if(de==="LineString")ts(ue,Ce,ve,!1);else if(de==="MultiLineString"){if(J.lineMetrics){for(let Le of ue)Ce=[],ts(Le,Ce,ve,!1),Ne.push(So(xe,"LineString",Ce,W.properties));return}sa(ue,Ce,ve,!1)}else if(de==="Polygon")sa(ue,Ce,ve,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(let Le of W.geometry.geometries)Os(Ne,{id:xe,geometry:Le,properties:W.properties},J,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Le of ue){let Oe=[];sa(Le,Oe,ve,!0),Ce.push(Oe)}}Ne.push(So(xe,de,Ce,W.properties))}function ai(Ne,W){W.push(sl(Ne[0]),al(Ne[1]),0)}function ts(Ne,W,J,Q){let ue,de,ve=0;for(let xe=0;xe<Ne.length;xe++){let Le=sl(Ne[xe][0]),Oe=al(Ne[xe][1]);W.push(Le,Oe,0),xe>0&&(ve+=Q?(ue*Oe-Le*de)/2:Math.sqrt(Math.pow(Le-ue,2)+Math.pow(Oe-de,2))),ue=Le,de=Oe}let Ce=W.length-3;W[2]=1,oa(W,0,Ce,J),W[Ce+2]=1,W.size=Math.abs(ve),W.start=0,W.end=W.size}function sa(Ne,W,J,Q){for(let ue=0;ue<Ne.length;ue++){let de=[];ts(Ne[ue],de,J,Q),W.push(de)}}function sl(Ne){return Ne/360+.5}function al(Ne){let W=Math.sin(Ne*Math.PI/180),J=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return J<0?0:J>1?1:J}function yi(Ne,W,J,Q,ue,de,ve,Ce){if(Q/=W,de>=(J/=W)&&ve<Q)return Ne;if(ve<J||de>=Q)return null;let xe=[];for(let Le of Ne){let Oe=Le.geometry,ke=Le.type,Xe=ue===0?Le.minX:Le.minY,ot=ue===0?Le.maxX:Le.maxY;if(Xe>=J&&ot<Q){xe.push(Le);continue}if(ot<J||Xe>=Q)continue;let st=[];if(ke==="Point"||ke==="MultiPoint")ll(Oe,st,J,Q,ue);else if(ke==="LineString")cl(Oe,st,J,Q,ue,!1,Ce.lineMetrics);else if(ke==="MultiLineString")aa(Oe,st,J,Q,ue,!1);else if(ke==="Polygon")aa(Oe,st,J,Q,ue,!0);else if(ke==="MultiPolygon")for(let Tt of Oe){let Mt=[];aa(Tt,Mt,J,Q,ue,!0),Mt.length&&st.push(Mt)}if(st.length){if(Ce.lineMetrics&&ke==="LineString"){for(let Tt of st)xe.push(So(Le.id,ke,Tt,Le.tags));continue}ke!=="LineString"&&ke!=="MultiLineString"||(st.length===1?(ke="LineString",st=st[0]):ke="MultiLineString"),ke!=="Point"&&ke!=="MultiPoint"||(ke=st.length===3?"Point":"MultiPoint"),xe.push(So(Le.id,ke,st,Le.tags))}}return xe.length?xe:null}function ll(Ne,W,J,Q,ue){for(let de=0;de<Ne.length;de+=3){let ve=Ne[de+ue];ve>=J&&ve<=Q&&qt(W,Ne[de],Ne[de+1],Ne[de+2])}}function cl(Ne,W,J,Q,ue,de,ve){let Ce=Ni(Ne),xe=ue===0?Do:Nu,Le,Oe,ke=Ne.start;for(let Mt=0;Mt<Ne.length-3;Mt+=3){let Ct=Ne[Mt],Dt=Ne[Mt+1],sn=Ne[Mt+2],hn=Ne[Mt+3],Kt=Ne[Mt+4],pn=ue===0?Ct:Dt,_n=ue===0?hn:Kt,vr=!1;ve&&(Le=Math.sqrt(Math.pow(Ct-hn,2)+Math.pow(Dt-Kt,2))),pn<J?_n>J&&(Oe=xe(Ce,Ct,Dt,hn,Kt,J),ve&&(Ce.start=ke+Le*Oe)):pn>Q?_n<Q&&(Oe=xe(Ce,Ct,Dt,hn,Kt,Q),ve&&(Ce.start=ke+Le*Oe)):qt(Ce,Ct,Dt,sn),_n<J&&pn>=J&&(Oe=xe(Ce,Ct,Dt,hn,Kt,J),vr=!0),_n>Q&&pn<=Q&&(Oe=xe(Ce,Ct,Dt,hn,Kt,Q),vr=!0),!de&&vr&&(ve&&(Ce.end=ke+Le*Oe),W.push(Ce),Ce=Ni(Ne)),ve&&(ke+=Le)}let Xe=Ne.length-3,ot=Ne[Xe],st=Ne[Xe+1],Tt=ue===0?ot:st;Tt>=J&&Tt<=Q&&qt(Ce,ot,st,Ne[Xe+2]),Xe=Ce.length-3,de&&Xe>=3&&(Ce[Xe]!==Ce[0]||Ce[Xe+1]!==Ce[1])&&qt(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&W.push(Ce)}function Ni(Ne){let W=[];return W.size=Ne.size,W.start=Ne.start,W.end=Ne.end,W}function aa(Ne,W,J,Q,ue,de){for(let ve of Ne)cl(ve,W,J,Q,ue,de,!1)}function qt(Ne,W,J,Q){Ne.push(W,J,Q)}function Do(Ne,W,J,Q,ue,de){let ve=(de-W)/(Q-W);return qt(Ne,de,J+(ue-J)*ve,1),ve}function Nu(Ne,W,J,Q,ue,de){let ve=(de-J)/(ue-J);return qt(Ne,W+(Q-W)*ve,de,1),ve}function Mi(Ne,W){let J=[];for(let Q=0;Q<Ne.length;Q++){let ue=Ne[Q],de=ue.type,ve;if(de==="Point"||de==="MultiPoint"||de==="LineString")ve=ns(ue.geometry,W);else if(de==="MultiLineString"||de==="Polygon"){ve=[];for(let Ce of ue.geometry)ve.push(ns(Ce,W))}else if(de==="MultiPolygon"){ve=[];for(let Ce of ue.geometry){let xe=[];for(let Le of Ce)xe.push(ns(Le,W));ve.push(xe)}}J.push(So(ue.id,de,ve,ue.tags))}return J}function ns(Ne,W){let J=[];J.size=Ne.size,Ne.start!==void 0&&(J.start=Ne.start,J.end=Ne.end);for(let Q=0;Q<Ne.length;Q+=3)J.push(Ne[Q]+W,Ne[Q+1],Ne[Q+2]);return J}function ul(Ne,W){if(Ne.transformed)return Ne;let J=1<<Ne.z,Q=Ne.x,ue=Ne.y;for(let de of Ne.features){let ve=de.geometry,Ce=de.type;if(de.geometry=[],Ce===1)for(let xe=0;xe<ve.length;xe+=2)de.geometry.push(hl(ve[xe],ve[xe+1],W,J,Q,ue));else for(let xe=0;xe<ve.length;xe++){let Le=[];for(let Oe=0;Oe<ve[xe].length;Oe+=2)Le.push(hl(ve[xe][Oe],ve[xe][Oe+1],W,J,Q,ue));de.geometry.push(Le)}}return Ne.transformed=!0,Ne}function hl(Ne,W,J,Q,ue,de){return[Math.round(J*(Ne*Q-ue)),Math.round(J*(W*Q-de))]}function dl(Ne,W,J,Q,ue){let de=W===ue.maxZoom?0:ue.tolerance/((1<<W)*ue.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:Ne.length,source:null,x:J,y:Q,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Ce of Ne)zu(ve,Ce,de,ue);return ve}function zu(Ne,W,J,Q){let ue=W.geometry,de=W.type,ve=[];if(Ne.minX=Math.min(Ne.minX,W.minX),Ne.minY=Math.min(Ne.minY,W.minY),Ne.maxX=Math.max(Ne.maxX,W.maxX),Ne.maxY=Math.max(Ne.maxY,W.maxY),de==="Point"||de==="MultiPoint")for(let Ce=0;Ce<ue.length;Ce+=3)ve.push(ue[Ce],ue[Ce+1]),Ne.numPoints++,Ne.numSimplified++;else if(de==="LineString")fl(ve,ue,Ne,J,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let Ce=0;Ce<ue.length;Ce++)fl(ve,ue[Ce],Ne,J,de==="Polygon",Ce===0);else if(de==="MultiPolygon")for(let Ce=0;Ce<ue.length;Ce++){let xe=ue[Ce];for(let Le=0;Le<xe.length;Le++)fl(ve,xe[Le],Ne,J,!0,Le===0)}if(ve.length){let Ce=W.tags||null;if(de==="LineString"&&Q.lineMetrics){Ce={};for(let Le in W.tags)Ce[Le]=W.tags[Le];Ce.mapbox_clip_start=ue.start/ue.size,Ce.mapbox_clip_end=ue.end/ue.size}let xe={geometry:ve,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Ce};W.id!==null&&(xe.id=W.id),Ne.features.push(xe)}}function fl(Ne,W,J,Q,ue,de){let ve=Q*Q;if(Q>0&&W.size<(ue?ve:Q))return void(J.numPoints+=W.length/3);let Ce=[];for(let xe=0;xe<W.length;xe+=3)(Q===0||W[xe+2]>ve)&&(J.numSimplified++,Ce.push(W[xe],W[xe+1])),J.numPoints++;ue&&function(xe,Le){let Oe=0;for(let ke=0,Xe=xe.length,ot=Xe-2;ke<Xe;ot=ke,ke+=2)Oe+=(xe[ke]-xe[ot])*(xe[ke+1]+xe[ot+1]);if(Oe>0===Le)for(let ke=0,Xe=xe.length;ke<Xe/2;ke+=2){let ot=xe[ke],st=xe[ke+1];xe[ke]=xe[Xe-2-ke],xe[ke+1]=xe[Xe-1-ke],xe[Xe-2-ke]=ot,xe[Xe-1-ke]=st}}(Ce,de),Ne.push(Ce)}let Bu={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Vu{constructor(W,J){let Q=(J=this.options=function(de,ve){for(let Ce in ve)de[Ce]=ve[Ce];return de}(Object.create(Bu),J)).debug;if(Q&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=function(de,ve){let Ce=[];if(de.type==="FeatureCollection")for(let xe=0;xe<de.features.length;xe++)Os(Ce,de.features[xe],ve,xe);else Os(Ce,de.type==="Feature"?de:{geometry:de},ve);return Ce}(W,J);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=function(de,ve){let Ce=ve.buffer/ve.extent,xe=de,Le=yi(de,1,-1-Ce,Ce,0,-1,2,ve),Oe=yi(de,1,1-Ce,2+Ce,0,-1,2,ve);return(Le||Oe)&&(xe=yi(de,1,-Ce,1+Ce,0,-1,2,ve)||[],Le&&(xe=Mi(Le,1).concat(xe)),Oe&&(xe=xe.concat(Mi(Oe,-1)))),xe}(ue,J),ue.length&&this.splitTile(ue,0,0,0),Q&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,J,Q,ue,de,ve,Ce){let xe=[W,J,Q,ue],Le=this.options,Oe=Le.debug;for(;xe.length;){ue=xe.pop(),Q=xe.pop(),J=xe.pop(),W=xe.pop();let ke=1<<J,Xe=Dr(J,Q,ue),ot=this.tiles[Xe];if(!ot&&(Oe>1&&console.time("creation"),ot=this.tiles[Xe]=dl(W,J,Q,ue,Le),this.tileCoords.push({z:J,x:Q,y:ue}),Oe)){Oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,Q,ue,ot.numFeatures,ot.numPoints,ot.numSimplified),console.timeEnd("creation"));let vr=`z${J}`;this.stats[vr]=(this.stats[vr]||0)+1,this.total++}if(ot.source=W,de==null){if(J===Le.indexMaxZoom||ot.numPoints<=Le.indexMaxPoints)continue}else{if(J===Le.maxZoom||J===de)continue;if(de!=null){let vr=de-J;if(Q!==ve>>vr||ue!==Ce>>vr)continue}}if(ot.source=null,W.length===0)continue;Oe>1&&console.time("clipping");let st=.5*Le.buffer/Le.extent,Tt=.5-st,Mt=.5+st,Ct=1+st,Dt=null,sn=null,hn=null,Kt=null,pn=yi(W,ke,Q-st,Q+Mt,0,ot.minX,ot.maxX,Le),_n=yi(W,ke,Q+Tt,Q+Ct,0,ot.minX,ot.maxX,Le);W=null,pn&&(Dt=yi(pn,ke,ue-st,ue+Mt,1,ot.minY,ot.maxY,Le),sn=yi(pn,ke,ue+Tt,ue+Ct,1,ot.minY,ot.maxY,Le),pn=null),_n&&(hn=yi(_n,ke,ue-st,ue+Mt,1,ot.minY,ot.maxY,Le),Kt=yi(_n,ke,ue+Tt,ue+Ct,1,ot.minY,ot.maxY,Le),_n=null),Oe>1&&console.timeEnd("clipping"),xe.push(Dt||[],J+1,2*Q,2*ue),xe.push(sn||[],J+1,2*Q,2*ue+1),xe.push(hn||[],J+1,2*Q+1,2*ue),xe.push(Kt||[],J+1,2*Q+1,2*ue+1)}}getTile(W,J,Q){W=+W,J=+J,Q=+Q;let ue=this.options,{extent:de,debug:ve}=ue;if(W<0||W>24)return null;let Ce=1<<W,xe=Dr(W,J=J+Ce&Ce-1,Q);if(this.tiles[xe])return ul(this.tiles[xe],de);ve>1&&console.log("drilling down to z%d-%d-%d",W,J,Q);let Le,Oe=W,ke=J,Xe=Q;for(;!Le&&Oe>0;)Oe--,ke>>=1,Xe>>=1,Le=this.tiles[Dr(Oe,ke,Xe)];return Le&&Le.source?(ve>1&&(console.log("found parent tile z%d-%d-%d",Oe,ke,Xe),console.time("drilling down")),this.splitTile(Le.source,Oe,ke,Xe,W,J,Q),ve>1&&console.timeEnd("drilling down"),this.tiles[xe]?ul(this.tiles[xe],de):null):null}}function Dr(Ne,W,J){return 32*((1<<Ne)*J+W)+Ne}function sc(Ne,W){let J=Ne.tileID.canonical;if(!this._geoJSONIndex)return void W(null,null);let Q=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!Q)return void W(null,null);let ue=new Fu(Q.features),de=Ee(ue);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),W(null,{vectorTile:ue,rawData:de.buffer})}class ju extends Jo{constructor(W,J,Q,ue,de,ve){super(W,J,Q,ue,sc,ve),de&&(this.loadGeoJSON=de),this._dynamicIndex=new Qo}loadData(W,J){let Q=W&&W.request,ue=Q&&Q.collectResourceTiming;this.loadGeoJSON(W,(de,ve)=>{if(de||!ve)return J(de);if(typeof ve!="object")return J(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{try{if(W.filter){let xe=n.U(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xe.result==="error")throw new Error(xe.value.map(Le=>`${Le.key}: ${Le.message}`).join(", "));ve.features=ve.features.filter(Le=>xe.value.evaluate({zoom:0},Le))}W.dynamic?(ve.type==="Feature"&&(ve={type:"FeatureCollection",features:[ve]}),W.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ve.features,this.loaded),W.cluster&&(ve.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=W.cluster?new ol(function({superclusterOptions:xe,clusterProperties:Le}){if(!Le||!xe)return xe;let Oe={},ke={},Xe={accumulated:null,zoom:0},ot={properties:null},st=Object.keys(Le);for(let Tt of st){let[Mt,Ct]=Le[Tt],Dt=n.U(Ct),sn=n.U(typeof Mt=="string"?[Mt,["accumulated"],["get",Tt]]:Mt);Oe[Tt]=Dt.value,ke[Tt]=sn.value}return xe.map=Tt=>{ot.properties=Tt;let Mt={};for(let Ct of st)Mt[Ct]=Oe[Ct].evaluate(Xe,ot);return Mt},xe.reduce=(Tt,Mt)=>{ot.properties=Mt;for(let Ct of st)Xe.accumulated=Tt[Ct],Tt[Ct]=ke[Ct].evaluate(Xe,ot)},xe}(W)).load(ve.features):W.dynamic?this._dynamicIndex:function(xe,Le){return new Vu(xe,Le)}(ve,W.geojsonVtOptions)}catch(xe){return J(xe)}let Ce={};if(ue){let xe=F(Q);xe&&(Ce.resourceTiming={},Ce.resourceTiming[W.source]=JSON.parse(JSON.stringify(xe)))}J(null,Ce)}})}reloadTile(W,J){let Q=this.loaded;return Q&&Q[W.uid]?W.partial?J(null,void 0):super.reloadTile(W,J):this.loadTile(W,J)}loadGeoJSON(W,J){if(W.request)n.n(W.request,J);else{if(typeof W.data!="string")return J(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));try{return J(null,JSON.parse(W.data))}catch{return J(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(W,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(Q){J(Q)}}getClusterChildren(W,J){try{J(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(Q){J(Q)}}getClusterLeaves(W,J){try{J(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(Q){J(Q)}}}class ac{constructor(W,J){this.tileID=new n.aG(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=W.projection,this.brightness=J}parse(W,J,Q,ue){this.status="parsing";let de=new n.aG(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),ve=[],Ce=J.familiesBySource[Q.source],xe=new n.d$(de,Q.promoteId);return xe.bucketLayerIDs=[],xe.is3DTile=!0,n.ea(W).then(Le=>{if(!Le)return ue(new Error("Could not parse tile"));let Oe=n.eb(Le,1/n.cc(Q.tileID.canonical)),ke=Le.json.extensionsUsed&&Le.json.extensionsUsed.includes("MAPBOX_mesh_features")||Le.json.asset.extras&&Le.json.asset.extras.MAPBOX_mesh_features,Xe=Le.json.extensionsUsed&&Le.json.extensionsUsed.includes("EXT_meshopt_compression"),ot=new n.a8(this.zoom,{brightness:this.brightness});for(let st in Ce)for(let Tt of Ce[st]){let Mt=Tt[0];xe.bucketLayerIDs.push(Tt.map(Dt=>n.aC(Dt.id,Dt.scope))),Mt.recalculate(ot,[]);let Ct=new n.ec(Tt,Oe,de,ke,Xe,this.brightness,xe);ke||(Ct.needsUpload=!0),ve.push(Ct),Ct.evaluate(Mt)}this.status="done",ue(null,{buckets:ve,featureIndex:xe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Le=>ue(new Error(Le.message)))}}class $r{constructor(W,J,Q,ue,de,ve){this.actor=W,this.layerIndex=J,this.availableImages=Q,this.brightness=ve,this.loading={},this.loaded={}}loadTile(W,J){let Q=W.uid,ue=this.loading[Q]=new ac(W,this.brightness);n.bi(W.request,(de,ve)=>{let Ce=!this.loading[Q];return delete this.loading[Q],Ce||de?(ue.status="done",Ce||(this.loaded[Q]=ue),J(de)):ve&&ve.byteLength!==0?void ue.parse(ve,this.layerIndex,W,(xe,Le)=>{ue.status="done",this.loaded=this.loaded||{},this.loaded[Q]=ue,xe||!Le?J(xe):J(null,Le)}):(ue.status="done",this.loaded[Q]=ue,J())})}reloadTile(W,J){let Q=this.loaded,ue=W.uid;if(Q&&Q[ue]){let de=Q[ue];de.projection=W.projection,de.brightness=W.brightness;let ve=(Ce,xe)=>{de.reloadCallback&&(delete de.reloadCallback,this.loadTile(W,J)),J(Ce,xe)};de.status==="parsing"?de.reloadCallback=ve:de.status==="done"&&this.loadTile(W,J)}}abortTile(W,J){let Q=W.uid;this.loading[Q]&&delete this.loading[Q],J()}removeTile(W,J){let Q=this.loaded,ue=W.uid;Q&&Q[ue]&&delete Q[ue],J()}}class Mo{constructor(W){this.self=W,this.actor=new n.ed(W,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new n.I,this.projections={},this.defaultProjection=n.bP({name:"mercator"}),this.workerSourceTypes={vector:Jo,geojson:ju,"batched-model":$r},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(J,Q)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=Q},this.self.registerRTLTextPlugin=J=>{if(n.ee.isParsed())throw new Error("RTL text plugin already registered.");n.ee.applyArabicShaping=J.applyArabicShaping,n.ee.processBidirectionalText=J.processBidirectionalText,n.ee.processStyledBidirectionalText=J.processStyledBidirectionalText}}clearCaches(W,J,Q){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],delete this.rasterArrayWorkerSource,Q()}checkIfReady(W,J,Q){Q()}setReferrer(W,J){this.referrer=J}spriteLoaded(W,{scope:J,isLoaded:Q}){if(this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={}),this.isSpriteLoaded[W][J]=Q,this.workerSources[W]&&this.workerSources[W][J])for(let ue in this.workerSources[W][J]){let de=this.workerSources[W][J][ue];for(let ve in de){let Ce=de[ve];Ce instanceof Jo&&(Ce.isSpriteLoaded=Q,Ce.fire(new n.z("isSpriteLoaded")))}}}setImages(W,{scope:J,images:Q},ue){if(this.availableImages[W]||(this.availableImages[W]={}),this.availableImages[W][J]=Q,this.workerSources[W]&&this.workerSources[W][J]){for(let de in this.workerSources[W][J]){let ve=this.workerSources[W][J][de];for(let Ce in ve)ve[Ce].availableImages=Q}ue()}else ue()}setProjection(W,J){this.projections[W]=n.bP(J)}setBrightness(W,J,Q){this.brightness=J,Q()}setLayers(W,J,Q){this.getLayerIndex(W,J.scope).replace(J.layers,J.options),Q()}updateLayers(W,J,Q){this.getLayerIndex(W,J.scope).update(J.layers,J.removedIds,J.options),Q()}loadTile(W,J,Q){J.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,J.type,J.source,J.scope).loadTile(J,Q)}loadDEMTile(W,J,Q){this.getDEMWorkerSource(W,J.source,J.scope).loadTile(J,Q)}decodeRasterArray(W,J,Q){this.getRasterArrayWorkerSource().decodeRasterArray(J,Q)}reloadTile(W,J,Q){J.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,J.type,J.source,J.scope).reloadTile(J,Q)}abortTile(W,J,Q){this.getWorkerSource(W,J.type,J.source,J.scope).abortTile(J,Q)}removeTile(W,J,Q){this.getWorkerSource(W,J.type,J.source,J.scope).removeTile(J,Q)}removeSource(W,J,Q){if(!(this.workerSources[W]&&this.workerSources[W][J.scope]&&this.workerSources[W][J.scope][J.type]&&this.workerSources[W][J.scope][J.type][J.source]))return;let ue=this.workerSources[W][J.scope][J.type][J.source];delete this.workerSources[W][J.scope][J.type][J.source],ue.removeSource!==void 0?ue.removeSource(J,Q):Q()}loadWorkerSource(W,J,Q){try{this.self.importScripts(J.url),Q()}catch(ue){Q(ue.toString())}}syncRTLPluginState(W,J,Q){try{n.ee.setState(J);let ue=n.ee.getPluginURL();if(n.ee.isLoaded()&&!n.ee.isParsed()&&ue!=null){this.self.importScripts(ue);let de=n.ee.isParsed();Q(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ue}`),de)}}catch(ue){Q(ue.toString())}}setDracoUrl(W,J){this.dracoUrl=J}getAvailableImages(W,J){this.availableImages[W]||(this.availableImages[W]={});let Q=this.availableImages[W][J];return Q||(Q=[]),Q}getLayerIndex(W,J){this.layerIndexes[W]||(this.layerIndexes[W]={});let Q=this.layerIndexes[W][J];return Q||(Q=this.layerIndexes[W][J]=new ae,Q.scope=J),Q}getWorkerSource(W,J,Q,ue){return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][ue]||(this.workerSources[W][ue]={}),this.workerSources[W][ue][J]||(this.workerSources[W][ue][J]={}),this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={}),this.workerSources[W][ue][J][Q]||(this.workerSources[W][ue][J][Q]=new this.workerSourceTypes[J]({send:(de,ve,Ce,xe,Le,Oe)=>{this.actor.send(de,ve,Ce,W,Le,Oe)},scheduler:this.actor.scheduler},this.getLayerIndex(W,ue),this.getAvailableImages(W,ue),this.isSpriteLoaded[W][ue],void 0,this.brightness)),this.workerSources[W][ue][J][Q]}rasterizeImages(W,J,Q){let{imageTasks:ue,scope:de}=J,ve={};for(let Ce in ue){let{image:xe,imageIdWithOptions:Le}=ue[Ce];ve[Ce]=this.imageRasterizer.rasterize(Le,xe,de,W)}Q(void 0,ve)}removeRasterizedImages(W,J,Q){let{imageIds:ue,scope:de}=J;this.imageRasterizer.removeImagesFromCacheByIds(ue,de,W),Q()}getDEMWorkerSource(W,J,Q){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][Q]||(this.demWorkerSources[W][Q]={}),this.demWorkerSources[W][Q][J]||(this.demWorkerSources[W][Q][J]=new Vt),this.demWorkerSources[W][Q][J]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ut),this.rasterArrayWorkerSource}enforceCacheSizeLimit(W,J){n.ef(J)}getWorkerPerformanceMetrics(W,J,Q){Q(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Mo(self)),Mo}),g(["./shared"],function(n){var F="3.10.0";let H={create:"create",load:"load",fullLoad:"fullLoad"},$={mark(u){performance.mark(u)},measure(u,t,i){performance.measure(u,t,i)}};function ae(u){let t=u.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var Te,Fe={},Ze=function(){if(Te)return Fe;function u(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,x,S=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(S);try{x=new Worker(A),y=!0}catch{y=!1}return x&&x.terminate(),URL.revokeObjectURL(A),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var x=y.getContext("2d");if(!x)return!1;var S=x.getImageData(0,0,1,1);return S&&S.width===y.width}()?(i[m=d&&d.failIfMajorPerformanceCaveat]===void 0&&(i[m]=function(y){var x,S=function(A){var R=document.createElement("canvas"),P=Object.create(u.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=A,R.getContext("webgl2",P)}(y);if(!S)return!1;try{x=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!x||S.isContextLost())&&(S.shaderSource(x,"void main() {}"),S.compileShader(x),S.getShaderParameter(x,S.COMPILE_STATUS)===!0)}(m)),i[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}Te=1,Fe.supported=u,Fe.notSupportedReason=t;var i={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Fe}();function ze(u,t,i){let d=document.createElement(u);return t!=null&&(d.className=t),i&&i.appendChild(d),d}function pt(u,t,i){let d=document.createElementNS("http://www.w3.org/2000/svg",u);for(let m of Object.keys(t))d.setAttributeNS(null,m,String(t[m]));return i&&i.appendChild(d),d}let vt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Cn=vt&&vt.userSelect!==void 0?"userSelect":"WebkitUserSelect",En;function Ft(){vt&&Cn&&(En=vt[Cn],vt[Cn]="none")}function mi(){vt&&Cn&&(vt[Cn]=En)}function Eo(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",Eo,!0)}function Bt(){window.addEventListener("click",Eo,!0),window.setTimeout(()=>{window.removeEventListener("click",Eo,!0)},0)}function To(u,t){let i=u.getBoundingClientRect();return Ut(u,i,t)}function Jo(u,t){let i=u.getBoundingClientRect(),d=[];for(let m=0;m<t.length;m++)d.push(Ut(u,i,t[m]));return d}function Vt(u){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&u.button===2&&u.ctrlKey?0:u.button}function Ut(u,t,i){let d=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new n.P((i.clientX-t.left)*d,(i.clientY-t.top)*d)}let Xa="01",Ya="NO_ACCESS_TOKEN";class Fu{constructor(t,i,d){this._transformRequestFn=t,this._customAccessToken=i,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){let t=function(){let i="";for(let d=0;d<10;d++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Xa,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,i){return this._transformRequestFn&&this._transformRequestFn(t,i)||{url:t}}normalizeStyleURL(t,i){if(!n.f(t))return t;let d=gi(t);return d.params.push(`sdk=js-${F}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||i)}normalizeGlyphsURL(t,i){if(!n.f(t))return t;let d=gi(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||i)}normalizeModelURL(t,i){if(!n.f(t))return t;let d=gi(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||i)}normalizeSourceURL(t,i,d,m){if(!n.f(t))return t;let y=gi(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),d&&y.params.push(`language=${d}`),m&&y.params.push(`worldview=${m}`),this._makeAPIURL(y,this._customAccessToken||i)}normalizeIconsetURL(t,i){let d=gi(t);return n.f(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||i)):Qo(d)}normalizeSpriteURL(t,i,d,m){let y=gi(t);return n.f(t)?(y.path=`/styles/v1${y.path}/sprite${i}${d}`,this._makeAPIURL(y,this._customAccessToken||m)):(y.path+=`${i}${d}`,Qo(y))}normalizeTileURL(t,i,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.f(t))return t;let m=gi(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||d&&m.authority!=="raster"&&d===512?"@2x":""}${n.m.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${n.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${n.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${n.e.TILE_URL_VERSION}${m.path}`);let y=this._customAccessToken||function(x){for(let S of x){let A=S.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(m.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,y)}canonicalizeTileURL(t,i){let d=gi(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let m="mapbox://";d.path.match(/^\/raster\/v1\//)?m+=`raster/${d.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${d.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${d.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let y=d.params;return i&&(y=y.filter(x=>!x.match(/^access_token=/))),y.length&&(m+=`?${y.join("&")}`),m}canonicalizeTileset(t,i){let d=!!i&&n.f(i),m=[];for(let y of t.tiles||[])n.h(y)?m.push(this.canonicalizeTileURL(y,d)):m.push(y);return m}_makeAPIURL(t,i){let d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=gi(n.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){let y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return Qo(t);if(i=i||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(y=>y.indexOf("access_token")===-1),t.params.push(`access_token=${i||""}`),Qo(t)}}let Xt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gi(u){let t=u.match(Xt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Qo(u){let t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}let Ka="mapbox.eventData";function nn(u){if(!u)return null;let t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.j(t[1]))}catch{return null}}class es{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let i=nn(n.e.ACCESS_TOKEN),d="";return d=i&&i.u?n.k(i.u):n.e.ACCESS_TOKEN||"",t?`${Ka}.${t}:${d}`:`${Ka}:${d}`}fetchEventData(){let t=n.s("localStorage"),i=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{let m=localStorage.getItem(i);m&&(this.eventData=JSON.parse(m));let y=localStorage.getItem(d);y&&(this.anonId=y)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){let t=n.s("localStorage"),i=this.getStorageKey(),d=this.getStorageKey("uuid"),m=this.anonId;if(t&&m)try{localStorage.setItem(d,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,d,m){if(!n.e.EVENTS_URL)return;let y=gi(n.e.EVENTS_URL);y.params.push(`access_token=${m||n.e.ACCESS_TOKEN||""}`);let x={event:this.type,created:new Date(t).toISOString()},S=i?n.l(x,i):x,A={url:Qo(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=n.p(A,R=>{this.pendingRequest=null,d(R),this.saveEventData(),this.processRequests(m)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}let Ja=new class extends es{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(i=>n.f(i)||n.h(i))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=nn(n.e.ACCESS_TOKEN),i=t?t.u:n.e.ACCESS_TOKEN,d=i!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),d=!0);let m=this.queue.shift();if(this.eventData.lastSuccess){let y=new Date(this.eventData.lastSuccess),x=new Date(m),S=(m-this.eventData.lastSuccess)/864e5;d=d||S>=1||S<-1||y.getDate()!==x.getDate()}else d=!0;d?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:Xa,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=m,this.eventData.tokenU=i)},u):this.processRequests()}},Rs=Ja.postTurnstileEvent.bind(Ja),Gt=new class extends es{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,i,d){this.skuToken=t,this.errorCb=d,n.e.EVENTS_URL&&(i||n.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},i):this.errorCb(new Error(Ya)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:Xa,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},qd=Gt.postMapLoadEvent.bind(Gt),Qa=new class extends es{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=n.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){let t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){let{map:i,style:d,importedStyles:m}=t;if(!n.e.EVENTS_URL||!u&&!n.e.ACCESS_TOKEN)return;let y=this.getMapInstanceId(i),x={mapInstanceId:y,eventId:this.getEventId(y),style:d};m.length&&(x.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:x},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,payload:i}=this.queue.shift();this.postEvent(t,i,()=>{},u)}},el=Qa.postStyleLoadEvent.bind(Qa),tl=new class extends es{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){n.e.EVENTS_URL&&(u||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,performanceData:i}=this.queue.shift(),d=function(m){let y=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),S=function(V){let Z={};if(V){for(let G in V)if(G!=="other")for(let Y of V[G]){let X=`${G}ResolveRangeMin`,ee=`${G}ResolveRangeMax`,se=`${G}RequestCount`,oe=`${G}RequestCachedCount`;Z[X]=Math.min(Z[X]||1/0,Y.startTime),Z[ee]=Math.max(Z[ee]||-1/0,Y.responseEnd);let fe=ce=>{Z[ce]===void 0&&(Z[ce]=0),++Z[ce]};Y.transferSize!==void 0&&Y.transferSize===0&&fe(oe),fe(se)}}return Z}(function(V,Z){let G={};if(V)for(let Y of V){let X=Z(Y);G[X]===void 0&&(G[X]=[]),G[X].push(Y)}return G}(y,ae)),A=window.devicePixelRatio,R=navigator.connection||navigator.mozConnection||navigator.webkitConnection,P=R?R.effectiveType:void 0,k={counters:[],metadata:[],attributes:[]},N=(V,Z,G)=>{G!=null&&V.push({name:Z,value:G.toString()})};for(let V in S)N(k.counters,V,S[V]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(N(k.counters,"interactionRangeMin",m.interactionRange[0]),N(k.counters,"interactionRangeMax",m.interactionRange[1])),x)for(let V of Object.keys(H)){let Z=H[V],G=x.find(Y=>Y.name===Z);G&&N(k.counters,Z,G.startTime)}return N(k.counters,"visibilityHidden",m.visibilityHidden),N(k.attributes,"style",function(V){if(V)for(let Z of V){let G=Z.name.split("?")[0];if(n.i(G)){let Y=G.split("/").slice(-2);if(Y.length===2)return`mapbox://styles/${Y[0]}/${Y[1]}`}}}(y)),N(k.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),N(k.attributes,"fogEnabled",m.fogEnabled?"true":"false"),N(k.attributes,"projection",m.projection),N(k.attributes,"zoom",m.zoom),N(k.metadata,"devicePixelRatio",A),N(k.metadata,"connectionEffectiveType",P),N(k.metadata,"navigatorUserAgent",navigator.userAgent),N(k.metadata,"screenWidth",window.screen.width),N(k.metadata,"screenHeight",window.screen.height),N(k.metadata,"windowWidth",window.innerWidth),N(k.metadata,"windowHeight",window.innerHeight),N(k.metadata,"mapWidth",m.width/A),N(k.metadata,"mapHeight",m.height/A),N(k.metadata,"webglRenderer",m.renderer),N(k.metadata,"webglVendor",m.vendor),N(k.metadata,"sdkVersion",F),N(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(i);for(let m of d.metadata);for(let m of d.counters);for(let m of d.attributes);this.postEvent(t,d,()=>{},u)}},Io=tl.postPerformanceEvent.bind(tl),nl=new class extends es{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,i,d){if(!n.e.API_URL||!n.e.SESSION_PATH)return;let m=gi(n.e.API_URL+n.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${d||n.e.ACCESS_TOKEN||""}`);let y={url:Qo(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(y,x=>{this.pendingRequest=null,i(x),this.saveEventData(),this.processRequests(d)})}getSessionAPI(u,t,i,d){this.skuToken=t,this.errorCb=d,n.e.SESSION_PATH&&n.e.API_URL&&(i||n.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},i):this.errorCb(new Error(Ya)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},Ee=nl.getSessionAPI.bind(nl),rl=new Set;function il(u,t){t?rl.add(u):rl.delete(u)}class ra{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,i){this._updatedSourceCaches[t]=i,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){let i=t.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(t.id),this.setDirty()}removeLayer(t){let i=t.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][t.id]=t,this._updatedLayers[i].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){let t={};for(let i in this._updatedLayers)t[i]=t[i]||{},t[i].updatedIds=Array.from(this._updatedLayers[i].values());for(let i in this._removedLayers)t[i]=t[i]||{},t[i].removedIds=Object.keys(this._removedLayers[i]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function at(u){let{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class si extends n.E{constructor(t){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&n.t()&&(this.imageRasterizerDispatcher=new n.D(n.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.I),this._imageRasterizer}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new n.r({width:1,height:1})}isLoaded(){for(let t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,i){if(this.loaded[i]!==t&&(this.loaded[i]=t,t)){for(let{ids:d,callback:m}of this.requestors)this._notify(d,i,m);this.requestors=[]}}hasImage(t,i){return!!this.getImage(t,i)}getImage(t,i){return this.images[i][t]}addImage(t,i,d){this._validate(t,d)&&(this.images[i][t]=d)}_validate(t,i){let d=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new n.y(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new n.y(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(i.content,i)||(this.fire(new n.y(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,i){if(!t)return!0;let d=0;for(let m of t){if(m[0]<d||m[1]<m[0]||i<m[1])return!1;d=m[1]}return!0}_validateContent(t,i){return t?t.length!==4||!i.usvg&&(t[0]<0||i.data.width<t[0]||t[1]<0||i.data.height<t[1]||t[2]<0||i.data.width<t[2]||t[3]<0||i.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,i,d){d.version=this.images[i][t].version+1,this.images[i][t]=d,this.updatedImages[i][t]=!0,this.removeFromImageRasterizerCache(t,i)}removeFromImageRasterizerCache(t,i){this.spriteFormat!=="raster"&&(n.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:i}):this.imageRasterizer.removeImagesFromCacheByIds([t],i))}removeImage(t,i){let d=this.images[i][t];delete this.images[i][t],delete this.patterns[i][t],this.removeFromImageRasterizerCache(t,i),d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,i,d){let m=!0,y=!!this.loaded[i];if(!y)for(let x of t)this.images[i][x]||(m=!1);y||m?this._notify(t,i,d):this.requestors.push({ids:t,scope:i,callback:d})}rasterizeImages({scope:t,imageTasks:i},d){let m={};for(let y in i){let x=i[y],S=this.getImage(x.id,t);S&&(m[y]={image:S,imageIdWithOptions:x})}n.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:m,scope:t},d):this.rasterizeImagesInMainThread({imageTasks:m,scope:t},d)}rasterizeImagesInMainThread(t,i){let{imageTasks:d,scope:m}=t,y={};for(let x in d){let{image:S,imageIdWithOptions:A}=d[x];y[x]=this.imageRasterizer.rasterize(A,S,m,"")}i(void 0,y)}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,i,d){let m={};for(let y of t){this.images[i][y]||this.fire(new n.z("styleimagemissing",{id:y}));let x=this.images[i][y];x?m[y]={data:x.usvg?null:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,usvg:x.usvg,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:n.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,m)}getPixelSize(t){let{width:i,height:d}=this.atlasImage[t];return{width:i,height:d}}getPattern(t,i,d){let m=this.patterns[i][t],y=this.getImage(t,i);if(!y)return null;if(m&&m.position.version===y.version)return m.position;if(m)m.position.version=y.version;else{y.usvg&&!y.data&&(y.data=this.imageRasterizer.rasterize(n.A.from(t).getPrimary(),y,i,""));let x={w:y.data.width+2*n.B,h:y.data.height+2*n.B,x:0,y:0},S=new n.C(x,y,n.B);this.patterns[i][t]={bin:x,position:S}}return this._updatePatternAtlas(i,d),this.patterns[i][t].position}bind(t,i){let d=t.gl,m=this.atlasTexture[i];m?this.dirty&&(m.update(this.atlasImage[i]),this.dirty=!1):(m=new n.T(t,this.atlasImage[i],d.RGBA8),this.atlasTexture[i]=m),m.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,i){let d=[];for(let S in this.patterns[t])d.push(this.patterns[t][S].bin);let{w:m,h:y}=n.F(d),x=this.atlasImage[t];x.resize({width:m||1,height:y||1});for(let S in this.patterns[t]){let{bin:A,position:R}=this.patterns[t][S],P=R.padding,k=A.x+P,N=A.y+P,V=this.images[t][S].data,Z=V.width,G=V.height;P=P>1?P-1:P,n.r.copy(V,x,{x:0,y:0},{x:k,y:N},{width:Z,height:G},i),n.r.copy(V,x,{x:0,y:G-P},{x:k,y:N-P},{width:Z,height:P},i),n.r.copy(V,x,{x:0,y:0},{x:k,y:N+G},{width:Z,height:P},i),n.r.copy(V,x,{x:Z-P,y:0},{x:k-P,y:N},{width:P,height:G},i),n.r.copy(V,x,{x:0,y:0},{x:k+Z,y:N},{width:P,height:G},i),n.r.copy(V,x,{x:Z-P,y:G-P},{x:k-P,y:N-P},{width:P,height:P},i),n.r.copy(V,x,{x:0,y:G-P},{x:k+Z,y:N-P},{width:P,height:P},i),n.r.copy(V,x,{x:0,y:0},{x:k+Z,y:N+G},{width:P,height:P},i),n.r.copy(V,x,{x:Z-P,y:0},{x:k-P,y:N+G},{width:P,height:P},i)}this.dirty=!0}beginFrame(){for(let t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,i){for(let d of t){if(this.callbackDispatchedThisFrame[i][d])continue;this.callbackDispatchedThisFrame[i][d]=!0;let m=this.images[i][d];at(m)&&this.updateImage(d,i,m)}}}function _i(u){let t=u.key,i=u.value,d=u.valueSpec||{},m=u.objectElementValidators||{},y=u.style,x=u.styleSpec,S=[],A=n.H(i);if(A!=="object")return[new n.V(t,i,`object expected, ${A} found`)];for(let R in i){let P=R.split(".")[0],k;m[P]?k=m[P]:d[P]?k=qt:m["*"]?k=m["*"]:d["*"]&&(k=qt),k?S=S.concat(k({key:(t&&`${t}.`)+R,value:i[R],valueSpec:d[P]||d["*"],style:y,styleSpec:x,object:i,objectKey:R},i)):S.push(new n.G(t,i[R],`unknown property "${R}"`))}for(let R in d)m[R]||d[R].required&&d[R].default===void 0&&i[R]===void 0&&S.push(new n.V(t,i,`missing required property "${R}"`));return S}function ol(u){let t=u.value,i=u.valueSpec,d=u.style,m=u.styleSpec,y=u.key,x=u.arrayElementValidator||qt;if(n.H(t)!=="array")return[new n.V(y,t,`array expected, ${n.H(t)} found`)];if(i.length&&t.length!==i.length)return[new n.V(y,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new n.V(y,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let S={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};m.$version<7&&(S.function=i.function),n.H(i.value)==="object"&&(S=i.value);let A=[];for(let R=0;R<t.length;R++)A=A.concat(x({array:t,arrayIndex:R,value:t[R],valueSpec:S,style:d,styleSpec:m,key:`${y}[${R}]`},!0));return A}function ln(u){let t=u.key,i=u.value,d=u.valueSpec,m=n.H(i);if(m==="number"&&i!=i&&(m="NaN"),m!=="number")return[new n.V(t,i,`number expected, ${m} found`)];if("minimum"in d){let y=d.minimum;if(n.H(d.minimum)==="array"&&(y=d.minimum[u.arrayIndex]),i<y)return[new n.V(t,i,`${i} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if(n.H(d.maximum)==="array"&&(y=d.maximum[u.arrayIndex]),i>y)return[new n.V(t,i,`${i} is greater than the maximum value ${y}`)]}return[]}function Fr(u){let t=u.valueSpec,i=n.K(u.value.type),d,m,y,x={},S=i!=="categorical"&&u.value.property===void 0,A=!S,R=n.H(u.value.stops)==="array"&&n.H(u.value.stops[0])==="array"&&n.H(u.value.stops[0][0])==="object",P=_i({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(V){if(i==="identity")return[new n.V(V.key,V.value,'identity function may not have a "stops" property')];let Z=[],G=V.value;return Z=Z.concat(ol({key:V.key,value:G,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:k})),n.H(G)==="array"&&G.length===0&&Z.push(new n.V(V.key,G,"array must have at least one stop")),Z},default:function(V){return qt({key:V.key,value:V.value,valueSpec:t,style:V.style,styleSpec:V.styleSpec})}}});return i==="identity"&&S&&P.push(new n.V(u.key,u.value,'missing required property "property"')),i==="identity"||u.value.stops||P.push(new n.V(u.key,u.value,'missing required property "stops"')),i==="exponential"&&u.valueSpec.expression&&!n.L(u.valueSpec)&&P.push(new n.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(A&&!n.M(u.valueSpec)?P.push(new n.V(u.key,u.value,"property functions not supported")):S&&!n.N(u.valueSpec)&&P.push(new n.V(u.key,u.value,"zoom functions not supported"))),i!=="categorical"&&!R||u.value.property!==void 0||P.push(new n.V(u.key,u.value,'"property" property is required')),P;function k(V){let Z=[],G=V.value,Y=V.key;if(n.H(G)!=="array")return[new n.V(Y,G,`array expected, ${n.H(G)} found`)];if(G.length!==2)return[new n.V(Y,G,`array length 2 expected, length ${G.length} found`)];if(R){if(n.H(G[0])!=="object")return[new n.V(Y,G,`object expected, ${n.H(G[0])} found`)];if(G[0].zoom===void 0)return[new n.V(Y,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new n.V(Y,G,"object stop key must have value")];let X=n.K(G[0].zoom);if(typeof X!="number")return[new n.V(Y,G[0].zoom,"stop zoom values must be numbers")];if(y&&y>X)return[new n.V(Y,G[0].zoom,"stop zoom values must appear in ascending order")];X!==y&&(y=X,m=void 0,x={}),Z=Z.concat(_i({key:`${Y}[0]`,value:G[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:ln,value:N}}))}else Z=Z.concat(N({key:`${Y}[0]`,value:G[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},G));return n.O(n.Q(G[1]))?Z.concat([new n.V(`${Y}[1]`,G[1],"expressions are not allowed in function stops.")]):Z.concat(qt({key:`${Y}[1]`,value:G[1],valueSpec:t,style:V.style,styleSpec:V.styleSpec}))}function N(V,Z){let G=n.H(V.value),Y=n.K(V.value),X=V.value!==null?V.value:Z;if(d){if(G!==d)return[new n.V(V.key,X,`${G} stop domain type must match previous stop domain type ${d}`)]}else d=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof Y!="number"&&typeof Y!="string"&&typeof Y!="boolean")return[new n.V(V.key,X,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&i!=="categorical"){let ee=`number expected, ${G} found`;return n.M(t)&&i===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(V.key,X,ee)]}return i!=="categorical"||G!=="number"||typeof Y=="number"&&isFinite(Y)&&Math.floor(Y)===Y?i!=="categorical"&&G==="number"&&typeof Y=="number"&&typeof m=="number"&&m!==void 0&&Y<m?[new n.V(V.key,X,"stop domain values must appear in ascending order")]:(m=Y,i==="categorical"&&Y in x?[new n.V(V.key,X,"stop domain values must be unique")]:(x[Y]=!0,[])):[new n.V(V.key,X,`integer expected, found ${String(Y)}`)]}}function Zi(u){let t=(u.expressionContext==="property"?n.S:n.U)(n.Q(u.value),u.valueSpec);if(t.result==="error")return t.value.map(d=>new n.V(`${u.key}${d.key}`,u.value,d.message));let i=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!i.outputDefined())return[new n.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!n.W(i))return[new n.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Ps(i,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!n.X(i,["zoom","feature-state"]))return[new n.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!n.Y(i))return[new n.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ps(u,t){let i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(let m of t.valueSpec.expression.parameters)i.delete(m);if(i.size===0)return[];let d=[];return u instanceof n.Z&&i.has(u.name)?[new n.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(m=>{d.push(...Ps(m,t))}),d)}function ia(u){let t=u.key,i=u.value,d=u.valueSpec,m=[];return Array.isArray(d.values)?d.values.indexOf(n.K(i))===-1&&m.push(new n.V(t,i,`expected one of [${d.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(d.values).indexOf(n.K(i))===-1&&m.push(new n.V(t,i,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(i)} found`)),m}function oa(u){return n.$(n.Q(u.value))?Zi(n.J({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):Yt(u)}function Yt(u){let t=u.value,i=u.key;if(n.H(t)!=="array")return[new n.V(i,t,`array expected, ${n.H(t)} found`)];let d=u.styleSpec,m,y=[];if(t.length<1)return[new n.V(i,t,"filter array must have at least 1 element")];switch(y=y.concat(ia({key:`${i}[0]`,value:t[0],valueSpec:d.filter_operator,style:u.style,styleSpec:u.styleSpec})),n.K(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.K(t[1])==="$type"&&y.push(new n.V(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new n.V(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=n.H(t[1]),m!=="string"&&y.push(new n.V(`${i}[1]`,t[1],`string expected, ${m} found`)));for(let x=2;x<t.length;x++)m=n.H(t[x]),n.K(t[1])==="$type"?y=y.concat(ia({key:`${i}[${x}]`,value:t[x],valueSpec:d.geometry_type,style:u.style,styleSpec:u.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&y.push(new n.V(`${i}[${x}]`,t[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)y=y.concat(Yt({key:`${i}[${x}]`,value:t[x],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":m=n.H(t[1]),t.length!==2?y.push(new n.V(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&y.push(new n.V(`${i}[1]`,t[1],`string expected, ${m} found`))}return y}function So(u,t){let i=u.key,d=u.style,m=u.layer,y=u.styleSpec,x=u.value,S=u.objectKey,A=y[`${t}_${u.layerType}`];if(!A)return[];let R=S.match(/^(.*)-use-theme$/);if(t==="paint"&&R&&A[R[1]])return n.O(x)?[].concat(qt({key:u.key,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:S})):qt({key:i,value:x,valueSpec:{type:"string"},style:d,styleSpec:y});let P=S.match(/^(.*)-transition$/);if(t==="paint"&&P&&A[P[1]]&&A[P[1]].transition)return qt({key:i,value:x,valueSpec:y.transition,style:d,styleSpec:y});let k=u.valueSpec||A[S];if(!k)return[new n.G(i,x,`unknown property "${S}"`)];let N;if(n.H(x)==="string"&&n.M(k)&&!k.tokens&&(N=/^{([^}]+)}$/.exec(x))){let Z=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new n.V(i,x,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${Z}.`)]}let V=[];if(u.layerType==="symbol")S!=="text-field"||!d||d.glyphs||d.imports||V.push(new n.V(i,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&n.a0(n.Q(x))&&n.K(x.type)==="identity"&&V.push(new n.V(i,x,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&n.M(k)&&(n.a1(k)||n.N(k))){let Z=n.S(n.Q(x),k),G=Z.value.expression||Z.value._styleExpression.expression;G&&!n.X(G,["measure-light"])&&(S==="model-emissive-strength"&&n.Y(G)&&n.W(G)||V.push(new n.V(i,x,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return V.concat(qt({key:u.key,value:x,valueSpec:k,style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:S}))}function ao(u){return So(u,"paint")}function Os(u){return So(u,"layout")}function ai(u){let t=[],i=u.value,d=u.key,m=u.style,y=u.styleSpec;i.type||i.ref||t.push(new n.V(d,i,'either "type" or "ref" is required'));let x=n.K(i.type),S=n.K(i.ref);if(i.id){let A=n.K(i.id);for(let R=0;R<u.arrayIndex;R++){let P=m.layers[R];n.K(P.id)===A&&t.push(new n.V(d,i.id,`duplicate layer id "${i.id}", previously used at line ${P.id.__line__}`))}}if("ref"in i){let A;["type","source","source-layer","filter","layout"].forEach(R=>{R in i&&t.push(new n.V(d,i[R],`"${R}" is prohibited for ref layers`))}),m.layers.forEach(R=>{n.K(R.id)===S&&(A=R)}),A?A.ref?t.push(new n.V(d,i.ref,"ref cannot reference another ref layer")):x=n.K(A.type):typeof S=="string"&&t.push(new n.V(d,i.ref,`ref layer "${S}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(i.source){let A=m.sources&&m.sources[i.source],R=A&&n.K(A.type);A?R==="vector"&&x==="raster"?t.push(new n.V(d,i.source,`layer "${i.id}" requires a raster source`)):R==="raster"&&x!=="raster"?t.push(new n.V(d,i.source,`layer "${i.id}" requires a vector source`)):R!=="vector"||i["source-layer"]?R==="raster-dem"&&x!=="hillshade"?t.push(new n.V(d,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||R==="geojson"&&A.lineMetrics?x==="raster-particle"&&R!=="raster-array"&&t.push(new n.V(d,i.source,`layer "${i.id}" requires a 'raster-array' source.`)):t.push(new n.V(d,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new n.V(d,i.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(d,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new n.V(d,i.source,`source "${i.source}" not found`))}else t.push(new n.V(d,i,'missing required property "source"'));return t=t.concat(_i({key:d,value:i,valueSpec:y.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>qt({key:`${d}.type`,value:i.type,valueSpec:y.layer.type,style:u.style,styleSpec:u.styleSpec,object:i,objectKey:"type"}),filter:A=>oa(n.J({layerType:x},A)),layout:A=>_i({layer:i,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":R=>Os(n.J({layerType:x},R))}}),paint:A=>_i({layer:i,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":R=>ao(n.J({layerType:x,layer:i},R))}})}})),t}function ts(u){let t=u.value,i=u.key,d=n.H(t);return d!=="string"?[new n.V(i,t,`string expected, ${d} found`)]:[]}let sa={promoteId:function u({key:t,value:i}){if(n.H(i)==="string")return ts({key:t,value:i});if(Array.isArray(i)){let d=[],m=n.Q(i),y=n.U(m);return y.result==="error"&&y.value.forEach(x=>{d.push(new n.V(`${t}${x.key}`,null,`${x.message}`))}),n.X(y.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new n.V(`${t}`,null,"promoteId expression should be only feature dependent")),d}{let d=[];for(let m in i)d.push(...u({key:`${t}.${m}`,value:i[m]}));return d}}};function sl(u){let t=u.value,i=u.key,d=u.styleSpec,m=u.style;if(!t.type)return[new n.V(i,t,'"type" is required')];let y=n.K(t.type),x=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(t.url||t.tiles||x.push(new n.G(i,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(_i({key:i,value:t,valueSpec:d[`source_${y.replace("-","_")}`],style:u.style,styleSpec:d,objectElementValidators:sa})),x;case"geojson":if(x=_i({key:i,value:t,valueSpec:d.source_geojson,style:m,styleSpec:d,objectElementValidators:sa}),t.cluster)for(let S in t.clusterProperties){let[A,R]=t.clusterProperties[S],P=typeof A=="string"?[A,["accumulated"],["get",S]]:A;x.push(...Zi({key:`${i}.${S}.map`,value:R,expressionContext:"cluster-map"})),x.push(...Zi({key:`${i}.${S}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return x;case"video":return _i({key:i,value:t,valueSpec:d.source_video,style:m,styleSpec:d});case"image":return _i({key:i,value:t,valueSpec:d.source_image,style:m,styleSpec:d});case"canvas":return[new n.V(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ia({key:`${i}.type`,value:t.type,valueSpec:{values:al(d)},style:m,styleSpec:d})}}function al(u){return u.source.reduce((t,i)=>{let d=u[i];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t},[])}function yi(u){let t=u.value,i=u.styleSpec,d=i.light,m=u.style,y=[],x=n.H(t);if(t===void 0)return y;if(x!=="object")return y=y.concat([new n.V("light",t,`object expected, ${x} found`)]),y;for(let S in t){let A=S.match(/^(.*)-transition$/),R=S.match(/^(.*)-use-theme$/);y=y.concat(R&&d[R[1]]?qt({key:S,value:t[S],valueSpec:{type:"string"},style:m,styleSpec:i}):A&&d[A[1]]&&d[A[1]].transition?qt({key:S,value:t[S],valueSpec:i.transition,style:m,styleSpec:i}):d[S]?qt({key:S,value:t[S],valueSpec:d[S],style:m,styleSpec:i}):[new n.V(S,t[S],`unknown property "${S}"`)])}return y}function ll(u){let t=u.value,i=[];if(!t)return i;let d=n.H(t);if(d!=="object")return i=i.concat([new n.V("light-3d",t,`object expected, ${d} found`)]),i;let m=u.styleSpec,y=m["light-3d"],x=u.key,S=u.style,A=u.style.lights;for(let k of["type","id"])if(!(k in t))return i=i.concat([new n.V("light-3d",t,`missing property ${k} on light`)]),i;if(t.type&&A)for(let k=0;k<u.arrayIndex;k++){let N=n.K(t.type),V=A[k];n.K(V.type)===N&&i.push(new n.V(x,t.id,`duplicate light type "${t.type}", previously defined at line ${V.id.__line__}`))}let R=`properties_light_${t.type}`;if(!(R in m))return i=i.concat([new n.V("light-3d",t,`Invalid light type ${t.type}`)]),i;let P=m[R];for(let k in t)if(k==="properties"){let N=t[k],V=n.H(N);if(V!=="object")return i=i.concat([new n.V("properties",N,`object expected, ${V} found`)]),i;for(let Z in N)i=i.concat(P[Z]?qt({key:Z,value:N[Z],valueSpec:P[Z],style:S,styleSpec:m}):[new n.G(u.key,N[Z],`unknown property "${Z}"`)])}else{let N=k.match(/^(.*)-transition$/),V=k.match(/^(.*)-use-theme$/);i=i.concat(V&&y[V[1]]?qt({key:k,value:t[k],valueSpec:{type:"string"},style:S,styleSpec:m}):N&&y[N[1]]&&y[N[1]].transition?qt({key:k,value:t[k],valueSpec:m.transition,style:S,styleSpec:m}):y[k]?qt({key:k,value:t[k],valueSpec:y[k],style:S,styleSpec:m}):[new n.G(k,t[k],`unknown property "${k}"`)])}return i}function cl(u){let t=u.value,i=u.key,d=u.style,m=u.styleSpec,y=m.terrain,x=[],S=n.H(t);if(t===void 0||S==="null")return x;if(S!=="object")return x=x.concat([new n.V("terrain",t,`object expected, ${S} found`)]),x;for(let A in t){let R=A.match(/^(.*)-transition$/),P=A.match(/^(.*)-use-theme$/);x=x.concat(P&&y[P[1]]?qt({key:A,value:t[A],valueSpec:{type:"string"},style:d,styleSpec:m}):R&&y[R[1]]&&y[R[1]].transition?qt({key:A,value:t[A],valueSpec:m.transition,style:d,styleSpec:m}):y[A]?qt({key:A,value:t[A],valueSpec:y[A],style:d,styleSpec:m}):[new n.G(A,t[A],`unknown property "${A}"`)])}if(t.source){let A=d.sources&&d.sources[t.source],R=A&&n.K(A.type);A?R!=="raster-dem"&&x.push(new n.V(i,t.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):x.push(new n.V(i,t.source,`source "${t.source}" not found`))}else x.push(new n.V(i,t,'terrain is missing required property "source"'));return x}function Ni(u){let t=u.value,i=u.style,d=u.styleSpec,m=d.fog,y=[],x=n.H(t);if(t===void 0)return y;if(x!=="object")return y=y.concat([new n.V("fog",t,`object expected, ${x} found`)]),y;for(let S in t){let A=S.match(/^(.*)-transition$/),R=S.match(/^(.*)-use-theme$/);y=y.concat(R&&m[R[1]]?qt({key:S,value:t[S],valueSpec:{type:"string"},style:i,styleSpec:d}):A&&m[A[1]]&&m[A[1]].transition?qt({key:S,value:t[S],valueSpec:d.transition,style:i,styleSpec:d}):m[S]?qt({key:S,value:t[S],valueSpec:m[S],style:i,styleSpec:d}):[new n.G(S,t[S],`unknown property "${S}"`)])}return y}let aa={"*":()=>[],array:ol,boolean:function(u){let t=u.value,i=u.key,d=n.H(t);return d!=="boolean"?[new n.V(i,t,`boolean expected, ${d} found`)]:[]},number:ln,color:function(u){let t=u.key,i=u.value,d=n.H(i);return d!=="string"?[new n.V(t,i,`color expected, ${d} found`)]:n._.parseCSSColor(i)===null?[new n.V(t,i,`color expected, "${i}" found`)]:[]},enum:ia,filter:oa,function:Fr,layer:ai,object:_i,source:sl,model:n.a2,light:yi,"light-3d":ll,terrain:cl,fog:Ni,string:ts,formatted:function(u){return ts(u).length===0?[]:Zi(u)},resolvedImage:function(u){return ts(u).length===0?[]:Zi(u)},projection:function(u){let t=u.value,i=u.styleSpec,d=i.projection,m=u.style,y=[],x=n.H(t);if(x==="object")for(let S in t)y=y.concat(qt({key:S,value:t[S],valueSpec:d[S],style:m,styleSpec:i}));else x!=="string"&&(y=y.concat([new n.V("projection",t,`object or string expected, ${x} found`)]));return y},import:function(u){let{value:t,styleSpec:i}=u,x=t,{data:d}=x,m=qx(x,["data"]);Object.defineProperty(m,"__line__",{value:t.__line__,enumerable:!1});let y=_i(n.J({},u,{value:m,valueSpec:i.import}));return n.K(m.id)===""&&y.push(new n.V(`${u.key}.id`,m,"import id can't be an empty string")),d&&(y=y.concat(Nu(d,i,{key:`${u.key}.data`}))),y}};function qt(u,t=!1){let i=u.value,d=u.valueSpec,m=u.styleSpec;if(d.expression&&n.a0(n.K(i)))return Fr(u);if(d.expression&&n.O(n.Q(i)))return Zi(u);if(d.type&&aa[d.type]){let y=aa[d.type](u);return t===!0&&y.length>0&&n.H(u.value)==="array"?Zi(u):y}return _i(n.J({},u,{valueSpec:d.type?m[d.type]:d}))}function Do(u){let t=u.value,i=u.key,d=ts(u);return d.length||(t.indexOf("{fontstack}")===-1&&d.push(new n.V(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&d.push(new n.V(i,t,'"glyphs" url must include a "{range}" token'))),d}function Nu(u,t=n.a3,i={}){return qt({key:i.key||"",value:u,valueSpec:t.$root,styleSpec:t,style:u,objectElementValidators:{glyphs:Do,"*":()=>[]}})}function Mi(u,t=n.a3){return $r(Nu(u,t))}let ns=u=>$r(sl(u)),ul=u=>$r(yi(u)),hl=u=>$r(ll(u)),dl=u=>$r(cl(u)),zu=u=>$r(Ni(u)),fl=u=>$r(function(t){let i=t.value,d=t.style,m=t.styleSpec,y=m.snow,x=[],S=n.H(i);if(i===void 0)return x;if(S!=="object")return x=x.concat([new n.V("snow",i,`object expected, ${S} found`)]),x;for(let A in i){let R=A.match(/^(.*)-transition$/);x=x.concat(R&&y[R[1]]&&y[R[1]].transition?qt({key:A,value:i[A],valueSpec:m.transition,style:d,styleSpec:m}):y[A]?qt({key:A,value:i[A],valueSpec:y[A],style:d,styleSpec:m}):[new n.G(A,i[A],`unknown property "${A}"`)])}return x}(u)),Bu=u=>$r(function(t){let i=t.value,d=t.style,m=t.styleSpec,y=m.rain,x=[],S=n.H(i);if(i===void 0)return x;if(S!=="object")return x=x.concat([new n.V("rain",i,`object expected, ${S} found`)]),x;for(let A in i){let R=A.match(/^(.*)-transition$/);x=x.concat(R&&y[R[1]]&&y[R[1]].transition?qt({key:A,value:i[A],valueSpec:m.transition,style:d,styleSpec:m}):y[A]?qt({key:A,value:i[A],valueSpec:y[A],style:d,styleSpec:m}):[new n.G(A,i[A],`unknown property "${A}"`)])}return x}(u)),Vu=u=>$r(ai(u)),Dr=u=>$r(oa(u)),sc=u=>$r(ao(u)),ju=u=>$r(Os(u)),ac=u=>$r(n.a2(u));function $r(u){return u.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function Mo(u,t){let i=!1;if(t&&t.length)for(let d of t)d instanceof n.G?n.w(d.message):(u.fire(new n.y(new Error(d.message))),i=!0);return i}let Ne;class W extends n.E{constructor(t,i="flat"){super(),this._transitionable=new n.a4(Ne||(Ne=new n.a5({anchor:new n.a6(n.a3.light.anchor),position:new n.a7(n.a3.light.position),color:new n.a6(n.a3.light.color),intensity:new n.a6(n.a3.light.intensity)}))),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i,d={}){this._validate(ul,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=i)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,d){return(!d||d.validate!==!1)&&Mo(this,t.call(Mi,n.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}}let J=class extends n.E{constructor(u,t,i,d){super(),this.scope=i,this._transitionable=new n.a4(new n.a5({source:new n.a6(n.a3.terrain.source),exaggeration:new n.a6(n.a3.terrain.exaggeration)}),i,d),this._transitionable.setTransitionOrValue(u,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new n.a8(u)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let u=this._transitionable._values.exaggeration;if(!u)return null;let t=u.value.expression;if(!t)return null;let i=-1,d=-1,m=1;for(let y of t.zoomStops)m=t.evaluate(new n.a8(y)),m>.01?(i=y,d=-1):d=y;return m<.01&&i>0&&d>i?[i,d]:null}isZoomDependent(){let u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof n.a9}},Q=45,ue=65,de=.05;function ve(u,t,i,d){let m=n.ac(Q,ue,i),[y,x]=Ce(u,d),S=1-Math.min(1,Math.exp((t-y)/(x-y)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*m*u.alpha}function Ce(u,t){let i=.5/Math.tan(.5*t);return[u.range[0]+i,u.range[1]+i]}function xe(u,t,i,d,m){let y=n.ab.vec3.transformMat4([],[t,i,d],m.mercatorFogMatrix);return ve(u,n.ab.vec3.length(y),m.pitch,m._fov)}function Le(u,t,i,d,m,y,x){let S=[[i,d,0],[m,d,0],[m,y,0],[i,y,0]],A=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let P of S){let k=n.ab.vec3.transformMat4([],P,t),N=n.ab.vec3.length(k);A=Math.min(A,N),R=Math.max(R,N)}return[ve(u,A,x.pitch,x._fov),ve(u,R,x.pitch,x._fov)]}class Oe extends n.E{constructor(t,i,d,m){super();let y=new n.a5({range:new n.a6(n.a3.fog.range),color:new n.a6(n.a3.fog.color),"color-use-theme":new n.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.a6(n.a3.fog["high-color"]),"high-color-use-theme":new n.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.a6(n.a3.fog["space-color"]),"space-color-use-theme":new n.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.a6(n.a3.fog["horizon-blend"]),"star-intensity":new n.a6(n.a3.fog["star-intensity"]),"vertical-range":new n.a6(n.a3.fog["vertical-range"])});this._transitionable=new n.a4(y,d,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new n.ad(y),this.scope=d}get state(){let t=this._transform,i=t.projection.name==="globe",d=n.ae(t.zoom),m=this.properties.get("range"),y=[.5,3];return{range:i?[n.af(y[0],m[0],d),n.af(y[1],m[1],d)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i,d={}){if(this._validate(zu,t,d))return;let m=n.l({},t);for(let y of Object.keys(n.a3.fog))m[y]===void 0&&(m[y]=n.a3.fog[y].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;let i=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.ac(Q,ue,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(d,m,y){let x=n.aa.fromLngLat(m),S=y.elevation?y.elevation.getAtPointOrZero(x):0;return xe(d,x.x,x.y,S,y)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];let i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Le(this.state,i,0,0,n.ag,n.ag,this._transform)}getOpacityForBounds(t,i,d,m,y){return this._transform.projection.supportsFog?Le(this.state,t,i,d,m,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ce(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;let i=[4,5,6,7];for(let d of i){let m=t.points[d],y;if(m[2]>=0)y=m;else{let x=t.points[d-4];y=n.ah(x,m,x[2]/(x[2]-m[2]))}if(xe(this.state,y[0],y[1],0,this._transform)>=de)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,d){return(!d||d.validate!==!1)&&Mo(this,t.call(Mi,n.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}}let ke,Xe,ot,st,Tt=class extends n.E{constructor(u,t,i,d){super();let m=ke||(ke=new n.a5({density:new n.a6(n.a3.snow.density),intensity:new n.a6(n.a3.snow.intensity),color:new n.a6(n.a3.snow.color),opacity:new n.a6(n.a3.snow.opacity),vignette:new n.a6(n.a3.snow.vignette),"vignette-color":new n.a6(n.a3.snow["vignette-color"]),"center-thinning":new n.a6(n.a3.snow["center-thinning"]),direction:new n.a6(n.a3.snow.direction),"flake-size":new n.a6(n.a3.snow["flake-size"])}));this._transitionable=new n.a4(m,i,new Map(d)),this.set(u,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ad(m),this.scope=i}get state(){let u=this.properties.get("opacity"),t=this.properties.get("color"),i=this.properties.get("direction"),d=n.ai(i[0]),m=-Math.max(n.ai(i[1]),.01),y=[Math.cos(d)*Math.cos(m),Math.sin(d)*Math.cos(m),Math.sin(m)],x=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.aj(t.r,t.g,t.b,t.a*u),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(u,t,i={}){if(this._validate(fl,u,i))return;let d=n.l({},u);for(let m of Object.keys(n.a3.snow))d[m]===void 0&&(d[m]=n.a3.snow[m].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,i){return(!i||i.validate!==!1)&&Mo(this,u.call(Mi,n.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}},Mt=class extends n.E{constructor(u,t,i,d){super();let m=Xe||(Xe=new n.a5({density:new n.a6(n.a3.rain.density),intensity:new n.a6(n.a3.rain.intensity),color:new n.a6(n.a3.rain.color),opacity:new n.a6(n.a3.rain.opacity),vignette:new n.a6(n.a3.rain.vignette),"vignette-color":new n.a6(n.a3.rain["vignette-color"]),"center-thinning":new n.a6(n.a3.rain["center-thinning"]),direction:new n.a6(n.a3.rain.direction),"droplet-size":new n.a6(n.a3.rain["droplet-size"]),"distortion-strength":new n.a6(n.a3.rain["distortion-strength"])}));this._transitionable=new n.a4(m,i,new Map(d)),this.set(u,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ad(m),this.scope=i}get state(){let u=this.properties.get("opacity"),t=this.properties.get("color"),i=this.properties.get("direction"),d=n.ai(i[0]),m=-Math.max(n.ai(i[1]),.01),y=[Math.cos(d)*Math.cos(m),Math.sin(d)*Math.cos(m),Math.sin(m)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.aj(t.r,t.g,t.b,t.a*u),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(u,t,i={}){if(this._validate(Bu,u,i))return;let d=n.l({},u);for(let m of Object.keys(n.a3.rain))d[m]===void 0&&(d[m]=n.a3.rain[m].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,i){return(!i||i.validate!==!1)&&Mo(this,u.call(Mi,n.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}};class Ct extends n.E{constructor(t,i,d,m){super(),this.scope=d,this._options=t,this.properties=new n.ad(i),this._transitionable=new n.a4(i,d,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,i){this._options=t,this._transitionable.setTransitionOrValue(t.properties,i)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Dt{constructor(t,i,d,m){this.screenBounds=t,this.cameraPoint=i,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(t,i){let d,m;if(t instanceof n.P||typeof t[0]=="number"){let y=n.P.convert(t);d=[y],m=i.isPointAboveHorizon(y)}else{let y=n.P.convert(t[0]),x=n.P.convert(t[1]);d=[y,x],m=n.al(y,x).every(S=>i.isPointAboveHorizon(S))}return new Dt(d,i.getCameraPoint(),m,i)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){let i=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],m=n.al(i,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<d.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?m[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(m[3]=this.cameraPoint)),n.am(m,t)}bufferedCameraGeometryGlobe(t){let i=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],m=n.al(i,d,t),y=this.cameraPoint.clone();switch(3*((y.y>i.y)+(y.y>d.y))+((y.x>i.x)+(y.x>d.x))){case 0:m[0]=y,m[4]=y.clone();break;case 1:m.splice(1,0,y);break;case 2:m[1]=y;break;case 3:m.splice(4,0,y);break;case 5:m.splice(2,0,y);break;case 6:m[3]=y;break;case 7:m.splice(3,0,y);break;case 8:m[2]=y}return m}containsTile(t,i,d,m=0){let y=t.queryPadding/i._pixelsPerMercatorPixel+1,x=d?this._bufferedCameraMercator(y,i):this._bufferedScreenMercator(y,i),S=t.tileID.wrap+(x.unwrapped?m:0),A=x.polygon.map(Y=>n.an(t.tileTransform,Y,S));if(!n.ao(A,0,0,n.ag,n.ag))return;S=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);let R=this.screenGeometryMercator.polygon.map(Y=>n.ap(t.tileTransform,Y,S)),P=R.map(Y=>new n.P(Y[0],Y[1])),k=i.getFreeCameraOptions().position||new n.aa(0,0,0),N=n.ap(t.tileTransform,k,S),V=R.map(Y=>{let X=n.ab.vec3.sub(Y,Y,N);return n.ab.vec3.normalize(X,X),new n.aq(N,X)}),Z=n.ar(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:V,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(G=n.as(A),G.min.x=n.aw(G.min.x,0,n.ag),G.min.y=n.aw(G.min.y,0,n.ag),G.max.x=n.aw(G.max.x,0,n.ag),G.max.y=n.aw(G.max.y,0,n.ag),G),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Z};var G}_bufferedScreenMercator(t,i){let d=Kt(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let m;return m=i.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),i):{polygon:this.bufferedScreenGeometry(t).map(y=>i.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[d]=m,m}}_bufferedCameraMercator(t,i){let d=Kt(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let m;return m=i.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),i):{polygon:this.bufferedCameraGeometry(t).map(y=>i.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[d]=m,m}}_projectAndResample(t,i){let d=function(y,x){let S=n.ab.mat4.multiply([],x.pixelMatrix,x.globeMatrix),A=[0,-n.ax,0,1],R=[0,n.ax,0,1],P=[0,0,0,1];n.ab.vec4.transformMat4(A,A,S),n.ab.vec4.transformMat4(R,R,S),n.ab.vec4.transformMat4(P,P,S);let k=new n.P(A[0]/A[3],A[1]/A[3]),N=new n.P(R[0]/R[3],R[1]/R[3]),V=n.au(y,k)&&A[3]<P[3],Z=n.au(y,N)&&R[3]<P[3];if(!V&&!Z)return null;let G=function(he,le,ge){for(let we=1;we<he.length;we++){let Be=hn(le.pointCoordinate3D(he[we-1]).x),Re=hn(le.pointCoordinate3D(he[we]).x);if(ge<0){if(Be<Re)return{idx:we,t:-Be/(Re-1-Be)}}else if(Re<Be)return{idx:we,t:(1-Be)/(Re+1-Be)}}return null}(y,x,V?-1:1);if(!G)return null;let{idx:Y,t:X}=G,ee=Y>1?sn(y.slice(0,Y),x):[],se=Y<y.length?sn(y.slice(Y),x):[];ee=ee.map(he=>new n.P(hn(he.x),he.y)),se=se.map(he=>new n.P(hn(he.x),he.y));let oe=[...ee];oe.length===0&&oe.push(se[se.length-1]);let fe=n.af(oe[oe.length-1].y,(se.length===0?ee[0]:se[0]).y,X),ce;return ce=V?[new n.P(0,fe),new n.P(0,0),new n.P(1,0),new n.P(1,fe)]:[new n.P(1,fe),new n.P(1,1),new n.P(0,1),new n.P(0,fe)],oe.push(...ce),se.length===0?oe.push(ee[0]):oe.push(...se),{polygon:oe.map(he=>new n.aa(he.x,he.y)),unwrapped:!1}}(t,i);if(d)return d;let m=function(y,x){let S=!1,A=-1/0,R=0;for(let k=0;k<y.length-1;k++)y[k].x>A&&(A=y[k].x,R=k);for(let k=0;k<y.length-1;k++){let N=(R+k)%(y.length-1),V=y[N],Z=y[N+1];Math.abs(V.x-Z.x)>.5&&(V.x<Z.x?(V.x+=1,N===0&&(y[y.length-1].x+=1)):(Z.x+=1,N+1===y.length-1&&(y[0].x+=1)),S=!0)}let P=n.at(x.center.lng);return S&&P<Math.abs(P-1)&&y.forEach(k=>{k.x-=1}),{polygon:y,unwrapped:S}}(sn(t,i).map(y=>new n.P(hn(y.x),y.y)),i);return{polygon:m.polygon.map(y=>new n.aa(y.x,y.y)),unwrapped:m.unwrapped}}}function sn(u,t){return n.av(u,i=>{let d=t.pointCoordinate3D(i);i.x=d.x,i.y=d.y},1/256)}function hn(u){return u<0?1+u%1:u%1}function Kt(u){return 100*u|0}function pn(u,t,i,d,m){let y=function(S,A){if(S)return m(S);if(A){if(u.url&&A.tiles&&u.tiles&&delete u.tiles,A.variants){if(!Array.isArray(A.variants))return m(new Error("variants must be an array"));for(let P of A.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return m(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){A=n.l(A,P);break}}}let R=n.ay(n.l({},A,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);R.tiles=t.canonicalizeTileset(R,u.url),m(null,R)}},x=function(S,A,R){if(!S)return null;if(!A&&!R)return S;R=R||S.worldview_default;let P=Object.values(S.language||{});if(P.length===0)return null;let k=Object.values(S.worldview||{});if(k.length===0)return null;let N=P.every(Z=>Z===A),V=k.every(Z=>Z===R);return N&&V?S:A in(S.language_options||{})||R in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null}(u.data,i,d);return x?n.q.frame(()=>y(null,x)):u.url?n.n(t.transformRequest(t.normalizeSourceURL(u.url,null,i,d),n.R.Source),y):n.q.frame(()=>{let R=u,{data:S}=R,A=qx(R,["data"]);y(null,A)})}class _n{constructor(t,i,d){this.bounds=n.az.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){let i=Math.pow(2,t.z),d=Math.floor(n.at(this.bounds.getWest())*i),m=Math.floor(n.aA(this.bounds.getNorth())*i),y=Math.ceil(n.at(this.bounds.getEast())*i),x=Math.ceil(n.aA(this.bounds.getSouth())*i);return t.x>=d&&t.x<y&&t.y>=m&&t.y<x}}class vr extends n.E{constructor(t,i,d,m){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.l(this,n.ay(i,["url","scheme","tileSize","promoteId"])),this._options=n.l({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new n.aB}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));let i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=pn(this._options,this.map._requestManager,i,d,(m,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new n.y(m));else if(y){if(n.l(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(let x of y.vector_layers)this.vectorLayerIds.push(x.id),y.worldview&&y.worldview[x.source]&&this.localizableLayerIds.add(x.id)}y.bounds&&(this.tileBounds=new _n(y.bounds,this.minzoom,this.maxzoom)),Rs(y.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=n.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}loadTile(t,i){let d=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(d),y=this.map._requestManager.transformRequest(m,n.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,S=x?{image:x.image.clone()}:null,A={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&n.f(d)&&(A.worldview=this.map.getWorldview()||this.worldviewDefault,A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=i:t.request=t.actor.send("reloadTile",A,R.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",A,R.bind(this),void 0,!0);else{let P=n.aD.call({deduped:this._deduped},A,(k,N)=>{k||!N?R.call(this,k):(A.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},t.actor&&t.actor.send("loadTile",A,R.bind(this),void 0,!0))},!0);t.request={cancel:P}}function R(P,k){return delete t.request,t.aborted?i(null):P&&P.status!==404?i(P):(k&&k.resourceTiming&&(t.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&t.setExpiryData(k),t.loadVectorData(k,this.map.painter),n.aE(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,i){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Co extends n.E{constructor(t,i,d,m){super(),this.id=t,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.l({type:"raster"},i),n.l(this,n.ay(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._tileJSONRequest=pn(this._options,this.map._requestManager,null,null,(i,d)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new n.y(i)):d&&(n.l(this,d),d.raster_layers&&(this.rasterLayers=d.raster_layers,this.rasterLayerIds=this.rasterLayers.map(m=>m.id)),d.bounds&&(this.tileBounds=new _n(d.bounds,this.minzoom,this.maxzoom)),Rs(d.tiles),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=n.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,i){let d=n.q.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=n.o(this.map._requestManager.transformRequest(m,n.R.Tile),(y,x,S,A)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):y?(t.state="errored",i(y)):x?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:A}),t.setTexture(x,this.map.painter),t.state="loaded",n.aE(this.dispatcher),void i(null)):i(null)))}abortTile(t,i){t.request&&(t.request.cancel(),delete t.request),i&&i()}unloadTile(t,i){t.texture&&t.texture instanceof n.T?(t.destroy(!0),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i&&i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Mr extends Co{constructor(t,i,d,m){super(t,i,d,m),this.type="raster-array",this.maxzoom=22,this._options=n.l({type:"raster-array"},i)}triggerRepaint(t){let i=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);i&&i.enabled&&d&&i._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,i){let d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(d,n.R.Tile);t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(y,x,S,A)=>{if(delete t.request,t.aborted)return t.state="unloaded",i(null);if(y)return y.code===20?void 0:(t.state="errored",i(y));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:A}),t.state="empty",i(null)})}unloadTile(t,i){let d=t.texture;d&&d instanceof n.T?(t.destroy(!0),this.map.painter.saveTileTexture(d)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,i,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(i,d,(m,y)=>{if(m)return t.state="errored",this.fire(new n.y(m)),void this.triggerRepaint(t);y&&(t.setTexture(y,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;let i=this.rasterLayers.find(({id:y})=>y===t),d=i&&i.fields,m=d&&d.bands&&d.bands;return m?m[0]:0}getTextureDescriptor(t,i,d){if(!t)return;let m=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let y=null;i instanceof n.aH?y=i.paint.get("raster-array-band"):i instanceof n.aI&&(y=i.paint.get("raster-particle-array-band"));let x=y||this.getInitialBand(m);if(x!=null)if(t.textureDescriptor){if(!t.updateNeeded(m,x)||d)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,m,x)}}let Ar={vector:vr,raster:Co,"raster-dem":class extends Co{constructor(u,t,i,d){super(u,t,i,d),this.type="raster-dem",this.maxzoom=22,this._options=n.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){let i=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(m,y){m&&(u.state="errored",t(m)),y&&(u.dem=y,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=n.o(this.map._requestManager.transformRequest(i,n.R.Tile),function(m,y,x,S){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(m)u.state="errored",t(m);else if(y){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:x,expires:S});let A=ImageBitmap&&y instanceof ImageBitmap&&n.t(),R=1-(y.width-n.aF(y.width))/2;R<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));let P=A?y:n.q.getImageData(y,R),k={uid:u.uid,coord:u.tileID,source:this.id,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:R};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",k,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(u){let t=u.canonical,i=Math.pow(2,t.z),d=(t.x-1+i)%i,m=t.x===0?u.wrap-1:u.wrap,y=(t.x+1+i)%i,x=t.x+1===i?u.wrap+1:u.wrap,S={};return S[new n.aG(u.overscaledZ,m,t.z,d,t.y).key]={backfilled:!1},S[new n.aG(u.overscaledZ,x,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(S[new n.aG(u.overscaledZ,m,t.z,d,t.y-1).key]={backfilled:!1},S[new n.aG(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new n.aG(u.overscaledZ,x,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<i&&(S[new n.aG(u.overscaledZ,m,t.z,d,t.y+1).key]={backfilled:!1},S[new n.aG(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new n.aG(u.overscaledZ,x,t.z,y,t.y+1).key]={backfilled:!1}),S}},"raster-array":Mr,geojson:class extends n.E{constructor(u,t,i,d){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(d),this._data=t.data,this._options=n.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;let m=n.ag/this.tileSize;this.workerOptions=n.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:n.ag,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.ag,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new n.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new n.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let t=new Map;for(let i of this._data.features)t.set(i.id,i);for(let i of u.features)t.set(i.id,i);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,i,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:i},d),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.z("dataloading",{dataType:"source"})),this._loaded=!1;let t=n.l({append:u},this.workerOptions);t.scope=this.scope;let i=this._data;typeof i=="string"?(t.request=this.map._requestManager.transformRequest(n.q.resolveURL(i),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,m)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new n.y(d));else{let y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new n.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}reload(){let u=n.aC(this.id,this.scope);this.map.style.clearSource(u),this._updateWorkerData()}loadTile(u,t){let i=u.actor?"reloadTile":"loadTile";u.actor=this.actor;let d=this.map.style?this.map.style.getLut(this.scope):null,m=d?{image:d.image.clone()}:null,y=this._partialReload,x={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:y};u.request=this.actor.send(i,x,(S,A)=>y&&!A?(u.state="loaded",t(null)):(delete u.request,u.destroy(),u.aborted?t(null):S?t(S):(u.loadVectorData(A,this.map.painter,i==="reloadTile"),t(null))),void 0,i==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aJ{constructor(u,t,i,d){super(u,t,i,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;let u=this.options;this.urls=[];for(let t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aK(this.urls,(t,i)=>{this._loaded=!0,t?this.fire(new n.y(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){let t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new n.y(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aJ,model:class extends n.E{constructor(u,t,i,d){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){let u=[];for(let t in this._options.models){let i=this._options.models[t],d=n.aM(this.map._requestManager.transformRequest(i.uri,n.R.Model).url).then(m=>{if(!m)return;let y=n.aN(m),x=new n.aO(t,i.position,i.orientation,y);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(m=>{this.fire(new n.y(new Error(`Could not load model ${t} from ${i.uri}: ${m.message}`)))});u.push(d)}return Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new n.y(new Error(`Could not load models: ${t.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,t){}serialize(){return{type:"model"}}},"batched-model":class extends n.E{constructor(u,t,i,d){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();let u=n.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(u){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));let t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map.getWorldview();this._tileJSONRequest=pn(this._options,this.map._requestManager,t,i,(d,m)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),i&&i.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new n.y(d))):m&&(n.l(this,m),m.bounds&&(this.tileBounds=new _n(m.bounds,this.minzoom,this.maxzoom)),Rs(m.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),u&&u(d)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){let i=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(i,n.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){let y=Object.values(u.buckets);for(let x of y)x.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",d,m.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",d,m.bind(this),void 0,!0);function m(y,x){return u.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&x&&u.setExpiryData(x),u.loadModelData(x,this.map.painter),u.state="loaded",void t(null))}}serialize(){return n.l({},this._options)}},canvas:class extends n.aJ{constructor(u,t,i,d){super(u,t,i,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new n.y(new n.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.y(new n.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.y(new n.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.y(new n.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.y(new n.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof n.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends n.E{constructor(u,t,i,d){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _n(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),n.l(this,n.ay(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){let{x:t,y:i,z:d}=u.canonical;return this._implementation.hasTile({x:t,y:i,z:d})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){let{x:i,y:d,z:m}=u.tileID.canonical,y=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:i,y:d,z:m},{signal:y.signal})).then(function(x){return delete u.request,u.aborted?(u.state="unloaded",t(null)):x===void 0?(u.state="errored",t(null)):x===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(x)?(this.loadTileData(u,x),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(x=>{x.code!==20&&(u.state="errored",t(x))}),u.request.cancel=()=>y.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof n.T?(u.destroy(!0),u.texture&&u.texture instanceof n.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){let{x:i,y:d,z:m}=u.tileID.canonical;this._implementation.unloadTile({x:i,y:d,z:m})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){let u=n.aC(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}}},li=function(u,t,i,d){let m=new Ar[t.type](u,t,i,d);if(m.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${m.id}`);return n.aP(["load","abort","unload","serialize","prepare"],m),m};function lc(u,t,i=""){return`${i}:${t.id||""}:${t.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{let{featuresetId:m,importId:y}=d;return`featureset:${m}${y?`:import:${y}`:""}`}}(u.target)}`}function rs(u,t,i,d=""){if(u.uniqueFeatureID){let m=lc(u,t,d);if(i.has(m))return!0;i.add(m)}return!1}function cc(u,t,i,d,m=!1){let y=t.sourceCache.transform,x=t.sourceCache.tilesIn(u,t.has3DLayers,m);x.sort(Zd);let S=[];for(let A of x){let R=A.tile.queryRenderedFeatures(t,A,i,d,y,m);Object.keys(R).length&&S.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:R})}return S.length===0?{}:function(A){let R={},P={};for(let k of A){let N=k.queryResults,V=k.wrappedTileID,Z=P[V]=P[V]||{};for(let G in N){let Y=N[G],X=Z[G]=Z[G]||{},ee=R[G]=R[G]||[];for(let se of Y)X[se.featureIndex]||(X[se.featureIndex]=!0,ee.push(se))}}return R}(S)}function Wd(u,t,i,d,m){let y={},x=d.queryRenderedSymbols(u),S=[];for(let A of Object.keys(x).map(Number))S.push(m[A]);S.sort(Zd);for(let A of S){let R=A.featureIndex.lookupSymbolFeatures(x[A.bucketInstanceId],A.bucketIndex,A.sourceLayerIndex,t,i);for(let P in R){let k=y[P]=y[P]||[],N=R[P];N.sort((V,Z)=>{let G=A.featureSortOrder;if(G){let Y=G.indexOf(V.featureIndex);return G.indexOf(Z.featureIndex)-Y}return Z.featureIndex-V.featureIndex});for(let V of N)k.push(V)}}return y}function eg(u,t){let i=u.getRenderableIds().map(y=>u.getTileByID(y)),d=[],m={};for(let y=0;y<i.length;y++){let x=i[y],S=x.tileID.canonical.key;m[S]||(m[S]=!0,x.querySourceFeatures(d,t))}return d}function Zd(u,t){let i=u.tileID,d=t.tileID;return i.overscaledZ-d.overscaledZ||i.canonical.y-d.canonical.y||i.wrap-d.wrap||i.canonical.x-d.canonical.x}function Xd(u,t){let i={};if(!t)return i;for(let d of u){let m=d.layerIds.map(y=>t.getLayer(y)).filter(Boolean);if(m.length!==0){d.layers=m,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(y=>m.filter(x=>x.id===y)[0]));for(let y of m)i[y.fqid]=d}}return i}let ci=32,lo=33,is=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,i=0,d=0,m=0,y=0,x=0,S=0;for(1&t?m=y=x=ci:i=d=S=ci;(t>>=1)>1;){let R=i+m>>1,P=d+y>>1;1&t?(m=i,y=d,i=x,d=S):(i=m,d=y,m=x,y=S),x=R,S=P}let A=4*u;is[A+0]=i,is[A+1]=d,is[A+2]=m,is[A+3]=y}let Ao=new Uint16Array(2178),co=new Uint8Array(1089),Ro=new Uint16Array(1089);function Uu(u){return u===0?-.03125:u===32?.03125:0}let Yd={type:2,extent:n.ag,loadGeometry:()=>[[new n.P(0,0),new n.P(n.ag+1,0),new n.P(n.ag+1,n.ag+1),new n.P(0,n.ag+1),new n.P(0,0)]]};class Ls{constructor(t,i,d,m,y){this.tileID=t,this.uid=n.aV(),this.uses=0,this.tileSize=i,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(t){let i=t+this.timeAdded;i<n.q.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Xd(t.buckets,i.style),this.hasSymbolBuckets=!1;for(let m in this.buckets){let y=this.buckets[m];if(y instanceof n.aX){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let m in this.buckets){let y=this.buckets[m];if(y instanceof n.aX&&y.hasRTLText){this.hasRTLText=!0,n.aY();break}}this.queryPadding=0;for(let m in this.buckets){let y=this.buckets[m],x=i.style.getOwnLayer(m);if(!x)continue;let S=x.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,S)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.aW}unloadVectorData(){if(this.hasData()){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,i,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Xd(t.buckets,i.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(let m in this.buckets){let y=this.buckets[m];y.uploadPending()&&y.upload(t)}let i=t.gl,d=this.imageAtlas;if(d&&!d.uploaded){let m=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new n.T(t,d.image,i.RGBA8,{useMipmap:m}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(t,i,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let m=i.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(i,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(t,i,d,m,y,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};let S=function(A,R){let P=n.ab.mat4.fromScaling([],[.5*A.width,.5*-A.height,1]);return n.ab.mat4.translate(P,P,[1,-1,0]),n.ab.mat4.multiply(P,P,A.calculateProjMatrix(R.toUnwrapped())),Float32Array.from(P)}(y,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:i,pixelPosMatrix:S,transform:m,availableImages:d,tileTransform:this.tileTransform})}querySourceFeatures(t,i){let d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;let m=d.loadVTLayers(),y=i?i.sourceLayer:"",x=m._geojsonTileLayer||m[y];if(!x)return;let S=n.aZ(i&&i.filter),{z:A,x:R,y:P}=this.tileID.canonical,k={z:A,x:R,y:P};for(let N=0;N<x.length;N++){let V=x.feature(N);if(S.needGeometry){let Y=n.a_(V,!0);if(!S.filter(new n.a8(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!S.filter(new n.a8(this.tileID.overscaledZ),V))continue;let Z=d.getId(V,y),G=new n.a$(V,A,R,P,Z);G.tile=k,t.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let i=this.expirationTime;if(t.cacheControl){let d=n.b0(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let d=Date.now(),m=!1;if(this.expirationTime>d)m=!1;else if(i)if(this.expirationTime<i)m=!0;else{let y=this.expirationTime-i;y?this.expirationTime=d+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,i){if(!this.latestFeatureIndex||!t.style)return;let d=this.latestFeatureIndex.loadVTLayers(),m=t.style.listImages(),y=t.style.getBrightness();for(let x in this.buckets){if(!t.style.hasLayer(x))continue;let S=this.buckets[x],A=S.layers[0],R=A.sourceLayer||"_geojsonTileLayer",P=d[R],k=t.style.getLayerSourceCache(A),N={};k&&(N=k._state.getState(R,void 0));let V=this.imageAtlas&&this.imageAtlas.patternPositions||{},Z=Object.keys(N).length>0&&!i;Z&&!S.stateDependentLayers.length&&!i||S.update(N,P,m,V,Z?S.stateDependentLayers:S.layers,i,y),(S instanceof n.b1||S instanceof n.b2)&&t._terrain&&t._terrain.enabled&&k&&S.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(k.id,this.tileID);let G=t&&t.style&&t.style.getOwnLayer(x);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.q.now()+t}setTexture(t,i){let d=i.context,m=d.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(d,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,i){let d={};for(let m of i)d[m]=!0;this.dependencies[t]=d}hasDependency(t,i){for(let d of t){let m=this.dependencies[d];if(m){for(let y of i)if(m[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;let d=n.b3(Yd,this.tileID.canonical,this.tileTransform)[0],m=new n.b4,y=new n.b5;for(let x=0;x<d.length;x++){let{x:S,y:A}=d[x];m.emplaceBack(S,A),y.emplaceBack(x)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(m,n.b6.members),this._tileDebugSegments=n.b7.simpleSegment(0,0,m.length,y.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;let d=n.b3(Yd,this.tileID.canonical,this.tileTransform)[0],m,y;if(this.isRaster){let x=function(S,A){let R=n.aQ(S,A),P=Math.pow(2,S.z);for(let Y=0;Y<lo;Y++)for(let X=0;X<lo;X++){let ee=n.aR((S.x+(X+Uu(X))/ci)/P),se=n.aS((S.y+(Y+Uu(Y))/ci)/P),oe=A.project(ee,se),fe=Y*lo+X;Ao[2*fe+0]=Math.round((oe.x*R.scale-R.x)*n.ag),Ao[2*fe+1]=Math.round((oe.y*R.scale-R.y)*n.ag)}co.fill(0),Ro.fill(0);for(let Y=2045;Y>=0;Y--){let X=4*Y,ee=is[X+0],se=is[X+1],oe=is[X+2],fe=is[X+3],ce=ee+oe>>1,he=se+fe>>1,le=ce+he-se,ge=he+ee-ce,we=se*lo+ee,Be=fe*lo+oe,Re=he*lo+ce,Ge=Math.hypot((Ao[2*we+0]+Ao[2*Be+0])/2-Ao[2*Re+0],(Ao[2*we+1]+Ao[2*Be+1])/2-Ao[2*Re+1])>=16;co[Re]=co[Re]||(Ge?1:0),Y<1022&&(co[Re]=co[Re]||co[(se+ge>>1)*lo+(ee+le>>1)]||co[(fe+ge>>1)*lo+(oe+le>>1)])}let k=new n.aT,N=new n.aU,V=0;function Z(Y,X){let ee=X*lo+Y;return Ro[ee]===0&&(k.emplaceBack(Ao[2*ee+0],Ao[2*ee+1],Y*n.ag/ci,X*n.ag/ci),Ro[ee]=++V),Ro[ee]-1}function G(Y,X,ee,se,oe,fe){let ce=Y+ee>>1,he=X+se>>1;if(Math.abs(Y-oe)+Math.abs(X-fe)>1&&co[he*lo+ce])G(oe,fe,Y,X,ce,he),G(ee,se,oe,fe,ce,he);else{let le=Z(Y,X),ge=Z(ee,se),we=Z(oe,fe);N.emplaceBack(le,ge,we)}}return G(0,0,ci,ci,ci,0),G(ci,ci,0,0,0,ci),{vertices:k,indices:N}}(this.tileID.canonical,i);m=x.vertices,y=x.indices}else{m=new n.aT,y=new n.aU;for(let{x:S,y:A}of d)m.emplaceBack(S,A,0,0);let x=n.b8(m.int16,void 0,4);for(let S=0;S<x.length;S+=3)y.emplaceBack(x[S],x[S+1],x[S+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,n.b9.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=n.b7.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugBuffers(t,i){let d=i.projection;if(!d||d.name!=="globe"||i.freezeTileCoverage)return;let m=this.tileID.canonical,y=n.ba(m,i),x=n.bb(y),S=n.ae(i.zoom),A;S>0&&(A=n.ab.mat4.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,i,x,A,S),this._makeGlobeTileDebugTextBuffer(t,m,i,x,A,S)}_globePoint(t,i,d,m,y,x,S){let A=n.bc(t,i,d);if(x){let R=1<<d.z,P=n.at(m.center.lng),k=n.aA(m.center.lat),N=(d.x+.5)/R-P,V=0;N>.5?V=-1:N<-.5&&(V=1);let Z=(t/n.ag+d.x)/R+V,G=(i/n.ag+d.y)/R;Z=(Z-P)*m._pixelsPerMercatorPixel+P,G=(G-k)*m._pixelsPerMercatorPixel+k;let Y=[Z*m.worldSize,G*m.worldSize,0];n.ab.vec3.transformMat4(Y,Y,x),A=n.bd(A,Y,S)}return n.ab.vec3.transformMat4(A,A,y)}_makeGlobeTileDebugBorderBuffer(t,i,d,m,y,x){let S=new n.b4,A=new n.b5,R=new n.be,P=(N,V,Z,G,Y)=>{let X=(Z-N)/(Y-1),ee=(G-V)/(Y-1),se=S.length;for(let oe=0;oe<Y;oe++){let fe=N+oe*X,ce=V+oe*ee;S.emplaceBack(fe,ce);let he=this._globePoint(fe,ce,i,d,m,y,x);R.emplaceBack(he[0],he[1],he[2]),A.emplaceBack(se+oe)}},k=n.ag;P(0,0,k,0,16),P(k,0,k,k,16),P(k,k,0,k,16),P(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(S,n.b6.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(R,n.bf.members),this._tileDebugSegments=n.b7.simpleSegment(0,0,S.length,A.length)}_makeGlobeTileDebugTextBuffer(t,i,d,m,y,x){let S=n.ag/4,A=new n.b4,R=new n.aU,P=new n.be,k=25;R.reserve(32),A.reserve(k),P.reserve(k);let N=(V,Z)=>k*V+Z;for(let V=0;V<k;V++){let Z=V*S;for(let G=0;G<k;G++){let Y=G*S;A.emplaceBack(Y,Z);let X=this._globePoint(Y,Z,i,d,m,y,x);P.emplaceBack(X[0],X[1],X[2])}}for(let V=0;V<4;V++)for(let Z=0;Z<4;Z++){let G=N(V,Z),Y=N(V,Z+1),X=N(V+1,Z),ee=N(V+1,Z+1);R.emplaceBack(G,Y,X),R.emplaceBack(X,Y,ee)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(R),this._tileDebugTextBuffer=t.createVertexBuffer(A,n.b6.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(P,n.bf.members),this._tileDebugTextSegments=n.b7.simpleSegment(0,0,k,32)}destroy(t=!1){for(let i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bg.setPbf(n.bh);class ks extends Ls{constructor(t,i,d,m,y){super(t,i,d,m,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,i){let d=i.context,m=d.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t,{premultiply:!1}):this.texture=new n.T(d,t,m.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,i){let d=this._mrt=new n.bg(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.bi(m,(y,x,S,A)=>{if(y)i(y);else try{let R=d.getHeaderLength(x);if(R>t)return void(this.request=this.fetchHeader(R,i));d.parseHeader(x),this._isHeaderLoaded=!0;let P=0;for(let k of Object.values(d.layers))P=Math.max(P,k.dataIndex[k.dataIndex.length-1].last_byte);x.byteLength>=P&&(this.entireBuffer=x),i(null,this.entireBuffer||x,S,A)}catch(R){i(R)}}),this.request}fetchBand(t,i,d){let m=this._mrt;if(!this._isHeaderLoaded||!m)return void d(new Error("Tile header is not ready"));let y=this.actor;if(!y)return void d(new Error("Can't fetch tile band without an actor"));let x,S=(k,N)=>{x.complete(k,N),k?d(k):(this.updateTextureDescriptor(t,i),d(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(k,N)=>{if(k)return d(k);let V=y.send("decodeRasterArray",{buffer:N,task:x},S,void 0,!0);this._workQueue.push(()=>{V&&V.cancel(),x.cancel()})},R=m.getLayer(t);if(!R)return void d(new Error(`Unknown sourceLayer "${t}"`));if(R.hasDataForBand(i))return this.updateTextureDescriptor(t,i),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);let P=R.getDataRange([i]);if(x=m.createDecodingTask(P),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(P.firstByte,P.lastByte+1));else{let k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${P.firstByte}-${P.lastByte}`}}),N=n.bi(k,A);this._fetchQueue.push(()=>{N.cancel(),x.cancel()})}else d(null)}updateNeeded(t,i){return(!this.textureDescriptor||this.textureDescriptor.band!==i||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,i){if(!this._mrt)return;let d=this._mrt.getLayer(t);if(!d||!d.hasBand(i)||!d.hasDataForBand(i))return;let{bytes:m,tileSize:y,buffer:x,offset:S,scale:A}=d.getBandView(i),R=y+2*x,P={data:m,width:R,height:R},k=this.texture;k&&k instanceof n.T&&k.update(P,{premultiply:!1}),this.textureDescriptor={layer:t,band:i,img:P,buffer:x,offset:S,tileSize:y,format:d.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class tg{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(let t in this.data)for(let i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,d){let m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);let y={value:i,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},d)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){let i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;let d=t.wrapped().key,m=i===void 0?0:this.data[d].indexOf(i),y=this.data[d][m];return this.data[d].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){let i=[];for(let d in this.data)for(let m of this.data[d])t(m.value)||i.push(m);for(let d of i)this.remove(d.value.tileID,d)}}class Kd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,d){let m=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},n.l(this.stateChanges[t][m],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(let y in this.state[t])y!==m&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(let y in this.state[t][m])d[y]||(this.deletedStates[t][m][y]=null)}else for(let y in d)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][y]===null&&delete this.deletedStates[t][m][y]}removeFeatureState(t,i,d){if(this.deletedStates[t]===null)return;let m=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&i!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][d]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(d in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][d]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,i){let d=this.state[t]||{},m=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(i!==void 0){let S=String(i),A=n.l({},d[S],m[S]);if(y){let R=y[i];if(R===null)return{};for(let P in R)delete A[P]}return A}let x=n.l({},d,m);if(y)for(let S in y)delete x[S];return x}initializeTileState(t,i){t.refreshFeatureState(i)}coalesceChanges(t,i){let d={};for(let m in this.stateChanges){this.state[m]=this.state[m]||{};let y={};for(let x in this.stateChanges[m])this.state[m][x]||(this.state[m][x]={}),n.l(this.state[m][x],this.stateChanges[m][x]),y[x]=this.state[m][x];d[m]=y}for(let m in this.deletedStates){this.state[m]=this.state[m]||{};let y={};if(this.deletedStates[m]===null)for(let x in this.state[m])y[x]={},this.state[m][x]={};else for(let x in this.deletedStates[m]){if(this.deletedStates[m][x]===null)this.state[m][x]={};else if(this.state[m][x])for(let S of Object.keys(this.deletedStates[m][x]))delete this.state[m][x][S];y[x]=this.state[m][x]}d[m]=d[m]||{},n.l(d[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(let m in t)t[m].refreshFeatureState(i)}}class Xi extends n.E{constructor(t,i,d){super(),this.id=t,this._onlySymbols=d,i.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new tg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Kd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let t in this._tiles){let i=this._tiles[t];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let i in this._tiles){let d=this._tiles[i];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return n.bj(this._tiles).map(t=>t.tileID).sort(vn).map(t=>t.key)}getRenderableIds(t,i){let d=[];for(let m in this._tiles)this._isIdRenderable(+m,t,i)&&d.push(this._tiles[m]);return t?d.sort((m,y)=>{let x=m.tileID,S=y.tileID,A=new n.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),R=new n.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-S.overscaledZ||R.y-A.y||R.x-A.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(vn).map(m=>m.key)}hasRenderableParent(t){let i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){let d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=i),this._loadTile(d,this._tileLoaded.bind(this,d,t,i)))}_tileLoaded(t,i,d,m){if(m)if(t.state="errored",m.status!==404)this._source.fire(new n.y(m,{tile:t}));else{if(this._source.fire(new n.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=n.q.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new n.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){let i=this.getRenderableIds();for(let m=0;m<i.length;m++){let y=i[m];if(t.neighboringTiles&&t.neighboringTiles[y]){let x=this.getTileByID(y);d(t,x),d(x,t)}}function d(m,y){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let x=y.tileID.canonical.x-m.tileID.canonical.x,S=y.tileID.canonical.y-m.tileID.canonical.y,A=Math.pow(2,m.tileID.canonical.z),R=y.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+A)===1?x+=A:Math.abs(x-A)===1&&(x-=A)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,x,S),m.neighboringTiles&&m.neighboringTiles[R]&&(m.neighboringTiles[R].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,d,m){for(let y in this._tiles){let x=this._tiles[y];if(m[y]||!x.hasData()||x.tileID.overscaledZ<=i||x.tileID.overscaledZ>d)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>i+1;){let R=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[R.key],x&&x.hasData()&&(S=R)}let A=S;for(;A.overscaledZ>i;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){m[S.key]=S;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){let d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=i?d:null}for(let d=t.overscaledZ-1;d>=i;d--){let m=t.scaledTo(d),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(t){let i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;let d=Math.ceil(t.width/i)+1,m=Math.ceil(t.height/i)+1,y=Math.floor(d*m*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(S)}handleWrapJump(t){let i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){let d={};for(let m in this._tiles){let y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+i),d[y.tileID.key]=y}this._tiles=d;for(let m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(let m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,i,d,m){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let y=this._source.type==="batched-model",x,S=this._source.maxzoom,A=this.map&&this.map.painter?this.map.painter._terrain:null;if(A&&A.sourceCache===this&&A.attenuationRange()){let k=A.attenuationRange()[0],N=Math.floor(k)-Math.log2(A.getDemUpscale());S>N&&(S=N)}if(this.used||this.usedForTerrain){if(this._source.tileID)x=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new n.aG(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y));else if(this.tileCoverLift!==0){let k=t.clone();k.tileCoverLift=this.tileCoverLift,x=k.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.minzoom<=1&&t.projection.name==="globe"&&(x.push(new n.aG(1,0,1,0,0)),x.push(new n.aG(1,0,1,1,0)),x.push(new n.aG(1,0,1,0,1)),x.push(new n.aG(1,0,1,1,1)))}else if(x=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.hasTile){let k=this._source.hasTile.bind(this._source);x=x.filter(N=>k(N))}}else x=[];if(x.length>0&&this.castsShadows&&m&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Jd(this._source.type)){let k=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),N=Math.min(k,this._source.maxzoom);if(y){let V=t.extendTileCover(x,N);for(let Z of V)x.push(Z)}else{let V=t.extendTileCover(x,N,m);for(let Z of V)this._shadowCasterTiles[Z.key]=!0,x.push(Z)}}let R=this._updateRetainedTiles(x);if(Jd(this._source.type)&&x.length!==0){let k={},N={},V=Object.keys(R);for(let G of V){let Y=R[G],X=this._tiles[G];if(!X||X.fadeEndTime&&X.fadeEndTime<=n.q.now())continue;let ee=this.findLoadedParent(Y,Math.max(Y.overscaledZ-Xi.maxOverzooming,this._source.minzoom));ee&&(this._addTile(ee.tileID),k[ee.tileID.key]=ee.tileID),N[G]=Y}let Z=x[x.length-1].overscaledZ;for(let G in this._tiles){let Y=this._tiles[G];if(R[G]||!Y.hasData())continue;let X=Y.tileID;for(;X.overscaledZ>Z;){X=X.scaledTo(X.overscaledZ-1);let ee=this._tiles[X.key];if(ee&&ee.hasData()&&N[X.key]){R[G]=Y.tileID;break}}}for(let G in k)R[G]||(this._coveredTiles[G]=!0,R[G]=k[G])}for(let k in R)this._tiles[k].clearFadeHold();let P=n.bk(this._tiles,R);for(let k of P){let N=this._tiles[k];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(+k)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){let i={};if(t.length===0)return i;let d={},m=t.reduce((R,P)=>Math.min(R,P.overscaledZ),1/0),y=t[0].overscaledZ,x=Math.max(y-Xi.maxOverzooming,this._source.minzoom),S=Math.max(y+Xi.maxUnderzooming,this._source.minzoom),A={};for(let R of t){let P=this._addTile(R);i[R.key]=R,P.hasData()||m<this._source.maxzoom&&(A[R.key]=R)}this._retainLoadedChildren(A,m,S,i);for(let R of t){let P=this._tiles[R.key];if(P.hasData())continue;if(R.canonical.z>=this._source.maxzoom){let N=R.children(this._source.maxzoom)[0],V=this.getTile(N);if(V&&V.hasData()){i[N.key]=N;continue}}else{let N=R.children(this._source.maxzoom);if(i[N[0].key]&&i[N[1].key]&&i[N[2].key]&&i[N[3].key])continue}let k=P.wasRequested();for(let N=R.overscaledZ-1;N>=x;--N){let V=R.scaledTo(N);if(d[V.key]||(d[V.key]=!0,P=this.getTile(V),!P&&k&&(P=this._addTile(V)),P&&(i[V.key]=V,k=P.wasRequested(),P.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let i=[],d,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}i.push(m.key);let y=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;m=y}for(let y of i)this._loadedParentTiles[y]=d}}_addTile(t){let i=this._tiles[t.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));let d=!!i;if(!d){let m=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();i=this._source.type==="raster-array"?new ks(t,y,this.transform.tileZoom,m,this._isRaster):new Ls(t,y,this.transform.tileZoom,m,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,d||this._source.fire(new n.z("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let d=i.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){let i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"||i.state==="empty"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,d){let m=[],y=this.transform;if(!y)return m;let x=y.projection.name==="globe",S=n.at(y.center.lng);for(let A in this._tiles){let R=this._tiles[A];if(d&&R.clearQueryDebugViz(),R.holdingForFade())continue;let P;if(x){let k=R.tileID.canonical;if(k.z===0){let N=[Math.abs(n.aw(S,...At(k,-1))-S),Math.abs(n.aw(S,...At(k,1))-S)];P=[0,2*N.indexOf(Math.min(...N))-1]}else{let N=[Math.abs(n.aw(S,...At(k,-1))-S),Math.abs(n.aw(S,...At(k,0))-S),Math.abs(n.aw(S,...At(k,1))-S)];P=[N.indexOf(Math.min(...N))-1]}}else P=[0];for(let k of P){let N=t.containsTile(R,y,i,k);N&&m.push(N)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,i){let d=this.getRenderableIds(t,i).map(y=>this._tiles[y].tileID),m=this.transform.projection.name==="globe";for(let y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=m?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return d}sortCoordinatesByDistance(t){let i=t.slice(),d=this.transform._camera.position,m=this.transform._camera.forward(),y={};for(let x of i){let S=1/(1<<x.canonical.z);y[x.key]=((x.canonical.x+.5)*S+x.wrap-d[0])*m[0]+((x.canonical.y+.5)*S-d[1])*m[1]-d[2]*m[2]}return i.sort((x,S)=>y[x.key]-y[S.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(Jd(this._source.type))for(let t in this._tiles){let i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(t,i,d){this._state.updateState(t=t||"_geojsonTileLayer",i,d)}removeFeatureState(t,i,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,d)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,d){let m=this._tiles[t];m&&m.setDependencies(i,d)}reloadTilesForDependencies(t,i){for(let d in this._tiles)this._tiles[d].hasDependency(t,i)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){let A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,i))};return void this._source.on("data",A)}let d=new Map,m=Array.isArray(t)?t:[t],y=this.map.painter.terrain,x=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(let A of m){let R=A.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let P of R)d.set(P.key,P);this.usedForTerrain&&A.updateElevation(!1)}let S=Array.from(d.values());n.bl(S,(A,R)=>{let P=new Ls(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,k=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),R(k,P)})},i)}}function vn(u,t){let i=Math.abs(2*u.wrap)-+(u.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||d-i||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function Jd(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function At(u,t){let i=1<<u.z;return[u.x/i+t,(u.x+1)/i+t]}Xi.maxOverzooming=10,Xi.maxUnderzooming=3;class ng{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let t=!1,i=!1;for(let d in this.style._mergedLayers){let m=this.style._mergedLayers[d];if(m.type==="fill-extrusion")this.layers.push({layer:m,visible:t,visibilityChanged:i});else if(m.type==="model"){let y=this.style.getLayerSource(m);y&&y.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:i})}}}onNewFrame(t){this.layersGotHidden=!1;for(let i of this.layers){let d=i.layer,m=!1;d.type==="fill-extrusion"?m=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(m=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&i.visible,i.visible=m}}updateZOffset(t,i){this.currentBuildingBuckets=[];for(let m of this.layers){let y=m.layer,x=this.style.getLayerSourceCache(y),S=1;y.type==="fill-extrusion"&&(S=m.visible?y.paint.get("fill-extrusion-vertical-scale"):0);let A=x?x.getTile(i):null;if(!A&&x&&i.canonical.z>x.getSource().minzoom){let R=i.scaledTo(Math.min(x.getSource().maxzoom,i.overscaledZ-1));for(;R.overscaledZ>=x.getSource().minzoom&&(A=x.getTile(R),!A&&R.overscaledZ!==0);)R=R.scaledTo(R.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(y):null,tileID:A?A.tileID:i,verticalScale:S})}t.hasAnyZOffset=!1;let d=!1;for(let m=0;m<t.symbolInstances.length;m++){let y=t.symbolInstances.get(m),x=y.zOffset,S=this._getHeightAtTileOffset(i,y.tileAnchorX,y.tileAnchorY);y.zOffset=S!==Number.NEGATIVE_INFINITY?S:x,d||x===y.zOffset||(d=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,d,m){let y=i,x=d;if(t.canonical.z!==m.canonical.z){let S=m.canonical,A=1/(1<<t.canonical.z-S.z);y=(i+t.canonical.x*n.ag)*A-S.x*n.ag|0,x=(d+t.canonical.y*n.ag)*A-S.y*n.ag|0}return{tileX:y,tileY:x}}_getHeightAtTileOffset(t,i,d){let m,y;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;let{bucket:S,tileID:A,verticalScale:R}=this.currentBuildingBuckets[x];if(!S)continue;let{tileX:P,tileY:k}=this._mapCoordToOverlappingTile(t,i,d,A),N=S.getHeightAtTileCoord(P,k);N&&N.height!==void 0&&(N.hidden?m=N.height:y=Math.max(N.height*R,y||0))}if(y!==void 0)return y;for(let x=0;x<this.layers.length;++x){let S=this.layers[x];if(S.layer.type!=="model"||!S.visible)continue;let{bucket:A,tileID:R}=this.currentBuildingBuckets[x];if(!A)continue;let{tileX:P,tileY:k}=this._mapCoordToOverlappingTile(t,i,d,R),N=A.getHeightAtTileCoord(P,k);if(N&&!N.hidden)return N.height===void 0&&m!==void 0?Math.min(N.maxHeight,m)*N.verticalScale:N.height?N.height*N.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function $u(u,t){let i={};for(let d in u)d!=="ref"&&(i[d]=u[d]);return n.bm.forEach(d=>{d in t&&(i[d]=t[d])}),i}function Hu(u){u=u.slice();let t=Object.create(null);for(let i=0;i<u.length;i++)t[u[i].id]=u[i];for(let i=0;i<u.length;i++)"ref"in u[i]&&(u[i]=$u(u[i],t[u[i].ref]));return u}let Qt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Gu(u,t,i){i.push({command:Qt.addSource,args:[u,t[u]]})}function la(u,t,i){t.push({command:Qt.removeSource,args:[u]}),i[u]=!0}function yt(u,t,i,d){la(u,i,d),Gu(u,t,i)}function Tn(u,t,i){let d;for(d in u[i])if(u[i].hasOwnProperty(d)&&d!=="data"&&!n.bn(u[i][d],t[i][d]))return!1;for(d in t[i])if(t[i].hasOwnProperty(d)&&d!=="data"&&!n.bn(u[i][d],t[i][d]))return!1;return!0}function dn(u,t,i,d,m,y){let x;for(x in t=t||{},u=u||{})u.hasOwnProperty(x)&&(n.bn(u[x],t[x])||i.push({command:y,args:[d,x,t[x],m]}));for(x in t)t.hasOwnProperty(x)&&!u.hasOwnProperty(x)&&(n.bn(u[x],t[x])||i.push({command:y,args:[d,x,t[x],m]}))}function Zr(u){return u.id}function os(u,t){return u[t.id]=t,u}class gn{constructor(t,i){this.reset(t,i)}reset(t,i){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.aw(t,0,1);let i=1,d=this._distances[i],m=t*this.paddedLength+this.padding;for(;d<m&&i<this._distances.length;)d=this._distances[++i];let y=i-1,x=this._distances[y],S=d-x,A=S>0?(m-x)/S:0;return this.points[y].mult(1-A).add(this.points[i].mult(A))}}class uc{constructor(t,i,d){let m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(i/d);for(let x=0;x<this.xCellCount*this.yCellCount;x++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=i,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,i,d,m,y){this._forEachCell(i,d,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(t,i,d,m){this._forEachCell(i-m,d-m,i+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(i),this.circles.push(d),this.circles.push(m)}_insertBoxCell(t,i,d,m,y,x){this.boxCells[y].push(x)}_insertCircleCell(t,i,d,m,y,x){this.circleCells[y].push(x)}_query(t,i,d,m,y,x){if(d<0||t>this.width||m<0||i>this.height)return!y&&[];let S=[];if(t<=0&&i<=0&&this.width<=d&&this.height<=m){if(y)return!0;for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){let R=this.circles[3*A],P=this.circles[3*A+1],k=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:R-k,y1:P-k,x2:R+k,y2:P+k})}return x?S.filter(x):S}return this._forEachCell(t,i,d,m,this._queryCell,S,{hitTest:y,seenUids:{box:{},circle:{}}},x),y?S.length>0:S}_queryCircle(t,i,d,m,y){let x=t-d,S=t+d,A=i-d,R=i+d;if(S<0||x>this.width||R<0||A>this.height)return!m&&[];let P=[];return this._forEachCell(x,A,S,R,this._queryCellCircle,P,{hitTest:m,circle:{x:t,y:i,radius:d},seenUids:{box:{},circle:{}}},y),m?P.length>0:P}query(t,i,d,m,y){return this._query(t,i,d,m,!1,y)}hitTest(t,i,d,m,y){return this._query(t,i,d,m,!0,y)}hitTestCircle(t,i,d,m){return this._queryCircle(t,i,d,!0,m)}_queryCell(t,i,d,m,y,x,S,A){let R=S.seenUids,P=this.boxCells[y];if(P!==null){let N=this.bboxes;for(let V of P)if(!R.box[V]){R.box[V]=!0;let Z=4*V;if(t<=N[Z+2]&&i<=N[Z+3]&&d>=N[Z+0]&&m>=N[Z+1]&&(!A||A(this.boxKeys[V]))){if(S.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[V],x1:N[Z],y1:N[Z+1],x2:N[Z+2],y2:N[Z+3]})}}}let k=this.circleCells[y];if(k!==null){let N=this.circles;for(let V of k)if(!R.circle[V]){R.circle[V]=!0;let Z=3*V;if(this._circleAndRectCollide(N[Z],N[Z+1],N[Z+2],t,i,d,m)&&(!A||A(this.circleKeys[V]))){if(S.hitTest)return x.push(!0),!0;{let G=N[Z],Y=N[Z+1],X=N[Z+2];x.push({key:this.circleKeys[V],x1:G-X,y1:Y-X,x2:G+X,y2:Y+X})}}}}}_queryCellCircle(t,i,d,m,y,x,S,A){let R=S.circle,P=S.seenUids,k=this.boxCells[y];if(k!==null){let V=this.bboxes;for(let Z of k)if(!P.box[Z]){P.box[Z]=!0;let G=4*Z;if(this._circleAndRectCollide(R.x,R.y,R.radius,V[G+0],V[G+1],V[G+2],V[G+3])&&(!A||A(this.boxKeys[Z])))return x.push(!0),!0}}let N=this.circleCells[y];if(N!==null){let V=this.circles;for(let Z of N)if(!P.circle[Z]){P.circle[Z]=!0;let G=3*Z;if(this._circlesCollide(V[G],V[G+1],V[G+2],R.x,R.y,R.radius)&&(!A||A(this.circleKeys[Z])))return x.push(!0),!0}}}_forEachCell(t,i,d,m,y,x,S,A){let R=this._convertToXCellCoord(t),P=this._convertToYCellCoord(i),k=this._convertToXCellCoord(d),N=this._convertToYCellCoord(m);for(let V=R;V<=k;V++)for(let Z=P;Z<=N;Z++)if(y.call(this,t,i,d,m,this.xCellCount*Z+V,x,S,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,i,d,m,y,x){let S=m-t,A=y-i,R=d+x;return R*R>S*S+A*A}_circleAndRectCollide(t,i,d,m,y,x,S){let A=(x-m)/2,R=Math.abs(t-(m+A));if(R>A+d)return!1;let P=(S-y)/2,k=Math.abs(i-(y+P));if(k>P+d)return!1;if(R<=A||k<=P)return!0;let N=R-A,V=k-P;return N*N+V*V<=d*d}}let Po={unknown:0,flipRequired:1,flipNotRequired:2},hc=Math.tan(85*Math.PI/180);function Nr(u,t,i,d,m,y,x){let S=n.ab.mat4.create();if(i)if(y.name==="globe"){let A=n.bo(m,t);n.ab.mat4.multiply(S,S,A)}else{let A=n.ab.mat2.invert([],x);S[0]=A[0],S[1]=A[1],S[4]=A[2],S[5]=A[3],d||n.ab.mat4.rotateZ(S,S,m.angle)}else n.ab.mat4.multiply(S,m.labelPlaneMatrix,u);return S}function cr(u,t,i,d,m,y,x){let S=Nr(u,t,i,d,m,y,x);return y.name==="globe"&&i||(S[2]=S[6]=S[10]=S[14]=0),S}function Qd(u,t,i,d,m,y,x){if(i){if(y.name==="globe"){let S=Nr(u,t,i,d,m,y,x);return n.ab.mat4.invert(S,S),n.ab.mat4.multiply(S,u,S),S}{let S=n.ab.mat4.clone(u),A=n.ab.mat4.identity([]);return A[0]=x[0],A[1]=x[1],A[4]=x[2],A[5]=x[3],n.ab.mat4.multiply(S,S,A),d||n.ab.mat4.rotateZ(S,S,-m.angle),S}}return m.glCoordMatrix}function vi(u,t,i,d){let m=[u,t,i,1];i?n.ab.vec4.transformMat4(m,m,d):Yi(m,m,d);let y=m[3];return m[0]/=y,m[1]/=y,m[2]/=y,m}function qu(u,t){return Math.min(.5+u/t*.5,1.5)}function dc(u,t){let i=u[0]/u[3],d=u[1]/u[3];return i>=-t[0]&&i<=t[0]&&d>=-t[1]&&d<=t[1]}function Wu(u,t,i,d,m,y,x,S,A,R){let P=i.transform,k=d?u.textSizeData:u.iconSizeData,N=n.bp(k,i.transform.zoom),V=P.projection.name==="globe",Z=[256/i.width*2+1,256/i.height*2+1],G=d?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;G.clear();let Y=null;V&&(Y=d?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);let X=u.lineVertexArray,ee=d?u.text.placedSymbolArray:u.icon.placedSymbolArray,se=i.transform.width/i.transform.height,oe,fe=!1;for(let ce=0;ce<ee.length;ce++){let he=ee.get(ce),{numGlyphs:le,writingMode:ge}=he;if(ge!==n.bq.vertical||fe||oe===n.bq.horizontal||(fe=!0),oe=ge,(he.hidden||ge===n.bq.vertical)&&!fe){sr(le,G);continue}fe=!1;let we=new n.P(he.tileAnchorX,he.tileAnchorY),{x:Be,y:Re,z:Ge}=P.projection.projectTilePoint(we.x,we.y,R.canonical);if(A){let[qe,et,rt]=A(we);Be+=qe,Re+=et,Ge+=rt}let He=[Be,Re,Ge,1];if(n.ab.vec4.transformMat4(He,He,t),!dc(He,Z)){sr(le,G);continue}let Me=He[3],Ve=qu(i.transform.getCameraToCenterDistance(P.projection),Me),Qe=n.br(k,N,he),De=x?Qe/Ve:Qe*Ve,We=vi(Be,Re,Ge,m);if(We[3]<=0){sr(le,G);continue}let je={},it=x?null:A,Ye=Oo(he,De,!1,S,t,m,y,u.glyphOffsetArray,X,G,Y,We,we,je,se,it,P.projection,R,x);fe=Ye.useVertical,it&&Ye.needsFlipping&&(je={}),(Ye.notEnoughRoom||fe||Ye.needsFlipping&&Oo(he,De,!0,S,t,m,y,u.glyphOffsetArray,X,G,Y,We,we,je,se,it,P.projection,R,x).notEnoughRoom)&&sr(le,G)}d?(u.text.dynamicLayoutVertexBuffer.updateData(G),Y&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(Y)):(u.icon.dynamicLayoutVertexBuffer.updateData(G),Y&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(Y))}function fc(u,t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G){let{lineStartIndex:Y,glyphStartIndex:X,segment:ee}=S,se=X+S.numGlyphs,oe=Y+S.lineLength,fe=t.getoffsetX(X),ce=t.getoffsetX(se-1),he=ss(u*fe,i,d,m,y,x,ee,Y,oe,A,R,P,k,N,!0,V,Z,G);if(!he)return null;let le=ss(u*ce,i,d,m,y,x,ee,Y,oe,A,R,P,k,N,!0,V,Z,G);return le?{first:he,last:le}:null}function Xr(u,t,i,d){return u===n.bq.horizontal&&Math.abs(d)>Math.abs(i)?{useVertical:!0}:u===n.bq.vertical?d>0?{needsFlipping:!0}:null:t!==Po.unknown&&function(m,y){return m===0||Math.abs(y/m)>hc}(i,d)?t===Po.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function Oo(u,t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G,Y,X,ee){let se=t/24,oe=u.lineOffsetX*se,fe=u.lineOffsetY*se,{lineStartIndex:ce,glyphStartIndex:he,numGlyphs:le,segment:ge,writingMode:we,flipState:Be}=u,Re=ce+u.lineLength,Ge=He=>{if(P){let[De,We,je]=He.up,it=R.length;n.bs(P,it+0,De,We,je),n.bs(P,it+1,De,We,je),n.bs(P,it+2,De,We,je),n.bs(P,it+3,De,We,je)}let[Me,Ve,Qe]=He.point;n.bt(R,Me,Ve,Qe,He.angle)};if(le>1){let He=fc(se,S,oe,fe,i,k,N,u,A,y,V,G,!1,Y,X,ee);if(!He)return{notEnoughRoom:!0};if(d&&!i){let[Me,Ve,Qe]=He.first.point,[De,We,je]=He.last.point;[Me,Ve]=vi(Me,Ve,Qe,x),[De,We]=vi(De,We,je,x);let it=Xr(we,Be,(De-Me)*Z,We-Ve);if(u.flipState=it&&it.needsFlipping?Po.flipRequired:Po.flipNotRequired,it)return it}Ge(He.first);for(let Me=he+1;Me<he+le-1;Me++){let Ve=ss(se*S.getoffsetX(Me),oe,fe,i,k,N,ge,ce,Re,A,y,V,G,!1,!1,Y,X,ee);if(!Ve)return R.length-=4*(Me-he),{notEnoughRoom:!0};Ge(Ve)}Ge(He.last)}else{if(d&&!i){let Me=vi(N.x,N.y,0,m),Ve=ce+ge+1,Qe=new n.P(A.getx(Ve),A.gety(Ve)),De=vi(Qe.x,Qe.y,0,m),We=De[3]>0?De:ef(N,Qe,Me,1,m,void 0,Y,X.canonical),je=Xr(we,Be,(We[0]-Me[0])*Z,We[1]-Me[1]);if(u.flipState=je&&je.needsFlipping?Po.flipRequired:Po.flipNotRequired,je)return je}let He=ss(se*S.getoffsetX(he),oe,fe,i,k,N,ge,ce,Re,A,y,V,G,!1,!1,Y,X,ee);if(!He)return{notEnoughRoom:!0};Ge(He)}return{}}function Hr(u,t,i,d,m){let{x:y,y:x,z:S}=d.projectTilePoint(u.x,u.y,t);if(!m)return vi(y,x,S,i);let[A,R,P]=m(u);return vi(y+A,x+R,S+P,i)}function ef(u,t,i,d,m,y,x,S){let A=Hr(u.sub(t)._unit()._add(u),S,m,x,y);return n.ab.vec3.sub(A,i,A),n.ab.vec3.normalize(A,A),n.ab.vec3.scaleAndAdd(A,i,A,d)}function ss(u,t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G,Y,X){let ee=d?u-t:u+t,se=ee>0?1:-1,oe=0;d&&(se*=-1,oe=Math.PI),se<0&&(oe+=Math.PI);let fe=S+x+(se>0?0:1)|0,ce=m,he=m,le=0,ge=0,we=Math.abs(ee),Be=[],Re=[],Ge=y,He=Ge,Me=()=>ef(He,Ge,he,we-le+1,P,N,G,Y.canonical);for(;le+ge<=we;){if(fe+=se,fe<S||fe>=A)return null;if(he=ce,He=Ge,Be.push(he),V&&Re.push(He),Ge=new n.P(R.getx(fe),R.gety(fe)),ce=k[fe],!ce){let et=Hr(Ge,Y.canonical,P,G,N);ce=et[3]>0?k[fe]=et:Me()}le+=ge,ge=n.ab.vec3.distance(he,ce)}Z&&N&&(k[fe]&&(ce=Me(),ge=n.ab.vec3.distance(he,ce)),k[fe]=ce);let Ve=(we-le)/ge,Qe=Ge.sub(He)._mult(Ve)._add(He),De=n.ab.vec3.sub([],ce,he),We=n.ab.vec3.scaleAndAdd([],he,De,Ve),je=[0,0,1],it=De[0],Ye=De[1];if(X&&(je=G.upVector(Y.canonical,Qe.x,Qe.y),je[0]!==0||je[1]!==0||je[2]!==1)){let et=[je[2],0,-je[0]],rt=n.ab.vec3.cross([],je,et);n.ab.vec3.normalize(et,et),n.ab.vec3.normalize(rt,rt),it=n.ab.vec3.dot(De,et),Ye=n.ab.vec3.dot(De,rt)}if(i){let et=n.ab.vec3.cross([],je,De);n.ab.vec3.normalize(et,et),n.ab.vec3.scaleAndAdd(We,We,et,i*se)}let qe=oe+Math.atan2(Ye,it);return Be.push(We),V&&Re.push(Qe),{point:We,angle:qe,path:Be,tilePath:Re,up:je}}function sr(u,t){let i=t.length,d=i+4*u;t.resize(d),t.float32.fill(-1/0,4*i,4*d)}function Yi(u,t,i){let d=t[0],m=t[1];return u[0]=i[0]*d+i[4]*m+i[12],u[1]=i[1]*d+i[5]*m+i[13],u[3]=i[3]*d+i[7]*m+i[15],u}let zr=100;class xr{constructor(t,i,d=new uc(t.width+200,t.height+200,25),m=new uc(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+zr,this.screenBottomBoundary=t.height+zr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=i}placeCollisionBox(t,i,d,m,y,x,S,A){let R=d.projectedAnchorX,P=d.projectedAnchorY,k=d.projectedAnchorZ,N=d.elevation,V=d.tileID,Z=t.getProjection();if(N&&V){let[ce,he,le]=Z.upVector(V.canonical,d.tileAnchorX,d.tileAnchorY),ge=Z.upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=ce*N*ge,P+=he*N*ge,k+=le*N*ge}let G=this.projectAndGetPerspectiveRatio(S,R,P,k,d.tileID,Z.name==="globe"||!!N||this.transform.pitch>0,Z),Y=x*G.perspectiveRatio,X=(d.x1*i+m.x-d.padding)*Y+G.point.x,ee=(d.y1*i+m.y-d.padding)*Y+G.point.y,se=(d.x2*i+m.x+d.padding)*Y+G.point.x,oe=(d.y2*i+m.y+d.padding)*Y+G.point.y,fe=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid(X,ee,se,oe)||!y&&this.grid.hitTest(X,ee,se,oe,A)||fe?{box:[],offscreen:!1,occluded:G.occluded}:{box:[X,ee,se,oe],offscreen:this.isOffscreen(X,ee,se,oe),occluded:!1}}placeCollisionCircles(t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G){let Y=[],X=this.transform.elevation,ee=t.getProjection(),se=X?X.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,ee):null,oe=new n.P(d.tileAnchorX,d.tileAnchorY),{x:fe,y:ce,z:he}=ee.projectTilePoint(oe.x,oe.y,G.canonical);if(se){let[Qe,De,We]=se(oe);fe+=Qe,ce+=De,he+=We}let le=ee.name==="globe",ge=this.projectAndGetPerspectiveRatio(S,fe,ce,he,G,le||!!X||this.transform.pitch>0,ee),{perspectiveRatio:we}=ge,Be=(k?x/we:x*we)/n.bw,Re=vi(fe,ce,he,A),Ge=ge.signedDistanceFromCamera>0?fc(Be,y,d.lineOffsetX*Be,d.lineOffsetY*Be,!1,Re,oe,d,m,A,{},X&&!k?se:null,k&&!!X,ee,G,k):null,He=!1,Me=!1,Ve=!0;if(Ge&&!ge.occluded){let Qe=.5*V*we+Z,De=new n.P(-100,-100),We=new n.P(this.screenRightBoundary,this.screenBottomBoundary),je=new gn,{first:it,last:Ye}=Ge,qe=it.path.length,et=[];for(let gt=qe-1;gt>=1;gt--)et.push(it.path[gt]);for(let gt=1;gt<Ye.path.length;gt++)et.push(Ye.path[gt]);let rt=2.5*Qe;R&&(et=et.map(([gt,Pt,Et],St)=>(se&&!le&&(Et=se(St<qe-1?it.tilePath[qe-1-St]:Ye.tilePath[St-qe+2])[2]),vi(gt,Pt,Et,R))),et.some(gt=>gt[3]<=0)&&(et=[]));let dt=[];if(et.length>0){let gt=1/0,Pt=-1/0,Et=1/0,St=-1/0;for(let Nt of et)gt=Math.min(gt,Nt[0]),Et=Math.min(Et,Nt[1]),Pt=Math.max(Pt,Nt[0]),St=Math.max(St,Nt[1]);Pt>=De.x&&gt<=We.x&&St>=De.y&&Et<=We.y&&(dt=[et.map(Nt=>new n.P(Nt[0],Nt[1]))],(gt<De.x||Pt>We.x||Et<De.y||St>We.y)&&(dt=n.bu(dt,De.x,De.y,We.x,We.y)))}for(let gt of dt){je.reset(gt,.25*Qe);let Pt=0;Pt=je.length<=.5*Qe?1:Math.ceil(je.paddedLength/rt)+1;for(let Et=0;Et<Pt;Et++){let St=Et/Math.max(Pt-1,1),Nt=je.lerp(St),an=Nt.x+zr,An=Nt.y+zr;Y.push(an,An,Qe,0);let ir=an-Qe,Wn=An-Qe,jt=an+Qe,fn=An+Qe;if(Ve=Ve&&this.isOffscreen(ir,Wn,jt,fn),Me=Me||this.isInsideGrid(ir,Wn,jt,fn),!i&&this.grid.hitTestCircle(an,An,Qe,N)&&(He=!0,!P))return{circles:[],offscreen:!1,collisionDetected:He,occluded:!1}}}}return{circles:!P&&He||!Me?[]:Y,offscreen:Ve,collisionDetected:He,occluded:ge.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let i=[],d=1/0,m=1/0,y=-1/0,x=-1/0;for(let P of t){let k=new n.P(P.x+zr,P.y+zr);d=Math.min(d,k.x),m=Math.min(m,k.y),y=Math.max(y,k.x),x=Math.max(x,k.y),i.push(k)}let S=this.grid.query(d,m,y,x).concat(this.ignoredGrid.query(d,m,y,x)),A={},R={};for(let P of S){let k=P.key;if(A[k.bucketInstanceId]===void 0&&(A[k.bucketInstanceId]={}),A[k.bucketInstanceId][k.featureIndex])continue;let N=[new n.P(P.x1,P.y1),new n.P(P.x2,P.y1),new n.P(P.x2,P.y2),new n.P(P.x1,P.y2)];n.bv(i,N)&&(A[k.bucketInstanceId][k.featureIndex]=!0,R[k.bucketInstanceId]===void 0&&(R[k.bucketInstanceId]=[]),R[k.bucketInstanceId].push(k.featureIndex))}return R}insertCollisionBox(t,i,d,m,y){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:m,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,i,d,m,y){let x=i?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:m,collisionGroupID:y};for(let A=0;A<t.length;A+=4)x.insertCircle(S,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,i,d,m,y,x,S){let A=[i,d,m,1],R=!1;m||this.transform.pitch>0?(n.ab.vec4.transformMat4(A,A,t),this.fogState&&y&&S.name!=="globe"&&(R=function(N,V,Z,G,Y,X){let ee=X.calculateFogTileMatrix(Y),se=[V,Z,G];return n.ab.vec3.transformMat4(se,se,ee),ve(N,n.ab.vec3.length(se),X.pitch,X._fov)}(this.fogState,i,d,m,y.toUnwrapped(),this.transform)>.9)):Yi(A,A,t);let P=A[3];return{point:new n.P((A[0]/P+1)/2*this.transform.width+zr,(-A[1]/P+1)/2*this.transform.height+zr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/P*.5,1.5),signedDistanceFromCamera:P,occluded:x&&A[2]>P||R}}isOffscreen(t,i,d,m){return d<zr||t>=this.screenRightBoundary||m<zr||i>this.screenBottomBoundary}isInsideGrid(t,i,d,m){return d>=0&&t<this.gridRightBoundary&&m>=0&&i<this.gridBottomBoundary}getViewportMatrix(){let t=n.ab.mat4.identity([]);return n.ab.mat4.translate(t,t,[-100,-100,0]),t}}function pc(u,t,i){let d=t.createTileMatrix(u,u.worldSize,i.toUnwrapped());return n.ab.mat4.multiply(new Float32Array(16),u.projMatrix,d)}function uo(u,t,i){if(t.projection.name===i.projection.name)return u.projMatrix;let d=i.clone();return d.setProjection(t.projection),pc(d,t.getProjection(),u)}function ca(u,t,i){return t.name===i.projection.name?u.projMatrix:pc(i,t,u)}class mc{constructor(t,i,d,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?i:-i))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class ho{constructor(t,i,d,m,y,x=!1){this.text=new mc(t?t.text:null,i,d,y),this.icon=new mc(t?t.icon:null,i,m,y),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tf{constructor(t,i,d,m=!1){this.text=t,this.icon=i,this.skipFade=d,this.clipped=m}}class as{constructor(){this.invProjMatrix=n.ab.mat4.create(),this.viewportMatrix=n.ab.mat4.create(),this.circles=[]}}class qv{constructor(t,i,d,m,y){this.bucketInstanceId=t,this.featureIndex=i,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=y}}class nf{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let i=++this.maxGroupID;this.collisionGroups[t]={ID:i,predicate:d=>d.collisionGroupID===i}}return this.collisionGroups[t]}}function xi(u,t,i,d,m){let{horizontalAlign:y,verticalAlign:x}=n.bD(u),S=-(y-.5)*t,A=-(x-.5)*i,R=n.bC(u,d);return new n.P(S+R[0]*m,A+R[1]*m)}function rf(u,t,i,d,m){let y=new n.P(u,t);return i&&y._rotate(d?m:-m),y}class Zu{constructor(t,i,d,m,y,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new xr(this.transform,y),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new nf(d),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,d,m,y=1){let x=d.getBucket(i),S=d.latestFeatureIndex;if(!x||!S||i.fqid!==x.layerIds[0])return;let A=x.layers[0].layout,R=x.layers[0].paint,P=d.collisionBoxArray,k=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),N=d.tileSize/n.ag,V=d.tileID.toUnwrapped();this.transform.setProjection(x.projection);let Z=(G=d.tileID,Y=x.getProjection(),X=this.transform,Y.name===this.projection?X.calculateProjMatrix(G.toUnwrapped()):pc(X,Y,G));var G,Y,X;let ee=A.get("text-pitch-alignment")==="map",se=A.get("text-rotation-alignment")==="map";i.compileFilter(i.options);let oe=i.dynamicFilter(),fe=i.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(d),he=cr(Z,d.tileID.canonical,ee,se,this.transform,x.getProjection(),ce),le=null;if(ee){let Qe=Qd(Z,d.tileID.canonical,ee,se,this.transform,x.getProjection(),ce);le=n.ab.mat4.multiply([],this.transform.labelPlaneMatrix,Qe)}let ge=null;oe&&d.latestFeatureIndex&&(ge={unwrappedTileID:V,dynamicFilter:oe,dynamicFilterNeedsFeature:fe}),this.retainedQueryData[x.bucketInstanceId]=new qv(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,d.tileID);let[we,Be]=x.layers[0].layout.get("text-size-scale-range"),Re=n.aw(y,we,Be),[Ge,He]=A.get("icon-size-scale-range"),Me=n.aw(y,Ge,He),Ve={bucket:x,layout:A,paint:R,posMatrix:Z,textLabelPlaneMatrix:he,labelToScreenMatrix:le,clippingData:ge,scale:k,textPixelRatio:N,holdingForFade:d.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:n.bp(x.textSizeData,this.transform.zoom,Re),partiallyEvaluatedIconSize:n.bp(x.iconSizeData,this.transform.zoom,Me),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(m)for(let Qe of x.sortKeyRanges){let{sortKey:De,symbolInstanceStart:We,symbolInstanceEnd:je}=Qe;t.push({sortKey:De,symbolInstanceStart:We,symbolInstanceEnd:je,parameters:Ve})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G,Y,X,ee){let{textOffset0:se,textOffset1:oe,crossTileID:fe}=N,ce=[se,oe],he=xi(t,d,m,ce,y),le=this.collisionIndex.placeCollisionBox(Z,y,i,rf(he.x,he.y,x,S,this.transform.angle),k,A,R,P.predicate);if(Y){let ge=Z.getSymbolInstanceIconSize(ee,this.transform.zoom,N.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Z,ge,Y,rf(he.x,he.y,x,S,this.transform.angle),k,A,R,P.predicate).box.length===0)return}if(le.box.length>0){let ge;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe]&&this.prevPlacement.placements[fe]&&this.prevPlacement.placements[fe].text&&(ge=this.prevPlacement.variableOffsets[fe].anchor),this.variableOffsets[fe]={textOffset:ce,width:d,height:m,anchor:t,textScale:y,prevAnchor:ge},this.markUsedJustification(Z,t,N,G),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,G,N),this.placedOrientations[fe]=G),{shift:he,placedGlyphBoxes:le}}}placeLayerBucketPart(t,i,d,m,y=1){let{bucket:x,layout:S,paint:A,posMatrix:R,textLabelPlaneMatrix:P,labelToScreenMatrix:k,clippingData:N,textPixelRatio:V,holdingForFade:Z,collisionBoxArray:G,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:X,collisionGroup:ee,latestFeatureIndex:se}=t.parameters,oe=S.get("text-optional"),fe=S.get("icon-optional"),ce=S.get("text-allow-overlap"),he=S.get("icon-allow-overlap"),le=S.get("text-rotation-alignment")==="map",ge=S.get("text-pitch-alignment")==="map",we=S.get("symbol-z-elevate"),Be=A.get("symbol-z-offset"),Re=S.get("symbol-elevation-reference")==="sea",[Ge,He]=S.get("text-size-scale-range"),[Me,Ve]=S.get("icon-size-scale-range"),Qe=n.aw(y,Ge,He),De=n.aw(y,Me,Ve);this.transform.setProjection(x.projection);let We=ce&&(he||!x.hasIconData()||fe),je=he&&(ce||!x.hasTextData()||oe),it=!Be.isConstant();!x.collisionArrays&&G&&x.deserializeCollisionBoxes(G),d&&m&&x.updateCollisionDebugBuffers(this.transform.zoom,G,Qe,De);let Ye=(qe,et,rt)=>{let{crossTileID:dt,numVerticalGlyphVertices:gt}=qe,Pt=null;if(N&&N.dynamicFilterNeedsFeature||it){let Un=this.retainedQueryData[x.bucketInstanceId];Pt=se.loadFeature({featureIndex:qe.featureIndex,bucketIndex:Un.bucketIndex,sourceLayerIndex:Un.sourceLayerIndex,layoutVertexArrayOffset:0})}if(N&&!(0,N.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Pt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new n.P(qe.tileAnchorX,qe.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[dt]=new tf(!1,!1,!1,!0),void i.add(dt);let Et=Be.evaluate(Pt,{});if(i.has(dt))return;if(Z)return void(this.placements[dt]=new tf(!1,!1,!1));let St=!1,Nt=!1,an=!0,An=!1,ir=!1,Wn=null,jt={box:null,offscreen:null,occluded:null},fn={box:null,offscreen:null,occluded:null},wt=null,on=null,yn=null,bn=0,tr=0,Rr=0;rt.textFeatureIndex?bn=rt.textFeatureIndex:qe.useRuntimeCollisionCircles&&(bn=qe.featureIndex),rt.verticalTextFeatureIndex&&(tr=rt.verticalTextFeatureIndex);let Er=Un=>{Un.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let zn=this.transform.elevation;Un.elevation=Re?Et:Et+(zn?zn.getAtTileOffset(Un.tileID,Un.tileAnchorX,Un.tileAnchorY):0),Un.elevation+=qe.zOffset},Tr=rt.textBox;if(Tr){Er(Tr);let Un=un=>{let mr=n.bq.horizontal;if(x.allowVerticalPlacement&&!un&&this.prevPlacement){let Pr=this.prevPlacement.placedOrientations[dt];Pr&&(this.placedOrientations[dt]=Pr,mr=Pr,this.markUsedOrientation(x,mr,qe))}return mr},zn=(un,mr)=>{if(x.allowVerticalPlacement&&gt>0&&rt.verticalTextBox){for(let Pr of x.writingModes)if(Pr===n.bq.vertical?(jt=mr(),fn=jt):jt=un(),jt&&jt.box&&jt.box.length)break}else jt=un()};if(S.get("text-variable-anchor")){let un=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[dt]){let Vn=this.prevPlacement.variableOffsets[dt];un.indexOf(Vn.anchor)>0&&(un=un.filter(Jr=>Jr!==Vn.anchor),un.unshift(Vn.anchor))}let mr=(Vn,Jr,Qi)=>{let Oi=x.getSymbolInstanceTextSize(Y,qe,this.transform.zoom,et),wi=(Vn.x2-Vn.x1)*Oi+2*Vn.padding,Bo=(Vn.y2-Vn.y1)*Oi+2*Vn.padding,eo=qe.hasIconTextFit&&!he?Jr:null;eo&&Er(eo);let $i={box:[],offscreen:!1,occluded:!1},Ca=ce?2*un.length:un.length;for(let Vo=0;Vo<Ca;++Vo){let Aa=this.attemptAnchorPlacement(un[Vo%un.length],Vn,wi,Bo,Oi,le,ge,V,R,ee,Vo>=un.length,qe,et,x,Qi,eo,Y,X);if(Aa&&($i=Aa.placedGlyphBoxes,$i&&$i.box&&$i.box.length)){St=!0,Wn=Aa.shift;break}}return $i};zn(()=>mr(Tr,rt.iconBox,n.bq.horizontal),()=>{let Vn=rt.verticalTextBox;return Vn&&Er(Vn),x.allowVerticalPlacement&&!(jt&&jt.box&&jt.box.length)&&gt>0&&Vn?mr(Vn,rt.verticalIconBox,n.bq.vertical):{box:null,offscreen:null,occluded:null}}),jt&&(St=jt.box,an=jt.offscreen,An=jt.occluded);let Pr=Un(!(!jt||!jt.box));if(!St&&this.prevPlacement){let Vn=this.prevPlacement.variableOffsets[dt];Vn&&(this.variableOffsets[dt]=Vn,this.markUsedJustification(x,Vn.anchor,qe,Pr))}}else{let un=(mr,Pr)=>{let Vn=x.getSymbolInstanceTextSize(Y,qe,this.transform.zoom,et,y),Jr=this.collisionIndex.placeCollisionBox(x,Vn,mr,new n.P(0,0),ce,V,R,ee.predicate);return Jr&&Jr.box&&Jr.box.length&&(this.markUsedOrientation(x,Pr,qe),this.placedOrientations[dt]=Pr),Jr};zn(()=>un(Tr,n.bq.horizontal),()=>{let mr=rt.verticalTextBox;return x.allowVerticalPlacement&&gt>0&&mr?(Er(mr),un(mr,n.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Un(!!(jt&&jt.box&&jt.box.length))}}if(wt=jt,St=wt&&wt.box&&wt.box.length>0,an=wt&&wt.offscreen,An=wt&&wt.occluded,qe.useRuntimeCollisionCircles){let Un=x.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex>=0?qe.centerJustifiedTextSymbolIndex:qe.verticalPlacedTextSymbolIndex),zn=n.br(x.textSizeData,Y,Un),un=S.get("text-padding");on=this.collisionIndex.placeCollisionCircles(x,ce,Un,x.lineVertexArray,x.glyphOffsetArray,zn,R,P,k,d,ge,ee.predicate,qe.collisionCircleDiameter*zn/n.bw,un,this.retainedQueryData[x.bucketInstanceId].tileID),St=ce||on.circles.length>0&&!on.collisionDetected,an=an&&on.offscreen,An=on.occluded}if(rt.iconFeatureIndex&&(Rr=rt.iconFeatureIndex),rt.iconBox){let Un=zn=>{Er(zn);let un=qe.hasIconTextFit&&Wn?rf(Wn.x,Wn.y,le,ge,this.transform.angle):new n.P(0,0),mr=x.getSymbolInstanceIconSize(X,this.transform.zoom,qe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,mr,zn,un,he,V,R,ee.predicate)};fn&&fn.box&&fn.box.length&&rt.verticalIconBox?(yn=Un(rt.verticalIconBox),Nt=yn.box.length>0):(yn=Un(rt.iconBox),Nt=yn.box.length>0),an=an&&yn.offscreen,ir=yn.occluded}let Ui=oe||qe.numHorizontalGlyphVertices===0&&gt===0,Kr=fe||qe.numIconVertices===0;if(Ui||Kr?Kr?Ui||(Nt=Nt&&St):St=Nt&&St:Nt=St=Nt&&St,St&&wt&&wt.box&&this.collisionIndex.insertCollisionBox(wt.box,S.get("text-ignore-placement"),x.bucketInstanceId,fn&&fn.box&&tr?tr:bn,ee.ID),Nt&&yn&&this.collisionIndex.insertCollisionBox(yn.box,S.get("icon-ignore-placement"),x.bucketInstanceId,Rr,ee.ID),on&&(St&&this.collisionIndex.insertCollisionCircles(on.circles,S.get("text-ignore-placement"),x.bucketInstanceId,bn,ee.ID),d)){let Un=x.bucketInstanceId,zn=this.collisionCircleArrays[Un];zn===void 0&&(zn=this.collisionCircleArrays[Un]=new as);for(let un=0;un<on.circles.length;un+=4)zn.circles.push(on.circles[un+0]),zn.circles.push(on.circles[un+1]),zn.circles.push(on.circles[un+2]),zn.circles.push(on.collisionDetected?1:0)}let nr=x.projection.name!=="globe";We=We&&(nr||!An),je=je&&(nr||!ir),this.placements[dt]=new tf(St||We,Nt||je,an||x.justReloaded),i.add(dt)};if(we&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),x.sortFeaturesByY){let qe=x.getSortedSymbolIndexes(this.transform.angle);for(let et=qe.length-1;et>=0;--et){let rt=qe[et];Ye(x.symbolInstances.get(rt),rt,x.collisionArrays[rt])}x.hasAnyZOffset&&n.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let qe=x.getSortedIndexesByZOffset();for(let et=0;et<qe.length;++et){let rt=qe[et];Ye(x.symbolInstances.get(rt),rt,x.collisionArrays[rt])}}else for(let qe=t.symbolInstanceStart;qe<t.symbolInstanceEnd;qe++)Ye(x.symbolInstances.get(qe),qe,x.collisionArrays[qe]);if(d&&x.bucketInstanceId in this.collisionCircleArrays){let qe=this.collisionCircleArrays[x.bucketInstanceId];n.ab.mat4.invert(qe.invProjMatrix,R),qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,i,d,m){let{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:A,crossTileID:R}=d,P=n.bB(i),k=m===n.bq.vertical?A:P==="left"?y:P==="center"?x:P==="right"?S:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=k>=0&&y!==k?0:R),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=k>=0&&x!==k?0:R),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=k>=0&&S!==k?0:R),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=k>=0&&A!==k?0:R)}markUsedOrientation(t,i,d){let m=i===n.bq.horizontal||i===n.bq.horizontalOnly?i:0,y=i===n.bq.vertical?i:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:R}=d,P=t.text.placedSymbolArray;x>=0&&(P.get(x).placedOrientation=m),S>=0&&(P.get(S).placedOrientation=m),A>=0&&(P.get(A).placedOrientation=m),R>=0&&(P.get(R).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let i=this.prevPlacement,d=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;let m=i?i.symbolFadeChange(t):1,y=i?i.opacities:{},x=i?i.variableOffsets:{},S=i?i.placedOrientations:{};for(let A in this.placements){let R=this.placements[A],P=y[A];P?(this.opacities[A]=new ho(P,m,R.text,R.icon,null,R.clipped),d=d||R.text!==P.text.placed||R.icon!==P.icon.placed):(this.opacities[A]=new ho(null,m,R.text,R.icon,R.skipFade,R.clipped),d=d||R.text||R.icon)}for(let A in y){let R=y[A];if(!this.opacities[A]){let P=new ho(R,m,!1,!1);P.isHidden()||(this.opacities[A]=P,d=d||R.text.placed||R.icon.placed)}}for(let A in x)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=x[A]);for(let A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:t)}updateLayerOpacities(t,i,d,m){let y=new Set;for(let x of i){let S=x.getBucket(t);S&&x.latestFeatureIndex&&t.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,y,x,x.collisionBoxArray,d,m,x.tileID,t.scope),S.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,x.tileID),S.updateZOffset()))}}updateBucketOpacities(t,i,d,m,y,x,S,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let R=t.layers[0].layout,P=t.layers[0].paint,k=!!t.layers[0].dynamicFilter(),N=new ho(null,0,!1,!1,!0),V=R.get("text-allow-overlap"),Z=R.get("icon-allow-overlap"),G=R.get("text-variable-anchor"),Y=R.get("text-rotation-alignment")==="map",X=R.get("text-pitch-alignment")==="map",ee=P.get("symbol-z-offset"),se=R.get("symbol-elevation-reference")==="sea",oe=!ee.isConstant(),fe=new ho(null,0,V&&(Z||!t.hasIconData()||R.get("icon-optional")),Z&&(V||!t.hasTextData()||R.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);let ce=(le,ge,we)=>{for(let Be=0;Be<ge/4;Be++)le.opacityVertexArray.emplaceBack(we)},he=0;x&&t.updateReplacement(S,x);for(let le=0;le<t.symbolInstances.length;le++){let ge=t.symbolInstances.get(le),{numHorizontalGlyphVertices:we,numVerticalGlyphVertices:Be,crossTileID:Re,numIconVertices:Ge,tileAnchorX:He,tileAnchorY:Me}=ge,Ve=null,Qe=this.retainedQueryData[t.bucketInstanceId];oe&&ge&&Qe&&(Ve=d.latestFeatureIndex.loadFeature({featureIndex:ge.featureIndex,bucketIndex:Qe.bucketIndex,sourceLayerIndex:Qe.sourceLayerIndex,layoutVertexArrayOffset:0}));let De=ee.evaluate(Ve,{}),We=i.has(Re),je=this.opacities[Re];We?je=N:je||(je=fe,this.opacities[Re]=je),i.add(Re);let it=we>0||Be>0,Ye=Ge>0,qe=this.placedOrientations[Re],et=qe===n.bq.vertical,rt=qe===n.bq.horizontal||qe===n.bq.horizontalOnly;!it&&!Ye||je.isHidden()||he++;let dt=!1;if((it||Ye)&&x)for(let gt of t.activeReplacements){if(n.bx(gt,y,n.by.Symbol,A)||gt.min.x>He||He>gt.max.x||gt.min.y>Me||Me>gt.max.y)continue;let Pt=n.bz(He,Me,S.canonical,gt.footprintTileId.canonical);if(dt=n.bA(Pt,gt.footprint),dt)break}if(it){let gt=dt?ls:of(je.text);ce(t.text,we,et?ls:gt),ce(t.text,Be,rt?ls:gt);let Pt=je.text.isHidden(),{leftJustifiedTextSymbolIndex:Et,centerJustifiedTextSymbolIndex:St,rightJustifiedTextSymbolIndex:Nt,verticalPlacedTextSymbolIndex:an}=ge,An=t.text.placedSymbolArray,ir=Pt||et?1:0;Et>=0&&(An.get(Et).hidden=ir),St>=0&&(An.get(St).hidden=ir),Nt>=0&&(An.get(Nt).hidden=ir),an>=0&&(An.get(an).hidden=Pt||rt?1:0);let Wn=this.variableOffsets[Re];Wn&&this.markUsedJustification(t,Wn.anchor,ge,qe);let jt=this.placedOrientations[Re];jt&&(this.markUsedJustification(t,"left",ge,jt),this.markUsedOrientation(t,jt,ge))}if(Ye){let gt=dt?ls:of(je.icon),{placedIconSymbolIndex:Pt,verticalPlacedIconSymbolIndex:Et}=ge,St=t.icon.placedSymbolArray,Nt=je.icon.isHidden()?1:0;Pt>=0&&(ce(t.icon,Ge,et?ls:gt),St.get(Pt).hidden=Nt),Et>=0&&(ce(t.icon,ge.numVerticalIconVertices,rt?ls:gt),St.get(Et).hidden=Nt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let gt=t.collisionArrays[le];if(gt){let Pt=new n.P(0,0),Et=!0;if(gt.textBox||gt.verticalTextBox){if(G){let Nt=this.variableOffsets[Re];Nt?(Pt=xi(Nt.anchor,Nt.width,Nt.height,Nt.textOffset,Nt.textScale),Y&&Pt._rotate(X?this.transform.angle:-this.transform.angle)):Et=!1}k&&(Et=!je.clipped),gt.textBox&&gc(t.textCollisionBox.collisionVertexArray,je.text.placed,!Et||et,De,se,Pt.x,Pt.y),gt.verticalTextBox&&gc(t.textCollisionBox.collisionVertexArray,je.text.placed,!Et||rt,De,se,Pt.x,Pt.y)}let St=Et&&!!(!rt&&gt.verticalIconBox);gt.iconBox&&gc(t.iconCollisionBox.collisionVertexArray,je.icon.placed,St,De,se,ge.hasIconTextFit?Pt.x:0,ge.hasIconTextFit?Pt.y:0),gt.verticalIconBox&&gc(t.iconCollisionBox.collisionVertexArray,je.icon.placed,!St,De,se,ge.hasIconTextFit?Pt.x:0,ge.hasIconTextFit?Pt.y:0)}}}if(t.fullyClipped=he===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){let le=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=le.invProjMatrix,t.placementViewportMatrix=le.viewportMatrix,t.collisionCircleArray=le.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,i){let d=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function gc(u,t,i,d,m,y,x){u.emplaceBack(t?1:0,i?1:0,y||0,x||0,d,m?1:0),u.emplaceBack(t?1:0,i?1:0,y||0,x||0,d,m?1:0),u.emplaceBack(t?1:0,i?1:0,y||0,x||0,d,m?1:0),u.emplaceBack(t?1:0,i?1:0,y||0,x||0,d,m?1:0)}let _c=Math.pow(2,25),Wv=Math.pow(2,24),Zv=Math.pow(2,17),yc=Math.pow(2,16),vc=Math.pow(2,9),Xv=Math.pow(2,8),pl=Math.pow(2,1);function of(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;let t=u.placed?1:0,i=Math.floor(127*u.opacity);return i*_c+t*Wv+i*Zv+t*yc+i*vc+t*Xv+i*pl+t}let ls=0;class Fs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,i,d,m,y,x){let S=this._bucketParts;for(;this._currentTileIndex<t.length;)if(i.getBucketParts(S,m,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((A,R)=>A.sortKey-R.sortKey));this._currentPartIndex<S.length;){let A=S[this._currentPartIndex];if(i.placeLayerBucketPart(A,this._seenCrossTileIDs,d,A.symbolInstanceStart===0,x),this._currentPartIndex++,y())return!0}return!1}}class Yv{constructor(t,i,d,m,y,x,S,A,R){this.placement=new Zu(t,y,x,S,A,R),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,i,d,m,y){let x=n.q.now(),S=()=>{let A=n.q.now()-x;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){let A=i[t[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=R)&&(!A.maxzoom||A.maxzoom>R)){let P=A,k=P.layout.get("symbol-z-elevate"),N=P.layout.get("symbol-sort-key").constantOr(1)!==void 0,V=P.layout.get("symbol-z-order"),Z=V==="viewport-y"||V==="auto"&&!(V!=="viewport-y"&&N),G=P.layout.get("text-allow-overlap")||P.layout.get("icon-allow-overlap")||P.layout.get("text-ignore-placement")||P.layout.get("icon-ignore-placement"),Y=Z&&G,X=this._inProgressLayer=this._inProgressLayer||new Fs(P),ee=n.aC(A.source,A.scope);if(X.continuePlacement(k||Y?m[ee]:d[ee],this.placement,this._showCollisionBoxes,A,S,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let sf=512/n.ag/2;class Kv{constructor(t,i,d){this.tileID=t,this.bucketInstanceId=d,this.index=new n.bE(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let m=t.canonical.x*n.ag,y=t.canonical.y*n.ag;for(let x=0;x<i.length;x++){let{key:S,crossTileID:A,tileAnchorX:R,tileAnchorY:P}=i.get(x),k=Math.floor((m+R)*sf),N=Math.floor((y+P)*sf);this.index.add(k,N),this.keys.push(S),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,i,d){let m=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),y=sf/Math.pow(2,i.canonical.z-this.tileID.canonical.z),x=i.canonical.x*n.ag,S=i.canonical.y*n.ag;for(let A=0;A<t.length;A++){let R=t.get(A);if(R.crossTileID)continue;let{key:P,tileAnchorX:k,tileAnchorY:N}=R,V=Math.floor((x+k)*y),Z=Math.floor((S+N)*y),G=this.index.range(V-m,Z-m,V+m,Z+m);for(let Y of G){let X=this.crossTileIDs[Y];if(this.keys[Y]===P&&!d.has(X)){d.add(X),R.crossTileID=X;break}}}}}class rg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jv{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let i=Math.round((t-this.lng)/360);if(i!==0)for(let d in this.indexes){let m=this.indexes[d],y={};for(let x in m){let S=m[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+i),y[S.tileID.key]=S}this.indexes[d]=y}this.lng=t}addBucket(t,i,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<i.symbolInstances.length;y++)i.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);let m=this.usedCrossTileIDs[t.overscaledZ];for(let y in this.indexes){let x=this.indexes[y];if(Number(y)>t.overscaledZ)for(let S in x){let A=x[S];A.tileID.isChildOf(t)&&A.findMatches(i.symbolInstances,t,m)}else{let S=x[t.scaledTo(Number(y)).key];S&&S.findMatches(i.symbolInstances,t,m)}}for(let y=0;y<i.symbolInstances.length;y++){let x=i.symbolInstances.get(y);x.crossTileID||(x.crossTileID=d.generate(),m.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Kv(t,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(t,i){for(let d of i.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let i=!1;for(let d in this.indexes){let m=this.indexes[d];for(let y in m)t[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[y]),delete m[y],i=!0)}return i}}class af{constructor(){this.layerIndexes={},this.crossTileIDs=new rg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,i,d,m){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new Jv);let x=!1,S={};m.name!=="globe"&&y.handleWrapJump(d);for(let A of i){let R=A.getBucket(t);R&&t.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(A.tileID,R,this.crossTileIDs)&&(x=!0),S[R.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(x=!0),x}pruneUnusedLayers(t){let i={};t.forEach(d=>{i[d]=!0});for(let d in this.layerIndexes)i[d]||delete this.layerIndexes[d]}}let ua=771;class Jt{constructor(t,i,d,m){this.blendFunction=t,this.blendColor=i,this.mask=d,this.blendEquation=m}}Jt.Replace=[1,0,1,0],Jt.disabled=new Jt(Jt.Replace,n.aj.transparent,[!1,!1,!1,!1]),Jt.unblended=new Jt(Jt.Replace,n.aj.transparent,[!0,!0,!0,!0]),Jt.alphaBlended=new Jt([1,ua,1,ua],n.aj.transparent,[!0,!0,!0,!0]),Jt.alphaBlendedNonPremultiplied=new Jt([770,ua,770,ua],n.aj.transparent,[!0,!0,!0,!0]),Jt.multiply=new Jt([774,0,774,0],n.aj.transparent,[!0,!0,!0,!0]);class It{constructor(t,i,d){this.func=t,this.mask=i,this.range=d}}It.ReadOnly=!1,It.ReadWrite=!0,It.disabled=new It(519,It.ReadOnly,[0,1]);let Xu=7680;class Ot{constructor(t,i,d,m,y,x){this.test=t,this.ref=i,this.mask=d,this.fail=m,this.depthFail=y,this.pass=x}}Ot.disabled=new Ot({func:519,mask:0},0,0,Xu,Xu,Xu);let ml=1029,Yu=2305;class kt{constructor(t,i,d){this.enable=t,this.mode=i,this.frontFace=d}}function gl(u,t){let i=n.bG(u,3);n.ab.mat4.fromQuat(u,t),n.bI(u,3,i)}function ha(u,t){let i=n.ab.quat.identity([]);return n.ab.quat.rotateZ(i,i,-t),n.ab.quat.rotateX(i,i,-u),i}function lf(u,t){let i=[u[0],u[1],0],d=[t[0],t[1],0];if(n.ab.vec3.length(i)>=1e-15){let x=n.ab.vec3.normalize([],i);n.ab.vec3.scale(d,x,n.ab.vec3.dot(d,x)),t[0]=d[0],t[1]=d[1]}let m=n.ab.vec3.cross([],t,u);if(n.ab.vec3.len(m)<1e-15)return null;let y=Math.atan2(-m[1],m[0]);return ha(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),y)}kt.disabled=new kt(!1,ml,Yu),kt.backCCW=new kt(!0,ml,Yu),kt.backCW=new kt(!0,ml,2304),kt.frontCW=new kt(!0,1028,2304),kt.frontCCW=new kt(!0,1028,Yu);class Ku{constructor(t,i){this.position=t,this.orientation=i}get position(){return this._position}set position(t){if(t){let i=t instanceof n.aa?t:new n.aa(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=n.bF(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;let d=this.position,m=this._elevation?this._elevation.getAtPointOrZero(n.aa.fromLngLat(t)):0,y=n.aa.fromLngLat(t,m),x=[y.x-d.x,y.y-d.y,y.z-d.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=lf(x,i)}setPitchBearing(t,i){this.orientation=ha(n.ai(t),n.ai(-i))}}class bi{constructor(t,i){this._transform=n.ab.mat4.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){let t=this.position;return new n.aa(t[0],t[1],t[2])}get position(){let t=n.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&n.bI(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.ab.quat.identity([]),t&&gl(this._transform,this._orientation)}getPitchBearing(){let t=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,i){this._orientation=ha(t,i),gl(this._transform,this._orientation)}forward(){let t=n.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){let t=n.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){let t=n.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){let d=new Float64Array(16);return n.ab.mat4.invert(d,this.getWorldToCamera(t,i)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,d){let m=this.position;n.ab.vec3.scale(m,m,-t);let y=new Float64Array(16);return n.ab.mat4.fromScaling(y,[d,d,d]),n.ab.mat4.translate(y,y,m),y[10]*=i,y}getWorldToCamera(t,i){let d=new Float64Array(16),m=new Float64Array(4),y=this.position;return n.ab.quat.conjugate(m,this._orientation),n.ab.vec3.scale(y,y,-t),n.ab.mat4.fromQuat(d,m),n.ab.mat4.translate(d,d,y),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=i,d[9]*=i,d[10]*=i,d[11]*=i,d}getCameraToClipPerspective(t,i,d,m){let y=new Float64Array(16);return n.ab.mat4.perspective(y,t,i,d,m),y}getCameraToClipOrthographic(t,i,d,m,y,x){let S=new Float64Array(16);return n.ab.mat4.ortho(S,t,i,d,m,y,x),S}getDistanceToElevation(t,i=!1){let d=t===0?0:n.bH(t,i?n.aS(this.position[1]):this.position[1]),m=this.forward();return(d-this.position[2])/m[2]}clone(){return new bi([...this.position],[...this.orientation])}}let Gr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ct{constructor(t=0,i=0,d=0,m=0){if(isNaN(t)||t<0||isNaN(i)||i<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=i,this.left=d,this.right=m}interpolate(t,i,d){return i.top!=null&&t.top!=null&&(this.top=n.af(t.top,i.top,d)),i.bottom!=null&&t.bottom!=null&&(this.bottom=n.af(t.bottom,i.bottom,d)),i.left!=null&&t.left!=null&&(this.left=n.af(t.left,i.left,d)),i.right!=null&&t.right!=null&&(this.right=n.af(t.right,i.right,d)),this}getCenter(t,i){let d=n.aw((this.left+t-this.right)/2,0,t),m=n.aw((this.top+i-this.bottom)/2,0,i);return new n.P(d,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ct(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let cf=(u,t,i)=>(1-i)*u+i*t,Ju=u=>u*u*u*u*u;class xc{constructor(t,i,d,m,y,x,S){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=d??0,this._maxPitch=m??60,this.setProjection(x),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new n.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ct,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new bi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let t=new xc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,i=!1){let d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return n.ay(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};let i=this.projection?this.getProjection():void 0;this.projection=n.bP(this.projectionOptions);let d=this.getProjection(),m=!n.bn(i,d);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){let t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.bP({name:"mercator"});let i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){let i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=n.ab.mat2.create(),n.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let i=n.aw(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.ai(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){let i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){let t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let d=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop(),m=0,y=0;for(let x=0;x<i.length;x++){let S=new n.P(i[x][0]*this.width,d+i[x][1]*(this.height-d)),A=t.pointCoordinate(S);if(!A)continue;let R=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);m+=A[3]*R,y+=R}return y===0?NaN:m/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let t=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*i,m=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),x=Math.max(m-d,y);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){let i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),d;d=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];let m=n.ab.vec3.length(n.ab.vec3.sub([],this._camera.position,d));return n.aw(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!n.ab.quat.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){let d=[t.position.x,t.position.y,t.position.z];n.ab.vec3.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let t=this._camera.position,i=new Ku;return i.position=new n.aa(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!n.ab.quat.length(t))return!1;n.ab.quat.normalize(t,t);let i=n.ab.vec3.transformQuat([],[0,0,-1],t),d=n.ab.vec3.transformQuat([],[0,-1,0],t);if(d[2]<0)return!1;let m=lf(i,d);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){let i=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=n.aw(t[2],m/d,m/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,i,d){this._unmodified=!1,this._edgeInsets.interpolate(t,i,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){let i=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,i)}getVisibleUnwrappedCoordinates(t){let i=[new n.bQ(0,t)];if(this.renderWorldCopies){let d=this.pointCoordinate(new n.P(0,0)),m=this.pointCoordinate(new n.P(this.width,0)),y=this.pointCoordinate(new n.P(this.width,this.height)),x=this.pointCoordinate(new n.P(0,this.height)),S=Math.floor(Math.min(d.x,m.x,y.x,x.x)),A=Math.floor(Math.max(d.x,m.x,y.x,x.x)),R=1;for(let P=S-R;P<=A+R;P++)P!==0&&i.push(new n.bQ(P,t))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,i,d){let m=[],y=d!==void 0,x=!y;if(x&&this.zoom<i||y&&d[0]===0&&d[1]===0)return m;let S=new Set,A=(P,k,N,V,Z)=>{let G=n.c5(k,P,N,V,Z);S.has(G)||(m.push(new n.aG(P,k,N,V,Z)),S.add(G))};for(let P=0;P<t.length;P++){let k=t[P];if(x&&k.canonical.z!==i)continue;let N=k.canonical,V=k.overscaledZ,Z=k.wrap,G=1<<N.z,Y=N.x+1<G,X=N.x>0,ee=N.y+1<G,se=N.y>0,oe=k.wrap-(X?0:1),fe=k.wrap+(Y?0:1),ce=X?N.x-1:G-1,he=Y?N.x+1:0;if(y)d[0]<0?(A(V,fe,N.z,he,N.y),d[1]<0&&ee&&(A(V,Z,N.z,N.x,N.y+1),A(V,fe,N.z,he,N.y+1)),d[1]>0&&se&&(A(V,Z,N.z,N.x,N.y-1),A(V,fe,N.z,he,N.y-1))):d[0]>0?(A(V,oe,N.z,ce,N.y),d[1]<0&&ee&&(A(V,Z,N.z,N.x,N.y+1),A(V,oe,N.z,ce,N.y+1)),d[1]>0&&se&&(A(V,Z,N.z,N.x,N.y-1),A(V,oe,N.z,ce,N.y-1))):d[1]<0&&ee?A(V,Z,N.z,N.x,N.y+1):se&&A(V,Z,N.z,N.x,N.y-1);else{let le=k.visibleQuadrants;1&le&&(A(V,oe,N.z,ce,N.y),se&&(A(V,Z,N.z,N.x,N.y-1),A(V,oe,N.z,ce,N.y-1))),2&le&&(A(V,fe,N.z,he,N.y),se&&(A(V,Z,N.z,N.x,N.y-1),A(V,fe,N.z,he,N.y-1))),4&le&&(A(V,oe,N.z,ce,N.y),ee&&(A(V,Z,N.z,N.x,N.y+1),A(V,oe,N.z,ce,N.y+1))),8&le&&(A(V,fe,N.z,he,N.y),ee&&(A(V,Z,N.z,N.x,N.y+1),A(V,fe,N.z,he,N.y+1)))}}let R=[];for(let P of m)m.some(k=>P.isChildOf(k))||R.push(P);if(m=R.filter(P=>!t.some(k=>!!(P.overscaledZ<i&&k.isChildOf(P))||P.equals(k)||P.isChildOf(k))),x){let P=1<<i,k=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=[P*k.x,P*k.y],V=4,Z=V*V;m=m.filter(G=>{let Y=G.canonical.x+.5-N[0],X=G.canonical.y+.5-N[1];return Y*Y+X*X<Z})}return m}coveringTiles(t){let i=this.coveringZoomLevel(t),d=i,m=this.elevation&&this.elevation.exaggeration(),y=m&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&i<t.minzoom)return[];t.maxzoom!==void 0&&i>t.maxzoom&&(i=t.maxzoom);let S=this.locationCoordinate(this.center),A=this.center.lat,R=1<<i,P=[R*S.x,R*S.y,0],k=this.projection.name==="globe",N=!k,V=n.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,N),Z=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=R*n.bH(1,this.center.lat),Y=this._camera.position[2]/n.bH(1,this.center.lat),X=[R*Z.x,R*Z.y,Y*(N?1:G)],ee=k||m,se=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),oe=this.isLODDisabled(!0)?i:0,fe;if(this._elevation&&t.isTerrainDEM)fe=1e4*this._elevation.exaggeration();else if(this._elevation){let De=this._elevation.getMinMaxForVisibleTiles();fe=De?De.max:this._centerAltitude}else fe=this._centerAltitude;let ce=t.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?n.bS(this):1,le=De=>{let je=new n.aa(De.x+25e-6,De.y,De.z),it=new n.aa(De.x,De.y+25e-6,De.z),Ye=De.toLngLat(),qe=je.toLngLat(),et=it.toLngLat(),rt=this.locationCoordinate(Ye),dt=this.locationCoordinate(qe),gt=this.locationCoordinate(et),Pt=Math.hypot(dt.x-rt.x,dt.y-rt.y),Et=Math.hypot(gt.x-rt.x,gt.y-rt.y);return Math.sqrt(Pt*Et)*he/25e-6},ge=De=>{let We=fe,je=ce;return{aabb:n.bV(this,R,0,0,0,De,je,We,this.projection),zoom:0,x:0,y:0,minZ:je,maxZ:We,wrap:De,fullyVisible:!1}},we=[],Be=[],Re=i,Ge=t.reparseOverscaled?d:i,He=(Y-this._centerAltitude)*G,Me=De=>{if(!this._elevation||!De.tileID||!x)return;let We=this._elevation.getMinMaxForTile(De.tileID),je=De.aabb;We?(je.min[2]=We.min,je.max[2]=We.max,je.center[2]=(je.min[2]+je.max[2])/2):(De.shouldSplit=Qe(De),De.shouldSplit||(je.min[2]=je.max[2]=je.center[2]=this._centerAltitude))},Ve=(De,We)=>{if(.707*We<De)return 1;let je=We/De;return je/(1.4144271570014144+(Math.pow(1.1,je-1.4144271570014144+1)-1)/(1.1-1)-1)},Qe=De=>{if(De.zoom<oe)return!0;if(De.zoom===Re)return!1;if(De.shouldSplit!=null)return De.shouldSplit;let We=De.aabb.distanceX(X),je=De.aabb.distanceY(X),it=He,Ye=1;if(k){it=De.aabb.distanceZ(X);let Et=Math.pow(2,De.zoom),St=n.aS((De.y+1)/Et),Nt=n.aS(De.y/Et),an=Math.min(Math.max(A,St),Nt),An=n.c9(an)/n.c9(A);if(Ye=an===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,An/this._mercatorScaleRatio),this.zoom<=n.c6&&De.zoom===Re-1&&An>=.9)return!0}else if(y&&(it=De.aabb.distanceZ(X)*G),this.projection.isReprojectedInTileSpace&&d<=5){let Et=Math.pow(2,De.zoom),St=le(new n.aa((De.x+.5)/Et,(De.y+.5)/Et));Ye=St>.85?1:St}if(!x){let Et=Math.sqrt(We*We+je*je+it*it),St=(1<<Re-De.zoom)*se*Ye;return St*=Ve(Math.max(it,He),Et),Et<St}let qe=Number.MAX_VALUE,et=0,rt=De.aabb.getCorners(),dt=[];for(let Et of rt){n.ab.vec3.sub(dt,Et,X),k||(y?dt[2]*=G:dt[2]=He);let St=n.ab.vec3.dot(dt,this._camera.forward());St<qe&&(qe=St,et=Math.abs(dt[2]))}let gt=(1<<Re-De.zoom)*se*Ye;if(gt*=Ve(Math.max(et,He),qe),qe<gt)return!0;let Pt=De.aabb.closestPoint(P);return Pt[0]===P[0]&&Pt[1]===P[1]};if(this.renderWorldCopies)for(let De=1;De<=3;De++)we.push(ge(-De)),we.push(ge(De));for(we.push(ge(0));we.length>0;){let De=we.pop(),We=De.x,je=De.y,it=De.fullyVisible,Ye=()=>this.projection.name==="globe"&&(De.y===0||De.y===(1<<De.zoom)-1);if(!it){let qe=ee?De.aabb.intersects(V):De.aabb.intersectsFlat(V);if(qe===0&&Ye()){let et=new n.bT(De.zoom,We,je);qe=n.bU(this,R,et,!0).intersects(V)}if(qe===0)continue;it=qe===2}if(De.zoom!==Re&&Qe(De))for(let qe=0;qe<4;qe++){let et=(We<<1)+qe%2,rt=(je<<1)+(qe>>1),dt={aabb:x?De.aabb.quadrant(qe):n.bV(this,R,De.zoom+1,et,rt,De.wrap,De.minZ,De.maxZ,this.projection),zoom:De.zoom+1,x:et,y:rt,wrap:De.wrap,fullyVisible:it,tileID:void 0,shouldSplit:void 0,minZ:De.minZ,maxZ:De.maxZ};y&&!k&&(dt.tileID=new n.aG(De.zoom+1===Re?Ge:De.zoom+1,De.wrap,De.zoom+1,et,rt),Me(dt)),we.push(dt)}else{let qe=De.zoom===Re?Ge:De.zoom;if(t.minzoom&&t.minzoom>qe)continue;let et=0;if(!it){let Pt=ee?De.aabb.intersectsPrecise(V):De.aabb.intersectsPreciseFlat(V);if(Pt===0&&Ye()){let Et=new n.bT(De.zoom,We,je);Pt=n.bU(this,R,Et,!0).intersectsPrecise(V)}if(Pt===0)continue;if(t.calculateQuadrantVisibility)if(V.containsPoint(De.aabb.center))et=15;else for(let Et=0;Et<4;Et++)De.aabb.quadrant(Et).intersects(V)!==0&&(et|=1<<Et)}let rt=P[0]-(.5+We+(De.wrap<<De.zoom))*(1<<i-De.zoom),dt=P[1]-.5-je,gt=De.tileID?De.tileID:new n.aG(qe,De.wrap,De.zoom,We,je);t.calculateQuadrantVisibility&&(gt.visibleQuadrants=et),Be.push({tileID:gt,distanceSq:rt*rt+dt*dt})}}if(this.fogCullDistSq){let De=this.fogCullDistSq,We=this.horizonLineFromTop();Be=Be.filter(je=>{let it=[0,0,0,1],Ye=[n.ag,n.ag,0,1],qe=this.calculateFogTileMatrix(je.tileID.toUnwrapped());n.ab.vec4.transformMat4(it,it,qe),n.ab.vec4.transformMat4(Ye,Ye,qe);let et=n.ab.vec4.min([],it,Ye),rt=n.ab.vec4.max([],it,Ye),dt=n.bW(et,rt);if(dt===0)return!0;let gt=!1,Pt=this._elevation;if(Pt&&dt>De&&We!==0){let Et=this.calculateProjMatrix(je.tileID.toUnwrapped()),St;t.isTerrainDEM||(St=Pt.getMinMaxForTile(je.tileID)),St||(St={min:ce,max:fe});let Nt=n.c7(this.rotation),an=[Nt[0]*n.ag,Nt[1]*n.ag,St.max];n.ab.vec3.transformMat4(an,an,Et),gt=(1-an[1])*this.height*.5<We}return dt<De||gt})}return Be.sort((De,We)=>De.distanceSq-We.distanceSq).map(De=>De.tileID)}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){let i=n.aw(t.lat,-n.bX,n.bX),d=this.projection.project(t.lng,i);return new n.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let d,m,y=this.centerPoint;if(this.projection.name==="globe"){let S=this.worldSize;d=(i.x-y.x)/S,m=(i.y-y.y)/S}else{let S=this.pointCoordinate(i),A=this.pointCoordinate(y);d=S.x-A.x,m=S.y-A.y}let x=this.locationCoordinate(t);this.setLocation(new n.aa(x.x-d,x.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,i){let d=i?n.bH(i,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new n.aa(m.x,m.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,i){let d=i??this._centerAltitude,m=[t.x,t.y,0,1],y=[t.x,t.y,1,1];n.ab.vec4.transformMat4(m,m,this.pixelMatrixInverse),n.ab.vec4.transformMat4(y,y,this.pixelMatrixInverse);let x=y[3];n.ab.vec4.scale(m,m,1/m[3]),n.ab.vec4.scale(y,y,1/x);let S=m[2],A=y[2];return{p0:m,p1:y,t:S===A?0:(d-S)/(A-S)}}screenPointToMercatorRay(t){let i=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return n.ab.vec4.transformMat4(i,i,this.pixelMatrixInverse),n.ab.vec4.transformMat4(d,d,this.pixelMatrixInverse),n.ab.vec4.scale(i,i,1/i[3]),n.ab.vec4.scale(d,d,1/d[3]),i[2]=n.bH(i[2],this._center.lat)*this.worldSize,d[2]=n.bH(d[2],this._center.lat)*this.worldSize,n.ab.vec4.scale(i,i,1/this.worldSize),n.ab.vec4.scale(d,d,1/this.worldSize),new n.aq([i[0],i[1],i[2]],n.ab.vec3.normalize([],n.ab.vec3.sub([],d,i)))}rayIntersectionCoordinate(t){let{p0:i,p1:d,t:m}=t,y=n.bH(i[2],this._center.lat),x=n.bH(d[2],this._center.lat);return new n.aa(n.af(i[0],d[0],m)/this.worldSize,n.af(i[1],d[1],m)/this.worldSize,n.af(y,x,m))}pointCoordinate(t,i=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,i)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new n.aa(i[0],i[1],i[2]);let d=0,m=this.horizonLineFromTop();if(t.y>m)return this.pointCoordinate(t);let y=.02*m,x=t.clone();for(let S=0;S<10&&m-d>y;S++){x.y=n.af(d,m,.66);let A=this.projection.pointCoordinate3D(this,x.x,x.y);A?(m=x.y,i=A):d=x.y}return i?new n.aa(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.bY)return!this.isPointAboveHorizon(t);let i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){let d=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return n.ab.vec4.transformMat4(m,m,this.pixelMatrix),m[3]>0?new n.P(m[0]/m[3],m[1]/m[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:t,left:i}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,y=this.pointLocation3D(new n.P(i,t)),x=this.pointLocation3D(new n.P(m,t)),S=this.pointLocation3D(new n.P(m,d)),A=this.pointLocation3D(new n.P(i,d)),R=Math.min(y.lng,x.lng,S.lng,A.lng),P=Math.max(y.lng,x.lng,S.lng,A.lng),k=Math.min(y.lat,x.lat,S.lat,A.lat),N=Math.max(y.lat,x.lat,S.lat,A.lat),V=Math.pow(2,-this.zoom)/16*270,Z=this.projection.name==="globe"?1:4,G=(Y,X,ee,se,oe)=>{let fe=(Y+ee)/2,ce=(X+se)/2,he=new n.P(fe,ce),{lng:le,lat:ge}=this.pointLocation3D(he),we=Math.max(0,R-le,k-ge,le-P,ge-N);R=Math.min(R,le),P=Math.max(P,le),k=Math.min(k,ge),N=Math.max(N,ge),(oe<Z||we>V)&&(G(Y,X,fe,ce,oe+1),G(fe,ce,ee,se,oe+1))};if(G(i,t,m,t,1),G(m,t,m,d,1),G(m,d,i,d,1),G(i,d,i,t,1),this.projection.name==="globe"){let[Y,X]=n.bZ(this);Y?(N=90,P=180,R=-180):X&&(k=-90,P=180,R=-180)}return new n.az(new n.bO(R,k),new n.bO(P,N))}_getBoundsRectangular(t,i){let{top:d,left:m}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,S=new n.P(m,d),A=new n.P(x,d),R=new n.P(x,y),P=new n.P(m,y),k=this.pointCoordinate(S,t),N=this.pointCoordinate(A,t),V=this.pointCoordinate(R,i),Z=this.pointCoordinate(P,i),G=(Y,X)=>(X.y-Y.y)/(X.x-Y.x);return k.y>1&&N.y>=0?k=new n.aa((1-Z.y)/G(Z,k)+Z.x,1):k.y<0&&N.y<=1&&(k=new n.aa(-Z.y/G(Z,k)+Z.x,0)),N.y>1&&k.y>=0?N=new n.aa((1-V.y)/G(V,N)+V.x,1):N.y<0&&k.y<=1&&(N=new n.aa(-V.y/G(V,N)+V.x,0)),new n.az().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){let t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);let i=t.visibleDemTiles.reduce((d,m)=>{if(m.dem){let y=m.dem.tree;d.min=Math.min(d.min,y.minimums[0]),d.max=Math.max(d.max,y.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*t.exaggeration(),i.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){let i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-i*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.bX,this.maxLat=n.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.at(this.minLng)*this.tileSize,this.worldMaxX=n.at(this.maxLng)*this.tileSize,this.worldMinY=n.aA(this.maxLat)*this.tileSize,this.worldMaxY=n.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,i){return this.projection.createTileMatrix(this,i,t)}calculateDistanceTileData(t){let i=t.key,d=this._distanceTileDataCache;if(d[i])return d[i];let m=t.canonical,y=1/this.height,x=this.cameraWorldSize,S=x/this.zoomScale(m.z),A=(m.x+Math.pow(2,m.z)*t.wrap)*S,R=m.y*S,P=this.point;P.x*=x/this.worldSize,P.y*=x/this.worldSize;let k=this.angle,N=Math.sin(-k),V=-Math.cos(-k);return d[i]={bearing:[N,V],center:[(P.x-A)*y,(P.y-R)*y],scale:S/n.ag*y},d[i]}calculateFogTileMatrix(t){let i=t.key,d=this._fogTileMatrixCache;if(d[i])return d[i];let m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.ab.mat4.multiply(m,this.worldToFogMatrix,m),d[i]=new Float32Array(m),d[i]}calculateProjMatrix(t,i=!1,d=!1){let m=t.key,y;if(y=d?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,y[m])return y[m];let x=this.calculatePosMatrix(t,this.worldSize),S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,n.ab.mat4.multiply(x,S,x),y[m]=new Float32Array(x),y[m]}calculatePixelsToTileUnitsMatrix(t){let i=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[i])return d[i];let m=n.b_(t,this);return d[i]=m,d[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let t=1/this.worldSize,i=n.ab.mat4.fromScaling([],[t,t,t]);return n.ab.mat4.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let t=this._elevation;this._updateCameraState();let i=n.bH(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(i),m=this._camera.forward(),y=n.bH(1,this._center.lat);d[2]/=y,m[2]/=y,n.ab.vec3.normalize(m,m);let x=t.raycast(d,m,t.exaggeration());if(x){let S=n.ab.vec3.scaleAndAdd([],d,m,x),A=new n.aa(S[0],S[1],n.bH(S[2],n.aS(S[1]))),R=(A.z+n.ab.vec3.length([A.x-d[0],A.y-d[1],A.z-d[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;let i=this._elevation,d=n.bH(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(d),y=i.getAtPointOrZero(new n.aa(...m)),x=this.pixelsPerMeter/this.worldSize*y,S=this._minimumHeightOverTerrain(),A=m[2]-x;if(A<=S)if(A<0||t){let R=this.locationCoordinate(this._center,this._centerAltitude),P=[m[0],m[1],R.z-m[2]],k=n.ab.vec3.length(P);P[2]-=(S-A)/this._pixelsPerMercatorPixel;let N=n.ab.vec3.length(P);if(N===0)return;n.ab.vec3.scale(P,P,k/N*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],R.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){let N=this.center;return N.lat=n.aw(N.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(N.lng=n.aw(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}let i=this._unmodified,{x:d,y:m}=this.point,y=0,x=d,S=m,A=this.width/2,R=this.height/2,P=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(m-R<P&&(S=P+R),m+R>k&&(S=k-R),k-P<this.height&&(y=Math.max(y,this.height/(k-P)),S=(k+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let N=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,Z=this.worldSize/2-(N+V)/2;x=(d+Z+this.worldSize)%this.worldSize-Z,x-A<N&&(x=N+A),x+A>V&&(x=V-A),V-N<this.width&&(y=Math.max(y,this.width/(V-N)),x=(V+N)/2)}x===d&&S===m||(this.center=this.unproject(new n.P(x,S))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,i=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.bH(1,this.center.lat)/n.bH(1,n.c8));let m=n.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let y=this.projection.zAxisUnit==="meters"?d:1,x=this._camera.getWorldToCamera(this.worldSize,y),S,A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let ge=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),we=ge*this.aspect,Be=-we,Re=-ge;we-=t.x,Be-=t.x,ge+=t.y,Re+=t.y,S=this._camera.getCameraToClipOrthographic(Be,we,Re,ge,this._nearZ,this._farZ),((Ge,He,Me,Ve)=>{for(let Qe=0;Qe<16;Qe++)Ge[Qe]=cf(He[Qe],Me[Qe],Ve)})(S,S,A,Ju(this.pitch>=15?1:this.pitch/15))}else S=A;let R=n.ab.mat4.mul([],A,x),P=n.ab.mat4.mul([],S,x);if(this.projection.isReprojectedInTileSpace){let ge=this.locationCoordinate(this.center),we=n.ab.mat4.identity([]);n.ab.mat4.translate(we,we,[ge.x*this.worldSize,ge.y*this.worldSize,0]),n.ab.mat4.multiply(we,we,n.c0(this)),n.ab.mat4.translate(we,we,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),n.ab.mat4.multiply(P,P,we),n.ab.mat4.multiply(R,R,we),this.inverseAdjustmentMatrix=n.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.ab.mat4.scale([],P,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=P,this.invProjMatrix=n.ab.mat4.invert(new Float64Array(16),this.projMatrix),i){let ge=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ge[8]=2*-t.x/this.width,ge[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.ab.mat4.mul([],ge,x)}else this.expandedFarZProjMatrix=this.projMatrix;let k=n.ab.mat4.invert([],S);this.frustumCorners=n.c2.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);let N=new Float32Array(16);n.ab.mat4.identity(N),n.ab.mat4.scale(N,N,[1,-1,1]),n.ab.mat4.rotateX(N,N,this._pitch),n.ab.mat4.rotateZ(N,N,this.angle);let V=n.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.ab.mat4.clone(V);let Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-t.x/this.width,V[9]=2*(t.y+Z)/this.height,this.skyboxMatrix=n.ab.mat4.multiply(N,V,N);let G=this.point,Y=G.x,X=G.y,ee=this.width%2/2,se=this.height%2/2,oe=Math.cos(this.angle),fe=Math.sin(this.angle),ce=Y-Math.round(Y)+oe*ee+fe*se,he=X-Math.round(X)+oe*se+fe*ee,le=new Float64Array(P);if(n.ab.mat4.translate(le,le,[ce>.5?ce-1:ce,he>.5?he-1:he,0]),this.alignedProjMatrix=le,P=n.ab.mat4.create(),n.ab.mat4.scale(P,P,[this.width/2,-this.height/2,1]),n.ab.mat4.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=n.ab.mat4.create(),n.ab.mat4.scale(P,P,[1,-1,1]),n.ab.mat4.translate(P,P,[-1,-1,0]),n.ab.mat4.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=n.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},P=n.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.c3(this);let ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.ab.vec3.transformMat4(ge,ge,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,d=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,i];n.ab.vec3.scale(y,y,m),n.ab.vec3.scale(d,d,-1),n.ab.vec3.multiply(d,d,y);let x=n.ab.mat4.create();n.ab.mat4.translate(x,x,d),n.ab.mat4.scale(x,x,y),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,m)}_computeCameraPosition(t){let i=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),m=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-d[0]*y,m.y/this.worldSize-d[1]*y,t/this.worldSize*this._centerAltitude-d[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){let i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],m=t[2],y=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(y=Math.min((i-d)/m,1)),this._camera.position=n.ab.vec3.scaleAndAdd([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){let t=this._camera.position,i=this._camera.forward(),{pitch:d,bearing:m}=this._camera.getPitchBearing(),y=n.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.ai(this._maxPitch)),S=Math.max((t[2]-y)/Math.cos(d),x),A=this._zoomFromMercatorZ(S);n.ab.vec3.scaleAndAdd(t,t,i,S),this._pitch=n.aw(d,n.ai(this.minPitch),n.ai(this.maxPitch)),this.angle=n.bF(m,-Math.PI,Math.PI),this._setZoom(n.aw(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.aa(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){let t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,d=n.bY,m=0,y=1/0;for(;d-i>1e-6&&d>i;){let x=i+.5*(d-i),S=this.tileSize*Math.pow(2,x),A=this.getCameraToCenterDistance(this.projection,x,S),R=this.scaleZoom(A/(t*this.tileSize)),P=Math.abs(x-R);P<y&&(y=P,m=x),x<R?i=x:d=x}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){let d=Math.min(t.x,i.x),m=Math.max(t.x,i.x),y=Math.min(t.y,i.y),x=Math.max(t.y,i.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let S=[new n.P(d,y),new n.P(m,x),new n.P(d,x),new n.P(m,y)],A=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(let P of S){let k=this.pointRayIntersection(P);if(k.t<0)return!0;let N=this.rayIntersectionCoordinate(k);if(N.x<A||N.y<0||N.x>R||N.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,i){let d=n.ab.vec3.length(n.ab.vec3.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(d)+i;return d-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){let t=function([i,d,m],y){let x=[i,d,m,1];n.ab.vec4.transformMat4(x,x,y);let S=x[3]=Math.max(x[3],1e-6);return x[0]/=S,x[1]/=S,x[2]/=S,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,i=this.zoom,d=this.worldSize){let m=n.b$(t,i,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,d,m),x=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(x=cf(1,x,Ju(this.pitch>=15?1:this.pitch/15))),x}getWorldToCameraMatrix(){let t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.ab.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return n.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}let Ns=(u,t)=>{if(t>0&&u.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let i=u.transform,d=Math.max(Math.abs(i._zoom-(u.minCutoffZoom-1)),1),m=i.isLODDisabled(!1)?n.ac(60,45,i.pitch):n.ac(30,15,i.pitch),y=i._farZ-i._nearZ,x=t*i.height,S=((1-(A=m))*i.cameraToCenterDistance+A*(i._farZ+x))*d;var A;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(S-i._nearZ)/y,(S-x-i._nearZ)/y]}}},Br={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class cs{constructor(t,i){this.aabb=t,this.lastCascade=i}}class uf{add(t,i){let d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],i.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],i.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],i.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],i.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],i.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],i.max[2])):this.receivers[t.key]=new cs(i,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,i,d){let m=n.cd.fromPoints(t.points),y=0;for(let x in this.receivers){let S=this.receivers[x];if(!S||!m.intersectsAabb(S.aabb))continue;S.aabb.min=m.closestPoint(S.aabb.min),S.aabb.max=m.closestPoint(S.aabb.max);let A=S.aabb.getCorners();for(let R=0;R<d.length;R++){let P=!0;for(let k of A){let N=[k[0]*i,k[1]*i,k[2]];if(n.ab.vec3.transformMat4(N,N,d[R].matrix),N[0]<-1||N[0]>1||N[1]<-1||N[1]>1){P=!1;break}}if(S.lastCascade=R,y=Math.max(y,R),P)break}}return y+1}}class da{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new uf,this._depthMode=new It(t.context.gl.LEQUAL,It.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Br,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Br,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Br,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){let d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;let m=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||m<=0||(this._shadowLayerCount=d.style.order.reduce((Z,G)=>{let Y=d.style._mergedLayers[G];return Z+(Y.hasShadowPass()&&!Y.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let y=d.context,x=Br.shadowMapResolution,S=Br.shadowMapResolution;if(this._cascades.length===0||Br.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Z=0;Z<Br.cascadeCount;++Z){let G=d._shadowMapDebug,Y=y.gl,X=y.createFramebuffer(x,S,G,"texture"),ee=new n.T(y,{width:x,height:S,data:null},Y.DEPTH_COMPONENT16);if(X.depthAttachment.set(ee.texture),G){let se=new n.T(y,{width:x,height:S,data:null},Y.RGBA8);X.colorAttachment.set(se.texture)}this._cascades.push({framebuffer:X,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.bR,scale:0})}}this.shadowDirection=pa(i);let A=0;if(t.elevation){let Z=t.elevation,G=[1e4,-1e4];Z.visibleDemTiles.filter(Y=>Y.dem).forEach(Y=>{let X=Y.dem.tree;G[0]=Math.min(G[0],X.minimums[0]),G[1]=Math.max(G[1],X.maximums[0])}),G[0]!==1e4&&(A=(G[1]-G[0])*Z.exaggeration())}let R=1.5*t.cameraToCenterDistance,P=3*R,k=new Float64Array(16);for(let Z=0;Z<this._cascades.length;++Z){let G=this._cascades[Z],Y=t.height/50,X=1;Br.cascadeCount===1?X=P:Z===0?X=R:(Y=R,X=P);let[ee,se]=Qv(t,this.shadowDirection,Y,X,Br.shadowMapResolution,A);G.scale=t.scale,G.matrix=ee,G.boundingSphereRadius=se,n.ab.mat4.invert(k,G.matrix),G.frustum=n.bR.fromInvProjectionMatrix(k,1,0,!0),G.far=X}let N=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[N].far,this._cascades[N].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Br.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Br.shadowMapResolution,this._uniformValues.u_shadowmap_0=Gr.ShadowMap0,this._uniformValues.u_shadowmap_1=Gr.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let V=d.transform.elevation;for(let Z of this._groundShadowTiles){let G={min:0,max:0};if(V){let Y=V.getMinMaxForTile(Z);Y&&(G=Y)}this.addShadowReceiver(Z.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,i){if(!this.enabled)return;let d=this.painter,m=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),m.viewport.set([0,0,Br.shadowMapResolution,Br.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){d.currentShadowCascade=y,m.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),m.clear({color:n.aj.white,depth:1});for(let x of t.order){let S=t._mergedLayers[x];if(!S.hasShadowPass()||S.isHidden(d.transform.zoom))continue;let A=t.getLayerSourceCache(S),R=A?i[A.id]:void 0;(S.type==="model"||R&&R.length)&&d.renderLayer(d,A,S,R)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let t=this.painter,i=t.style,d=t.context,m=i.directionalLight,y=i.ambientLight;if(!m||!y)return;let x=[],S=Ns(t,t.longestCutoffRange);S.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&x.push("NORMAL_OFFSET");let A=hf(i,m,y),R=new It(d.gl.LEQUAL,It.ReadOnly,t.depthRangeFor3D);for(let P of this._groundShadowTiles){let k=P.toUnwrapped(),N=t.isTileAffectedByFog(P),V=t.getOrCreateProgram("groundShadow",{defines:x,overrideFog:N});this.setupShadows(k,V),t.uploadCommonUniforms(d,V,k,null,S);let Z={u_matrix:t.transform.calculateProjMatrix(k),u_ground_shadow_factor:A};V.draw(t,d.gl.TRIANGLES,R,Ot.disabled,Jt.multiply,kt.disabled,Z,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Jt.unblended:Jt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){let i=this.painter.transform,d=i.calculatePosMatrix(t,i.worldSize);return n.ab.mat4.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return n.ab.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,d,m=0){if(!this.enabled)return;let y=this.painter.transform,x=this.painter.context,S=x.gl,A=this._uniformValues,R=new Float64Array(16),P=y.calculatePosMatrix(t,y.worldSize);for(let k=0;k<this._cascades.length;k++)n.ab.mat4.multiply(R,this._cascades[k].matrix,P),A[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),x.activeTexture.set(S.TEXTURE0+Gr.ShadowMap0+k),this._cascades[k].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){let k=n.cc(t.canonical),N=2/y.tileSize*n.ag/Br.shadowMapResolution,V=N*this._cascades[0].boundingSphereRadius,Z=N*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(d==="vector-tile"?1:3)/Math.pow(2,m-t.canonical.z-(1-y.zoom+Math.floor(y.zoom)));A.u_shadow_normal_offset=[k,V*G,Z*G],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(x,A)}setupShadowsFromMatrix(t,i,d=!1){if(!this.enabled)return;let m=this.painter.context,y=m.gl,x=this._uniformValues,S=new Float64Array(16);for(let A=0;A<Br.cascadeCount;A++)n.ab.mat4.multiply(S,this._cascades[A].matrix,t),x[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),m.activeTexture.set(y.TEXTURE0+Gr.ShadowMap0+A),this._cascades[A].texture.bind(y.NEAREST,y.CLAMP_TO_EDGE);if(this.useNormalOffset=d,d){let A=Br.normalOffset;x.u_shadow_normal_offset=[1,A,A],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(m,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,d,m){if(m[2]>=0)return{};let y=function(A,R,P){let k=P/(1<<A.canonical.z);return new n.cd([A.canonical.x*k+A.wrap*P,A.canonical.y*k+A.wrap*P,0],[(A.canonical.x+1)*k+A.wrap*P,(A.canonical.y+1)*k+A.wrap*P,R])}(t,i,d).getCorners(),x=i/-m[2];m[0]<0?(n.ab.vec3.add(y[0],y[0],[m[0]*x,0,0]),n.ab.vec3.add(y[3],y[3],[m[0]*x,0,0])):m[0]>0&&(n.ab.vec3.add(y[1],y[1],[m[0]*x,0,0]),n.ab.vec3.add(y[2],y[2],[m[0]*x,0,0])),m[1]<0?(n.ab.vec3.add(y[0],y[0],[0,m[1]*x,0]),n.ab.vec3.add(y[1],y[1],[0,m[1]*x,0])):m[1]>0&&(n.ab.vec3.add(y[2],y[2],[0,m[1]*x,0]),n.ab.vec3.add(y[3],y[3],[0,m[1]*x,0]));let S={};return S.vertices=y,S.planes=[fa(y[1],y[0],y[4]),fa(y[2],y[1],y[5]),fa(y[3],y[2],y[6]),fa(y[0],y[3],y[7])],S}addShadowReceiver(t,i,d){this._receivers.add(t,n.cd.fromTileIdAndHeight(t,i,d))}getMaxCascadeForTile(t){let i=this._receivers.get(t);return i&&i.lastCascade?i.lastCascade:0}}function fa(u,t,i){let d=n.ab.vec3.sub([],i,t),m=n.ab.vec3.sub([],u,t),y=n.ab.vec3.cross([],d,m),x=n.ab.vec3.length(y);return x===0?[0,0,1,0]:(n.ab.vec3.scale(y,y,1/x),[y[0],y[1],y[2],-n.ab.vec3.dot(y,t)])}function pa(u){let t=u.properties.get("direction"),i=n.cb(t.x,t.y,t.z);i[2]=n.aw(i[2],0,75);let d=n.ce([i[0],i[1],i[2]]);return n.ab.vec3.fromValues(d.x,d.y,d.z)}function hf(u,t,i){let d=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),y=t.properties.get("intensity"),x=t.properties.get("direction"),S=[x.x,x.y,x.z],A=i.properties.get("color-use-theme")==="none",R=i.properties.get("color"),P=i.properties.get("intensity"),k=Math.max(n.ab.vec3.dot([0,0,1],S),0),N=[0,0,0];n.ab.vec3.scale(N,R.toRenderColor(A?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),P);let V=[0,0,0];return n.ab.vec3.scale(V,m.toRenderColor(d?null:u.getLut(i.scope)).toArray01Linear().slice(0,3),k*y),n.cf([N[0]>0?N[0]/(N[0]+V[0]):0,N[1]>0?N[1]/(N[1]+V[1]):0,N[2]>0?N[2]/(N[2]+V[2]):0])}function Qv(u,t,i,d,m,y){let x=u.zoom,S=u.scale,A=u.worldSize,R=1/A,P=u.aspect,k=Math.sqrt(1+P*P)*Math.tan(.5*u.fovX),N=k*k,V=d-i,Z=d+i,G,Y;N>V/Z?(G=d,Y=d*k):(G=.5*Z*(1+N),Y=.5*Math.sqrt(V*V+2*(d*d+i*i)*N+Z*Z*N*N));let X=u.projection.pixelsPerMeter(u.center.lat,A),ee=u._camera.getCameraToWorldMercator(),se=[0,0,-G*R];n.ab.vec3.transformMat4(se,se,ee);let oe=Y*R,fe=u._edgeInsets;if(!(fe.left===0&&fe.top===0&&fe.right===0&&fe.bottom===0||fe.left===fe.right&&fe.top===fe.bottom)){let it=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?X:1),Ye=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,i,d);Ye[8]=2*-u.centerOffset.x/u.width,Ye[9]=2*u.centerOffset.y/u.height;let qe=new Float64Array(16);n.ab.mat4.mul(qe,Ye,it);let et=new Float64Array(16);n.ab.mat4.invert(et,qe);let rt=n.bR.fromInvProjectionMatrix(et,A,x,!0);for(let dt of rt.points){let gt=((ce=dt)[0]/=S,ce[1]/=S,ce[2]=n.bH(ce[2],u._center.lat),ce);oe=Math.max(oe,n.ab.vec3.len(n.ab.vec3.subtract([],se,gt)))}}var ce;oe*=m/(m-1);let he=Math.acos(t[2]),le=Math.atan2(-t[0],-t[1]),ge=new bi;ge.position=se,ge.setPitchBearing(he,le);let we=ge.getWorldToCamera(A,X),Be=oe*A,Re=Math.min(u._mercatorZfromZoom(17)*A*-2,-2*Be),Ge=ge.getCameraToClipOrthographic(-Be,Be,-Be,Be,Re,(Be+y*X)/t[2]),He=new Float64Array(16);n.ab.mat4.multiply(He,Ge,we);let Me=n.ab.vec3.fromValues(Math.floor(1e6*se[0])/1e6*A,Math.floor(1e6*se[1])/1e6*A,0),Ve=.5*m,Qe=[0,0,0];n.ab.vec3.transformMat4(Qe,Me,He),n.ab.vec3.scale(Qe,Qe,Ve);let De=[Math.floor(Qe[0]),Math.floor(Qe[1]),Math.floor(Qe[2])],We=[0,0,0];n.ab.vec3.sub(We,Qe,De),n.ab.vec3.scale(We,We,-1/Ve);let je=new Float64Array(16);return n.ab.mat4.identity(je),n.ab.mat4.translate(je,je,We),n.ab.mat4.multiply(He,je,He),[He,Be]}class df extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,i){return n.aM(this.requestManager.transformRequest(i,n.R.Model).url).then(d=>{if(!d)return;let m=n.aN(d),y=new n.aO(t,void 0,void 0,m);return y.computeBoundsAndApplyParent(),y}).catch(d=>{if(d&&d.status===404)return null;this.fire(new n.y(new Error(`Could not load model ${t} from ${i}: ${d.message}`)))})}load(t,i,d={keepNumReferences:!1}){this.models[i]||(this.models[i]={});let m=Object.keys(t);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+m.length;let y=[];for(let x of m)y.push(this.loadModel(x,t[x]));Promise.allSettled(y).then(x=>{for(let S=0;S<x.length;S++){let{status:A,value:R}=x[S];if(A==="fulfilled"&&R){let P=this.models[i][m[S]];this.models[i][m[S]]={model:R,numReferences:d.keepNumReferences&&P?P.numReferences:1}}}this.numModelsLoading[i]-=m.length,this.fire(new n.z("data",{dataType:"style"}))}).catch(x=>{this.fire(new n.y(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(let t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,i){return!!this.getModel(t,i)}getModel(t,i){return this.models[i]||(this.models[i]={}),this.models[i][t]?this.models[i][t].model:void 0}addModel(t,i,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={}),this.hasModel(t,d)&&this.models[d][t].numReferences++,this.modelUris[d][t]=this.requestManager.normalizeModelURL(i),this.load({[t]:this.modelUris[d][t]},d)}addModels(t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});let d=this.modelUris[i];for(let m in t)this.models[i][m]={},d[m]=this.requestManager.normalizeModelURL(t[m]);this.load(d,i,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});let d={};for(let m of t)this.hasModel(m,i)?this.models[i][m].numReferences++:(this.modelUris[i][m]=this.requestManager.normalizeModelURL(m),d[m]=this.modelUris[i][m]);this.load(d,i)}removeModel(t,i){if(this.models[i]&&this.models[i][t]&&(this.models[i][t].numReferences--,this.models[i][t].numReferences===0)){let d=this.models[i][t].model;delete this.models[i][t],delete this.modelUris[i][t],d.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,i){this.models[i]||(this.models[i]={});for(let d in this.models[i])this.models[i][d].model&&this.models[i][d].model.upload(t.context)}}let e0=new n.a5({data:new n.a6(n.a3.colorTheme.data)}),ig={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function ff(u){return u=u||{},Object.assign(u,ig)}class pf extends n.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},n.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new n.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(x,S){let[A,R]=x,{center:P,radius:k}=S,[N,V]=P,Z=Math.abs(A-N);return Math.sqrt((Z>180?360-Z:Z)**2+(R-V)**2)<=k}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new n.z("floorplangone")));let i={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=new n.P(this._map.transform.width/2,this._map.transform.height/2),m=[new n.P(0,0),new n.P(this._map.transform.width,this._map.transform.height)],y=this._map.queryRenderedFeatures(t?m:d,i);y.length>0&&(this._selectedFloorplan&&y[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=y[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(y){let[[x,S],[A,R]]=y,P=(A-x+360)%360,k=P>180?360-P:P;return{center:[(x+k/2+360)%360,(S+R)/2],radius:Math.sqrt(k**2+(R-S)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});let i=this._floorplanStates[this._indoorData.id].selectedBuilding,d=this._floorplanStates[this._indoorData.id].selectedLevel,m;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(let y of this._indoorData.levels)y.id===this._selectedLevel.id&&(m=y.id);if(this.fire(new n.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:m})),i){let y=this._indoorData.buildings.find(x=>x.id===i);this._buildingSelected(y,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(d){let y=this._indoorData.levels.find(x=>x.id===d);this._updateLevels(y,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,i){i&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;let d=this._indoorData.levels.filter(m=>t.levels.includes(m.id));this.fire(new n.z("buildingselected",{buildingId:t.id,levels:d}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{let i=this._indoorData.levels.find(d=>d.id===t);this._updateLevels(i,!0)}this.fire(new n.z("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,i){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(i&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function d(R){let P=R.indexOf("/floor/");if(P===-1)return R;let k=P+7,N=R.indexOf("/",k);return N===-1?R.slice(k):R.slice(k,N)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;let m=[],y={},x={},S={},A={};for(let R of this._indoorData.levels)if(m.push(R.id),y[R.id]=R.height,x[R.id]=R.base,t){if(this.mergeFloors){let P=d(t.id),k=d(R.id);S[R.id]=k===P?"true":"false"}else S[R.id]=R.id===t.id?"true":"false";A[R.id]=R.base<t.base?"true":"false"}else A[R.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",m]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",A]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),i&&t.extent)){let R=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),P=this._map.getZoom(),k=R.zoom?Math.abs(P-R.zoom):0;this._map.fitBounds(t.extent,k>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:P})}}selectFloorplan(t){let i={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=[new n.P(0,0),new n.P(this._map.transform.width,this._map.transform.height)],m=this._map.queryRenderedFeatures(d,i);if(m.length>0){for(let y of m)if(JSON.parse(y.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=y,this._floorplanSelected(!0);break}}}selectBuilding(t){let i=this._indoorData.buildings.find(d=>d.id===t);this._buildingSelected(i,!0)}selectLevel(t){this._levelSelected(t)}}function t0(u){if(!u.metadata||!u.metadata.content_area)return;let t=n.q.devicePixelRatio,{left:i,top:d,width:m,height:y}=u.metadata.content_area,x=i*t,S=d*t;return[x,S,x+m*t,S+y*t]}function og(u){if(u)return u.map(([t,i])=>[t*n.q.devicePixelRatio,i*n.q.devicePixelRatio])}let ma=(u,t)=>Mo(u,t&&t.filter(i=>i.identifier!=="source.canvas")),n0=n.ay(Qt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),sg=n.ay(Qt,["setCenter","setZoom","setBearing","setPitch"]),mf=new Set(["background","sky","slot","custom"]),bc={version:8,layers:[],sources:{}},ag={duration:300,delay:0};class Ki extends n.E{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.globalId=null,this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=n.l({},ag),this._buildingIndex=new ng(this),this.crossTileSymbolIndex=new af,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new ra,this.dispatcher=i.dispatcher?i.dispatcher:new n.D(n.ci(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new si(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new n.cj(t._requestManager,i.localFontFamily?n.ck.all:i.localIdeographFontFamily?n.ck.ideographs:n.ck.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new df(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:i.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=i.initialConfig,this.dispatcher.broadcast("setReferrer",n.cl());let d=this;this._rtlTextPluginCallback=Ki.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,x)=>{if(n.cm(y),x&&x.every(S=>S))for(let S in d._sourceCaches){let A=d._sourceCaches[S],R=A.getSource().type;R!=="vector"&&R!=="geojson"||A.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;let y=this.getOwnSource(m.sourceId);if(y&&y.vectorLayerIds)for(let x in this._layers){let S=this._layers[x];S.source===y.id&&this._validateLayer(S)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.f(t))return t;let i=n.cn(t);if(!i.startsWith("http"))try{return new URL(i,location.href).toString()}catch{return i}return i}return`json://${n.co(JSON.stringify(t))}`}_diffStyle(t,i,d){this.globalId=this._getGlobalId(t);let m=(y,x)=>{try{x(null,this.setState(y,d))}catch(S){x(S,!1)}};if(typeof t=="string"){let y=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(y,n.R.Style);n.n(x,(S,A)=>{S?this.fire(new n.y(S)):A&&m(A,i)})}else typeof t=="object"&&m(t,i)}loadURL(t,i={}){this.fire(new n.z("dataloading",{dataType:"style"}));let d=typeof i.validate=="boolean"?i.validate:!n.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);let m=this.importsCache.get(t);if(m)return this._load(m,d);let y=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.n(y,(x,S)=>{if(this._request=null,x)this.fire(new n.y(x));else if(S)return this.importsCache.set(t,S),this._load(S,d)})}loadJSON(t,i={}){this.fire(new n.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.q.frame(()=>{this._request=null,this._load(t,i.validate!==!1)})}loadEmpty(){this.fire(new n.z("dataloading",{dataType:"style"})),this._load(bc,!1)}_loadImports(t,i,d){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let m=[];for(let y of t){let x=this._createFragmentStyle(y),S=new Promise(P=>{x.once("style.import.load",P),x.once("error",P)}).then(()=>this.mergeAll());if(m.push(S),this.resolvedImports.has(y.url)){x.loadEmpty();continue}let A=y.data||this.importsCache.get(y.url);A?(x.loadJSON(A,{validate:i}),this._isInternalStyle(A)&&(x.globalId=null)):y.url?x.loadURL(y.url,{validate:i}):x.loadEmpty();let R={style:x,id:y.id,config:y.config};if(d){let P=this.fragments.findIndex(({id:k})=>k===d);this.fragments=this.fragments.slice(0,P).concat(R).concat(this.fragments.slice(P))}else this.fragments.push(R)}return Promise.allSettled(m)}getImportGlobalIds(t=this,i=new Set){for(let d of t.fragments)d.style.globalId&&i.add(d.style.globalId),this.getImportGlobalIds(d.style,i);return[...i.values()]}_createFragmentStyle(t){let i=this.scope?n.aC(t.id,this.scope):t.id,d,m=this._initialConfig&&this._initialConfig[i];(t.config||m)&&(d=n.l({},t.config,m));let y=new Ki(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,i){let d=t.indoor?ff(t.schema):t.schema;if(this._isInternalStyle(t)){let x=n.l({},bc,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(x,i)}if(this.updateConfig(this._config,d),i&&ma(this,Mi(t)))return;this._loaded=!0,this.stylesheet=n.cp(t);let m=()=>{for(let R in t.sources)this.addSource(R,t.sources[R],{validate:!1,isInitialLoad:!0});t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);let x=Hu(this.stylesheet.layers);if(this._order=x.map(R=>R.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let R=this.stylesheet.lights[0];this.light=new W(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new W(this.stylesheet.light)),this._layers={};for(let R of x){let P=n.cu(R,this.scope,this._styleColorTheme.lut,this.options);P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P;let k=this.getOwnLayerSourceCache(P),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&P.canCastShadows()&&N&&(k.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.z("data",{dataType:"style"}));let A=this.isRootStyle();t.imports?this._loadImports(t.imports,i).then(()=>{this._reloadImports(),this.fire(new n.z(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.z(A?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];let y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){let x=this._evaluateColorThemeData(y);this._loadColorTheme(x).then(()=>{m()}).catch(S=>{n.w(`Couldn't load color theme from the stylesheet: ${S}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,i,d,m,y,x,S,A,R,P,k={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(N=>{if(N.stylesheet){if(N.light!=null&&(t=N.light),N.stylesheet.lights)for(let V of N.stylesheet.lights)V.type==="ambient"&&N.ambientLight!=null&&(i=N.ambientLight),V.type==="directional"&&N.directionalLight!=null&&(d=N.directionalLight);m=this._prioritizeTerrain(m,N.terrain,N.stylesheet.terrain),N.stylesheet.fog&&N.fog!=null&&(y=N.fog),N.stylesheet.snow&&N.snow!=null&&(x=N.snow),N.stylesheet.rain&&N.rain!=null&&(S=N.rain),N.stylesheet.camera!=null&&(P=N.stylesheet.camera),N.stylesheet.projection!=null&&(A=N.stylesheet.projection),N.stylesheet.transition!=null&&(R=N.stylesheet.transition),k[N.scope]=N._styleColorTheme}}),this.light=t,this.ambientLight=i,this.directionalLight=d,this.fog=y,this.snow=x,this.rain=S,this._styleColorThemeForScope=k,m===null?delete this.terrain:this.terrain=m,this.camera=P||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=n.l({},ag,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){let i=d=>{for(let m of d.fragments)i(m.style);t(d)};i(this)}_prioritizeTerrain(t,i,d){let m=t&&t.drapeRenderMode===0;return d===null?i&&i.drapeRenderMode===0?i:m?t:null:i!=null&&(!t||m||i&&i.drapeRenderMode===1)?i:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{t=this._prioritizeTerrain(t,i.terrain,i.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(i=>{i.stylesheet.projection!=null&&(t=i.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){let t={},i={},d={};this.forEachFragmentStyle(m=>{for(let y in m._sourceCaches){let x=n.aC(y,m.scope);t[x]=m._sourceCaches[y]}for(let y in m._otherSourceCaches){let x=n.aC(y,m.scope);i[x]=m._otherSourceCaches[y]}for(let y in m._symbolSourceCaches){let x=n.aC(y,m.scope);d[x]=m._symbolSourceCaches[y]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=d}mergeLayers(){let t={},i=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(y=>{for(let x of y._order){let S=y._layers[x];if(S.type==="slot"){let A=n.cq(x);if(t[A])continue;t[A]=[]}S.slot&&t[S.slot]?t[S.slot].push(S):i.push(S)}}),this._mergedOrder=[];let m=(y=[])=>{for(let x of y)if(x.type==="slot"){let S=n.cq(x.id);t[S]&&m(t[S]),this._mergedSlots.push(S)}else{let S=n.aC(x.id,x.scope);this._mergedOrder.push(S),d[S]=x,x.is3D()&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0),x.type==="clip"&&(this._clipLayerPresent=!0)}};m(i),this._mergedOrder.sort((y,x)=>{let S=d[y],A=d[x];return S.hasInitialOcclusionOpacityProperties?A.is3D()?1:0:S.is3D()&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=n.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(i,d,m){let y=n.l({},d);for(let S of Object.keys(n.a3.colorTheme))y[S]===void 0&&(y[S]=n.a3.colorTheme[S].default);let x=new n.a4(e0,i,new Map(m));return x.setTransitionOrValue(y,m),x.untransitioned().possiblyEvaluate(new n.a8(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let i=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,m)=>{let y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let x=t;x.startsWith(y)||(x=y+x);let S="mapbox-reserved-lut",A=new Image;A.src=x,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==i)return void d();this._styleColorTheme.lutLoading=!1;let{width:R,height:P,data:k}=n.q.getImageData(A);if(P>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==P*P)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new n.r({width:R,height:P},k),pixelRatio:1,sdf:!1,usvg:!1,version:0});let N=this.imageManager.getImage(S,this.scope);N?(this._styleColorTheme.lut={image:N.data,data:t},d()):m(new Error("Missing LUT image."))}})}getLut(t){let i=this._styleColorThemeForScope[t];return i?i.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(i,d,m){let y,x,S,A=n.q.devicePixelRatio>1?"@2x":"",R=n.n(d.transformRequest(d.normalizeSpriteURL(i,A,".json"),n.R.SpriteJSON),(N,V)=>{R=null,S||(S=N,y=V,k())}),P=n.o(d.transformRequest(d.normalizeSpriteURL(i,A,".png"),n.R.SpriteImage),(N,V)=>{P=null,S||(S=N,x=V,k())});function k(){if(S)m(S);else if(y&&x){let N=n.q.getImageData(x),V={};for(let Z in y){let{width:G,height:Y,x:X,y:ee,sdf:se,pixelRatio:oe,stretchX:fe,stretchY:ce,content:he}=y[Z],le=new n.r({width:G,height:Y});n.r.copy(N,le,{x:X,y:ee},{x:0,y:0},{width:G,height:Y},null),V[Z]={data:le,pixelRatio:oe,sdf:se,stretchX:fe,stretchY:ce,content:he,usvg:!1}}m(null,V)}}return{cancel(){R&&(R.cancel(),R=null),P&&(P.cancel(),P=null)}}}(t,this.map._requestManager,(i,d)=>{if(this._spriteRequest=null,i)this.fire(new n.y(i));else if(d)for(let m in d)this.imageManager.addImage(m,this.scope,d[m]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))})}_loadIconset(t){if(!n.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);let i=this.map._spriteFormat==="auto";var d,m;this._spriteRequest=(m=(y,x)=>{if(this._spriteRequest=null,y)i?this._loadSprite(t):this.fire(new n.y(y));else if(x)for(let S in x)this.imageManager.addImage(S,this.scope,x[S]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))},n.bi((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),n.R.Iconset),(y,x)=>{if(y)return void m(y);let S={},A=n.cg(new n.bh(x));for(let R of A.icons){let P={version:1,pixelRatio:n.q.devicePixelRatio,content:t0(R),stretchX:R.metadata?og(R.metadata.stretch_x_areas):void 0,stretchY:R.metadata?og(R.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:R};S[R.name]=P}m(null,S)}))}_validateLayer(t){let i=this.getOwnSource(t.source);if(!i)return;let d=t.sourceLayer;d&&(i.type==="geojson"||i.vectorLayerIds&&i.vectorLayerIds.indexOf(d)===-1)&&this.fire(new n.y(new Error(`Source layer "${d}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,i)=>{let d=this.fragments[i];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){let t={};for(let i in this._sourceCaches){let d=this._sourceCaches[i].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){let i=[];for(let d of t){let m=this._layers[d];m&&m.type!=="custom"&&i.push(m.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(let t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(let t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){let i=this.getOwnLayer(t);if(i)return i;this.fire(new n.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){let i=this.getOwnSource(t);if(i)return i;this.fire(new n.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,i){let d=this.map.painter;if(d)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){let y=t.getProgramIds();if(y)for(let x of y){let S=t.getDefaultProgramParams(x,i.zoom,this._styleColorTheme.lut);S&&(d.style=this,this.fog&&(d._fogVisible=!0,S.overrideFog=!0,d.getOrCreateProgram(x,S)),d._fogVisible=!1,S.overrideFog=!1,d.getOrCreateProgram(x,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,d.getOrCreateProgram(x,S)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);let i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));let d=this._changes.isDirty(),m=!1;if(this._changes.isDirty()){let x=this._changes.getLayerUpdatesByScope();for(let S in x){let{updatedIds:A,removedIds:R}=x[S];(A||R)&&(this._updateWorkerLayers(S,A,R),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}let y={};for(let x in this._mergedSourceCaches){let S=this._mergedSourceCaches[x];y[x]=S.used,S.used=!1,S.tileCoverLift=0}for(let x of this._mergedOrder){let S=this._mergedLayers[x];if(S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)){let A=this.getLayerSourceCache(S);A&&(A.used=!0,A.tileCoverLift=Math.max(A.tileCoverLift,S.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(S,t)}):this.precompilePrograms(S,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();for(let x in y){let S=this._mergedSourceCaches[x];y[x]!==S.used&&S.getSource().fire(new n.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new n.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){let t=this._changes.getUpdatedImages();if(t.length){for(let i in this._sourceCaches)this._sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,i,d){let m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:i?m._serializeLayers(i):[],scope:t,removedIds:d||[],options:m.options})}setState(t,i){if(this._checkLoaded(),ma(this,Mi(t)))return!1;(t=n.cp(t)).layers=Hu(t.layers);let d=function(x,S){if(!x)return[{command:Qt.setStyle,args:[S]}];let A=[];try{if(!n.bn(x.version,S.version))return[{command:Qt.setStyle,args:[S]}];if(n.bn(x.center,S.center)||A.push({command:Qt.setCenter,args:[S.center]}),n.bn(x.zoom,S.zoom)||A.push({command:Qt.setZoom,args:[S.zoom]}),n.bn(x.bearing,S.bearing)||A.push({command:Qt.setBearing,args:[S.bearing]}),n.bn(x.pitch,S.pitch)||A.push({command:Qt.setPitch,args:[S.pitch]}),n.bn(x.sprite,S.sprite)||A.push({command:Qt.setSprite,args:[S.sprite]}),n.bn(x.glyphs,S.glyphs)||A.push({command:Qt.setGlyphs,args:[S.glyphs]}),n.bn(x.imports,S.imports)||function(V=[],Z=[],G){Z=Z||[];let Y=(V=V||[]).map(Zr),X=Z.map(Zr),ee=V.reduce(os,{}),se=Z.reduce(os,{}),oe=Y.slice(),fe,ce,he,le;for(fe=0,ce=0;fe<Y.length;fe++)he=Y[fe],se.hasOwnProperty(he)?ce++:(G.push({command:Qt.removeImport,args:[he]}),oe.splice(oe.indexOf(he,ce),1));for(fe=0,ce=0;fe<X.length;fe++)he=X[X.length-1-fe],oe[oe.length-1-fe]!==he&&(ee.hasOwnProperty(he)?(G.push({command:Qt.removeImport,args:[he]}),oe.splice(oe.lastIndexOf(he,oe.length-ce),1)):ce++,le=oe[oe.length-fe],G.push({command:Qt.addImport,args:[se[he],le]}),oe.splice(oe.length-fe,0,he));for(let ge of Z){let we=ee[ge.id];we&&!n.bn(we,ge)&&G.push({command:Qt.updateImport,args:[ge.id,ge]})}}(x.imports,S.imports,A),n.bn(x.transition,S.transition)||A.push({command:Qt.setTransition,args:[S.transition]}),n.bn(x.light,S.light)||A.push({command:Qt.setLight,args:[S.light]}),n.bn(x.fog,S.fog)||A.push({command:Qt.setFog,args:[S.fog]}),n.bn(x.snow,S.snow)||A.push({command:Qt.setSnow,args:[S.snow]}),n.bn(x.rain,S.rain)||A.push({command:Qt.setRain,args:[S.rain]}),n.bn(x.projection,S.projection)||A.push({command:Qt.setProjection,args:[S.projection]}),n.bn(x.lights,S.lights)||A.push({command:Qt.setLights,args:[S.lights]}),n.bn(x.camera,S.camera)||A.push({command:Qt.setCamera,args:[S.camera]}),!n.bn(x["color-theme"],S["color-theme"]))return[{command:Qt.setStyle,args:[S]}];let R={},P=[];(function(V,Z,G,Y){let X;for(X in Z=Z||{},V=V||{})V.hasOwnProperty(X)&&(Z.hasOwnProperty(X)||la(X,G,Y));for(X in Z){if(!Z.hasOwnProperty(X))continue;let ee=Z[X];V.hasOwnProperty(X)?n.bn(V[X],ee)||(V[X].type==="geojson"&&ee.type==="geojson"&&Tn(V,Z,X)?G.push({command:Qt.setGeoJSONSourceData,args:[X,ee.data]}):yt(X,Z,G,Y)):Gu(X,Z,G)}})(x.sources,S.sources,P,R);let k=[];x.layers&&x.layers.forEach(V=>{V.source&&R[V.source]?A.push({command:Qt.removeLayer,args:[V.id]}):k.push(V)});let N=x.terrain;N&&R[N.source]&&(A.push({command:Qt.setTerrain,args:[void 0]}),N=void 0),A=A.concat(P),n.bn(N,S.terrain)||A.push({command:Qt.setTerrain,args:[S.terrain]}),function(V,Z,G){Z=Z||[];let Y=(V=V||[]).map(Zr),X=Z.map(Zr),ee=V.reduce(os,{}),se=Z.reduce(os,{}),oe=Y.slice(),fe=Object.create(null),ce,he,le,ge,we,Be,Re;for(ce=0,he=0;ce<Y.length;ce++)le=Y[ce],se.hasOwnProperty(le)?he++:(G.push({command:Qt.removeLayer,args:[le]}),oe.splice(oe.indexOf(le,he),1));for(ce=0,he=0;ce<X.length;ce++)le=X[X.length-1-ce],oe[oe.length-1-ce]!==le&&(ee.hasOwnProperty(le)?(G.push({command:Qt.removeLayer,args:[le]}),oe.splice(oe.lastIndexOf(le,oe.length-he),1)):he++,Be=oe[oe.length-ce],G.push({command:Qt.addLayer,args:[se[le],Be]}),oe.splice(oe.length-ce,0,le),fe[le]=!0);for(ce=0;ce<X.length;ce++)if(le=X[ce],ge=ee[le],we=se[le],!fe[le]&&!n.bn(ge,we))if(n.bn(ge.source,we.source)&&n.bn(ge["source-layer"],we["source-layer"])&&n.bn(ge.type,we.type)){for(Re in dn(ge.layout,we.layout,G,le,null,Qt.setLayoutProperty),dn(ge.paint,we.paint,G,le,null,Qt.setPaintProperty),n.bn(ge.slot,we.slot)||G.push({command:Qt.setSlot,args:[le,we.slot]}),n.bn(ge.filter,we.filter)||G.push({command:Qt.setFilter,args:[le,we.filter]}),n.bn(ge.minzoom,we.minzoom)&&n.bn(ge.maxzoom,we.maxzoom)||G.push({command:Qt.setLayerZoomRange,args:[le,we.minzoom,we.maxzoom]}),ge)ge.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?dn(ge[Re],we[Re],G,le,Re.slice(6),Qt.setPaintProperty):n.bn(ge[Re],we[Re])||G.push({command:Qt.setLayerProperty,args:[le,Re,we[Re]]}));for(Re in we)we.hasOwnProperty(Re)&&!ge.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?dn(ge[Re],we[Re],G,le,Re.slice(6),Qt.setPaintProperty):n.bn(ge[Re],we[Re])||G.push({command:Qt.setLayerProperty,args:[le,Re,we[Re]]}))}else G.push({command:Qt.removeLayer,args:[le]}),Be=oe[oe.lastIndexOf(le)+1],G.push({command:Qt.addLayer,args:[we,Be]})}(k,S.layers,A)}catch(R){console.warn("Unable to compute style diff:",R),A=[{command:Qt.setStyle,args:[S]}]}return A}(this.serialize(),t).filter(x=>!(x.command in sg));if(d.length===0)return!1;let m=d.filter(x=>!(x.command in n0));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);let y=[];return d.forEach(x=>{y.push(this[x.command].apply(this,x.args))}),i&&Promise.all(y).then(i),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,i){return this.getImage(t)?this.fire(new n.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,i),this._afterImageUpdated(t),this)}updateImage(t,i,d=!1){this.imageManager.updateImage(t,this.scope,i),d&&this._afterImageUpdated(t)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new n.y(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new n.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,i,d={}){return this._checkLoaded(),this._validate(ac,`models.${t}`,i,null,d)||(this.modelManager.addModel(t,i,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new n.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(ns,`sources.${t}`,i,null,d))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);let m=li(t,i,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));let y=x=>{let S=(x?"symbol:":"other:")+m.id,A=n.aC(S,this.scope),R=this._sourceCaches[S]=new Xi(A,m,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=R,R.onAdd(this.map)};y(!1),i.type!=="vector"&&i.type!=="geojson"||y(!0),m.onAdd&&m.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();let i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(let m in this._layers)if(this._layers[m].source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));let d=this.getOwnSourceCaches(t);for(let m of d){let y=n.cq(m.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(m.id),m.fire(new n.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,i){this._checkLoaded(),this.getOwnSource(t).setData(i),this._changes.setDirty()}getOwnSource(t){let i=this.getOwnSourceCache(t);return i&&i.getSource()}getOwnSources(){let t=[];for(let i in this._otherSourceCaches){let d=this.getOwnSourceCache(i);d&&t.push(d.getSource())}return t}areTilesLoaded(){let t=this._mergedSourceCaches;for(let i in t){let d=t[i]._tiles;for(let m in d){let y=d[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;let i=this._getTransitionParameters();for(let m of t){if(this._validate(hl,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){let y=this.ambientLight;y.set(m),y.updateTransitions(i)}else this.ambientLight=new Ct(m,ot||(ot=new n.a5({color:new n.a6(n.a3.properties_light_ambient.color),"color-use-theme":new n.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a6(n.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let y=this.directionalLight;y.set(m),y.updateTransitions(i)}else this.directionalLight=new Ct(m,st||(st=new n.a5({direction:new n.ak(n.a3.properties_light_directional.direction),color:new n.a6(n.a3.properties_light_directional.color),"color-use-theme":new n.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a6(n.a3.properties_light_directional.intensity),"cast-shadows":new n.a6(n.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new n.a6(n.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.a6(n.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let d=new n.a8(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;let d=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),m=t.properties.get("color").toRenderColor(null).toArray01(),y=t.properties.get("intensity"),x=t.properties.get("direction"),S=1-n.cb(x.x,x.y,x.z)[2]/90,A=d(m)*y*S,R=i.properties.get("color").toRenderColor(null).toArray01(),P=i.properties.get("intensity"),k=d(R)*P;return Number(((A+k)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(n.cr(t)){let i=n.cs(t),d=this.fragments.find(({id:y})=>y===i);if(!d)throw new Error(`Style import '${t}' not found`);let m=n.cq(t);return d.style.getFragmentStyle(m)}{let i=this.fragments.find(({id:d})=>d===t);return i?i.style:void 0}}setFeaturesetSelectors(t){if(!t)return;let i={},d=(m,y="")=>`${m}::${y}`;this._featuresetSelectors={};for(let m in t){let y=this._featuresetSelectors[m]=[];for(let x of t[m].selectors){if(x.featureNamespace){let A=this.getOwnLayer(x.layer);if(!A){n.w(`Layer is undefined for selector: ${x.layer}`);continue}let R=d(A.source,A.sourceLayer);if(R in i&&i[R]!==x.featureNamespace){n.w(`"featureNamespace ${x.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}i[R]=x.featureNamespace}let S;if(x.properties)for(let A in x.properties){let R=n.U(x.properties[A]);R.result==="success"&&(S=S||{},S[A]=R.value)}y.push({layerId:x.layer,namespace:x.featureNamespace,properties:S,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(t){let i=this.getFragmentStyle(t);if(!i||!i.stylesheet.featuresets)return[];let d=[];for(let m in i.stylesheet.featuresets)d.push({featuresetId:m,importId:i.scope?i.scope:void 0});return d}getFeaturesetLayers(t,i){let d=this.getFragmentStyle(i),m=d.stylesheet.featuresets;if(!m||!m[t])return this.fire(new n.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];let y=[];for(let x of m[t].selectors){let S=d.getOwnLayer(x.layer);S&&y.push(S)}return y}getConfigProperty(t,i){let d=this.getFragmentStyle(t);if(!d)return null;let m=n.aC(i,d.scope),y=d.options.get(m),x=y?y.value||y.default:null;return x?x.serialize():null}setConfigProperty(t,i,d){let m=this.getFragmentStyle(t);if(!m)return;let y=m.stylesheet.indoor?ff(m.stylesheet.schema):m.stylesheet.schema;if(!y||!y[i])return;let x=n.U(d);if(x.result!=="success")return void ma(this,x.value);let S=x.value.expression,A=n.aC(i,m.scope),R=m.options.get(A);if(!R)return;let P,{minValue:k,maxValue:N,stepValue:V,type:Z,values:G}=y[i],Y=n.U(y[i].default);Y.result==="success"&&(P=Y.value.expression),P?(this.options.set(A,Object.assign({},R,{value:S,default:P,minValue:k,maxValue:N,stepValue:V,type:Z,values:G})),this.updateConfigDependencies(i)):this.fire(new n.y(new Error(`No schema defined for the config option "${i}" in the "${t}" fragment.`)))}getConfig(t){let i=this.getFragmentStyle(t);if(!i)return null;let d=i.stylesheet.schema;if(!d)return null;let m={};for(let y in d){let x=n.aC(y,i.scope),S=i.options.get(x),A=S?S.value||S.default:null;m[y]=A?A.serialize():null}return m}setConfig(t,i){let d=this.getFragmentStyle(t);d&&(d.updateConfig(i,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){let i=this.getFragmentStyle(t);return i?i.stylesheet.schema:null}setSchema(t,i){let d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=i,d.updateConfig(d._config,i),this.updateConfigDependencies())}updateConfig(t,i){if(this._config=t,t||i)if(i)for(let d in i){let m,y,x=n.U(i[d].default);if(x.result==="success"&&(m=x.value.expression),t&&t[d]!==void 0){let N=n.U(t[d]);N.result==="success"&&(y=N.value.expression)}let{minValue:S,maxValue:A,stepValue:R,type:P,values:k}=i[d];if(m){let N=n.aC(d,this.scope);this.options.set(N,{default:m,value:y,minValue:S,maxValue:A,stepValue:R,type:P,values:k})}else this.fire(new n.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new n.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(let i of this._configDependentLayers){let d=this.getLayer(i);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(i=>{let d=i._styleColorTheme.colorThemeOverride?i._styleColorTheme.colorThemeOverride:i._styleColorTheme.colorTheme;if(d){let m=i._evaluateColorThemeData(d);(!i._styleColorTheme.lut&&m!==""||i._styleColorTheme.lut&&m!==i._styleColorTheme.lut.data)&&i.setColorTheme(d)}}),this._changes.setDirty()}addLayer(t,i,d={}){this._checkLoaded();let m=t.id;if(this._layers[m])return void this.fire(new n.y(new Error(`Layer with id "${m}" already exists on this map`)));let y;if(t.type==="custom"){if(ma(this,n.ct(t)))return;y=n.cu(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=n.cp(t),t=n.l(t,{source:m})),this._validate(Vu,`layers.${m}`,t,{arrayIndex:-1},d))return;y=n.cu(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let x=this._order.length;if(i){let P=this._order.indexOf(i);if(P===-1)return void this.fire(new n.y(new Error(`Layer with id "${i}" does not exist on this map.`)));y.slot===this._layers[i].slot?x=P:n.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,m),this._layerOrderChanged=!0,this._layers[m]=y;let S=this.getOwnLayerSourceCache(y),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&y.canCastShadows()&&A&&(S.castsShadows=!0);let R=this._changes.getRemovedLayer(y);if(R&&y.source&&S&&y.type!=="custom"){this._changes.discardLayerRemoval(y);let P=n.aC(y.source,y.scope);R.type!==y.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),S.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();let d=this._checkLayer(t);if(!d||t===i)return;let m=this._order.indexOf(t);this._order.splice(m,1);let y=this._order.length;if(i){let x=this._order.indexOf(i);if(x===-1)return void this.fire(new n.y(new Error(`Layer with id "${i}" does not exist on this map.`)));d.slot===this._layers[i].slot?y=x:n.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();let i=this._checkLayer(t);if(!i)return;i.setEventedParent(null);let d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);let m=this.getOwnLayerSourceCache(i);if(m&&m.castsShadows){let y=!1;for(let x in this._layers)if(this._layers[x].source===i.source&&this._layers[x].canCastShadows()){y=!0;break}m.castsShadows=y}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(let i in this._layers)if(this._layers[i].type===t)return!0;return!1}setLayerZoomRange(t,i,d){this._checkLoaded();let m=this._checkLayer(t);m&&(m.minzoom===i&&m.maxzoom===d||(i!=null&&(m.minzoom=i),d!=null&&(m.maxzoom=d),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,i){this._checkLoaded();let d=this._checkLayer(t);d&&d.slot!==i&&(d.slot=i,this._updateLayer(d))}setFilter(t,i,d={}){this._checkLoaded();let m=this._checkLayer(t);if(m&&!n.bn(m.filter,i))return i==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(Dr,`layers.${m.id}.filter`,i,{layerType:m.type},d)||(m.filter=n.cp(i),this._updateLayer(m)))}getFilter(t){let i=this._checkLayer(t);if(i)return n.cp(i.filter)}setLayoutProperty(t,i,d,m={}){this._checkLoaded();let y=this._checkLayer(t);if(y&&!n.bn(y.getLayoutProperty(i),d)){if(d!=null&&(!m||m.validate!==!1)&&ma(y,ju.call(Mi,{key:`layers.${t}.layout.${i}`,layerType:y.type,objectKey:i,value:d,styleSpec:n.a3,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(i,d),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(t,i){let d=this._checkLayer(t);if(d)return d.getLayoutProperty(i)}setPaintProperty(t,i,d,m={}){this._checkLoaded();let y=this._checkLayer(t);if(!y||n.bn(y.getPaintProperty(i),d)||d!=null&&(!m||m.validate!==!1)&&ma(y,sc.call(Mi,{key:`layers.${t}.paint.${i}`,layerType:y.type,objectKey:i,value:d,styleSpec:n.a3})))return;let x=y.setPaintProperty(i,d);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),x&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,i){let d=this._checkLayer(t);if(d)return d.getPaintProperty(i)}setFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){let{featuresetId:A,importId:R}=t.target,P=this.getFragmentStyle(R),k=P.getFeaturesetLayers(A);for(let{source:N,sourceLayer:V}of k)P.setFeatureState({id:t.id,source:N,sourceLayer:V},i)}else if("layerId"in t.target){let{layerId:A}=t.target,R=this.getLayer(A);this.setFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer},i)}return}let d=t.source,m=t.sourceLayer,y=this._checkSource(d);if(!y)return;let x=y.type;if(x==="geojson"&&m)return void this.fire(new n.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!m)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided.")));let S=this.getOwnSourceCaches(d);for(let A of S)A.setFeatureState(m,t.id,i)}removeFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){let{featuresetId:A,importId:R}=t.target,P=this.getFragmentStyle(R),k=P.getFeaturesetLayers(A);for(let{source:N,sourceLayer:V}of k)P.removeFeatureState({id:t.id,source:N,sourceLayer:V},i)}else if("layerId"in t.target){let{layerId:A}=t.target,R=this.getLayer(A);this.removeFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer},i)}return}let d=t.source,m=this._checkSource(d);if(!m)return;let y=m.type,x=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!x)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.y(new Error("A feature id is required to remove its specific state property.")));let S=this.getOwnSourceCaches(d);for(let A of S)A.removeFeatureState(x,t.id,i)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let y;if("featuresetId"in t.target){let{featuresetId:x,importId:S}=t.target,A=this.getFragmentStyle(S),R=A.getFeaturesetLayers(x);for(let{source:P,sourceLayer:k}of R){let N=A.getFeatureState({id:t.id,source:P,sourceLayer:k});if(N&&!y)y=N;else if(!n.bn(y,N))return void this.fire(new n.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){let{layerId:x}=t.target,S=this.getLayer(x);y=this.getFeatureState({id:t.id,source:S.source,sourceLayer:S.sourceLayer})}return y}let i=t.source,d=t.sourceLayer,m=this._checkSource(i);if(m){if(m.type!=="vector"||d)return t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(d,t.id);this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=n.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return n.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();let t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(let i of Object.values(this._mergedLayers))t(i)&&this._updateLayer(i)}_updateLayer(t){this._changes.updateLayer(t);let i=this.getLayerSourceCache(t),d=n.aC(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[d]&&i&&i.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){let i=S=>this._mergedLayers[S].is3D(),d=this.order,m={},y=[];for(let S=d.length-1;S>=0;S--){let A=d[S];if(i(A)){m[A]=S;for(let R of t){let P=R[A];if(P)for(let k of P)y.push(k)}}}y.sort((S,A)=>A.intersectionZ-S.intersectionZ);let x=[];for(let S=d.length-1;S>=0;S--){let A=d[S];if(i(A))for(let R=y.length-1;R>=0;R--){let P=y[R].feature;if(P.layer&&m[P.layer.id]<S)break;x.push(P),y.pop()}else for(let R of t){let P=R[A];if(P)for(let k of P)x.push(k.feature)}}return x}queryRenderedFeatures(t,i,d){let m;i&&!Array.isArray(i)&&i.filter&&(this._validate(Dr,"queryRenderedFeatures.filter",i.filter,null,i),m=n.aZ(i.filter));let y={},x=P=>{if(mf.has(P.type))return;let k=this.getOwnLayerSourceCache(P),N=y[k.id]=y[k.id]||{sourceCache:k,layers:{},has3DLayers:!1};P.is3D()&&(N.has3DLayers=!0),N.layers[P.fqid]=N.layers[P.fqid]||{styleLayer:P,targets:[]},N.layers[P.fqid].targets.push({filter:m})};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new n.y(new Error("parameters.layers must be an Array."))),[];for(let P of i.layers){let k=this._layers[P];if(!k)return this.fire(new n.y(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];x(k)}}else for(let P in this._layers)x(this._layers[P]);let S=this._queryRenderedFeatures(t,y,d),A=this._flattenAndSortRenderedFeatures(S),R=[];for(let P of A)n.cs(P.layer.id)===this.scope&&R.push(P);return R}queryRenderedFeatureset(t,i,d){let m;i&&!Array.isArray(i)&&i.filter&&(this._validate(Dr,"queryRenderedFeatures.filter",i.filter,null,i),m=n.aZ(i.filter));let y="mock",x=[];if(i&&i.target)x.push(Object.assign({},i,{targetId:y,filter:m}));else{let P=this.getFeaturesetDescriptors();for(let k of P)x.push({targetId:y,filter:m,target:k});for(let{style:k}of this.fragments){let N=k.getFeaturesetDescriptors();for(let V of N)x.push({targetId:y,filter:m,target:V})}}let S=this.queryRenderedTargets(t,x,d),A=[],R=new Set;for(let P of S)for(let k of P.variants[y])rs(k,P,R)||A.push(new n.cw(P,k));return A}queryRenderedTargets(t,i,d){let m={},y=(S,A,R,P)=>{let k=m[A.id]=m[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(k.layers[S.fqid]=k.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D()&&(k.has3DLayers=!0),!P)return R.uniqueFeatureID=!1,void k.layers[S.fqid].targets.push(R);k.layers[S.fqid].targets.push(Object.assign({},R,{namespace:P.namespace,properties:P.properties,uniqueFeatureID:P.uniqueFeatureID}))};for(let S of i)if("featuresetId"in S.target){let{featuresetId:A,importId:R}=S.target,P=this.getFragmentStyle(R);if(!P||!P._featuresetSelectors)continue;let k=P._featuresetSelectors[A];if(!k){this.fire(new n.y(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(let N of k){let V=P.getOwnLayer(N.layerId);V&&!mf.has(V.type)&&y(V,P.getOwnLayerSourceCache(V),S,N)}}else if("layerId"in S.target){let{layerId:A}=S.target,R=this.getLayer(A);if(!R||mf.has(R.type))continue;y(R,this.getLayerSourceCache(R),S)}let x=this._queryRenderedFeatures(t,m,d);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(t,i,d){let m=[],y=!!this.map._showQueryGeometry,x=Dt.createFromScreenPoints(t,d);for(let S in i){let A=cc(x,i[S],this._availableImages,d,y);Object.keys(A).length&&m.push(A)}if(this.placement)for(let S in i){if(!i[S].sourceCache._onlySymbols)continue;let A=Wd(x.screenGeometry,i[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(A).length&&m.push(A)}return m}querySourceFeatures(t,i){let d=i&&i.filter;d&&this._validate(Dr,"querySourceFeatures.filter",d,null,i);let m=[],y=this.getOwnSourceCaches(t);for(let x of y)m=m.concat(eg(x,i));return m}addSourceType(t,i,d){return Ki.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(Ki.setSourceType(t,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:i.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,d={}){this._checkLoaded();let m=this.light.getLight(),y=!1;for(let S in t)if(!n.bn(t[S],m[S])){y=!0;break}if(!y)return;let x=this._getTransitionParameters();this.light.setLight(t,i,d),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,i=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),i===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t,m=t.source==null;if(i===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){let S="terrain-dem-src";this.addSource(S,d.source),d=n.cp(d),d=n.l(d,{source:S})}let y=n.l({},d),x={};if(this.terrain&&m){y.source=this.terrain.get().source;let S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(x.style=S.serialize())}if(this._validate(dl,"terrain",y,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&i!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,i),this.fire(new n.z("data",{dataType:"style"}))}else{let y=this.terrain,x=y.get();for(let S of Object.keys(n.a3.terrain))!d.hasOwnProperty(S)&&n.a3.terrain[S].default&&(d[S]=n.a3.terrain[S].default);for(let S in t)if(!n.bn(t[S],x[S])){y.set(t,this.options),this.stylesheet.terrain=t;let A=this._getTransitionParameters({duration:0});y.updateTransitions(A),this.fire(new n.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){let i=this.fog=new Oe(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=i.get();let d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}_createSnow(t){let i=this.snow=new Tt(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=i.get();let d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}_createRain(t){let i=this.rain=new Mt(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=i.get();let d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let i=this.fog;if(!n.bn(i.get(),t)){i.set(t,this.options),this.stylesheet.fog=i.get();let d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){let i=this.snow;if(!n.bn(i.get(),t)){i.set(t,this.options),this.stylesheet.snow=i.get();let d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){let i=this.rain;if(!n.bn(i.get(),t)){i.set(t,this.options),this.stylesheet.rain=i.get();let d=this._getTransitionParameters({duration:0});i.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){let t=()=>{for(let m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(let m in this._sourceCaches)this._sourceCaches[m].clearTiles()},i=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!i)return this._styleColorTheme.lut=null,void t();let d=this._evaluateColorThemeData(i);this._loadColorTheme(d).then(()=>{this.fire(new n.z("colorthemeset")),t()}).catch(m=>{n.w(`Couldn't set color theme: ${m}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,i){let d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=i,d._reloadColorTheme())}_getTransitionParameters(t){return{now:n.q.now(),transition:n.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;let t=[],i=[];for(let d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):i.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...i)}_createTerrain(t,i){let d=this.terrain=new J(t,i,this.scope,this.options);i===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let m=this._getTransitionParameters({duration:0});d.updateTransitions(m)}_force3DLayerUpdate(){for(let t in this._layers){let i=this._layers[t];i.type==="fill-extrusion"&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(let t in this._layers){let i=this._layers[t];i.type==="symbol"&&this._updateLayer(i)}}_validate(t,i,d,m,y={}){if(y&&y.validate===!1)return!1;let x=n.l({},this.serialize());return ma(this,t.call(Mi,n.l({key:i,style:x,value:d,styleSpec:n.a3},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(let t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){let i=this.getSourceCaches(t);for(let d of i)d.clearTiles()}clearSources(){for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){let i=this.getSourceCaches(t);for(let d of i)d.resume(),d.reload()}reloadSources(){for(let t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let i;this.directionalLight&&(i=pa(this.directionalLight));for(let d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(t,void 0,void 0,i)}_generateCollisionBoxes(){for(let t in this._sourceCaches){let i=this._sourceCaches[t];i.resume(),i.reload()}}_updatePlacement(t,i,d,m,y,x,S=!1){let A=!1,R=!1,P={},k={};for(let N of this._mergedOrder){let V=this._mergedLayers[N];if(V.type!=="symbol")continue;let Z=n.aC(V.source,V.scope),G=P[Z];if(!G){let X=this.getLayerSourceCache(V);if(!X)continue;let ee=X.getRenderableIds(!0).map(se=>X.getTileByID(se));k[Z]=ee.slice(),G=P[Z]=ee.sort((se,oe)=>oe.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(oe.tileID)?-1:1))}let Y=this.crossTileSymbolIndex.addLayer(V,G,i.center.lng,i.projection);A=A||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new n.z("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),i.zoom))&&(this.pauseablePlacement=new Yv(i,this._mergedOrder,S,d,m,y,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,P,k,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),R=!0),A&&this.pauseablePlacement.placement.setStale()),R||A){this._buildingIndex.onNewFrame(i.zoom);for(let N=0;N<this._mergedOrder.length;N++){let V=this._mergedLayers[this._mergedOrder[N]];if(V.type!=="symbol")continue;let Z=this.isLayerClipped(V);this.placement.updateLayerOpacities(V,P[n.aC(V.source,V.scope)],N,Z?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(let t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,i){this._checkLoaded();let d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:y})=>y===t.id)!==-1)return void this.fire(new n.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!i)return d.push(t),this._loadImports([t],!0);let m=d.findIndex(({id:y})=>y===i);return m===-1&&this.fire(new n.y(new Error(`Import with id "${i}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,m).concat(t).concat(d.slice(m)),this._loadImports([t],!0,i)}updateImport(t,i){this._checkLoaded();let d=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof i=="string"?(this.setImportUrl(t,i),this):(i.url&&i.url!==d[m].url&&this.setImportUrl(t,i.url),n.bn(i.config,d[m].config)||this.setImportConfig(t,i.config,i.data.schema),n.bn(i.data,d[m].data)||this.setImportData(t,i.data),this)}moveImport(t,i){this._checkLoaded();let d=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;let y=this.getImportIndex(i);if(y===-1)return this;let x=d[m],S=this.fragments[m];return d=d.filter(({id:A})=>A!==t),this.fragments=this.fragments.filter(({id:A})=>A!==t),this.stylesheet.imports=d.slice(0,y).concat(x).concat(d.slice(y)),this.fragments=this.fragments.slice(0,y).concat(S).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,i){this._checkLoaded();let d=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;d[m].url=i;let y=this.fragments[m];return y.style=this._createFragmentStyle(d[m]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(i),this}setImportData(t,i){this._checkLoaded();let d=this.getImportIndex(t),m=this.stylesheet.imports||[];return d===-1?this:i?(this.fragments[d].style.setState(i),this._reloadImports(),this):(delete m[d].data,this.setImportUrl(t,m[d].url))}setImportConfig(t,i,d){this._checkLoaded();let m=this.getImportIndex(t),y=this.stylesheet.imports||[];if(m===-1)return this;i?y[m].config=i:delete y[m].config;let x=this.fragments[m];d&&x.style.stylesheet&&(x.style.stylesheet.schema=d);let S=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=i,x.style.updateConfig(i,S),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();let i=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(i.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){let i=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return i===-1&&this.fire(new n.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){let t=[];for(let i in this._mergedOtherSourceCaches){let d=this._mergedOtherSourceCaches[i];d&&t.push(d.getSource())}return t}getSource(t,i){let d=this.getSourceCache(t,i);return d&&d.getSource()}getLayerSource(t){let i=this.getLayerSourceCache(t);return i&&i.getSource()}getSourceCache(t,i){let d=n.aC(t,i);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){let i=n.aC(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);let i=[];return this._mergedOtherSourceCaches[t]&&i.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&i.push(this._mergedSymbolSourceCaches[t]),i}updateSourceCaches(){let t=this._changes.getUpdatedSourceCaches();for(let i in t){let d=t[i];d==="reload"?this.reloadSource(i):d==="clear"&&this.clearSource(i)}}updateLayers(t){let i=this._changes.getUpdatedPaintProperties();for(let d of i){let m=this.getLayer(d);m&&m.updateTransitions(t)}}getImages(t,i,d){this.imageManager.getImages(i.icons,i.scope,d),this._updateTilesForChangedImages();let m=y=>{y&&y.setDependencies(i.tileID.key,i.type,i.icons)};m(this._otherSourceCaches[i.source]),m(this._symbolSourceCaches[i.source])}rasterizeImages(t,i,d){this.imageManager.rasterizeImages(i,d)}getGlyphs(t,i,d){this.glyphManager.getGlyphs(i.stacks,i.scope,d)}getResource(t,i,d){return n.cy(i,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){let i=[];return this._otherSourceCaches[t]&&i.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&i.push(this._symbolSourceCaches[t]),i}_isSourceCacheLoaded(t){let i=this.getOwnSourceCaches(t);return i.length===0?(this.fire(new n.y(new Error(`There is no source with ID '${t}'`))),!1):i.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,i){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;let d=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(d||i&&i.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ki.getSourceType=function(u){return Ar[u]},Ki.setSourceType=function(u,t){Ar[u]=t},Ki.registerForPluginStateChange=n.ch;var Qu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,wc=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,eh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,zs="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",th=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,gf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ga=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,_l=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ec=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Tc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,_a=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let ya=[];va(Qu,ya),va(eh,ya),va(wc,ya);let yl={"_prelude_fog.vertex.glsl":gf,"_prelude_terrain.vertex.glsl":th,"_prelude_shadow.vertex.glsl":Tc,"_prelude_fog.fragment.glsl":ga,"_prelude_shadow.fragment.glsl":_a,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":_l,"_prelude_raster_particle.glsl":Ec},Ic={};cn("",th),cn(ga,gf),cn(_a,Tc),cn(_l,""),cn(Ec,"");let nh=cn(wc,eh),Sc=Qu;var vl={background:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:cn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:cn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:cn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:cn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:cn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:cn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:cn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:cn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:cn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:cn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:cn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:cn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:cn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:cn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:cn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,zs),skyboxGradient:cn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,zs),skyboxCapture:cn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:cn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:cn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:cn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:cn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:cn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:cn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:cn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function va(u,t){let i=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of i)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let m=d.split(" ");for(let y of m)t.includes(y)||t.push(y)}}function cn(u,t){let i=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,m=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(R=>{let P=R.split(" ");return P[P.length-1]}),m=[...new Set(m)]);let y={},x=[],S=[];if(u=u.replace(i,(R,P)=>(S.push(P),"")),(t=t.replace(i,(R,P)=>(x.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...ya];va(u,A),va(t,A);for(let R of[...x,...S])yl[R]||console.error(`Undefined include: ${R}`),Ic[R]||(Ic[R]=[],va(yl[R],Ic[R])),A=[...A,...Ic[R]];return{fragmentSource:u=u.replace(d,(R,P,k,N,V)=>(y[V]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${k} ${N} ${V};
#else
uniform ${k} ${N} u_${V};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${k} ${N} ${V} = u_${V};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${k} ${N} ${V};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(d,(R,P,k,N,V)=>{let Z=N==="float"?"vec2":N,G=V.match(/color/)?"color":Z;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${k} ${N} a_${V};
#endif
`:y[V]?P==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${k} ${Z} a_${V};
out ${k} ${N} ${V};
#else
uniform ${k} ${N} u_${V};
#endif
`:P==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${k} ${N} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${G}(a_${V}, u_${V}_t);
#else
    ${k} ${N} ${V} = u_${V};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${k} ${N} a_${V};
    out ${k} ${N} ${V};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${k} ${Z} a_${V};
#else
uniform ${k} ${N} u_${V};
#endif
`:P==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${k} ${N} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${Z} a_${V};
#else
uniform ${k} ${N} u_${V};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${k} ${N} ${V} = a_${V};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${k} ${N} ${V} = a_${V};
#else
    ${k} ${N} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${k} ${N} ${V} = unpack_mix_${G}(a_${V}, u_${V}_t);
#else
    ${k} ${N} ${V} = u_${V};
#endif
`}),staticAttributes:m,usedDefines:A,vertexIncludes:x,fragmentIncludes:S}}class lg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,i,d,m,y,x,S,A){this.context=t;let R=this.boundPaintVertexBuffers.length!==m.length;for(let k=0;!R&&k<m.length;k++)this.boundPaintVertexBuffers[k]!==m[k]&&(R=!0);let P=this.boundDynamicVertexBuffers.length!==S.length;for(let k=0;!P&&k<S.length;k++)this.boundDynamicVertexBuffers[k]!==S[k]&&(P=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==d||R||P||this.boundIndexBuffer!==y||this.boundVertexOffset!==x)this.freshBind(i,d,m,y,x,S,A);else{t.bindVertexArrayOES.set(this.vao);for(let k of S)k&&(k.bind(),A&&k.instanceCount&&k.setVertexAttribDivisor(t.gl,i,A));y&&y.dynamicDraw&&y.bind()}}freshBind(t,i,d,m,y,x,S){let A=t.numAttributes,R=this.context,P=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=x,i.enableAttributes(P,t),i.bind(),i.setVertexAttribPointers(P,t,y);for(let k of d)k.enableAttributes(P,t),k.bind(),k.setVertexAttribPointers(P,t,y);for(let k of x)k&&(k.enableAttributes(P,t),k.bind(),k.setVertexAttribPointers(P,t,y),S&&k.instanceCount&&k.setVertexAttribDivisor(P,t,S));m&&m.bind(),R.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function xl(u,t){let i=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new n.aa(0,d/i).toLngLat().lat,new n.aa(0,(d+1)/i).toLngLat().lat]}function cg(u,t,i,d,m,y,x){let S=u.context,A=S.gl,R=i.hillshadeFBO;if(!R)return;u.prepareDrawTile();let P=u.isTileAffectedByFog(t),k=u.getOrCreateProgram("hillshade",{overrideFog:P});S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get());let N=((Y,X,ee,se)=>{let oe=ee.paint.get("hillshade-shadow-color"),fe=ee.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ce=ee.paint.get("hillshade-highlight-color"),he=ee.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",le=ee.paint.get("hillshade-accent-color"),ge=ee.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",we=ee.paint.get("hillshade-emissive-strength"),Be=n.ai(ee.paint.get("hillshade-illumination-direction"));if(ee.paint.get("hillshade-illumination-anchor")==="viewport")Be-=Y.transform.angle;else if(Y.style&&Y.style.enable3dLights()&&Y.style.directionalLight){let Ge=Y.style.directionalLight.properties.get("direction"),He=n.cb(Ge.x,Ge.y,Ge.z);Be=n.ai(He[1])}let Re=!Y.options.moving;return{u_matrix:se||Y.transform.calculateProjMatrix(X.tileID.toUnwrapped(),Re),u_image:0,u_latrange:xl(0,X.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),Be],u_shadow:oe.toRenderColor(fe?null:ee.lut),u_highlight:ce.toRenderColor(he?null:ee.lut),u_emissive_strength:we,u_accent:le.toRenderColor(ge?null:ee.lut)}})(u,i,d,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(S,k,t.toUnwrapped());let{tileBoundsBuffer:V,tileBoundsIndexBuffer:Z,tileBoundsSegments:G}=u.getTileBoundsBuffers(i);k.draw(u,A.TRIANGLES,m,y,x,kt.disabled,N,d.id,V,Z,G)}function ug(u,t,i){if(!t.needsDEMTextureUpload)return;let d=u.context,m=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(i.stride);let y=i.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new n.T(d,y,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function r0(u,t,i){let d=u.context,m=d.gl;if(!t.dem)return;let y=t.dem;if(d.activeTexture.set(m.TEXTURE1),ug(u,t,y),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);let x=y.dim;d.activeTexture.set(m.TEXTURE0);let S=t.hillshadeFBO;if(!S){let N=new n.T(d,{width:x,height:x,data:null},m.RGBA8);N.bind(m.LINEAR,m.CLAMP_TO_EDGE),S=t.hillshadeFBO=d.createFramebuffer(x,x,!0,"renderbuffer"),S.colorAttachment.set(N.texture)}d.bindFramebuffer.set(S.framebuffer),d.viewport.set([0,0,x,x]);let{tileBoundsBuffer:A,tileBoundsIndexBuffer:R,tileBoundsSegments:P}=u.getMercatorTileBoundsBuffers(),k=[];u.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(u,m.TRIANGLES,It.disabled,Ot.disabled,Jt.unblended,kt.disabled,((N,V)=>{let Z=V.stride,G=n.ab.mat4.create();return n.ab.mat4.ortho(G,0,n.ag,-n.ag,0,0,1),n.ab.mat4.translate(G,G,[0,-n.ag,0]),{u_matrix:G,u_image:1,u_dimension:[Z,Z],u_zoom:N.overscaledZ}})(t.tileID,y),i.id,A,R,P),t.needsHillshadePrepare=!1}class Xn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _f extends Xn{getDefault(){return n.aj.transparent}set(t){let i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class yf extends Xn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class vf extends Xn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class xf extends Xn{getDefault(){return[!0,!0,!0,!0]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hg extends Xn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class dg extends Xn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class i0 extends Xn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let i=this.current;(t.func!==i.func||t.ref!==i.ref||t.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Dc extends Xn{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Mc extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=t,this.dirty=!1}}class fg extends Xn{getDefault(){return[0,1]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ci extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=t,this.dirty=!1}}class bf extends Xn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class rh extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.BLEND):i.disable(i.BLEND),this.current=t,this.dirty=!1}}class ih extends Xn{getDefault(){let t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class wf extends Xn{getDefault(){return n.aj.transparent}set(t){let i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ef extends Xn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class oh extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=t,this.dirty=!1}}class Tf extends Xn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class If extends Xn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let sh=class extends Xn{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class pg extends Xn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class mg extends Xn{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class bl extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class o0 extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class s0 extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindTexture(i.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class a0 extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class l0 extends Xn{getDefault(){return null}set(t){let i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class c0 extends Xn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class u0 extends Xn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Sf extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Df extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ah extends Xn{constructor(t,i){super(t),this.context=t,this.parent=i}getDefault(){return null}}class wl extends ah{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Mf extends ah{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class gg extends ah{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _g extends Mf{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let Cf=(u,t,i)=>({u_matrix:u,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),Bs=(u,t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:i,u_zoom_transition:m,u_merc_center:y,u_image0:0,u_frustum_tl:x,u_frustum_tr:S,u_frustum_br:A,u_frustum_bl:R,u_globe_pos:P,u_globe_radius:k,u_viewport:N,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:Z});function Af(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}let zi=new class{constructor(){this.operations={}}newMorphing(u,t,i,d,m){if(u in this.operations){let y=this.operations[u];y.to.tileID.key!==i.tileID.key&&(y.queued=i)}else this.operations[u]={startTime:d,phase:0,duration:m,from:t,to:i,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;let t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(let t in this.operations){let i=this.operations[t];for(i.phase=(u-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},lh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Cc(u,t,i){if(t===0)return 0;let d=t<1&&i===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*d}function yg(u,t){let i=1<<u.z;return!t&&(u.x===0||u.x===i-1)||u.y===0||u.y===i-1}let ch=u=>({u_matrix:u});function Ac(u,t,i,d,m){if(m>0){let y=n.q.now(),x=(y-u.timeAdded)/m,S=t?(y-t.timeAdded)/m:-1,A=i.getSource(),R=d.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),P=!t||Math.abs(t.tileID.overscaledZ-R)>Math.abs(u.tileID.overscaledZ-R),k=P&&u.refreshedUponExpiration?1:n.aw(P?x:1-S,0,1);return u.refreshedUponExpiration&&x>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class Rf extends Xi{constructor(t){let i={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new n.D(n.ci(),null),m=li("mock-dem",i,d,t.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,i){t.state="loaded",i(null)}}class h0 extends Xi{constructor(t){let i=li("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new n.D(n.ci(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,d){if(t.freezeTileCoverage)return;this.transform=t;let m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,x)=>{if(y[x.key]="",!this._tiles[x.key]){let S=new Ls(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);S.state="loaded",this._tiles[x.key]=S}return y},{});for(let y in this._tiles)y in m||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){let i=this.proxyCachedFBO[t];if(i!==void 0){let d=Object.values(i);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Pf extends n.aG{constructor(t,i,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=i,this.projMatrix=d}}class El extends n.cJ{constructor(t,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[d,m,y]=function(A){let R=new n.b4,P=new n.aU,k=131;R.reserve(17161),P.reserve(33800);let N=n.ag/128,V=n.ag+N/2,Z=V+N;for(let Y=-N;Y<Z;Y+=N)for(let X=-N;X<Z;X+=N){let ee=X<0||X>V||Y<0||Y>V?24575:0,se=n.aw(Math.round(X),0,n.ag),oe=n.aw(Math.round(Y),0,n.ag);R.emplaceBack(se+ee,oe)}let G=(Y,X)=>{let ee=X*k+Y;P.emplaceBack(ee+1,ee,ee+k),P.emplaceBack(ee+k,ee+k+1,ee+1)};for(let Y=1;Y<129;Y++)for(let X=1;X<129;X++)G(X,Y);return[0,129].forEach(Y=>{for(let X=0;X<130;X++)G(X,Y),G(Y,X)}),[R,P,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(d,n.b6.members),this.gridIndexBuffer=x.createIndexBuffer(m),this.gridSegments=n.b7.simpleSegment(0,0,d.length,m.length),this.gridNoSkirtSegments=n.b7.simpleSegment(0,0,d.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new h0(i.map),this.orthoMatrix=n.ab.mat4.create(),n.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.ag,0,n.ag,0,1);let S=x.gl;this._overlapStencilMode=new Ot({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Rf(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,i,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);let m=t.terrain.properties,y=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();let S=t.terrain&&t.terrain.scope,A=m.get("source"),R=y?this._mockSourceCache:t.getSourceCache(A,S);if(!R)return void n.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=R,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(i):m.get("exaggeration"),!i.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;let P=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let k=this.getScaledDemTileSize();this.sourceCache.update(i,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),i.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);let i=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;let m=i!=null?d-i:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;let y=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(y);let S=y-this._previousZoom,A=this._previousUpdateTimestamp,R=y;this._evaluationZoom!=null&&(R=this._evaluationZoom,Math.abs(y-R)>.5&&(S=.5*(y-R+S)),S*m<0&&(R+=S)),this._evaluationZoom=R;let P=x.getExaggeration(R),k=P===x.getExaggeration(Math.max(0,R-.1));if(k&&Math.abs(P-this._exaggeration)<.01)return P;let N=Math.min(.1,.00375*(this._updateTimestamp-A));return(k||P<.1||Math.abs(S)<1e-4)&&(N=Math.min(.2,4*N)),n.af(this._exaggeration,P,N)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let i=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(n.aa.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let m=this.proxyCoords=i.getIds().map(A=>{let R=i.getTileByID(A).tileID;return R.projMatrix=d.calculateProjMatrix(R.toUnwrapped()),R});(function(A,R){let P=R.transform.pointCoordinate(R.transform.getCameraPoint()),k=new n.P(P.x,P.y);A.sort((N,V)=>{if(V.overscaledZ-N.overscaledZ)return V.overscaledZ-N.overscaledZ;let Z=new n.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),G=new n.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),Y=k.mult(1<<N.canonical.z);return Y.x-=.5,Y.y-=.5,Y.distSqr(Z)-Y.distSqr(G)})})(m,this.painter);let y=this.proxyToSource||{};this.proxyToSource={},m.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};let x=this._style._mergedSourceCaches;for(let A in x){let R=x[A];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,t[A],y),R.usedForTerrain))continue;let P=t[A];R.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[i.id]=m.map(A=>new Pf(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;let S={};this._visibleDemTiles=[];for(let A of this.proxyCoords){let R=this.terrainTileForTile[A.key];if(!R)continue;let P=R.tileID.key;P in S||(this._visibleDemTiles.push(R),S[P]=P)}}_assignTerrainTiles(t){this._initializing||t.forEach(i=>{if(this.terrainTileForTile[i.key])return;let d=this._findTileCoveringTileID(i,this.sourceCache);d&&(this.terrainTileForTile[i.key]=d)})}_prepareDEMTextures(){let t=this.painter.context,i=t.gl;for(let d in this.terrainTileForTile){let m=this.terrainTileForTile[d],y=m.dem;!y||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(i.TEXTURE1),ug(this.painter,m,y))}}_prepareDemTileUniforms(t,i,d,m){if(!i||i.demTexture==null)return!1;let y=t.tileID.canonical,x=Math.pow(2,i.tileID.canonical.z-y.z),S=m||"";return d[`u_dem_tl${S}`]=[y.x*x%1,y.y*x%1],d[`u_dem_scale${S}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0,i=this._visibleDemTiles.reduce((d,m)=>{if(!m.dem)return d;let y=m.dem.tree.minimums[0];return y>0&&t++,d+y},0);return t?i/t:0}_updateEmptyDEMTexture(){let t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);let d=this._getLoadedAreaMinimum(),m=new n.cK({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(m,{premultiply:!1}):y=this._emptyDEMTexture=new n.T(t,m,i.R32F,{premultiply:!1}),y}setupElevationDraw(t,i,d){let m=this.painter.context,y=m.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let S=null,A=null,R=1;if(d&&d.morphing&&this._useVertexMorphing){let V=d.morphing.srcDemTile,Z=d.morphing.dstDemTile;R=d.morphing.phase,V&&Z&&(this._prepareDemTileUniforms(t,V,x,"_prev")&&(A=V),this._prepareDemTileUniforms(t,Z,x)&&(S=Z))}let P=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST,k=null;var N;if(this.enabled?A&&S?(k=S.demTexture,m.activeTexture.set(y.TEXTURE4),A.demTexture.bind(P(A),y.CLAMP_TO_EDGE),x.u_dem_lerp=R):(S=this.terrainTileForTile[t.tileID.key],k=this._prepareDemTileUniforms(t,S,x)?S.demTexture:this.emptyDEMTexture):k=this.emptyDEMTexture,m.activeTexture.set(y.TEXTURE2),k&&(x.u_dem_size=(N=k).size[0]===1?1:N.size[0]-2,k.bind(P(S),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,i,x),d&&d.useMeterToDem&&S){let V=(1<<S.tileID.canonical.z)*n.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=V}if(d&&d.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),i.setTerrainUniformValues(m,x),this.painter.transform.projection.name==="globe"){let V=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);i.setGlobeUniformValues(m,V)}}globeUniformValues(t,i,d){let m=t.projection;return{u_tile_tl_up:m.upVector(i,0,0),u_tile_tr_up:m.upVector(i,n.ag,0),u_tile_br_up:m.upVector(i,n.ag,n.ag),u_tile_bl_up:m.upVector(i,0,n.ag),u_tile_up_scale:d?n.cL(1):m.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){let i=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,y,x,S,A){if(m.transform.projection.name==="globe")(function(R,P,k,N,V){let Z=R.context,G=Z.gl,Y,X,ee=R.transform,se=n.cC(R,Z,ee),oe=(Ge,He)=>{if(X===He)return;let Me=[lh[He],"PROJECTION_GLOBE_VIEW"];se&&Me.push("CUSTOM_ANTIALIASING");let Ve=R.isTileAffectedByFog(Ge);Y=R.getOrCreateProgram("globeRaster",{defines:Me,overrideFog:Ve}),X=He},fe=R.colorModeForRenderPass(),ce=new It(G.LEQUAL,It.ReadWrite,R.depthRangeFor3D);zi.update(V);let he=n.cD(ee),le=[n.at(ee.center.lng),n.aA(ee.center.lat)],ge=R.globeSharedBuffers,we=[ee.width*n.q.devicePixelRatio,ee.height*n.q.devicePixelRatio],Be=Float32Array.from(ee.globeMatrix),Re={useDenormalizedUpVectorScale:!0};{let Ge=R.transform,He=Cc(Ge.zoom,P.exaggeration(),P.sourceCache._source.tileSize);X=-1;let Me=G.TRIANGLES;for(let Ve of N){let Qe=k.getTile(Ve),De=Ot.disabled,We=P.prevTerrainTileForTile[Ve.key],je=P.terrainTileForTile[Ve.key];Af(We,je)&&zi.newMorphing(Ve.key,We,je,V,250),Z.activeTexture.set(G.TEXTURE0),Qe.texture&&Qe.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let it=zi.getMorphValuesForProxy(Ve.key),Ye=it?1:0;it&&n.J(Re,{morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:n.cB(it.phase)}});let qe=n.cE(Ve.canonical),et=n.cF(qe.getCenter().lat),rt=n.cG(Ve.canonical,qe,et,Ge.worldSize/Ge._pixelsPerMercatorPixel),dt=n.bb(n.cH(Ve.canonical)),gt=Bs(Ge.expandedFarZProjMatrix,Be,he,dt,n.ae(Ge.zoom),le,Ge.frustumCorners.TL,Ge.frustumCorners.TR,Ge.frustumCorners.BR,Ge.frustumCorners.BL,Ge.globeCenterInViewSpace,Ge.globeRadius,we,He,Ge._farZ,rt);if(oe(Ve,Ye),Y&&(P.setupElevationDraw(Qe,Y,Re),R.uploadCommonUniforms(Z,Y,Ve.toUnwrapped()),ge)){let[Pt,Et,St]=ge.getGridBuffers(et,He!==0);Y.draw(R,Me,ce,De,fe,kt.backCCW,gt,"globe_raster",Pt,Et,St)}}}if(ge&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){let Ge=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];se&&Ge.push("CUSTOM_ANTIALIASING"),Y=R.getOrCreateProgram("globeRaster",{defines:Ge});for(let He of N){let{x:Me,y:Ve,z:Qe}=He.canonical,De=Ve===0,We=Ve===(1<<Qe)-1,[je,it,Ye,qe]=ge.getPoleBuffers(Qe,!1);if(qe&&(De||We)){let et=k.getTile(He);Z.activeTexture.set(G.TEXTURE0),et.texture&&et.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let rt=n.cI(Qe,Me,ee),dt=n.bb(n.cH(He.canonical)),gt=(Pt,Et)=>Pt.draw(R,G.TRIANGLES,ce,Ot.disabled,fe,kt.disabled,Bs(ee.expandedFarZProjMatrix,rt,rt,dt,0,le,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,we,0,ee._farZ),"globe_pole_raster",Et,Ye,qe);P.setupElevationDraw(et,Y,Re),R.uploadCommonUniforms(Z,Y,He.toUnwrapped()),De&&R.renderDefaultNorthPole&&gt(Y,je),We&&R.renderDefaultSouthPole&&(rt=n.ab.mat4.scale(n.ab.mat4.create(),rt,[1,-1,1]),gt(Y,it))}}}})(m,y,x,S,A);else{let R=m.context,P=R.gl,k,N,V=m.shadowRenderer,Z=Ns(m,m.longestCutoffRange),G=fe=>{if(N===fe)return;let ce=[];ce.push(lh[fe]),Z.shouldRenderCutoff&&ce.push("RENDER_CUTOFF"),V&&(ce.push("RENDER_SHADOWS","DEPTH_TEXTURE"),V.useNormalOffset&&ce.push("NORMAL_OFFSET")),k=m.getOrCreateProgram("terrainRaster",{defines:ce}),N=fe},Y=m.colorModeForRenderPass(),X=new It(P.LEQUAL,It.ReadWrite,m.depthRangeFor3D);zi.update(A);let ee=m.transform,se=Cc(ee.zoom,y.exaggeration(),y.sourceCache._source.tileSize),oe=[0,0,0];if(V){let fe=m.style.directionalLight,ce=m.style.ambientLight;fe&&ce&&(oe=hf(m.style,fe,ce))}{N=-1;let fe=P.TRIANGLES,[ce,he]=[y.gridIndexBuffer,y.gridSegments];for(let le of S){let ge=x.getTile(le),we=Ot.disabled,Be=y.prevTerrainTileForTile[le.key],Re=y.terrainTileForTile[le.key];Af(Be,Re)&&zi.newMorphing(le.key,Be,Re,A,250),R.activeTexture.set(P.TEXTURE0),ge.texture&&ge.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let Ge=zi.getMorphValuesForProxy(le.key),He=Ge?1:0,Me;Ge&&(Me={morphing:{srcDemTile:Ge.from,dstDemTile:Ge.to,phase:n.cB(Ge.phase)}});let Ve=Cf(le.projMatrix,yg(le.canonical,ee.renderWorldCopies)?se/10:se,oe);if(G(He),!k)continue;y.setupElevationDraw(ge,k,Me);let Qe=le.toUnwrapped();V&&V.setupShadows(Qe,k),m.uploadCommonUniforms(R,k,Qe,null,Z),k.draw(m,fe,X,we,Y,kt.backCCW,Ve,"terrain_raster",y.gridBuffer,ce,he)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;let i=this.painter,d=this.painter.context,m=this.proxySourceCache,y=this.proxiedCoords[m.id],x=this._drapedRenderBatches.shift(),S=i.style.order,A=[],R=0;for(let P of y){let k=m.getTileByID(P.proxyTileKey),N=m.proxyCachedFBO[P.key]?m.proxyCachedFBO[P.key][t]:void 0,V=N!==void 0?m.renderCache[N]:this.pool[R++],Z=N!==void 0;if(k.texture=V.tex,Z&&!V.dirty){A.push(k.tileID);continue}let G;d.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(d.clear({color:n.aj.transparent,stencil:0}),V.dirty=!1);for(let Y=x.start;Y<=x.end;++Y){let X=i.style._mergedLayers[S[Y]];if(X.isHidden(i.transform.zoom))continue;let ee=i.style.getLayerSourceCache(X),se=ee?this.proxyToSource[P.key][ee.id]:[P];if(!se)continue;let oe=se;d.viewport.set([0,0,V.fb.width,V.fb.height]),G!==(ee?ee.id:null)&&(this._setupStencil(V,se,X,ee),G=ee?ee.id:null),i.renderLayer(i,ee,X,oe)}if(this._drapedRenderBatches.length===0)for(let Y of this._pendingGroundEffectLayers){let X=i.style._mergedLayers[S[Y]];if(X.isHidden(i.transform.zoom))continue;let ee=i.style.getLayerSourceCache(X),se=ee?this.proxyToSource[P.key][ee.id]:[P];if(!se)continue;let oe=se;d.viewport.set([0,0,V.fb.width,V.fb.height]),G!==(ee?ee.id:null)&&(this._setupStencil(V,se,X,ee),G=ee?ee.id:null),i.renderLayer(i,ee,X,oe)}this.renderedToTile?(V.dirty=!0,A.push(k.tileID)):Z||--R,R===5&&(R=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,i.width,i.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){let i=t.order.length,d=-1,m=i;for(let y=0;y<i;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?d=Math.max(d,y):m=Math.min(m,y);return m>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(i=>{t=Math.min(t,i.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,i,d){if(!this._visibleDemTiles)return null;let m=this._visibleDemTiles.filter(y=>y.dem).map(y=>{let x=y.tileID,S=1<<x.overscaledZ,{x:A,y:R}=x.canonical,P=A/S,k=(A+1)/S,N=R/S,V=(R+1)/S;return{minx:P,miny:N,maxx:k,maxy:V,t:y.dem.tree.raycastRoot(P,N,k,V,t,i,d),tile:y}});m.sort((y,x)=>(y.t!==null?y.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(let y of m){if(y.t==null)return null;let x=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,i,d);if(x!=null)return x}return null}_createFBO(){let t=this.painter.context,i=t.gl,d=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);let m=new n.T(t,{width:d[0],height:d[1],data:null},i.RGBA8);m.bind(i.LINEAR,i.CLAMP_TO_EDGE);let y=t.createFramebuffer(d[0],d[1],!0,null);return y.colorAttachment.set(m.texture),y.depthAttachment=new _g(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{let i=this._style._mergedLayers[t],d=i.isHidden(this.painter.transform.zoom);return i.type==="hillshade"||i.type==="custom"?!d&&i.shouldRedrape():!d&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(let d of this._style.getSources())if(d instanceof vr){t=!0;break}if(!t)return;let i={};for(let d=0;d<this._style.order.length;++d){let m=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(m);if(y&&!i[y.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof n.a9){i[y.id]=!0;for(let x of this.proxyCoords){let S=this.proxyToSource[x.key][y.id];if(S)for(let A of S)this._clearRenderCacheForTile(y.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(let d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Co){t=!0;break}if(!t)return;let i={};for(let d=0;d<this._style.order.length;++d){let m=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(m);if(!y||i[y.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;let x=m.paint.get("raster-fade-duration");for(let S of this.proxyCoords){let A=this.proxyToSource[S.key][y.id];if(A)for(let R of A){let P=Ac(y.getTile(R),y.findLoadedParent(R,0),y,this.painter.transform,x);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(y.id,R)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();let t=this._style.order,i=t.length;if(i===0)return;let d=[];this._pendingGroundEffectLayers=[];let m,y=0,x=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++y<i;)x=this._style._mergedLayers[t[y]];for(;y<i;++y){let S=this._style._mergedLayers[t[y]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?m===void 0&&(m=y):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),m!==void 0&&(d.push({start:m,end:y-1}),m=void 0)))}if(m!==void 0&&d.push({start:m,end:y-1}),d.length!==0){let S=d[d.length-1];this._pendingGroundEffectLayers.every(A=>A>S.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){let i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){let x=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let S=0;S<x.length;++S){let A=Object.values(x[S]);i.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();let d=this.proxyCoords,m=this._tilesDirty;for(let x=d.length-1;x>=0;x--){let S=d[x];if(i.getTileByID(S.key),i.proxyCachedFBO[S.key]!==void 0){let A=t[S.key],R=this.proxyToSource[S.key],P=0;for(let k in R){let N=R[k],V=A[k];if(!V||V.length!==N.length||N.some((Z,G)=>Z!==V[G]||m[k]&&m[k].hasOwnProperty(Z.key))){P=-1;break}++P}for(let k in i.proxyCachedFBO[S.key])i.renderCache[i.proxyCachedFBO[S.key][k]].dirty=P<0||P!==Object.values(A).length}}let y=[...this._drapedRenderBatches];y.sort((x,S)=>S.end-S.start-(x.end-x.start));for(let x of y)for(let S of d){if(i.proxyCachedFBO[S.key])continue;let A=i.renderCachePool.pop();A===void 0&&i.renderCache.length<50&&(A=i.renderCache.length,i.renderCache.push(this._createFBO())),A!==void 0&&(i.proxyCachedFBO[S.key]={},i.proxyCachedFBO[S.key][x.start]=A,i.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,i,d,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let y=this.painter.context,x=y.gl;if(i.length<=1)return void(this._overlapStencilType=!1);let S;if(d.isTileClipped())S=i.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ot.disabled}_renderTileClippingMasks(t,i){let d=this.painter,m=this.painter.context,y=m.gl;d._tileClippingMaskIDs={},m.setColorMode(Jt.disabled),m.setDepthMode(It.disabled);let x=d.getOrCreateProgram("clippingMask");for(let S of t){let A=d._tileClippingMaskIDs[S.key]=--i;x.draw(d,y.TRIANGLES,It.disabled,new Ot({func:y.ALWAYS,mask:0},A,255,y.KEEP,y.KEEP,y.REPLACE),Jt.disabled,kt.disabled,ch(S.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){let i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;let d=[t.x,t.y,1,1];n.ab.vec4.transformMat4(d,d,i.pixelMatrixInverse),n.ab.vec4.scale(d,d,1/d[3]),d[0]/=i.worldSize,d[1]/=i.worldSize;let m=i._camera.position,y=n.bH(1,i.center.lat),x=[m[0],m[1],m[2]/y,0],S=n.ab.vec3.subtract([],d.slice(0,3),x);n.ab.vec3.normalize(S,S);let A=this.raycast(x,S,this._exaggeration);return A!==null&&A?(n.ab.vec3.scaleAndAdd(x,x,S,A),x[3]=x[2],x[2]*=y,x):null}_setupProxiedCoordsForOrtho(t,i,d){if(t.getSource()instanceof n.aJ)return this._setupProxiedCoordsForImageSource(t,i,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};let m=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let A=0;A<y.length;A++){let R=y[A],P=this._findTileCoveringTileID(R,t);if(P){let k=this._createProxiedId(R,P,d[R.key]&&d[R.key][t.id]);m.push(k),this.proxyToSource[R.key][t.id]=[k]}}let x=!1,S=new Set;for(let A=0;A<i.length;A++){let R=t.getTile(i[A]);if(!R||!R.hasData())continue;let P=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==R.tileID.canonical.z){let k=this.proxyToSource[P.tileID.key][t.id],N=this._createProxiedId(P.tileID,R,d[P.tileID.key]&&d[P.tileID.key][t.id]);k?k.splice(k.length-1,0,N):this.proxyToSource[P.tileID.key][t.id]=[N];let V=this.proxyToSource[P.tileID.key][t.id];S.has(V)||S.add(V),m.push(N),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(let A of S)A.sort((R,P)=>P.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(t,i,d){if(!t.getSource().loaded())return;let m=this.proxiedCoords[t.id]=[],y=this.proxyCoords,x=t.getSource(),S=x.tileID;if(!S)return;let A=new n.P(S.x,S.y)._div(1<<S.z),R=x.coordinates.map(n.aa.fromLngLat).reduce((k,N)=>(k.min.x=Math.min(k.min.x,N.x-A.x),k.min.y=Math.min(k.min.y,N.y-A.y),k.max.x=Math.max(k.max.x,N.x-A.x),k.max.y=Math.max(k.max.y,N.y-A.y),k),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(k,N)=>{let V=k.wrap+k.canonical.x/(1<<k.canonical.z),Z=k.canonical.y/(1<<k.canonical.z),G=n.ag/(1<<k.canonical.z),Y=N.wrap+N.canonical.x/(1<<N.canonical.z),X=N.canonical.y/(1<<N.canonical.z);return V+G<Y+R.min.x||V>Y+R.max.x||Z+G<X+R.min.y||Z>X+R.max.y};for(let k=0;k<y.length;k++){let N=y[k];for(let V=0;V<i.length;V++){let Z=t.getTile(i[V]);if(!Z||!Z.hasData()||P(N,Z.tileID))continue;let G=this._createProxiedId(N,Z,d[N.key]&&d[N.key][t.id]),Y=this.proxyToSource[N.key][t.id];Y?Y.push(G):this.proxyToSource[N.key][t.id]=[G],m.push(G)}}}_createProxiedId(t,i,d){let m=this.orthoMatrix;if(d){let y=d.find(x=>x.key===i.tileID.key);if(y)return y}if(i.tileID.key!==t.key){let y=t.canonical.z-i.tileID.canonical.z,x,S,A;m=n.ab.mat4.create();let R=i.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(x=n.ag>>y,S=x*((i.tileID.canonical.x<<y)-t.canonical.x+R),A=x*((i.tileID.canonical.y<<y)-t.canonical.y)):(x=n.ag<<-y,S=n.ag*(i.tileID.canonical.x-(t.canonical.x+R<<-y)),A=n.ag*(i.tileID.canonical.y-(t.canonical.y<<-y))),n.ab.mat4.ortho(m,0,x,0,x,0,1),n.ab.mat4.translate(m,m,[S,A,0])}return new Pf(i.tileID,t.key,m)}_findTileCoveringTileID(t,i){let d=i.getTile(t);if(d&&d.hasData())return d;let m=this._findCoveringTileCache[i.id],y=m[t.key];if(d=y?i.getTileByID(y):null,d&&d.hasData()||y===null)return d;let x=d?d.tileID:t,S=x.overscaledZ,A=i.getSource().minzoom,R=[];if(!y){let k=i.getSource().maxzoom;if(t.canonical.z>=k){let N=t.canonical.z-k;i.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,i.transform.tileZoom),x=new n.aG(S,t.wrap,k,t.canonical.x>>N,t.canonical.y>>N)):N!==0&&(S=k,x=new n.aG(S,t.wrap,k,t.canonical.x>>N,t.canonical.y>>N))}x.key!==t.key&&(R.push(x.key),d=i.getTile(x))}let P=k=>{R.forEach(N=>{m[N]=k}),R.length=0};for(S-=1;S>=A&&(!d||!d.hasData());S--){d&&P(d.tileID.key);let k=x.calculateScaledKey(S);if(d=i.getTileByID(k),d&&d.hasData())break;let N=m[k];if(N===null)break;N===void 0?R.push(k):d=i.getTileByID(N)}return P(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,i){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[i.key]=!0}}function d0(u,t,i){let d=function(S,A,R){let P=n.ab.vec3.dot(A,S),k=n.ab.vec3.dot(R,[.2126,.7152,.0722]),N=(Z,G,Y)=>(1-Y)*Z+Y*G,V=N(1-.3*Math.min(k,1),1,Math.min(P+1,1));return N(.92,1,Math.asin(n.aw(A[2],-1,1))/Math.PI+.5)*V}(u,[0,0,1],t),m=[0,0,0];n.ab.vec3.scale(m,i.slice(0,3),d);let y=[0,0,0];n.ab.vec3.scale(y,t.slice(0,3),u[2]);let x=[0,0,0];return n.ab.vec3.add(x,m,y),n.cf(x)}let f0=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],vg=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class xg{static cacheKey(t,i,d,m){let y=`${i}${m?m.cacheKey:""}`;for(let x of d)t.usedDefines.includes(x)&&(y+=`/${x}`);return y}constructor(t,i,d,m,y,x){let S=t.gl;this.program=S.createProgram(),this.configuration=m,this.name=i,this.fixedDefines=[...x];let A=m?m.getBinderAttributes():[],R=(d.staticAttributes||[]).concat(A),P=m?m.defines():[];P=P.concat(x.map(Y=>`#define ${Y}`));let k=`#version 300 es
`,N=k+P.concat("precision mediump float;",Sc,nh.fragmentSource).join(`
`);for(let Y of d.fragmentIncludes)N+=`
${yl[Y]}`;N+=`
${d.fragmentSource}`;let V=k+P.concat("precision highp float;",Sc,nh.vertexSource).join(`
`);for(let Y of d.vertexIncludes)V+=`
${yl[Y]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(V+=`
uniform int u_instanceID;
`),V+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(V=V.replaceAll("gl_InstanceID","u_instanceID"));let Z=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(Z,N),S.compileShader(Z),S.attachShader(this.program,Z);let G=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(G,V),S.compileShader(G),S.attachShader(this.program,G),this.attributes={},this.numAttributes=R.length;for(let Y=0;Y<this.numAttributes;Y++)if(R[Y]){let X=R[Y].startsWith("a_")?R[Y]:`a_${R[Y]}`;S.bindAttribLocation(this.program,Y,X),this.attributes[X]=Y}S.linkProgram(this.program),S.deleteShader(G),S.deleteShader(Z),this.fixedUniforms=y(t),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Y=>({u_instanceID:new n.bN(Y)}))(t)),(x.includes("TERRAIN")||i.indexOf("symbol")!==-1||i.indexOf("circle")!==-1)&&(this.terrainUniforms=(Y=>({u_dem:new n.bN(Y),u_dem_prev:new n.bN(Y),u_dem_tl:new n.bK(Y),u_dem_scale:new n.bM(Y),u_dem_tl_prev:new n.bK(Y),u_dem_scale_prev:new n.bM(Y),u_dem_size:new n.bM(Y),u_dem_lerp:new n.bM(Y),u_exaggeration:new n.bM(Y),u_depth:new n.bN(Y),u_depth_size_inv:new n.bK(Y),u_depth_range_unpack:new n.bK(Y),u_occluder_half_size:new n.bM(Y),u_occlusion_depth_offset:new n.bM(Y),u_meter_to_dem:new n.bM(Y),u_label_plane_matrix_inv:new n.bJ(Y)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new n.bL(Y),u_tile_tr_up:new n.bL(Y),u_tile_br_up:new n.bL(Y),u_tile_bl_up:new n.bL(Y),u_tile_up_scale:new n.bM(Y)}))(t)),x.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new n.bJ(Y),u_fog_range:new n.bK(Y),u_fog_color:new n.ca(Y),u_fog_horizon_blend:new n.bM(Y),u_fog_vertical_limit:new n.bK(Y),u_fog_temporal_offset:new n.bM(Y),u_frustum_tl:new n.bL(Y),u_frustum_tr:new n.bL(Y),u_frustum_br:new n.bL(Y),u_frustum_bl:new n.bL(Y),u_globe_pos:new n.bL(Y),u_globe_radius:new n.bM(Y),u_globe_transition:new n.bM(Y),u_is_globe:new n.bN(Y),u_viewport:new n.bK(Y)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new n.ca(Y)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new n.bL(Y),u_lighting_directional_dir:new n.bL(Y),u_lighting_directional_color:new n.bL(Y),u_ground_radiance:new n.bL(Y)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new n.bJ(Y),u_light_matrix_1:new n.bJ(Y),u_fade_range:new n.bK(Y),u_shadow_normal_offset:new n.bL(Y),u_shadow_intensity:new n.bM(Y),u_shadow_texel_size:new n.bM(Y),u_shadow_map_resolution:new n.bM(Y),u_shadow_direction:new n.bL(Y),u_shadow_bias:new n.bL(Y),u_shadowmap_0:new n.bN(Y),u_shadowmap_1:new n.bN(Y)}))(t))}}setTerrainUniformValues(t,i){if(!this.terrainUniforms)return;let d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let m in i)d[m]&&d[m].set(this.program,m,i[m])}}setGlobeUniformValues(t,i){if(!this.globeUniforms)return;let d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let m in i)d[m]&&d[m].set(this.program,m,i[m])}}setFogUniformValues(t,i){if(!this.fogUniforms)return;let d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let m in i)d[m].set(this.program,m,i[m])}}setCutoffUniformValues(t,i){if(!this.cutoffUniforms)return;let d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let m in i)d[m].set(this.program,m,i[m])}}setLightsUniformValues(t,i){if(!this.lightsUniforms)return;let d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let m in i)d[m].set(this.program,m,i[m])}}setShadowUniformValues(t,i){if(this.failedToCreate||!this.shadowUniforms)return;let d=this.shadowUniforms;t.program.set(this.program);for(let m in i)d[m].set(this.program,m,i[m])}_drawDebugWireframe(t,i,d,m,y,x,S,A,R,P){let k=t.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;let N=t.context;if(!(!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||t._terrain&&t._terrain.renderingToTexture||!f0.includes(this.name))||!(!k.layers3D||!vg.includes(this.name))))return;let V=N.gl,Z=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,N);if(!Z)return;let G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");let Y=t.getOrCreateProgram(this.name,{config:this.configuration,defines:G});N.program.set(Y.program);let X=(oe,fe,ce)=>{if(fe[oe]&&ce[oe])for(let he in fe[oe])ce[oe][he]&&ce[oe][he].set(ce.program,he,fe[oe][he].current)};R&&R.setUniforms(Y.program,N,Y.binderUniforms,S,{zoom:A}),X("fixedUniforms",this,Y),X("terrainUniforms",this,Y),X("globeUniforms",this,Y),X("fogUniforms",this,Y),X("lightsUniforms",this,Y),X("shadowUniforms",this,Y),Z.bind(),N.setColorMode(new Jt([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],n.aj.transparent,[!0,!0,!0,!1])),N.setDepthMode(new It(i.func===V.LESS?V.LEQUAL:i.func,It.ReadOnly,i.range)),N.setStencilMode(Ot.disabled);let ee=3*x.primitiveLength*2,se=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){let oe=P||1;for(let fe=0;fe<oe;++fe)Y.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",fe),V.drawElements(V.LINES,ee,V.UNSIGNED_SHORT,se)}else P&&P>1?V.drawElementsInstanced(V.LINES,ee,V.UNSIGNED_SHORT,se,P):V.drawElements(V.LINES,ee,V.UNSIGNED_SHORT,se);y.bind(),N.program.set(this.program),N.setDepthMode(i),N.setStencilMode(d),N.setColorMode(m)}checkUniforms(t,i,d){if(this.fixedDefines.includes(i)){for(let m of Object.keys(d))if(!d[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${i} being defined`)}}draw(t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G,Y){let X=t.context,ee=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(d),X.setStencilMode(m),X.setColorMode(y),X.setCullFace(x);for(let fe of Object.keys(this.fixedUniforms))this.fixedUniforms[fe].set(this.program,fe,S[fe]);Z&&Z.setUniforms(this.program,X,this.binderUniforms,N,{zoom:V});let se={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[i];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);let oe=Y&&Y>0?1:void 0;for(let fe of k.get()){let ce=fe.vaos||(fe.vaos={});if((ce[A]||(ce[A]=new lg)).bind(X,this,R,Z?Z.getPaintVertexBuffers():[],P,fe.vertexOffset,G||[],oe),this.forceManualRenderingForInstanceIDShaders){let he=Y||1;for(let le=0;le<he;++le)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",le),P?ee.drawElements(i,fe.primitiveLength*se,ee.UNSIGNED_SHORT,fe.primitiveOffset*se*2):ee.drawArrays(i,fe.vertexOffset,fe.vertexLength)}else Y&&Y>1?ee.drawElementsInstanced(i,fe.primitiveLength*se,ee.UNSIGNED_SHORT,fe.primitiveOffset*se*2,Y):P?ee.drawElements(i,fe.primitiveLength*se,ee.UNSIGNED_SHORT,fe.primitiveOffset*se*2):ee.drawArrays(i,fe.vertexOffset,fe.vertexLength);i===ee.TRIANGLES&&P&&this._drawDebugWireframe(t,d,m,y,P,fe,N,V,Z,Y)}}}function uh(u,t){let i=Math.pow(2,t.tileID.overscaledZ),d=t.tileSize*Math.pow(2,u.transform.tileZoom)/i,m=d*(t.tileID.canonical.x+t.tileID.wrap*i),y=d*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ar(t,1,u.transform.tileZoom),u_pixel_coord_upper:[m>>16,y>>16],u_pixel_coord_lower:[65535&m,65535&y]}}let Tl={terrain:0,flat:1},Il=n.ab.mat4.create(),hh=(u,t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G,Y,X)=>{let ee=t.style.light,se=ee.properties.get("position"),oe=[se.x,se.y,se.z],fe=n.ab.mat3.create();ee.properties.get("anchor")==="viewport"&&(n.ab.mat3.fromRotation(fe,-t.transform.angle),n.ab.vec3.transformMat3(oe,oe,fe));let ce=ee.properties.get("color"),he=t.transform,le={u_matrix:u,u_lightpos:oe,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_vertical_gradient:+i,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Il,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Tl[R],u_base_type:Tl[P],u_ao:m,u_edge_radius:y,u_width_scale:x,u_flood_light_color:Z,u_vertical_scale:G,u_flood_light_intensity:Y,u_ground_shadow_factor:X};return he.projection.name==="globe"&&(le.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],le.u_zoom_transition=k,le.u_inv_rot_matrix=V,le.u_merc_center=N,le.u_up_dir=he.projection.upVector(new n.bT(0,0,0),N[0]*n.ag,N[1]*n.ag),le.u_height_lift=A),le},Rc=(u,t,i,d,m,y)=>({u_matrix:u,u_edge_radius:t,u_width_scale:i,u_vertical_scale:d,u_height_type:Tl[m],u_base_type:Tl[y]}),bg=(u,t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G,Y)=>{let X=hh(u,t,i,d,m,y,x,S,R,P,k,N,V,Z,G,Y,1,[0,0,0]),ee={u_height_factor:-Math.pow(2,S.overscaledZ)/A.tileSize/8};return n.l(X,uh(t,A),ee)},Pc=(u,t)=>({u_matrix:u,u_emissive_strength:t}),Oc=(u,t,i,d)=>n.l(Pc(u,t),uh(i,d)),Of=(u,t,i)=>({u_matrix:u,u_world:i,u_emissive_strength:t}),wg=(u,t,i,d,m)=>n.l(Oc(u,t,i,d),{u_world:m}),p0=(u,t,i,d)=>{let m=n.ag/i.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.getCameraToCenterDistance(d),u_extrude_scale:[t.pixelsToGLUnits[0]/m,t.pixelsToGLUnits[1]/m]}},xa=(u,t,i=1)=>({u_matrix:u,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:i}),dh=n.ab.mat4.create(),_t=(u,t,i,d,m,y,x)=>{let S=u.transform,A=S.projection.name==="globe",R=A?n.cN(S.zoom,t.canonical)*S._pixelsPerMercatorPixel:n.ar(i,1,y),P={u_matrix:t.projMatrix,u_extrude_scale:R,u_intensity:x,u_inv_rot_matrix:dh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){P.u_inv_rot_matrix=d,P.u_merc_center=m,P.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],P.u_zoom_transition=n.ae(S.zoom);let k=m[0]*n.ag,N=m[1]*n.ag;P.u_up_dir=S.projection.upVector(new n.bT(0,0,0),k,N)}return P};function Lf(u,[t,i,d,m],[y,x]){if(y===x)return[0,0,0,0];let S=255*(u-1)/(u*(x-y));return[t*S,i*S,d*S,m*S]}function kf(u,t,[i,d]){return i===d?0:.5/u+(t-i)*(u-1)/(u*(d-i))}let Vs=(u,t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G,Y,X,ee,se,oe)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:d,u_grid_matrix:m,u_tl_parent:y,u_scale_parent:R,u_fade_t:P.mix,u_opacity:P.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:n.cO(k.paint.get("raster-saturation")),u_contrast_factor:n.cP(k.paint.get("raster-contrast")),u_spin_weights:ba(k.paint.get("raster-hue-rotate")),u_perspective_transform:N,u_raster_elevation:V,u_zoom_transition:x,u_merc_center:S,u_cutoff_params:A,u_colorization_mix:Lf(n.cQ,G,X),u_colorization_offset:kf(n.cQ,Y,X),u_color_ramp:Z,u_texture_offset:[se/(ee+2*se),ee/(ee+2*se)],u_texture_res:[ee+2*se,ee+2*se],u_emissive_strength:oe});function ba(u){u*=Math.PI/180;let t=Math.sin(u),i=Math.cos(u);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}let bt=.05,Ff=(u,t,i,d,m,y,x,S,A,R,P,k)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:d,u_grid_matrix:m,u_tl_parent:y,u_scale_parent:R,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:x,u_merc_center:S,u_cutoff_params:A}),m0=(u,t,i,d,m,y,x,S,A,R)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:i,u_velocity:d,u_color_ramp:y,u_velocity_res:m,u_max_speed:x,u_uv_offset:S,u_data_scale:[255*A[0],255*A[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[bt,bt]}),g0=(u,t,i,d,m,y,x,S,A,R)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:i,u_velocity_res:d,u_max_speed:m,u_speed_factor:y,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*A[0],255*A[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[bt,bt]}),fh=n.ab.mat4.create(),Nf=(u,t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G,Y,X,ee,se,oe,fe)=>{let ce=m.transform,he={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ce.getCameraToCenterDistance(ee),u_rotate_symbol:+i,u_aspect_ratio:ce.width/ce.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:x,u_coord_matrix:S,u_is_text:+R,u_elevation_from_sea:A?1:0,u_pitch_with_map:+d,u_texsize:P,u_texsize_icon:k,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:fh,u_up_vector:[0,-1,0],u_color_adj_mat:se,u_icon_transition:oe||0,u_gamma_scale:d?m.transform.getCameraToCenterDistance(ee)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:+N,u_scale_factor:fe||1};return ee.name==="globe"&&(he.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],he.u_zoom_transition=Z,he.u_inv_rot_matrix=Y,he.u_merc_center=G,he.u_camera_forward=ce._camera.forward(),he.u_ecef_origin=n.cR(ce.globeMatrix,V.toUnwrapped()),he.u_tile_matrix=Float32Array.from(ce.globeMatrix),he.u_up_vector=X),he},zf=(u,t,i,d)=>({u_matrix:u,u_emissive_strength:t,u_opacity:i,u_color:d}),Eg=(u,t,i,d,m,y,x,S,A)=>n.l(function(R,P,k,N,V,Z){let{width:G,height:Y}=N.imageManager.getPixelSize(P),X=Math.pow(2,Z.tileID.overscaledZ),ee=Z.tileSize*Math.pow(2,N.transform.tileZoom)/X,se=ee*(Z.tileID.canonical.x+Z.tileID.wrap*X),oe=ee*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[G,Y],u_pattern_size:k.displaySize,u_pattern_units_to_pixels:V?[N.transform.width,-1*N.transform.height]:[1/n.ar(Z,1,N.transform.tileZoom),1/n.ar(Z,1,N.transform.tileZoom)],u_pixel_coord_upper:[se>>16,oe>>16],u_pixel_coord_lower:[65535&se,65535&oe]}}(0,y,x,d,S,A),{u_matrix:u,u_emissive_strength:t,u_opacity:i}),Bf=new Float32Array(n.ab.mat4.identity([])),Lc=(u,t,i,d,m,y,x,S,A,R,P,k,N,V=[0,0,0],Z)=>{let G=m.style.light,Y=G.properties.get("position"),X=[-Y.x,-Y.y,Y.z],ee=n.ab.mat3.create();G.properties.get("anchor")==="viewport"&&(n.ab.mat3.fromRotation(ee,-m.transform.angle),n.ab.vec3.transformMat3(X,X,ee));let se=P.alphaMode==="MASK",oe=G.properties.get("color").toRenderColor(null),fe=N.paint.get("model-ambient-occlusion-intensity"),ce=N.paint.get("model-color").constantOr(n.aj.white).toRenderColor(null),he=N.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:i,u_node_matrix:d||Bf,u_lightpos:X,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[oe.r,oe.g,oe.b],u_camera_pos:V,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+se,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[S[0],S[1],S[2],1],u_metallicFactor:A,u_roughnessFactor:R,u_baseColorTexture:Gr.BaseColor,u_metallicRoughnessTexture:Gr.MetallicRoughness,u_normalTexture:Gr.Normal,u_occlusionTexture:Gr.Occlusion,u_emissionTexture:Gr.Emission,u_lutTexture:Gr.LUT,u_color_mix:[ce.r,ce.g,ce.b,he],u_aoIntensity:fe,u_emissive_strength:k,u_occlusionTextureTransform:Z||[0,0,0,0]}},ph=(u,t=Bf,i=Bf)=>({u_matrix:u,u_instance:t,u_node_matrix:i}),Vf={fillExtrusion:u=>({u_matrix:new n.bJ(u),u_lightpos:new n.bL(u),u_lightintensity:new n.bM(u),u_lightcolor:new n.bL(u),u_vertical_gradient:new n.bM(u),u_opacity:new n.bM(u),u_edge_radius:new n.bM(u),u_width_scale:new n.bM(u),u_ao:new n.bK(u),u_height_type:new n.bN(u),u_base_type:new n.bN(u),u_tile_id:new n.bL(u),u_zoom_transition:new n.bM(u),u_inv_rot_matrix:new n.bJ(u),u_merc_center:new n.bK(u),u_up_dir:new n.bL(u),u_height_lift:new n.bM(u),u_flood_light_color:new n.bL(u),u_vertical_scale:new n.bM(u),u_flood_light_intensity:new n.bM(u),u_ground_shadow_factor:new n.bL(u)}),fillExtrusionDepth:u=>({u_matrix:new n.bJ(u),u_edge_radius:new n.bM(u),u_width_scale:new n.bM(u),u_vertical_scale:new n.bM(u),u_height_type:new n.bN(u),u_base_type:new n.bN(u)}),fillExtrusionPattern:u=>({u_matrix:new n.bJ(u),u_lightpos:new n.bL(u),u_lightintensity:new n.bM(u),u_lightcolor:new n.bL(u),u_vertical_gradient:new n.bM(u),u_height_factor:new n.bM(u),u_edge_radius:new n.bM(u),u_width_scale:new n.bM(u),u_ao:new n.bK(u),u_height_type:new n.bN(u),u_base_type:new n.bN(u),u_tile_id:new n.bL(u),u_zoom_transition:new n.bM(u),u_inv_rot_matrix:new n.bJ(u),u_merc_center:new n.bK(u),u_up_dir:new n.bL(u),u_height_lift:new n.bM(u),u_image:new n.bN(u),u_texsize:new n.bK(u),u_pixel_coord_upper:new n.bK(u),u_pixel_coord_lower:new n.bK(u),u_tile_units_to_pixels:new n.bM(u),u_opacity:new n.bM(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new n.bJ(u),u_opacity:new n.bM(u),u_ao_pass:new n.bM(u),u_meter_to_tile:new n.bM(u),u_ao:new n.bK(u),u_flood_light_intensity:new n.bM(u),u_flood_light_color:new n.bL(u),u_attenuation:new n.bM(u),u_edge_radius:new n.bM(u),u_fb:new n.bN(u),u_fb_size:new n.bM(u),u_dynamic_offset:new n.bM(u)}),fill:u=>({u_matrix:new n.bJ(u),u_emissive_strength:new n.bM(u)}),fillPattern:u=>({u_matrix:new n.bJ(u),u_emissive_strength:new n.bM(u),u_image:new n.bN(u),u_texsize:new n.bK(u),u_pixel_coord_upper:new n.bK(u),u_pixel_coord_lower:new n.bK(u),u_tile_units_to_pixels:new n.bM(u)}),fillOutline:u=>({u_matrix:new n.bJ(u),u_emissive_strength:new n.bM(u),u_world:new n.bK(u)}),fillOutlinePattern:u=>({u_matrix:new n.bJ(u),u_emissive_strength:new n.bM(u),u_world:new n.bK(u),u_image:new n.bN(u),u_texsize:new n.bK(u),u_pixel_coord_upper:new n.bK(u),u_pixel_coord_lower:new n.bK(u),u_tile_units_to_pixels:new n.bM(u)}),circle:n.cS,collisionBox:u=>({u_matrix:new n.bJ(u),u_camera_to_center_distance:new n.bM(u),u_extrude_scale:new n.bK(u)}),collisionCircle:u=>({u_matrix:new n.bJ(u),u_inv_matrix:new n.bJ(u),u_camera_to_center_distance:new n.bM(u),u_viewport_size:new n.bK(u)}),debug:u=>({u_color:new n.cz(u),u_matrix:new n.bJ(u),u_overlay:new n.bN(u),u_overlay_scale:new n.bM(u)}),clippingMask:u=>({u_matrix:new n.bJ(u)}),heatmap:u=>({u_extrude_scale:new n.bM(u),u_intensity:new n.bM(u),u_matrix:new n.bJ(u),u_inv_rot_matrix:new n.bJ(u),u_merc_center:new n.bK(u),u_tile_id:new n.bL(u),u_zoom_transition:new n.bM(u),u_up_dir:new n.bL(u)}),heatmapTexture:u=>({u_image:new n.bN(u),u_color_ramp:new n.bN(u),u_opacity:new n.bM(u)}),hillshade:u=>({u_matrix:new n.bJ(u),u_image:new n.bN(u),u_latrange:new n.bK(u),u_light:new n.bK(u),u_shadow:new n.cz(u),u_highlight:new n.cz(u),u_emissive_strength:new n.bM(u),u_accent:new n.cz(u)}),hillshadePrepare:u=>({u_matrix:new n.bJ(u),u_image:new n.bN(u),u_dimension:new n.bK(u),u_zoom:new n.bM(u)}),line:n.cT,linePattern:n.cU,raster:u=>({u_matrix:new n.bJ(u),u_normalize_matrix:new n.bJ(u),u_globe_matrix:new n.bJ(u),u_merc_matrix:new n.bJ(u),u_grid_matrix:new n.cA(u),u_tl_parent:new n.bK(u),u_scale_parent:new n.bM(u),u_fade_t:new n.bM(u),u_opacity:new n.bM(u),u_image0:new n.bN(u),u_image1:new n.bN(u),u_brightness_low:new n.bM(u),u_brightness_high:new n.bM(u),u_saturation_factor:new n.bM(u),u_contrast_factor:new n.bM(u),u_spin_weights:new n.bL(u),u_perspective_transform:new n.bK(u),u_raster_elevation:new n.bM(u),u_zoom_transition:new n.bM(u),u_merc_center:new n.bK(u),u_cutoff_params:new n.ca(u),u_colorization_mix:new n.ca(u),u_colorization_offset:new n.bM(u),u_color_ramp:new n.bN(u),u_texture_offset:new n.bK(u),u_texture_res:new n.bK(u),u_emissive_strength:new n.bM(u)}),rasterParticle:u=>({u_matrix:new n.bJ(u),u_normalize_matrix:new n.bJ(u),u_globe_matrix:new n.bJ(u),u_merc_matrix:new n.bJ(u),u_grid_matrix:new n.cA(u),u_tl_parent:new n.bK(u),u_scale_parent:new n.bM(u),u_fade_t:new n.bM(u),u_opacity:new n.bM(u),u_image0:new n.bN(u),u_image1:new n.bN(u),u_raster_elevation:new n.bM(u),u_zoom_transition:new n.bM(u),u_merc_center:new n.bK(u),u_cutoff_params:new n.ca(u)}),rasterParticleTexture:u=>({u_texture:new n.bN(u),u_opacity:new n.bM(u)}),rasterParticleDraw:u=>({u_particle_texture:new n.bN(u),u_particle_texture_side_len:new n.bM(u),u_tile_offset:new n.bK(u),u_velocity:new n.bN(u),u_color_ramp:new n.bN(u),u_velocity_res:new n.bK(u),u_max_speed:new n.bM(u),u_uv_offset:new n.bK(u),u_data_scale:new n.bK(u),u_data_offset:new n.bM(u),u_particle_pos_scale:new n.bM(u),u_particle_pos_offset:new n.bK(u)}),rasterParticleUpdate:u=>({u_particle_texture:new n.bN(u),u_particle_texture_side_len:new n.bM(u),u_velocity:new n.bN(u),u_velocity_res:new n.bK(u),u_max_speed:new n.bM(u),u_speed_factor:new n.bM(u),u_reset_rate:new n.bM(u),u_rand_seed:new n.bM(u),u_uv_offset:new n.bK(u),u_data_scale:new n.bK(u),u_data_offset:new n.bM(u),u_particle_pos_scale:new n.bM(u),u_particle_pos_offset:new n.bK(u)}),symbol:u=>({u_is_size_zoom_constant:new n.bN(u),u_is_size_feature_constant:new n.bN(u),u_size_t:new n.bM(u),u_size:new n.bM(u),u_camera_to_center_distance:new n.bM(u),u_rotate_symbol:new n.bN(u),u_aspect_ratio:new n.bM(u),u_fade_change:new n.bM(u),u_matrix:new n.bJ(u),u_label_plane_matrix:new n.bJ(u),u_coord_matrix:new n.bJ(u),u_is_text:new n.bN(u),u_elevation_from_sea:new n.bN(u),u_pitch_with_map:new n.bN(u),u_texsize:new n.bK(u),u_texsize_icon:new n.bK(u),u_texture:new n.bN(u),u_texture_icon:new n.bN(u),u_gamma_scale:new n.bM(u),u_device_pixel_ratio:new n.bM(u),u_tile_id:new n.bL(u),u_zoom_transition:new n.bM(u),u_inv_rot_matrix:new n.bJ(u),u_merc_center:new n.bK(u),u_camera_forward:new n.bL(u),u_tile_matrix:new n.bJ(u),u_up_vector:new n.bL(u),u_ecef_origin:new n.bL(u),u_is_halo:new n.bN(u),u_icon_transition:new n.bM(u),u_color_adj_mat:new n.bJ(u),u_scale_factor:new n.bM(u)}),background:u=>({u_matrix:new n.bJ(u),u_emissive_strength:new n.bM(u),u_opacity:new n.bM(u),u_color:new n.cz(u)}),backgroundPattern:u=>({u_matrix:new n.bJ(u),u_emissive_strength:new n.bM(u),u_opacity:new n.bM(u),u_image:new n.bN(u),u_pattern_tl:new n.bK(u),u_pattern_br:new n.bK(u),u_texsize:new n.bK(u),u_pattern_size:new n.bK(u),u_pixel_coord_upper:new n.bK(u),u_pixel_coord_lower:new n.bK(u),u_pattern_units_to_pixels:new n.bK(u)}),terrainRaster:u=>({u_matrix:new n.bJ(u),u_image0:new n.bN(u),u_skirt_height:new n.bM(u),u_ground_shadow_factor:new n.bL(u)}),skybox:u=>({u_matrix:new n.bJ(u),u_sun_direction:new n.bL(u),u_cubemap:new n.bN(u),u_opacity:new n.bM(u),u_temporal_offset:new n.bM(u)}),skyboxGradient:u=>({u_matrix:new n.bJ(u),u_color_ramp:new n.bN(u),u_center_direction:new n.bL(u),u_radius:new n.bM(u),u_opacity:new n.bM(u),u_temporal_offset:new n.bM(u)}),skyboxCapture:u=>({u_matrix_3f:new n.cA(u),u_sun_direction:new n.bL(u),u_sun_intensity:new n.bM(u),u_color_tint_r:new n.ca(u),u_color_tint_m:new n.ca(u),u_luminance:new n.bM(u)}),globeRaster:u=>({u_proj_matrix:new n.bJ(u),u_globe_matrix:new n.bJ(u),u_normalize_matrix:new n.bJ(u),u_merc_matrix:new n.bJ(u),u_zoom_transition:new n.bM(u),u_merc_center:new n.bK(u),u_image0:new n.bN(u),u_grid_matrix:new n.cA(u),u_skirt_height:new n.bM(u),u_far_z_cutoff:new n.bM(u),u_frustum_tl:new n.bL(u),u_frustum_tr:new n.bL(u),u_frustum_br:new n.bL(u),u_frustum_bl:new n.bL(u),u_globe_pos:new n.bL(u),u_globe_radius:new n.bM(u),u_viewport:new n.bK(u)}),globeAtmosphere:u=>({u_frustum_tl:new n.bL(u),u_frustum_tr:new n.bL(u),u_frustum_br:new n.bL(u),u_frustum_bl:new n.bL(u),u_horizon:new n.bM(u),u_transition:new n.bM(u),u_fadeout_range:new n.bM(u),u_color:new n.ca(u),u_high_color:new n.ca(u),u_space_color:new n.ca(u),u_temporal_offset:new n.bM(u),u_horizon_angle:new n.bM(u)}),model:u=>({u_matrix:new n.bJ(u),u_lighting_matrix:new n.bJ(u),u_normal_matrix:new n.bJ(u),u_node_matrix:new n.bJ(u),u_lightpos:new n.bL(u),u_lightintensity:new n.bM(u),u_lightcolor:new n.bL(u),u_camera_pos:new n.bL(u),u_opacity:new n.bM(u),u_baseColorFactor:new n.ca(u),u_emissiveFactor:new n.ca(u),u_metallicFactor:new n.bM(u),u_roughnessFactor:new n.bM(u),u_baseTextureIsAlpha:new n.bN(u),u_alphaMask:new n.bN(u),u_alphaCutoff:new n.bM(u),u_baseColorTexture:new n.bN(u),u_metallicRoughnessTexture:new n.bN(u),u_normalTexture:new n.bN(u),u_occlusionTexture:new n.bN(u),u_emissionTexture:new n.bN(u),u_lutTexture:new n.bN(u),u_color_mix:new n.ca(u),u_aoIntensity:new n.bM(u),u_emissive_strength:new n.bM(u),u_occlusionTextureTransform:new n.ca(u)}),modelDepth:u=>({u_matrix:new n.bJ(u),u_instance:new n.bJ(u),u_node_matrix:new n.bJ(u)}),groundShadow:u=>({u_matrix:new n.bJ(u),u_ground_shadow_factor:new n.bL(u)}),stars:u=>({u_matrix:new n.bJ(u),u_up:new n.bL(u),u_right:new n.bL(u),u_intensity_multiplier:new n.bM(u)}),snowParticle:u=>({u_modelview:new n.bJ(u),u_projection:new n.bJ(u),u_time:new n.bM(u),u_cam_pos:new n.bL(u),u_velocityConeAperture:new n.bM(u),u_velocity:new n.bM(u),u_horizontalOscillationRadius:new n.bM(u),u_horizontalOscillationRate:new n.bM(u),u_boxSize:new n.bM(u),u_billboardSize:new n.bM(u),u_simpleShapeParameters:new n.bK(u),u_screenSize:new n.bK(u),u_thinningCenterPos:new n.bK(u),u_thinningShape:new n.bL(u),u_thinningAffectedRatio:new n.bM(u),u_thinningParticleOffset:new n.bM(u),u_particleColor:new n.ca(u),u_direction:new n.bL(u)}),rainParticle:u=>({u_modelview:new n.bJ(u),u_projection:new n.bJ(u),u_time:new n.bM(u),u_cam_pos:new n.bL(u),u_texScreen:new n.bN(u),u_velocityConeAperture:new n.bM(u),u_velocity:new n.bM(u),u_boxSize:new n.bM(u),u_rainDropletSize:new n.bK(u),u_distortionStrength:new n.bM(u),u_rainDirection:new n.bL(u),u_color:new n.ca(u),u_screenSize:new n.bK(u),u_thinningCenterPos:new n.bK(u),u_thinningShape:new n.bL(u),u_thinningAffectedRatio:new n.bM(u),u_thinningParticleOffset:new n.bM(u),u_shapeDirectionalPower:new n.bM(u),u_shapeNormalPower:new n.bM(u),u_mode:new n.bM(u)}),vignette:u=>({u_vignetteShape:new n.bL(u),u_vignetteColor:new n.ca(u)}),occlusion:u=>({u_matrix:new n.bJ(u),u_anchorPos:new n.bL(u),u_screenSizePx:new n.bK(u),u_occluderSizePx:new n.bK(u),u_color:new n.ca(u)})},mh=(()=>{class u{constructor(i,d,m,y){this.id=u.uniqueIdxCounter,u.uniqueIdxCounter++,this.context=i;let x=i.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||y||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=u.uniqueIdxCounter,u.uniqueIdxCounter++;let d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return u.uniqueIdxCounter=0,u})(),Ai={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class js{constructor(t,i,d,m,y,x){this.length=i.length,this.attributes=d,this.itemSize=i.bytesPerElement,this.dynamicDraw=m,this.instanceCount=x,this.context=t;let S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||y||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){let i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,i){for(let d=0;d<this.attributes.length;d++){let m=i.attributes[this.attributes[d].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,i,d){for(let m=0;m<this.attributes.length;m++){let y=this.attributes[m],x=i.attributes[y.name];x!==void 0&&t.vertexAttribPointer(x,y.components,t[Ai[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,i,d){for(let m=0;m<this.attributes.length;m++){let y=i.attributes[this.attributes[m].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class jf{constructor(t,i,d,m,y){this.context=t,this.width=i,this.height=d;let x=this.framebuffer=t.gl.createFramebuffer();m&&(this.colorAttachment=new wl(t,x)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Mf(t,x):new gg(t,x))}destroy(){let t=this.context.gl;if(this.colorAttachment){let i=this.colorAttachment.get();i&&t.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i)}else{let i=this.depthAttachment.get();i&&t.deleteTexture(i)}t.deleteFramebuffer(this.framebuffer)}}class Uf{constructor(t,i){this.gl=t,this.clearColor=new _f(this),this.clearDepth=new yf(this),this.clearStencil=new vf(this),this.colorMask=new xf(this),this.depthMask=new hg(this),this.stencilMask=new dg(this),this.stencilFunc=new i0(this),this.stencilOp=new Dc(this),this.stencilTest=new Mc(this),this.depthRange=new fg(this),this.depthTest=new Ci(this),this.depthFunc=new bf(this),this.blend=new rh(this),this.blendFunc=new ih(this),this.blendColor=new wf(this),this.blendEquation=new Ef(this),this.cullFace=new oh(this),this.cullFaceSide=new Tf(this),this.frontFace=new If(this),this.program=new sh(this),this.activeTexture=new pg(this),this.viewport=new mg(this),this.bindFramebuffer=new bl(this),this.bindRenderbuffer=new o0(this),this.bindTexture=new s0(this),this.bindVertexBuffer=new a0(this),this.bindElementBuffer=new l0(this),this.bindVertexArrayOES=new c0(this),this.pixelStoreUnpack=new u0(this),this.pixelStoreUnpackPremultiplyAlpha=new Sf(this),this.pixelStoreUnpackFlipY=new Df(this),this.options=i?Object.assign({},i):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=i&&!!i.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,i,d){return new mh(this,t,i,d)}createVertexBuffer(t,i,d,m,y){return new js(this,t,i,d,m,y)}createRenderbuffer(t,i,d){let m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,t,i,d),this.bindRenderbuffer.set(null),y}createFramebuffer(t,i,d,m){return new jf(this,t,i,d,m)}clear({color:t,depth:i,stencil:d,colorMask:m}){let y=this.gl,x=0;t&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(m||[!0,!0,!0,!0])),i!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),d!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),y.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.bn(t.blendFunction,Jt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Sl;function gh(u,t,i,d,m,y,x){let S=u.context,A=S.gl,R=u.transform,P=u.getOrCreateProgram("collisionBox"),k=[],N=0,V=0;for(let oe=0;oe<d.length;oe++){let fe=d[oe],ce=t.getTile(fe),he=ce.getBucket(i);if(!he)continue;let le=uo(fe,he,R),ge=le;m[0]===0&&m[1]===0||(ge=u.translatePosMatrix(le,ce,m,y));let we=x?he.textCollisionBox:he.iconCollisionBox,Be=he.collisionCircleArray;if(Be.length>0){let Re=n.ab.mat4.create(),Ge=ge;n.ab.mat4.mul(Re,he.placementInvProjMatrix,R.glCoordMatrix),n.ab.mat4.mul(Re,Re,he.placementViewportMatrix),k.push({circleArray:Be,circleOffset:V,transform:Ge,invTransform:Re,projection:he.getProjection()}),N+=Be.length/4,V=N}we&&(u.terrain&&u.terrain.setupElevationDraw(ce,P),P.draw(u,A.LINES,It.disabled,Ot.disabled,u.colorModeForRenderPass(),kt.disabled,p0(ge,R,ce,he.getProjection()),i.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,R.zoom,null,[we.collisionVertexBuffer,we.collisionVertexBufferExt]))}if(!x||!k.length)return;let Z=u.getOrCreateProgram("collisionCircle"),G=new n.cV;G.resize(4*N),G._trim();let Y=0;for(let oe of k)for(let fe=0;fe<oe.circleArray.length/4;fe++){let ce=4*fe,he=oe.circleArray[ce+0],le=oe.circleArray[ce+1],ge=oe.circleArray[ce+2],we=oe.circleArray[ce+3];G.emplace(Y++,he,le,ge,we,0),G.emplace(Y++,he,le,ge,we,1),G.emplace(Y++,he,le,ge,we,2),G.emplace(Y++,he,le,ge,we,3)}(!Sl||Sl.length<2*N)&&(Sl=function(oe){let fe=2*oe,ce=new n.aU;ce.resize(fe),ce._trim();for(let he=0;he<fe;he++){let le=6*he;ce.uint16[le+0]=4*he+0,ce.uint16[le+1]=4*he+1,ce.uint16[le+2]=4*he+2,ce.uint16[le+3]=4*he+2,ce.uint16[le+4]=4*he+3,ce.uint16[le+5]=4*he+0}return ce}(N));let X=S.createIndexBuffer(Sl,!0),ee=S.createVertexBuffer(G,n.cW.members,!0);for(let oe of k){let fe={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(se=R).getCameraToCenterDistance(oe.projection),u_viewport_size:[se.width,se.height]};Z.draw(u,A.TRIANGLES,It.disabled,Ot.disabled,u.colorModeForRenderPass(),kt.disabled,fe,i.id,ee,X,n.b7.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,R.zoom)}var se;ee.destroy(),X.destroy()}let kc=n.ab.mat4.create();function Bi(u){let t=u._camera.getWorldToCamera(u.worldSize,1),i=n.ab.mat4.multiply([],t,u.globeMatrix);n.ab.mat4.invert(i,i);let d=[0,0,0],m=[0,1,0,0];return n.ab.vec4.transformMat4(m,m,i),d[0]=m[0],d[1]=m[1],d[2]=m[2],n.ab.vec3.normalize(d,d),d}function Gn({width:u,height:t,anchor:i,textOffset:d,textScale:m},y){let{horizontalAlign:x,verticalAlign:S}=n.bD(i),A=-(x-.5)*u,R=-(S-.5)*t,P=n.bC(i,d);return new n.P((A/m+P[0])*y,(R/m+P[1])*y)}function _h(u,t,i,d,m,y,x,S,A,R,P){let k=u.text.placedSymbolArray,N=u.text.dynamicLayoutVertexArray,V=u.icon.dynamicLayoutVertexArray,Z={},G=u.getProjection(),Y=ca(S,G,y),X=y.elevation,ee=G.upVectorScale(S.canonical,y.center.lat,y.worldSize).metersToTile;N.clear();for(let se=0;se<k.length;se++){let oe=k.get(se),{tileAnchorX:fe,tileAnchorY:ce,numGlyphs:he}=oe,le=oe.hidden||!oe.crossTileID||u.allowVerticalPlacement&&!oe.placedOrientation?null:d[oe.crossTileID];if(le){let ge=0,we=0,Be=0;if(X){let je=X?X.getAtTileOffset(S,fe,ce):0,[it,Ye,qe]=G.upVector(S.canonical,fe,ce);ge=je*it*ee,we=je*Ye*ee,Be=je*qe*ee}let[Re,Ge,He,Me]=vi(oe.projectedAnchorX+ge,oe.projectedAnchorY+we,oe.projectedAnchorZ+Be,i?Y:x),Ve=qu(y.getCameraToCenterDistance(G),Me),Qe=m.evaluateSizeForFeature(u.textSizeData,R,oe)*Ve/n.bw;i&&(Qe*=u.tilePixelRatio/A);let De=Gn(le,Qe);i?({x:Re,y:Ge,z:He}=G.projectTilePoint(fe+De.x,ce+De.y,S.canonical),[Re,Ge,He]=vi(Re+ge,Ge+we,He+Be,x)):(t&&De._rotate(-y.angle),Re+=De.x,Ge+=De.y,He=0);let We=u.allowVerticalPlacement&&oe.placedOrientation===n.bq.vertical?Math.PI/2:0;for(let je=0;je<he;je++)n.bt(N,Re,Ge,He,We);P&&oe.associatedIconIndex>=0&&(Z[oe.associatedIconIndex]={x:Re,y:Ge,z:He,angle:We})}else sr(he,N)}if(P){V.clear();let se=u.icon.placedSymbolArray;for(let oe=0;oe<se.length;oe++){let fe=se.get(oe),{numGlyphs:ce}=fe,he=Z[oe];if(fe.hidden||!he)sr(ce,V);else{let{x:le,y:ge,z:we,angle:Be}=he;for(let Re=0;Re<ce;Re++)n.bt(V,le,ge,we,Be)}}u.icon.dynamicLayoutVertexBuffer.updateData(V)}u.text.dynamicLayoutVertexBuffer.updateData(N)}function Fc(u,t,i,d,m,y,x={}){let S=i.paint.get("icon-translate"),A=i.paint.get("text-translate"),R=i.paint.get("icon-translate-anchor"),P=i.paint.get("text-translate-anchor"),k=i.layout.get("icon-rotation-alignment"),N=i.layout.get("text-rotation-alignment"),V=i.layout.get("icon-pitch-alignment"),Z=i.layout.get("text-pitch-alignment"),G=i.layout.get("icon-keep-upright"),Y=i.layout.get("text-keep-upright"),X=i.paint.get("icon-color-saturation"),ee=i.paint.get("icon-color-contrast"),se=i.paint.get("icon-color-brightness-min"),oe=i.paint.get("icon-color-brightness-max"),fe=i.layout.get("symbol-elevation-reference")==="sea",ce=u.context,he=ce.gl,le=u.transform,ge=k==="map",we=N==="map",Be=V==="map",Re=Z==="map",Ge=i.layout.get("symbol-sort-key").constantOr(1)!==void 0,He=!1,Me=u.depthModeForSublayer(0,It.ReadOnly),Ve=[n.at(le.center.lng),n.aA(le.center.lat)],Qe=i.layout.get("text-variable-anchor"),De=le.projection.name==="globe",We=[],je=[0,-1,0];for(let it of d){let Ye=t.getTile(it),qe=Ye.getBucket(i);if(!qe||qe.projection.name==="mercator"&&De||qe.fullyClipped)continue;let et=qe.projection.name==="globe",rt=et?n.ae(le.zoom):0,dt=ca(it,qe.getProjection(),le),gt=le.calculatePixelsToTileUnitsMatrix(Ye),Pt=Qe&&qe.hasTextData(),Et=qe.hasIconTextFit()&&Pt&&qe.hasIconData(),St=qe.getProjection().createInversionMatrix(le,it.canonical),Nt=yn=>{le.depthOcclusionForSymbolsAndCircles&&(i.hasInitialOcclusionOpacityProperties||u.terrain)&&(yn.push("DEPTH_D24"),yn.push("DEPTH_OCCLUSION"))},an=()=>{let yn=ge&&i.layout.get("symbol-placement")!=="point",bn=[];Nt(bn);let tr=yn||Et,Rr=i.paint.get("icon-image-cross-fade").constantOr(0);u.terrainRenderModeElevated()&&Be&&bn.push("PITCH_WITH_MAP_TERRAIN"),et&&(bn.push("PROJECTION_GLOBE_VIEW"),tr&&bn.push("PROJECTED_POS_ON_VIEWPORT")),Rr>0&&bn.push("ICON_TRANSITION"),qe.icon.zOffsetVertexBuffer&&bn.push("Z_OFFSET"),X===0&&ee===0&&se===0&&oe===1||bn.push("COLOR_ADJUSTMENT"),qe.sdfIcons&&bn.push("RENDER_SDF");let Er=qe.icon.programConfigurations.get(i.id),Tr=u.getOrCreateProgram("symbol",{config:Er,defines:bn}),Ui=Ye.imageAtlasTexture?Ye.imageAtlasTexture.size:[0,0],Kr=qe.iconSizeData,nr=n.bp(Kr,le.zoom),Un=Be||le.pitch!==0,zn=Nr(dt,Ye.tileID.canonical,Be,ge,le,qe.getProjection(),gt),un=Qd(dt,Ye.tileID.canonical,Be,ge,le,qe.getProjection(),gt),mr=u.translatePosMatrix(un,Ye,S,R,!0),Pr=u.translatePosMatrix(dt,Ye,S,R),Vn=tr?kc:zn,Jr=ge&&!Be&&!yn,Qi=je;!De&&!le.mercatorFromTransition||ge||(Qi=Bi(le));let Oi=et?Qi:je,wi=i.getColorAdjustmentMatrix(X,ee,se,oe),Bo=Nf(Kr.kind,nr,Jr,Be,u,Pr,Vn,mr,fe,!1,Ui,[0,0],!0,it,rt,Ve,St,Oi,qe.getProjection(),wi,Rr),eo=Ye.imageAtlasTexture?Ye.imageAtlasTexture:null,$i=i.layout.get("icon-size").constantOr(0)!==1||qe.iconsNeedLinear,Ca=qe.sdfIcons||u.options.rotating||u.options.zooming||$i||Un?he.LINEAR:he.NEAREST,Vo=qe.sdfIcons&&i.paint.get("icon-halo-width").constantOr(1)!==0,Aa=u.terrain&&Be&&yn?n.ab.mat4.invert(n.ab.mat4.create(),zn):kc;if(yn&&qe.icon){let Bl=le.elevation,Oh=Bl?Bl.getAtTileOffsetFunc(it,le.center.lat,le.worldSize,qe.getProjection()):null,hp=cr(dt,Ye.tileID.canonical,Be,ge,le,qe.getProjection(),gt);Wu(qe,dt,u,!1,hp,un,Be,G,Oh,it)}return{program:Tr,buffers:qe.icon,uniformValues:Bo,atlasTexture:eo,atlasTextureIcon:null,atlasInterpolation:Ca,atlasInterpolationIcon:null,isSDF:qe.sdfIcons,hasHalo:Vo,tile:Ye,labelPlaneMatrixInv:Aa}},An=()=>{let yn=we&&i.layout.get("symbol-placement")!=="point",bn=[],tr=yn||Qe||Et;u.terrainRenderModeElevated()&&Re&&bn.push("PITCH_WITH_MAP_TERRAIN"),et&&(bn.push("PROJECTION_GLOBE_VIEW"),tr&&bn.push("PROJECTED_POS_ON_VIEWPORT")),qe.text.zOffsetVertexBuffer&&bn.push("Z_OFFSET"),qe.iconsInText&&bn.push("RENDER_TEXT_AND_SYMBOL"),bn.push("RENDER_SDF"),Nt(bn);let Rr=qe.text.programConfigurations.get(i.id),Er=u.getOrCreateProgram("symbol",{config:Rr,defines:bn}),Tr,Ui=[0,0],Kr=null,nr=qe.textSizeData;qe.iconsInText&&(Ui=Ye.imageAtlasTexture?Ye.imageAtlasTexture.size:[0,0],Kr=Ye.imageAtlasTexture?Ye.imageAtlasTexture:null,Tr=Re||le.pitch!==0||u.options.rotating||u.options.zooming||nr.kind==="composite"||nr.kind==="camera"?he.LINEAR:he.NEAREST);let Un=Ye.glyphAtlasTexture?Ye.glyphAtlasTexture.size:[0,0],zn=i.layout.get("text-size-scale-range"),un=n.aw(u.scaleFactor,zn[0],zn[1]),mr=n.bp(nr,le.zoom,un),Pr=Nr(dt,Ye.tileID.canonical,Re,we,le,qe.getProjection(),gt),Vn=Qd(dt,Ye.tileID.canonical,Re,we,le,qe.getProjection(),gt),Jr=u.translatePosMatrix(Vn,Ye,A,P,!0),Qi=u.translatePosMatrix(dt,Ye,A,P),Oi=tr?kc:Pr,wi=we&&!Re&&!yn,Bo=je;!De&&!le.mercatorFromTransition||we||(Bo=Bi(le));let eo=Nf(nr.kind,mr,wi,Re,u,Qi,Oi,Jr,fe,!0,Un,Ui,!0,it,rt,Ve,St,et?Bo:je,qe.getProjection(),null,null,un),$i=Ye.glyphAtlasTexture?Ye.glyphAtlasTexture:null,Ca=he.LINEAR,Vo=i.paint.get("text-halo-width").constantOr(1)!==0,Aa=u.terrain&&Re&&yn?n.ab.mat4.invert(n.ab.mat4.create(),Pr):kc;if(yn&&qe.text){let Bl=le.elevation,Oh=Bl?Bl.getAtTileOffsetFunc(it,le.center.lat,le.worldSize,qe.getProjection()):null,hp=cr(dt,Ye.tileID.canonical,Re,we,le,qe.getProjection(),gt);Wu(qe,dt,u,!0,hp,Vn,Re,Y,Oh,it)}return{program:Er,buffers:qe.text,uniformValues:eo,atlasTexture:$i,atlasTextureIcon:Kr,atlasInterpolation:Ca,atlasInterpolationIcon:Tr,isSDF:!0,hasHalo:Vo,tile:Ye,labelPlaneMatrixInv:Aa}},ir=qe.icon.segments.get().length,Wn=qe.text.segments.get().length,jt=ir&&!x.onlyText?an():null,fn=Wn&&!x.onlyIcons?An():null,wt=i.paint.get("icon-opacity").constantOr(1),on=i.paint.get("text-opacity").constantOr(1);if(Ge&&qe.canOverlap){He=!0;let yn=wt&&!x.onlyText?qe.icon.segments.get():[],bn=on&&!x.onlyIcons?qe.text.segments.get():[];for(let tr of yn)We.push({segments:new n.b7([tr]),sortKey:tr.sortKey,state:jt});for(let tr of bn)We.push({segments:new n.b7([tr]),sortKey:tr.sortKey,state:fn})}else x.onlyText||We.push({segments:wt?qe.icon.segments:new n.b7([]),sortKey:0,state:jt}),x.onlyIcons||We.push({segments:on?qe.text.segments:new n.b7([]),sortKey:0,state:fn})}He&&We.sort((it,Ye)=>it.sortKey-Ye.sortKey);for(let it of We){let Ye=it.state;if(Ye)if(u.terrain?u.terrain.setupElevationDraw(Ye.tile,Ye.program,{useDepthForOcclusion:le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ye.labelPlaneMatrixInv}):u.setupDepthForOcclusion(le.depthOcclusionForSymbolsAndCircles,Ye.program),ce.activeTexture.set(he.TEXTURE0),Ye.atlasTexture&&Ye.atlasTexture.bind(Ye.atlasInterpolation,he.CLAMP_TO_EDGE,!0),Ye.atlasTextureIcon&&(ce.activeTexture.set(he.TEXTURE1),Ye.atlasTextureIcon&&Ye.atlasTextureIcon.bind(Ye.atlasInterpolationIcon,he.CLAMP_TO_EDGE,!0)),u.uploadCommonLightUniforms(u.context,Ye.program),Ye.hasHalo){let qe=Ye.uniformValues;qe.u_is_halo=1,yh(Ye.buffers,it.segments,i,u,Ye.program,Me,m,y,qe,2),qe.u_is_halo=0}else{if(Ye.isSDF){let qe=Ye.uniformValues;Ye.hasHalo&&(qe.u_is_halo=1,yh(Ye.buffers,it.segments,i,u,Ye.program,Me,m,y,qe,1)),qe.u_is_halo=0}yh(Ye.buffers,it.segments,i,u,Ye.program,Me,m,y,Ye.uniformValues,1)}}}function yh(u,t,i,d,m,y,x,S,A,R){let P=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];m.draw(d,d.context.gl.TRIANGLES,y,x,S,kt.disabled,A,i.id,u.layoutVertexBuffer,u.indexBuffer,t,i.paint,d.transform.zoom,u.programConfigurations.get(i.id),P,R)}function $f(u,t,i,d,m,y,x){let S=u.context.gl,A=i.paint.get("fill-pattern"),R=i.is3D(),P=R?u.stencilModeFor3D():Ot.disabled,k=A&&A.constantOr(1),N,V,Z,G,Y;x?(V=k&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=S.LINES):(V=k?"fillPattern":"fill",N=S.TRIANGLES);for(let X of d){let ee=t.getTile(X);if(k&&!ee.patternsLoaded())continue;let se=ee.getBucket(i);if(!se)continue;u.prepareDrawTile();let oe=se.programConfigurations.get(i.id),fe=u.isTileAffectedByFog(X),ce=u.getOrCreateProgram(V,{config:oe,overrideFog:fe});k&&(u.context.activeTexture.set(S.TEXTURE0),ee.imageAtlasTexture&&ee.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),oe.updatePaintBuffers());let he=A.constantOr(null);if(he&&ee.imageAtlas){let we=ee.imageAtlas,Be=n.A.from(he).getPrimary().scaleSelf(n.q.devicePixelRatio).serialize(),Re=we.patternPositions[Be];Re&&oe.setConstantPatternPositions(Re)}let le=u.translatePosMatrix(X.projMatrix,ee,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),ge=i.paint.get("fill-emissive-strength");if(x){G=se.indexBuffer2,Y=se.segments2;let we=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];Z=V==="fillOutlinePattern"&&k?wg(le,ge,u,ee,we):Of(le,ge,we)}else G=se.indexBuffer,Y=se.segments,Z=k?Oc(le,ge,u,ee):Pc(le,ge);u.uploadCommonUniforms(u.context,ce,X.toUnwrapped()),ce.draw(u,N,m,R?P:u.stencilModeForClipping(X),y,kt.disabled,Z,i.id,se.layoutVertexBuffer,G,Y,i.paint,u.transform.zoom,oe,void 0)}}function Nc(u,t,i,d,m,y,x,S){i.resetLayerRenderingStats(u);let A=u.context,R=A.gl,P=u.transform,k=i.paint.get("fill-extrusion-pattern"),N=k.constantOr(1),V=i.paint.get("fill-extrusion-opacity"),Z=u.style.enable3dLights(),G=i.paint.get(Z&&!N?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Y=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],X=i.layout.get("fill-extrusion-edge-radius"),ee=X>0&&!i.paint.get("fill-extrusion-rounded-roof"),se=ee?0:X,oe=P.projection.name==="globe"?n.d3():0,fe=P.projection.name==="globe",ce=fe?n.ae(P.zoom):0,he=[n.at(P.center.lng),n.aA(P.center.lat)],le=i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ge=i.paint.get("fill-extrusion-flood-light-color").toRenderColor(le?null:i.lut).toArray01().slice(0,3),we=i.paint.get("fill-extrusion-flood-light-intensity"),Be=i.paint.get("fill-extrusion-vertical-scale"),Re=i.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ge=i.paint.get("fill-extrusion-height-alignment"),He=i.paint.get("fill-extrusion-base-alignment"),Me=Ns(u,i.paint.get("fill-extrusion-cutoff-fade-range")),Ve=[],Qe;fe&&Ve.push("PROJECTION_GLOBE_VIEW"),Y[0]>0&&Ve.push("FAUX_AO"),ee&&Ve.push("ZERO_ROOF_RADIUS"),S&&Ve.push("HAS_CENTROID"),we>0&&Ve.push("FLOOD_LIGHT"),Me.shouldRenderCutoff&&Ve.push("RENDER_CUTOFF"),Re&&Ve.push("RENDER_WALL_MODE");let De=u.renderPass==="shadow",We=u.shadowRenderer,je=De&&!!We;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let it=[0,0,0];if(We){let et=u.style.directionalLight,rt=u.style.ambientLight;et&&rt&&(it=hf(u.style,et,rt)),De||(Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),We.useNormalOffset&&Ve.push("NORMAL_OFFSET")),Qe=Ve.concat(["SHADOWS_SINGLE_CASCADE"])}let Ye=je?"fillExtrusionDepth":N?"fillExtrusionPattern":"fillExtrusion",qe=i.getLayerRenderingStats();for(let et of d){let rt=t.getTile(et),dt=rt.getBucket(i);if(!dt||dt.projection.name!==P.projection.name)continue;let gt=!1;We&&(gt=We.getMaxCascadeForTile(et.toUnwrapped())===0);let Pt=u.isTileAffectedByFog(et),Et=dt.programConfigurations.get(i.id),St=u.getOrCreateProgram(Ye,{config:Et,defines:gt?Qe:Ve,overrideFog:Pt});if(u.terrain&&u.terrain.setupElevationDraw(rt,St,{useMeterToDem:!0}),!dt.centroidVertexBuffer){let fn=St.attributes.a_centroid_pos;fn!==void 0&&R.vertexAttrib2f(fn,0,0)}!De&&We&&We.setupShadows(rt.tileID.toUnwrapped(),St,"vector-tile",rt.tileID.overscaledZ),N&&(u.context.activeTexture.set(R.TEXTURE0),rt.imageAtlasTexture&&rt.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Et.updatePaintBuffers());let Nt=k.constantOr(null);if(Nt&&rt.imageAtlas){let fn=rt.imageAtlas,wt=n.A.from(Nt).getPrimary().scaleSelf(n.q.devicePixelRatio),on=fn.patternPositions[wt.serialize()];on&&Et.setConstantPatternPositions(on)}let an=i.paint.get("fill-extrusion-vertical-gradient"),An=1/dt.tileToMeter,ir;if(De&&We){if(Al(rt.tileID,dt,u))continue;let fn=We.calculateShadowPassMatrixFromTile(rt.tileID.toUnwrapped());ir=Rc(fn,se,An,Be,Ge,He)}else{let fn=u.translatePosMatrix(et.expandedProjMatrix,rt,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),wt=P.projection.createInversionMatrix(P,et.canonical);ir=N?bg(fn,u,an,V,Y,se,An,et,rt,oe,Ge,He,ce,he,wt,ge,Be):hh(fn,u,an,V,Y,se,An,et,oe,Ge,He,ce,he,wt,ge,Be,we,it)}u.uploadCommonUniforms(A,St,et.toUnwrapped(),null,Me);let Wn=dt.segments;if(P.projection.name==="mercator"&&!De&&(Wn=dt.getVisibleSegments(rt.tileID,u.terrain,u.transform.getFrustum(0)),!Wn.get().length))continue;if(qe)if(De)for(let fn of Wn.get())qe.numRenderedVerticesInShadowPass+=fn.primitiveLength;else for(let fn of Wn.get())qe.numRenderedVerticesInTransparentPass+=fn.primitiveLength;let jt=[];(u.terrain||S)&&jt.push(dt.centroidVertexBuffer),fe&&jt.push(dt.layoutVertexExtBuffer),Re&&jt.push(dt.wallVertexBuffer),St.draw(u,A.gl.TRIANGLES,m,y,x,kt.backCCW,ir,i.id,dt.layoutVertexBuffer,dt.indexBuffer,Wn,i.paint,u.transform.zoom,Et,jt)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function Dl(u,t,i,d,m,y,x,S,A,R,P,k,N,V,Z,G,Y,X,ee){let se=u.context,oe=se.gl,fe=u.transform,ce=u.transform.zoom,he=[],le=Ns(u,i.paint.get("fill-extrusion-cutoff-fade-range"));R==="clear"?(he.push("CLEAR_SUBPASS"),ee&&(he.push("CLEAR_FROM_TEXTURE"),se.activeTexture.set(oe.TEXTURE0),ee.bind(oe.LINEAR,oe.CLAMP_TO_EDGE))):R==="sdf"&&he.push("SDF_SUBPASS"),Y&&he.push("HAS_CENTROID"),le.shouldRenderCutoff&&he.push("RENDER_CUTOFF");let ge=i.layout.get("fill-extrusion-edge-radius"),we=(Be,Re,Ge,He,Me)=>{let Ve=Re.programConfigurations.get(i.id),Qe=u.isTileAffectedByFog(Be),De=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ve,defines:he,overrideFog:Qe}),We=((it,Ye,qe,et,rt,dt,gt,Pt,Et,St,Nt)=>({u_matrix:Ye,u_opacity:qe,u_ao_pass:et?1:0,u_meter_to_tile:rt,u_ao:dt,u_flood_light_intensity:gt,u_flood_light_color:Pt,u_attenuation:Et,u_edge_radius:St,u_fb:0,u_fb_size:Nt,u_dynamic_offset:1}))(0,He,P,A,Me,[k,N*Me],V,Z,G,ce>=17?0:ge*Me,ee?ee.size[0]:0),je=[];Y&&je.push(Re.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(se,De,Be.toUnwrapped(),null,le),De.draw(u,se.gl.TRIANGLES,m,y,x,S,We,i.id,Re.vertexBuffer,Re.indexBuffer,Ge,i.paint,ce,Ve,je)};for(let Be of d){let Re=t.getTile(Be),Ge=Re.getBucket(i);if(!Ge||Ge.projection.name!==fe.projection.name||!Ge.groundEffect||Ge.groundEffect&&!Ge.groundEffect.hasData())continue;let He=Ge.groundEffect,Me=1/Ge.tileToMeter;{let Ve=u.translatePosMatrix(Be.projMatrix,Re,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Qe=He.getDefaultSegment();we(Be,He,Qe,Ve,Me)}if(X)for(let Ve=0;Ve<4;Ve++){let Qe=n.d4[Ve](Be),De=t.getTile(Qe);if(!De)continue;let We=De.getBucket(i);if(!We||We.projection.name!==fe.projection.name||!We.groundEffect||We.groundEffect&&!We.groundEffect.hasData())continue;let je=We.groundEffect,it,Ye;Ve===0?(it=[-n.ag,0,0],Ye=1):Ve===1?(it=[n.ag,0,0],Ye=0):Ve===2?(it=[0,-n.ag,0],Ye=3):(it=[0,n.ag,0],Ye=2);let qe=je.regionSegments[Ye];if(!qe)continue;let et=new Float32Array(16);n.ab.mat4.translate(et,Be.projMatrix,it),we(Be,je,qe,u.translatePosMatrix(et,Re,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Me)}}}function Ml(u,t,i,d,m,y,x){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();let S=y?y.findDEMTileFor(i):null;if(!(S&&S.dem||x))return;y&&S&&S.dem&&d.selfDEMTileTimestamp!==S.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=S.dem._timestamp);let A=X=>new n.P(Math.ceil((X+n.d7)*n.d8),0),R=X=>{let ee=t.getSource().minzoom,se=fe=>{let ce=t.getTileByID(fe);if(ce&&ce.hasData())return ce.getBucket(m)},oe=[0,-1,1];for(let fe of oe){if(X.overscaledZ+fe<ee)continue;let ce=se(X.calculateScaledKey(X.overscaledZ+fe));if(ce)return ce}},P=[0,0,0],k=(X,ee)=>(P[0]=Math.min(X.min.y,ee.min.y),P[1]=Math.max(X.max.y,ee.max.y),P[2]=n.ag-ee.min.x>X.max.x?ee.min.x-n.ag:X.max.x,P),N=(X,ee)=>(P[0]=Math.min(X.min.x,ee.min.x),P[1]=Math.max(X.max.x,ee.max.x),P[2]=n.ag-ee.min.y>X.max.y?ee.min.y-n.ag:X.max.y,P),V=[(X,ee)=>k(X,ee),(X,ee)=>k(ee,X),(X,ee)=>N(X,ee),(X,ee)=>N(ee,X)],Z=(X,ee,se,oe,fe,ce,he)=>{if(!y)return 0;let le=[[ce?se:X,ce?X:se,0],[ce?se:ee,ce?ee:se,0]],ge=he<0?n.ag+he:he,we=[ce?ge:(X+ee)/2,ce?(X+ee)/2:ge,0];return se===0&&he<0||se!==0&&he>0?y.getForTilePoints(fe,[we],!0,oe):le.push(we),y.getForTilePoints(i,le,!0,S),Math.max(le[0][2],le[1][2],we[2])/y.exaggeration()};for(let X=0;X<4;X++){let ee=d.borderFeatureIndices[X];if(ee.length===0)continue;let se=n.d4[X](i),oe=R(se);if(!(oe&&oe instanceof n.d5))continue;let fe=y?y.findDEMTileFor(se):null;if(!(fe&&fe.dem||x)||(y&&fe&&fe.dem&&d.borderDEMTileTimestamp[X]!==fe.dem._timestamp&&(d.borderDoneWithNeighborZ[X]=-1,d.borderDEMTileTimestamp[X]=fe.dem._timestamp),d.borderDoneWithNeighborZ[X]===oe.canonical.z))continue;oe.centroidVertexArray.length===0&&oe.createCentroidsBuffer();let ce=(X<2?1:5)-X,he=oe.borderDoneWithNeighborZ[ce]!==d.canonical.z,le=oe.borderFeatureIndices[ce],ge=0;if(d.canonical.z!==oe.canonical.z){for(let we of ee)d.showCentroid(d.featuresOnBorder[we]);if(he)for(let we of le)oe.showCentroid(oe.featuresOnBorder[we]);d.borderDoneWithNeighborZ[X]=oe.canonical.z,oe.borderDoneWithNeighborZ[ce]=d.canonical.z}for(let we of ee){let Be=d.featuresOnBorder[we],Re=d.centroidData[Be.centroidDataIndex],Ge=Be.borders[X],He;for(;ge<le.length;){He=oe.featuresOnBorder[le[ge]];let Me=He.borders[ce];if(Me[1]>Ge[0]+3||Me[0]>Ge[0]-3)break;oe.showCentroid(He),ge++}if(He&&ge<le.length){let Me=ge,Ve=0;for(;!(He.borders[ce][0]>Ge[1]-3)&&(Ve++,++ge!==le.length);)He=oe.featuresOnBorder[le[ge]];He=oe.featuresOnBorder[le[Me]];let Qe=!1;if(Ve>=1){let je=He.borders[ce];Math.abs(Ge[0]-je[0])<3&&Math.abs(Ge[1]-je[1])<3&&(Ve=1,Qe=!0,ge=Me+1)}else if(Ve===0){d.showCentroid(Be);continue}let De=oe.centroidData[He.centroidDataIndex];x&&Qe&&(((G=Re).flags|(Y=De).flags)&n.d6?(G.flags|=n.d6,Y.flags|=n.d6):(G.flags&=~n.d6,Y.flags&=~n.d6));let We=Be.intersectsCount()>1||He.intersectsCount()>1;if(Ve>1)ge=Me,Re.centroidXY=De.centroidXY=new n.P(0,0);else if(fe&&fe.dem&&!We){let je=V[X](Re,De),it=X%2?n.ag-1:0,Ye=Z(je[0],Math.min(n.ag-1,je[1]),it,fe,se,X<2,je[2]);Re.centroidXY=De.centroidXY=A(Ye)}else We?Re.centroidXY=De.centroidXY=new n.P(0,0):(Re.centroidXY=d.encodeBorderCentroid(Be),De.centroidXY=oe.encodeBorderCentroid(He));d.writeCentroidToBuffer(Re),oe.writeCentroidToBuffer(De)}else d.showCentroid(Be)}d.borderDoneWithNeighborZ[X]=oe.canonical.z,oe.borderDoneWithNeighborZ[ce]=d.canonical.z}var G,Y;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(u)}let Cl=[1,0,0],nt=[0,1,0],ft=[0,0,1];function Al(u,t,i){let d=i.transform,m=i.shadowRenderer;if(!m)return!0;let y=u.toUnwrapped(),x=d.tileSize*m._cascades[i.currentShadowCascade].scale,S=t.maxHeight;if(d.elevation){let G=d.elevation.getMinMaxForTile(u);G&&(S+=G.max)}let A=[...m.shadowDirection];A[2]=-A[2];let R=m.computeSimplifiedTileShadowVolume(y,S,x,A);if(!R)return!1;let P=[Cl,nt,ft,A,[A[0],0,A[2]],[0,A[1],A[2]]],k=d.projection.name==="globe",N=d.scaleZoom(x),V=n.bR.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,N,!k),Z=m.getCurrentCascadeFrustum();return V.intersectsPrecise(R.vertices,R.planes,P)===0||Z.intersectsPrecise(R.vertices,R.planes,P)===0}function er(u){return[u[0]*n.d9,u[1]*n.d9,u[2]*n.d9,0]}function Pe(u,t,i,d,m,y,x,S,A){let R=d.getSource(),P=i.globeSharedBuffers;if(!P)return;let k,N,V;if(t&&(k=d.getTile(t)),R instanceof n.aJ?(N=R.texture,V=n.cI(0,0,i.transform)):k&&t&&(N=k.texture,V=n.cI(t.canonical.z,t.canonical.x,i.transform)),!N||!V)return;u||(V=n.ab.mat4.scale(n.ab.mat4.create(),V,[1,-1,1]));let Z=i.context,G=Z.gl,Y=m.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,X=i.colorModeForDrapableLayerRenderPass(y),ee=x.defines;ee.push("GLOBE_POLES");let se=new It(G.LEQUAL,It.ReadWrite,i.depthRangeFor3D),oe=Float32Array.from(i.transform.expandedFarZProjMatrix),fe=Float32Array.from(n.bb(n.cH(new n.bT(0,0,0))));i.terrain&&i.terrain.prepareDrawTile(),Z.activeTexture.set(G.TEXTURE0),N.bind(Y,G.CLAMP_TO_EDGE),Z.activeTexture.set(G.TEXTURE1),N.bind(Y,G.CLAMP_TO_EDGE),N.useMipmap&&Z.extTextureFilterAnisotropic&&i.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);let[ce,he,le,ge]=t?P.getPoleBuffers(t.canonical.z,!1):P.getPoleBuffers(0,!0),we=m.paint.get("raster-elevation"),Be;u?(Be=ce,i.renderDefaultNorthPole=we!==0):(Be=he,i.renderDefaultSouthPole=we!==0);let Re=er(x.mix),Ge=((Me,Ve,Qe,De,We,je,it,Ye,qe,et,rt,dt,gt)=>Vs(Me,Ve,Qe,new Float32Array(16),new Float32Array(9),[0,0],De,[0,0],[0,0,0,0],1,{opacity:1,mix:0},je,[0,0],Ye,2,et,rt,dt,1,0,gt))(oe,fe,V,n.ae(i.transform.zoom),0,m,0,we,0,Re,x.offset,x.range,y),He=i.getOrCreateProgram("raster",{defines:ee});i.uploadCommonUniforms(Z,He,null),He.draw(i,G.TRIANGLES,se,A,X,S,Ge,m.id,Be,le,ge)}function Tg(u){let t=u._nearZ,i=u.projection.farthestPixelDistance(u),d=i-t,m=.2*u.height,y=t+m;return[t,i,(y-m-t)/d,(y-t)/d]}function vh(u,t,i,d){if(u)return t instanceof Mr&&u instanceof ks?t.getTextureDescriptor(u,i,!0):{texture:u.texture,mix:er(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Hf=n.da([{name:"a_index",type:"Int16",components:1}]);class Ig{constructor(t,i,d,m){let y={width:d[0],height:d[1],data:null},x=t.gl;this.targetColorTexture=new n.T(t,y,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,y,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(i,m),this.lastInvalidatedAt=0}updateParticleTexture(t,i){if(this.particleTextureDimension===i.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let d=this.context.gl,m=i.width*i.height;this.particleTexture0=new n.T(this.context,i,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,i,d.RGBA8,{premultiply:!1,useMipmap:!1});let y=new n.db;y.reserve(m);for(let x=0;x<m;x++)y.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(y,Hf.members,!0),this.particleSegment=n.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=i.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Sg(u,t,i){if(!u)return null;let d=t.getTextureDescriptor(u,i,!0);if(!d)return null;let{texture:m,mix:y,offset:x,tileSize:S,buffer:A,format:R}=d;if(!m||!R)return null;let P=!1;return R==="uint32"&&(P=!0,y[3]=0,y=Lf(n.dc,y,[0,i.paint.get("raster-particle-max-speed")]),x=kf(n.dc,x,[0,i.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[A/(S+2*A),S/(S+2*A)],tileSize:S,scalarData:P,scale:y,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function Dg(u){let t=u._nearZ,i=u.projection.farthestPixelDistance(u),d=i-t,m=.2*u.height,y=t+m;return[t,i,(y-m-t)/d,(y-t)/d]}let Rl=new n.aj(1,0,0,1),_0=new n.aj(0,1,0,1),y0=new n.aj(0,0,1,1),Mg=new n.aj(1,0,1,1),xh=new n.aj(0,1,1,1);function Us(u,t,i,d,m,y,x){let S=u.context,A=u.transform,R=S.gl,P=A.projection.name==="globe",k=P?["PROJECTION_GLOBE_VIEW"]:[],N=n.ab.mat4.clone(i.projMatrix);if(P&&n.ae(A.zoom)>0){let Re=n.ba(i.canonical,A),Ge=n.dd(Re);N=n.ab.mat4.multiply(new Float32Array(16),A.globeMatrix,Ge),n.ab.mat4.multiply(N,A.projMatrix,N)}let V=n.ab.mat4.create();V[12]+=2*m/(n.q.devicePixelRatio*A.width),V[13]+=2*y/(n.q.devicePixelRatio*A.height),n.ab.mat4.multiply(N,V,N);let Z=u.getOrCreateProgram("debug",{defines:k}),G=t.getTileByID(i.key);u.terrain&&u.terrain.setupElevationDraw(G,Z);let Y=It.disabled,X=Ot.disabled,ee=u.colorModeForRenderPass(),se="$debug";S.activeTexture.set(R.TEXTURE0),u.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),P?G._makeGlobeTileDebugBuffers(u.context,A):G._makeDebugTileBoundsBuffers(u.context,A.projection);let oe=G._tileDebugBuffer||u.debugBuffer,fe=G._tileDebugIndexBuffer||u.debugIndexBuffer,ce=G._tileDebugSegments||u.debugSegments;if(Z.draw(u,R.LINE_STRIP,Y,X,ee,kt.disabled,xa(N,d),se,oe,fe,ce,null,null,null,[G._globeTileDebugBorderBuffer]),x){let Re=G.latestRawTileData,Ge=Math.floor((Re&&Re.byteLength||0)/1024),He=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(He+=` => ${i.overscaledZ}`),He+=` ${G.state}`,He+=` ${Ge}kb`,function(Me,Ve){Me.initDebugOverlayCanvas();let Qe=Me.debugOverlayCanvas,De=Me.context.gl,We=Me.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,Qe.width,Qe.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(Ve,5,5),We.strokeText(Ve,5,5),Me.debugOverlayTexture.update(Qe),Me.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(u,He)}let he=t.getTile(i).tileSize,le=512/Math.min(he,512)*(i.overscaledZ/A.zoom)*.5,ge=G._tileDebugTextBuffer||u.debugBuffer,we=G._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Be=G._tileDebugTextSegments||u.debugSegments;Z.draw(u,R.TRIANGLES,Y,X,Jt.alphaBlended,kt.disabled,xa(N,n.aj.transparent,le),se,ge,we,Be,null,null,null,[G._globeTileDebugTextBuffer])}function Gf(u,t,i,d){wa(u,0,t+i/2,u.transform.width,i,d)}function qf(u,t,i,d){wa(u,t-i/2,0,i,u.transform.height,d)}function wa(u,t,i,d,m,y){let x=u.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*n.q.devicePixelRatio,i*n.q.devicePixelRatio,d*n.q.devicePixelRatio,m*n.q.devicePixelRatio),x.clear({color:y}),S.disable(S.SCISSOR_TEST)}let bh=n.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Lo}=bh;function us(u,t,i,d){u.emplaceBack(t,i,d)}class Cg{constructor(t){this.vertexArray=new n.de,this.indices=new n.aU,us(this.vertexArray,-1,-1,1),us(this.vertexArray,1,-1,1),us(this.vertexArray,-1,1,1),us(this.vertexArray,1,1,1),us(this.vertexArray,-1,-1,-1),us(this.vertexArray,1,-1,-1),us(this.vertexArray,-1,1,-1),us(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Lo),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.b7.simpleSegment(0,0,36,12)}}function kr(u,t,i,d,m,y){let x=u.context.gl,S=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),R=t.paint.get("sky-atmosphere-sun-intensity"),P=((k,N,V,Z,G)=>({u_matrix_3f:k,u_sun_direction:N,u_sun_intensity:V,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(n.ab.mat3.fromMat4(n.ab.mat3.create(),d),m,R,S,A);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),i.draw(u,x.TRIANGLES,It.disabled,Ot.disabled,Jt.unblended,kt.frontCW,P,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}let v0=n.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class zc{constructor(t){let i=new n.df;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);let d=new n.aU;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,v0.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=n.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let qn=n.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class xn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ag{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Jt([1,ua,1,ua],n.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Jt([1,0,1,0],n.aj.transparent,[!1,!1,!1,!0]),this.params=new xn,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){let i=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new zc(i);let d=this.params.sizeRange,m=this.params.intensityRange,y=function(P){let k=n.di(30),N=[];for(let V=0;V<P;++V){let Z=2*Math.PI*k(),G=Math.acos(1-2*k())-.5*Math.PI;N.push(n.ab.vec3.fromValues(Math.cos(G)*Math.cos(Z),Math.cos(G)*Math.sin(Z),Math.sin(G)))}return N}(this.params.starsCount),x=n.di(300),S=new n.dg,A=new n.aU,R=0;for(let P=0;P<y.length;++P){let k=n.ab.vec3.scale([],y[P],200),N=Math.max(0,1+.01*d*(1*x()-.5)),V=Math.max(0,1+.01*m*(1*x()-.5));S.emplaceBack(k[0],k[1],k[2],-1,-1,N,V),S.emplaceBack(k[0],k[1],k[2],1,-1,N,V),S.emplaceBack(k[0],k[1],k[2],1,1,N,V),S.emplaceBack(k[0],k[1],k[2],-1,1,N,V),A.emplaceBack(R+0,R+1,R+2),A.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=i.createVertexBuffer(S,qn.members),this.starsIdx=i.createIndexBuffer(A),this.starsSegments=n.b7.simpleSegment(0,0,S.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){let d=t.context,m=d.gl,y=t.transform,x=new It(m.LEQUAL,It.ReadOnly,[0,1]),S=n.ae(y.zoom),A=t.style.getLut(i.scope),R=i.properties.get("color-use-theme")==="none",P=i.properties.get("color").toRenderColor(R?null:A).toArray01(),k=i.properties.get("high-color-use-theme")==="none",N=i.properties.get("high-color").toRenderColor(k?null:A).toArray01(),V=i.properties.get("space-color-use-theme")==="none",Z=i.properties.get("space-color").toRenderColor(V?null:A).toArray01PremultipliedAlpha(),G=5e-4,Y=n.dh(i.properties.get("horizon-blend"),0,1,G,.25),X=n.cC(t,d,y)&&Y===G?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,ee=t.frameCounter/1e3%1,se=n.ab.vec3.length(y.globeCenterInViewSpace),oe=Math.sqrt(Math.pow(se,2)-Math.pow(X,2)),fe=Math.acos(oe/se),ce=he=>{let le=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];he&&le.push("ALPHA_PASS");let ge=t.getOrCreateProgram("globeAtmosphere",{defines:le}),we=((Re,Ge,He,Me,Ve,Qe,De,We,je,it,Ye,qe)=>({u_frustum_tl:Re,u_frustum_tr:Ge,u_frustum_br:He,u_frustum_bl:Me,u_horizon:Ve,u_transition:Qe,u_fadeout_range:De,u_color:We,u_high_color:je,u_space_color:it,u_temporal_offset:Ye,u_horizon_angle:qe}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,S,Y,P,N,Z,ee,fe);t.uploadCommonUniforms(d,ge);let Be=this.atmosphereBuffer;Be&&ge.draw(t,m.TRIANGLES,x,Ot.disabled,he?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,kt.backCW,we,he?"atmosphere_glow_alpha":"atmosphere_glow",Be.vertexBuffer,Be.indexBuffer,Be.segments)};ce(!1),ce(!0)}drawStars(t,i){let d=n.aw(i.properties.get("star-intensity"),0,1);if(d===0)return;let m=t.context,y=m.gl,x=t.transform,S=t.getOrCreateProgram("stars"),A=n.ab.quat.identity([]);n.ab.quat.rotateX(A,A,-x._pitch),n.ab.quat.rotateZ(A,A,-x.angle),n.ab.quat.rotateX(A,A,n.ai(x._center.lat)),n.ab.quat.rotateY(A,A,-n.ai(x._center.lng));let R=n.ab.mat4.fromQuat(new Float32Array(16),A),P=n.ab.mat4.multiply([],x.starsProjMatrix,R),k=n.ab.mat3.fromMat4([],R),N=n.ab.mat3.invert([],k),V=[0,1,0];n.ab.vec3.transformMat3(V,V,N),n.ab.vec3.scale(V,V,this.params.sizeMultiplier);let Z=[1,0,0];n.ab.vec3.transformMat3(Z,Z,N),n.ab.vec3.scale(Z,Z,this.params.sizeMultiplier);let G=(Y=V,X=Z,ee=d,{u_matrix:Float32Array.from(P),u_up:Y,u_right:X,u_intensity_multiplier:ee});var Y,X,ee;t.uploadCommonUniforms(m,S),this.starsVx&&this.starsIdx&&S.draw(t,y.TRIANGLES,It.disabled,Ot.disabled,this.colorModeAlphaBlendedWriteRGB,kt.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function hs(u,t){let i=[...u],d=t.cameraWorldSizeForFog/t.worldSize,m=n.ab.mat4.identity([]);return n.ab.mat4.scale(m,m,[d,d,1]),n.ab.mat4.multiply(i,m,i),n.ab.mat4.multiply(i,t.worldToFogMatrix,i),i}function Pl(u,t,i,d,m){let y=i.material,x=d.context,{baseColorTexture:S,metallicRoughnessTexture:A}=y.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:P,emissionTexture:k}=y;function N(Z,G,Y){if(Z&&(u.push(G),x.activeTexture.set(x.gl.TEXTURE0+Y),Z.gfxTexture)){let{minFilter:X,magFilter:ee,wrapS:se,wrapT:oe}=Z.sampler;Z.gfxTexture.bindExtraParam(X,ee,se,oe)}}N(S,"HAS_TEXTURE_u_baseColorTexture",Gr.BaseColor),N(A,"HAS_TEXTURE_u_metallicRoughnessTexture",Gr.MetallicRoughness),N(R,"HAS_TEXTURE_u_normalTexture",Gr.Normal),N(P,"HAS_TEXTURE_u_occlusionTexture",Gr.Occlusion),N(k,"HAS_TEXTURE_u_emissionTexture",Gr.Emission),m&&(m.texture||(m.texture=new n.dk(d.context,m.image,[m.image.height,m.image.height,m.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+Gr.LUT),m.texture&&m.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),i.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(i.texcoordBuffer)),i.colorBuffer&&(u.push(i.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(i.colorBuffer)),i.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(i.normalBuffer)),i.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(i.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||u.push("DIFFUSE_SHADED");let V=d.shadowRenderer;V&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),V.useNormalOffset&&u.push("NORMAL_OFFSET"))}function ds(u,t,i,d,m,y){let x=i.paint.get("model-opacity").constantOr(1),S=t.context,A=new It(t.context.gl.LEQUAL,It.ReadWrite,t.depthRangeFor3D),R=t.transform,P=u.mesh,k=P.material,N=k.pbrMetallicRoughness,V=t.style.fog,Z;Z=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:n.ab.mat4.multiply([],d.zScaleMatrix,u.nodeModelMatrix),n.ab.mat4.multiply(Z,d.negCameraPosMatrix,Z);let G=n.ab.mat4.invert([],Z);n.ab.mat4.transpose(G,G);let Y=i.paint.get("model-color-use-theme").constantOr("default")==="none",X=i.paint.get("model-emissive-strength").constantOr(0),ee=Lc(new Float32Array(u.worldViewProjection),new Float32Array(Z),new Float32Array(G),null,t,x,N.baseColorFactor.toRenderColor(null),k.emissiveFactor,N.metallicFactor,N.roughnessFactor,k,X,i),se={defines:[]},oe=[],fe=t.shadowRenderer;fe&&(fe.useNormalOffset=!1),Pl(se.defines,oe,P,t,Y?null:i.lut);let ce=null;if(V){let ge=hs(u.nodeModelMatrix,t.transform);if(ce=new Float32Array(ge),R.projection.name!=="globe"){let we=P.aabb.min,Be=P.aabb.max,[Re,Ge]=V.getOpacityForBounds(ge,we[0],we[1],Be[0],Be[1]);se.overrideFog=Re>=de||Ge>=de}}let he=Ns(t,i.paint.get("model-cutoff-fade-range"));he.shouldRenderCutoff&&se.defines.push("RENDER_CUTOFF");let le=t.getOrCreateProgram("model",se);t.uploadCommonUniforms(S,le,null,ce,he),t.renderPass!=="shadow"&&fe&&fe.setupShadowsFromMatrix(u.nodeModelMatrix,le),le.draw(t,S.gl.TRIANGLES,A,m,y,P.material.doubleSided?kt.disabled:kt.backCCW,ee,i.id,P.vertexBuffer,P.indexBuffer,P.segments,i.paint,t.transform.zoom,void 0,oe)}function wh(u,t,i,d,m,y,x){let S;S=u.projection.name==="globe"?n.dl(i,u):[...i],n.ab.mat4.multiply(S,S,t.matrix);let A=n.ab.mat4.multiply([],d,S);if(t.meshes)for(let R of t.meshes){if(R.material.alphaMode!=="BLEND"){x.push({mesh:R,depth:0,modelIndex:m,worldViewProjection:A,nodeModelMatrix:S});continue}let P=n.ab.vec3.transformMat4([],R.centroid,A);!u.isOrthographic&&P[2]<=0||y.push({mesh:R,depth:P[2],modelIndex:m,worldViewProjection:A,nodeModelMatrix:S})}if(t.children)for(let R of t.children)wh(u,R,i,d,m,y,x)}function Bc(u,t,i,d){let m=i.shadowRenderer;if(!m)return;let y=m.getShadowPassDepthMode(),x=m.getShadowPassColorMode(),S=m.calculateShadowPassMatrixFromMatrix(t),A=ph(S);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,y,Ot.disabled,x,kt.backCCW,A,d.id,u.vertexBuffer,u.indexBuffer,u.segments,d.paint,i.transform.zoom,void 0,void 0)}function ko(u,t,i){let d=t.updateZoomBasedPaintProperties(),m=function(y,x,S){let A,R,P,k=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&k>0){let N=y.terrain,V=N.findDEMTileFor(S);V&&V.dem?A=n.dn.create(N,S,V):k=0}if(k===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),k===x.validForExaggeration&&(k===0||A&&A._demTile&&A._demTile.tileID===x.validForDEMTile.id&&A._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(let N in x.instancesPerModel){let V=x.instancesPerModel[N];for(let Z=0;Z<V.instancedDataArray.length;++Z){let G=(A?k*A.getElevationAt(0|V.instancedDataArray.float32[16*Z],0|V.instancedDataArray.float32[16*Z+1],!0,!0):0)+V.instancesEvaluatedElevation[Z];V.instancedDataArray.float32[16*Z+6]=G,R=R?Math.min(x.terrainElevationMin,G):G,P=P?Math.max(x.terrainElevationMax,G):G}}return x.terrainElevationMin=R||0,x.terrainElevationMax=P||0,x.validForExaggeration=k,x.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,i);(d||m)&&(t.uploaded=!1,t.upload(u.context))}let Yr={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.cd([0,0,0],[n.ag,n.ag,0])};function Eh(u,t){let i=1<<u.canonical.z,d=t.getFreeCameraOptions().position,m=t.elevation,y=u.canonical.x/i,x=(u.canonical.x+1)/i,S=u.canonical.y/i,A=(u.canonical.y+1)/i,R=t._centerAltitude;if(m){let V=m.getMinMaxForTile(u);V&&V.max>R&&(R=V.max)}let P=n.aw(d.x,y,x)-d.x,k=n.aw(d.y,S,A)-d.y,N=n.bH(R,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(P*P+k*k+N*N))}function Vc(u,t,i,d,m,y,x){let S=u.context,A=u.renderPass==="shadow",R=u.shadowRenderer,P=A&&R?R.getShadowPassDepthMode():new It(S.gl.LEQUAL,It.ReadWrite,u.depthRangeFor3D),k=u.isTileAffectedByFog(y);if(i.meshes)for(let N of i.meshes){let V=["MODEL_POSITION_ON_GPU"],Z=[],G,Y,X;d.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");let ee=Ns(u,t.paint.get("model-cutoff-fade-range"));if(ee.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),A&&R)G=u.getOrCreateProgram("modelDepth",{defines:V}),Y=ph(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(i.matrix)),X=R.getShadowPassColorMode();else{Pl(V,Z,N,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),G=u.getOrCreateProgram("model",{defines:V,overrideFog:k});let oe=N.material,fe=oe.pbrMetallicRoughness,ce=t.paint.get("model-opacity").constantOr(1),he=t.paint.get("model-emissive-strength").constantOr(0);Y=Lc(y.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),null,u,ce,fe.baseColorFactor.toRenderColor(null),oe.emissiveFactor,fe.metallicFactor,fe.roughnessFactor,oe,he,t,m),R&&(x.shadowUniformsInitialized?G.setShadowUniformValues(S,R.getShadowUniformValues()):(R.setupShadows(y.toUnwrapped(),G,"model-tile",y.overscaledZ),x.shadowUniformsInitialized=!0)),X=ee.shouldRenderCutoff||ce<1||oe.alphaMode!=="OPAQUE"?Jt.alphaBlended:Jt.unblended}u.uploadCommonUniforms(S,G,y.toUnwrapped(),null,ee);let se=N.material.doubleSided?kt.disabled:kt.backCCW;if(d.instancedDataArray.length>20)Z.push(d.instancedDataBuffer),G.draw(u,S.gl.TRIANGLES,P,Ot.disabled,X,se,Y,t.id,N.vertexBuffer,N.indexBuffer,N.segments,t.paint,u.transform.zoom,void 0,Z,d.instancedDataArray.length);else{let oe=A?"u_instance":"u_normal_matrix";for(let fe=0;fe<d.instancedDataArray.length;++fe)Y[oe]=new Float32Array(d.instancedDataArray.arrayBuffer,64*fe,16),G.draw(u,S.gl.TRIANGLES,P,Ot.disabled,X,se,Y,t.id,N.vertexBuffer,N.indexBuffer,N.segments,t.paint,u.transform.zoom,void 0,Z)}}if(i.children)for(let N of i.children)Vc(u,t,N,d,m,y,x)}let Wf=[1,-1,1];function Zf(u,t,i,d){if(!i.modelManager)return!0;let m=i.modelManager;if(!i.shadowRenderer)return!0;let y=i.shadowRenderer,x=t.aabb,S=!0,A=u.maxHeight;if(A===0){let P=0;for(let k in u.instancesPerModel){let N=m.getModel(k,d);N?P=Math.max(P,Math.max(Math.max(N.aabb.max[0],N.aabb.max[1]),N.aabb.max[2])):S=!1}A=u.maxScale*P*1.41+u.maxVerticalOffset,S&&(u.maxHeight=A)}x.max[2]=A,x.min[2]+=u.terrainElevationMin,x.max[2]+=u.terrainElevationMax,n.ab.vec3.transformMat4(x.min,x.min,t.tileMatrix),n.ab.vec3.transformMat4(x.max,x.max,t.tileMatrix);let R=x.intersects(y.getCurrentCascadeFrustum());return i.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=R===2),R===0}function Ea(u,t){let i=u.uniformValues.u_cutoff_params[0],d=u.uniformValues.u_cutoff_params[1],m=u.uniformValues.u_cutoff_params[2],y=u.uniformValues.u_cutoff_params[3];return d===i||y===m?1:n.aw(((t-i)/(d-i)-m)/(y-m),0,1)}function Xf(u,t,i,d){if(t.pitch<20)return 1;let m=t.getWorldToCameraMatrix();n.ab.mat4.multiply(m,m,u);let y=n.ab.vec4.fromValues(i.min[0],i.min[1],i.min[2],1),x=n.ab.vec4.transformMat4(n.ab.vec4.create(),y,m),S=x,A=x;y[1]=i.max[1],x=n.ab.vec4.transformMat4(n.ab.vec4.create(),y,m),S=x[1]<S[1]?x:S,A=x[1]>A[1]?x:A,y[0]=i.max[0],x=n.ab.vec4.transformMat4(n.ab.vec4.create(),y,m),S=x[1]<S[1]?x:S,A=x[1]>A[1]?x:A,y[1]=i.min[1],x=n.ab.vec4.transformMat4(n.ab.vec4.create(),y,m),S=x[1]<S[1]?x:S,A=x[1]>A[1]?x:A;let R=n.aw(d[0],0,1),P=100*t.pixelsPerMeter*n.aw(d[1],0,1),k=n.aw(d[2],0,1),N=n.ab.vec4.lerp(n.ab.vec4.create(),S,A,R),V=Math.tan(.5*t.fovX),Z=-N[2]*V;if(P===0)return N[1]<-Math.abs(Z)?k:1;let G=(-Math.abs(Z)-N[1])/P,Y=(ee,se,oe)=>(1-oe)*ee+oe*se,X=n.aw(Y(1,k,G),k,1);return Y(1,X,n.aw((t.pitch-20)/20,0,1))}class $s{}class Yf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,d){{let k=this._storage.get(i.id);if(k)return k.lastUsedFrameIdx=t,k.buf}let m=d.gl,y=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),x=new ArrayBuffer(y),S=new Int16Array(x);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));let A=new n.dq;for(let k=0;k<y/2;k+=3){let N=S[k],V=S[k+1],Z=S[k+2];A.emplaceBack(N,V),A.emplaceBack(V,Z),A.emplaceBack(Z,N)}let R=d.bindVertexArrayOES.current,P=new $s;return P.buf=new mh(d,A),P.lastUsedFrameIdx=t,this._storage.set(i.id,P),d.bindVertexArrayOES.set(R),P.buf}update(t){for(let[i,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(i))}destroy(){for(let[t,i]of this._storage)i.buf.destroy(),this._storage.delete(t)}}class Th{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}let Kf=n.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Jf{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Vr{constructor(t,i){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...i,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...i,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}let Qf=n.da([{type:"Float32",name:"a_pos_2f",components:2}]);class ep{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,i){let d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){let x=new n.dr,S=new n.aU;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(x,Qf.members),this.vignetteIdx=t.context.createIndexBuffer(S)}let m=n.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);let x={u_vignetteShape:(y={vignetteShape:[i.start,i.range,Math.pow(10,i.fadePower)],vignetteColor:[i.color.r,i.color.g,i.color.b,i.color.a*i.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,It.disabled,Ot.disabled,Jt.alphaBlended,kt.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,m,{})}var y}}class jc{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,i){let d=t.getFreeCameraOptions().position,m=d.toAltitude(),y=d.toLngLat(),x=n.ai(y.lng),S=n.ai(y.lat),A=t.pixelsPerMeter/i,R=x*n.ds,P=n.ds*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{let k=-this._offsetYPrev+P,N=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+R)*A,this._accumulatedOffsetY+=k*A,this._accumulatedElevation+=N*A,this._offsetXPrev=R,this._offsetYPrev=P,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Hs(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function Ih(u){let t=n.di(1323123451230),i=[];for(let d=0;d<u;++d){let m=2*t()-1,y=2*t()-1,x=2*t()-1;i.push(n.ab.vec3.fromValues(m,y,x))}return i}function Fo(u,t,i,d,m){let y=n.aw((m-i)/(d-i),0,1);return(1-y)*u+y*t}class Sh{constructor(t){this._movement=new jc,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new ep,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,i){let d=t.transform;this._movement.update(d,this._ppmScaleFactor);let m=d.starsProjMatrix,y=n.ab.quat.identity([]);n.ab.quat.rotateX(y,y,n.ai(90)-d._pitch),n.ab.quat.rotateZ(y,y,-d.angle);let x=n.ab.mat4.fromQuat(new Float32Array(16),y),S=n.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=n.ab.mat4.transpose([],S),R=n.ab.mat4.multiply([],A,x),P=Date.now()/1e3;return this._accumulatedTimeFromStart+=(P-this._prevTime)*i,this._prevTime=P,{projectionMatrix:m,modelviewMatrix:R}}}class Ol extends Sh{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Vr(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){let i=t.context;if(!this.particlesVx){let d=Ih(this.particlesCount),m=new n.dt,y=new n.aU,x=0,S=n.di(1323123451230);for(let A=0;A<d.length;++A){let R=d[A],P=[2*S()-1,S(),S(),S()];m.emplaceBack(R[0],R[1],R[2],-1,-1,...P),m.emplaceBack(R[0],R[1],R[2],1,-1,...P),m.emplaceBack(R[0],R[1],R[2],1,1,...P),m.emplaceBack(R[0],R[1],R[2],-1,1,...P),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=i.createVertexBuffer(m,Kf.members),this.particlesIdx=i.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;let i=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(i.revealStart>d)return;let m=Fo(0,1,i.revealStart,i.revealStart+i.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;let y=structuredClone(this._params),x=[-y.direction.x,y.direction.y,-100];n.ab.vec3.normalize(x,x);let S=structuredClone(this._vignetteParams);S.strength*=m,y.overrideStyleParameters||(y.intensity=t.style.rain.state.density,y.timeFactor=t.style.rain.state.intensity,y.color=structuredClone(t.style.rain.state.color),x=structuredClone(t.style.rain.state.direction),y.screenThinning.intensity=t.style.rain.state.centerThinning,y.dropletSizeX=t.style.rain.state.dropletSize[0],y.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],y.distortionStrength=100*t.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(t.style.rain.state.vignetteColor));let A=this.updateOnRender(t,y.timeFactor),R=t.context,P=R.gl,k=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new n.T(R,{width:t.width,height:t.height,data:null},P.RGBA8)),y.distortionStrength>0&&(R.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),P.copyTexSubImage2D(P.TEXTURE_2D,0,0,0,0,0,t.width,t.height));let N=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(R,N),R.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let V=[y.color.r,y.color.g,y.color.b,y.color.a],Z=(G,Y)=>{let X=Hs(this._movement.getPosition(),G),ee=y.dropletSizeX,se=y.dropletSizeX*y.dropletSizeYScale,oe=t.width/2,fe=t.height/2,ce=Fo(0,y.screenThinning.start,0,1,y.screenThinning.intensity),he=Fo(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),le=Fo(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),ge=(we={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:G,rainDropletSize:[ee,se],distortionStrength:y.distortionStrength,rainDirection:x,color:V,screenSize:[k.width,k.height],thinningCenterPos:[oe,fe],thinningShape:[ce,he,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:le,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:Y?0:1},{u_modelview:Float32Array.from(we.modelview),u_projection:Float32Array.from(we.projection),u_time:we.time,u_cam_pos:we.camPos,u_texScreen:0,u_velocityConeAperture:we.velocityConeAperture,u_velocity:we.velocity,u_boxSize:we.boxSize,u_rainDropletSize:we.rainDropletSize,u_distortionStrength:we.distortionStrength,u_rainDirection:we.rainDirection,u_color:we.color,u_screenSize:we.screenSize,u_thinningCenterPos:we.thinningCenterPos,u_thinningShape:we.thinningShape,u_thinningAffectedRatio:we.thinningAffectedRatio,u_thinningParticleOffset:we.thinningParticleOffset,u_shapeDirectionalPower:we.shapeDirectionalPower,u_shapeNormalPower:we.shapeNormalPower,u_mode:we.mode});var we;let Be=Math.round(y.intensity*this.particlesCount),Re=n.b7.simpleSegment(0,0,4*Be,2*Be);N.draw(t,P.TRIANGLES,It.disabled,Ot.disabled,Jt.alphaBlended,kt.disabled,ge,"rain_particles",this.particlesVx,this.particlesIdx,Re,{})};y.distortionStrength>0&&Z(y.boxSize,!0),Z(y.boxSize,!1),this._vignette.draw(t,S)}}let tp=n.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class np extends Sh{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Vr(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){let i=t.context;if(!this.particlesVx){let d=Ih(this.particlesCount),m=new n.du,y=new n.aU,x=0,S=n.di(1323123451230);for(let A=0;A<d.length;++A){let R=d[A],P=S(),k=S(),N=S(),V=[A/d.length,P,k,N],Z=[S(),S()];m.emplaceBack(R[0],R[1],R[2],-1,-1,...V,...Z),m.emplaceBack(R[0],R[1],R[2],1,-1,...V,...Z),m.emplaceBack(R[0],R[1],R[2],1,1,...V,...Z),m.emplaceBack(R[0],R[1],R[2],-1,1,...V,...Z),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=i.createVertexBuffer(m,tp.members),this.particlesIdx=i.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;let i=structuredClone(this._params),d=[-i.direction.x,i.direction.y,-100];n.ab.vec3.normalize(d,d);let m=structuredClone(this._vignetteParams),y=i.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=t.transform.zoom;if(y.revealStart>x)return;let S=Fo(0,1,y.revealStart,y.revealStart+y.revealRange,x);m.strength*=S,i.overrideStyleParameters||(i.intensity=t.style.snow.state.density,i.timeFactor=t.style.snow.state.intensity,i.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),i.screenThinning.intensity=t.style.snow.state.centerThinning,i.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));let A=this.updateOnRender(t,i.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;let R=t.context,P=R.gl,k=t.transform,N=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(R,N),((V,Z,G)=>{let Y=Hs(this._movement.getPosition(),V),X=k.width/2,ee=k.height/2,se=Fo(0,G.screenThinning.start,0,1,G.screenThinning.intensity),oe=Fo(.001,G.screenThinning.range,0,1,G.screenThinning.intensity),fe=Fo(0,G.screenThinning.particleOffset,0,1,G.screenThinning.intensity),ce=(he={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Y,velocityConeAperture:G.velocityConeAperture,velocity:G.velocity,horizontalOscillationRadius:G.horizontalOscillationRadius,horizontalOscillationRate:G.horizontalOscillationRate,boxSize:V,billboardSize:1*G.billboardSize,simpleShapeParameters:[G.shapeFadeStart,G.shapeFadePower],screenSize:[k.width,k.height],thinningCenterPos:[X,ee],thinningShape:[se,oe,Math.pow(10,G.screenThinning.fadePower)],thinningAffectedRatio:G.screenThinning.affectedRatio,thinningParticleOffset:fe,color:[G.color.r,G.color.g,G.color.b,G.color.a],direction:d},{u_modelview:Float32Array.from(he.modelview),u_projection:Float32Array.from(he.projection),u_time:he.time,u_cam_pos:he.camPos,u_velocityConeAperture:he.velocityConeAperture,u_velocity:he.velocity,u_horizontalOscillationRadius:he.horizontalOscillationRadius,u_horizontalOscillationRate:he.horizontalOscillationRate,u_boxSize:he.boxSize,u_billboardSize:he.billboardSize,u_simpleShapeParameters:he.simpleShapeParameters,u_screenSize:he.screenSize,u_thinningCenterPos:he.thinningCenterPos,u_thinningShape:he.thinningShape,u_thinningAffectedRatio:he.thinningAffectedRatio,u_thinningParticleOffset:he.thinningParticleOffset,u_particleColor:he.color,u_direction:he.direction});var he;let le=Math.round(G.intensity*this.particlesCount),ge=n.b7.simpleSegment(0,0,4*le,2*le);this.particlesVx&&this.particlesIdx&&N.draw(t,P.TRIANGLES,It.disabled,Ot.disabled,Jt.alphaBlended,kt.disabled,ce,"snow_particles",this.particlesVx,this.particlesIdx,ge,{})})(i.boxSize,0,i),this._vignette.draw(t,m)}}let Uc={symbol:function(u,t,i,d,m){if(u.renderPass!=="translucent")return;let y=Ot.disabled,x=u.colorModeForRenderPass(),S=i.layout.get("text-variable-anchor"),A=i.layout.get("text-size-scale-range"),R=n.aw(u.scaleFactor,A[0],A[1]);S&&function(N,V,Z,G,Y,X,ee,se){let oe=V.transform,fe=Y==="map",ce=X==="map";for(let he of N){let le=G.getTile(he),ge=le.getBucket(Z);if(!ge||!ge.text||!ge.text.segments.get().length)continue;let we=n.bp(ge.textSizeData,oe.zoom,se),Be=ca(he,ge.getProjection(),oe),Re=oe.calculatePixelsToTileUnitsMatrix(le),Ge=Nr(Be,le.tileID.canonical,ce,fe,oe,ge.getProjection(),Re),He=ge.hasIconTextFit()&&ge.hasIconData();if(we){let Me=Math.pow(2,oe.zoom-le.tileID.overscaledZ);_h(ge,fe,ce,ee,n.cX,oe,Ge,he,Me,we,He)}}}(d,u,i,t,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),m,R);let P=i.paint.get("icon-opacity").constantOr(1)!==0,k=i.paint.get("text-opacity").constantOr(1)!==0;i.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(P||k)?Fc(u,t,i,d,y,x):(P&&Fc(u,t,i,d,y,x,{onlyIcons:!0}),k&&Fc(u,t,i,d,y,x,{onlyText:!0})),t.map.showCollisionBoxes&&(gh(u,t,i,d,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),gh(u,t,i,d,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,i,d){if(u.renderPass!=="translucent")return;let m=i.paint.get("circle-opacity"),y=i.paint.get("circle-stroke-width"),x=i.paint.get("circle-stroke-opacity"),S=i.layout.get("circle-sort-key").constantOr(1)!==void 0,A=i.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(y.constantOr(1)===0||x.constantOr(1)===0))return;let R=u.context,P=R.gl,k=u.transform,N=u.depthModeForSublayer(0,It.ReadOnly),V=Ot.disabled,Z=u.colorModeForDrapableLayerRenderPass(A),G=k.projection.name==="globe",Y=[n.at(k.center.lng),n.aA(k.center.lat)],X=[];for(let se=0;se<d.length;se++){let oe=d[se],fe=t.getTile(oe),ce=fe.getBucket(i);if(!ce||ce.projection.name!==k.projection.name)continue;let he=ce.programConfigurations.get(i.id),le=n.cY(i),ge=u.isTileAffectedByFog(oe);G&&le.push("PROJECTION_GLOBE_VIEW"),le.push("DEPTH_D24"),u.terrain&&k.depthOcclusionForSymbolsAndCircles&&le.push("DEPTH_OCCLUSION");let we=u.getOrCreateProgram("circle",{config:he,defines:le,overrideFog:ge}),Be=ce.layoutVertexBuffer,Re=ce.globeExtVertexBuffer,Ge=ce.indexBuffer,He=k.projection.createInversionMatrix(k,oe.canonical),Me={programConfiguration:he,program:we,layoutVertexBuffer:Be,globeExtVertexBuffer:Re,indexBuffer:Ge,uniformValues:n.cZ(u,oe,fe,He,Y,i),tile:fe};if(S){let Ve=ce.segments.get();for(let Qe of Ve)X.push({segments:new n.b7([Qe]),sortKey:Qe.sortKey,state:Me})}else X.push({segments:ce.segments,sortKey:0,state:Me})}S&&X.sort((se,oe)=>se.sortKey-oe.sortKey);let ee={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(let se of X){let{programConfiguration:oe,program:fe,layoutVertexBuffer:ce,globeExtVertexBuffer:he,indexBuffer:le,uniformValues:ge,tile:we}=se.state,Be=se.segments;u.terrain&&u.terrain.setupElevationDraw(we,fe,ee),u.uploadCommonUniforms(R,fe,we.tileID.toUnwrapped()),fe.draw(u,P.TRIANGLES,N,V,Z,kt.disabled,ge,i.id,ce,le,Be,i.paint,k.zoom,oe,[he])}},heatmap:function(u,t,i,d){if(i.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){let m=u.context,y=m.gl,x=Ot.disabled,S=new Jt([y.ONE,y.ONE,y.ONE,y.ONE],n.aj.transparent,[!0,!0,!0,!0]);(function(V,Z,G,Y){let X=V.gl,ee=Z.width*Y,se=Z.height*Y;V.activeTexture.set(X.TEXTURE1),V.viewport.set([0,0,ee,se]);let oe=G.heatmapFbo;if(!oe||oe&&(oe.width!==ee||oe.height!==se)){oe&&oe.destroy();let fe=X.createTexture();X.bindTexture(X.TEXTURE_2D,fe),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),oe=G.heatmapFbo=V.createFramebuffer(ee,se,!0,null),function(ce,he,le,ge,we,Be){let Re=ce.gl;Re.texImage2D(Re.TEXTURE_2D,0,ce.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,we,Be,0,Re.RGBA,ce.extRenderToTextureHalfFloat?Re.HALF_FLOAT:Re.UNSIGNED_BYTE,null),ge.colorAttachment.set(le)}(V,0,fe,oe,ee,se)}else X.bindTexture(X.TEXTURE_2D,oe.colorAttachment.get()),V.bindFramebuffer.set(oe.framebuffer)})(m,u,i,u.transform.projection.name==="globe"?.5:.25),m.clear({color:n.aj.transparent});let A=u.transform,R=A.projection.name==="globe",P=R?["PROJECTION_GLOBE_VIEW"]:[],k=R?kt.frontCCW:kt.disabled,N=[n.at(A.center.lng),n.aA(A.center.lat)];for(let V=0;V<d.length;V++){let Z=d[V];if(t.hasRenderableParent(Z))continue;let G=t.getTile(Z),Y=G.getBucket(i);if(!Y||Y.projection.name!==A.projection.name)continue;let X=u.isTileAffectedByFog(Z),ee=Y.programConfigurations.get(i.id),se=u.getOrCreateProgram("heatmap",{config:ee,defines:P,overrideFog:X}),{zoom:oe}=u.transform;u.terrain&&u.terrain.setupElevationDraw(G,se),u.uploadCommonUniforms(m,se,Z.toUnwrapped());let fe=A.projection.createInversionMatrix(A,Z.canonical);se.draw(u,y.TRIANGLES,It.disabled,x,S,k,_t(u,Z,G,fe,N,oe,i.paint.get("heatmap-intensity")),i.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,i.paint,u.transform.zoom,ee,R?[Y.globeExtVertexBuffer]:null)}m.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(m,y){let x=m.context,S=x.gl,A=y.heatmapFbo;if(!A)return;x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),x.activeTexture.set(S.TEXTURE1);let R=y.colorRampTexture;R||(R=y.colorRampTexture=new n.T(x,y.colorRamp,S.RGBA8)),R.bind(S.LINEAR,S.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,S.TRIANGLES,It.disabled,Ot.disabled,m.colorModeForRenderPass(),kt.disabled,((P,k,N,V)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,y),y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(u,i))},line:function(u,t,i,d){if(u.renderPass!=="translucent")return;let m=i.paint.get("line-opacity"),y=i.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;let x=i.paint.get("line-emissive-strength"),S=i.paint.get("line-occlusion-opacity"),A=i.layout.get("line-elevation-reference"),R=i.layout.get("line-width-unit")==="meters",P=A==="sea",k=u.context,N=k.gl;if(i.hasElevatedBuckets&&u.transform.projection.name==="globe")return;let V=i.layout.get("line-cross-slope"),Z=V!==void 0,G=V<1,Y=u.colorModeForDrapableLayerRenderPass(x),X=u.terrain&&u.terrain.renderingToTexture,ee=X?1:n.q.devicePixelRatio,se=i.paint.get("line-dasharray"),oe=se.constantOr(1),fe=i.layout.get("line-cap"),ce=se.constantOr(null),he=fe.constantOr(null),le=i.paint.get("line-pattern"),ge=le.constantOr(1),we=le.constantOr(null),Be=i.paint.get("line-opacity").constantOr(1),Re=!ge&&Be!==1||u.depthOcclusion&&S>0&&S<1,Ge=i.paint.get("line-gradient"),He=ge?"linePattern":"line",Me=n.c_(i),Ve;if(X&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(Re=!1),S!==0&&u.depthOcclusion){let De=i.paint._values["line-opacity"];De&&De.value&&De.value.kind==="constant"?Ve=De.value:n.w(`Occlusion opacity for layer ${i.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&Me.push("VARIABLE_LINE_WIDTH");let Qe=(De,We,je,it,Ye)=>{for(let qe of De){let et=t.getTile(qe);if(ge&&!et.patternsLoaded())continue;let rt=et.getBucket(i);if(!rt||rt.hasZOffset&&!Ye||!rt.hasZOffset&&Ye)continue;u.prepareDrawTile();let dt=rt.programConfigurations.get(i.id),gt=u.isTileAffectedByFog(qe),Pt=u.getOrCreateProgram(He,{config:dt,defines:We,overrideFog:gt,overrideRtt:!Ye&&void 0});if(we&&et.imageAtlas){let jt=n.A.from(we).getPrimary().scaleSelf(ee).serialize(),fn=et.imageAtlas.patternPositions[jt];fn&&dt.setConstantPatternPositions(fn)}if(!ge&&ce&&he&&et.lineAtlas){let jt=et.lineAtlas.getDash(ce,he);jt&&dt.setConstantPatternPositions(jt)}let[Et,St]=i.paint.get("line-trim-offset");(he==="round"||he==="square")&&Et!==St&&(Et===0&&(Et-=1),St===1&&(St+=1));let Nt=X?qe.projMatrix:null,an=R?1/rt.tileToMeter/n.ar(et,1,u.transform.zoom):1,An=R?1/rt.tileToMeter/n.ar(et,1,Math.floor(u.transform.zoom)):1,ir=ge?n.c$(u,et,i,Nt,ee,an,An,[Et,St]):n.d0(u,et,i,Nt,rt.lineClipsArray.length,ee,an,An,[Et,St]);if(Ge){let jt=rt.gradients[i.id],fn=jt.texture;if(i.gradientVersion!==jt.version){let wt=256;if(i.stepInterpolant){let on=t.getSource().maxzoom,yn=qe.canonical.z===on?Math.ceil(1<<u.transform.maxZoom-qe.canonical.z):1;wt=n.aw(n.d1(rt.maxLineLength/n.ag*1024*yn),256,k.maxTextureSize)}jt.gradient=n.d2({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:wt,image:jt.gradient||void 0,clips:rt.lineClipsArray}),jt.texture?jt.texture.update(jt.gradient):jt.texture=new n.T(k,jt.gradient,N.RGBA8),jt.version=i.gradientVersion,fn=jt.texture}k.activeTexture.set(N.TEXTURE1),fn.bind(i.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}oe&&(k.activeTexture.set(N.TEXTURE0),et.lineAtlasTexture&&et.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),dt.updatePaintBuffers()),ge&&(k.activeTexture.set(N.TEXTURE0),et.imageAtlasTexture&&et.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),dt.updatePaintBuffers()),Ye&&!P&&u.terrain.setupElevationDraw(et,Pt),u.uploadCommonUniforms(k,Pt,qe.toUnwrapped());let Wn=jt=>{Ve!=null&&(Ve.value=Be*S),Pt.draw(u,N.TRIANGLES,je,jt,Y,kt.disabled,ir,i.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,i.paint,u.transform.zoom,dt,[rt.layoutVertexBuffer2,rt.patternVertexBuffer,rt.zOffsetVertexBuffer]),Ve!=null&&(Ve.value=Be)};if(Re&&!Ye){let jt=u.stencilModeForClipping(qe).ref;jt===0&&X&&k.clear({stencil:0});let fn={func:N.EQUAL,mask:255};ir.u_alpha_discard_threshold=.8,Wn(new Ot(fn,jt,255,N.KEEP,N.KEEP,N.INVERT)),ir.u_alpha_discard_threshold=0,Wn(new Ot(fn,jt,255,N.KEEP,N.KEEP,N.KEEP))}else Re&&Ye&&(ir.u_alpha_discard_threshold=.001),Wn(Ye?it:u.stencilModeForClipping(qe))}};if(i.hasNonElevatedBuckets){let De=!X&&u.terrain;S!==0&&De?n.w(`Occlusion opacity for layer ${i.id} is supported on terrain only if the layer has line-z-offset enabled.`):De?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${i.id}.`):Qe(d,Me,u.depthModeForSublayer(0,It.ReadOnly),Ot.disabled,!1)}if(i.hasElevatedBuckets){Me.push("ELEVATED"),Z&&Me.push(G?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),P&&Me.push("ELEVATION_REFERENCE_SEA");let De=Re?u.stencilModeFor3D():Ot.disabled,We=new It(u.depthOcclusion?N.GREATER:N.LEQUAL,It.ReadOnly,u.depthRangeFor3D);u.forceTerrainMode=!0,Qe(d,Me,We,De,!0),u.forceTerrainMode=!1}Re&&(u.resetStencilClippingMasks(),X&&k.clear({stencil:0})),S===0||u.depthOcclusion||X||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,i,d){let m=i.paint.get("fill-color"),y=i.paint.get("fill-opacity"),x=i.is3D(),S=new It(u.context.gl.LEQUAL,It.ReadWrite,u.depthRangeFor3D);if(y.constantOr(1)===0)return;let A=i.paint.get("fill-emissive-strength"),R=u.colorModeForDrapableLayerRenderPass(A),P=i.paint.get("fill-pattern"),k=u.opaquePassEnabledForLayer()&&!P.constantOr(1)&&m.constantOr(n.aj.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===k){let N=x?S:u.depthModeForSublayer(1,u.renderPass==="opaque"?It.ReadWrite:It.ReadOnly);$f(u,t,i,d,N,R,!1)}if(!x&&u.renderPass==="translucent"&&i.paint.get("fill-antialias")){let N=x?S:u.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,It.ReadOnly);$f(u,t,i,d,N,R,!0)}},"fill-extrusion":function(u,t,i,d){let m=i.paint.get("fill-extrusion-opacity"),y=u.context,x=y.gl,S=u.terrain,A=S&&S.renderingToTexture;if(m===0)return;let R=u.conflationActive&&u.style.isLayerClipped(i,t.getSource()),P=u.style.order.indexOf(i.fqid);if(R&&function(k,N,V,Z,G){for(let Y of Z){let X=N.getTile(Y).getBucket(V);X&&(X.updateReplacement(Y,k.replacementSource,G),X.uploadCentroid(k.context))}}(u,t,i,d,P),S||R)for(let k of d){let N=t.getTile(k).getBucket(i);N&&Ml(u.context,t,k,N,i,S,R)}if(u.renderPass==="shadow"&&u.shadowRenderer){let k=u.shadowRenderer;if(S&&m<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.a9)return;let N=k.getShadowPassDepthMode(),V=k.getShadowPassColorMode();Nc(u,t,i,d,N,Ot.disabled,V,R)}else if(u.renderPass==="translucent"){let k=!i.paint.get("fill-extrusion-pattern").constantOr(1),N=i.paint.get("fill-extrusion-color").constantOr(n.aj.white);if(!A&&N.a!==0){let V=new It(u.context.gl.LEQUAL,It.ReadWrite,u.depthRangeFor3D);m===1&&k?Nc(u,t,i,d,V,Ot.disabled,Jt.unblended,R):(Nc(u,t,i,d,V,Ot.disabled,Jt.disabled,R),Nc(u,t,i,d,V,u.stencilModeFor3D(),u.colorModeForRenderPass(),R),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&k&&(!S&&u.transform.projection.name!=="globe"||A)){let V=i.paint.get("fill-extrusion-opacity"),Z=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),G=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Y=i.paint.get("fill-extrusion-flood-light-intensity"),X=i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ee=i.paint.get("fill-extrusion-flood-light-color").toRenderColor(X?null:i.lut).toArray01().slice(0,3),se=Z>0&&G>0,oe=Y>0,fe=(he,le,ge)=>(1-ge)*he+ge*le,ce=he=>{let le=u.depthModeForSublayer(1,It.ReadOnly,x.LEQUAL,!0),ge=i.paint.get(he?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),we=fe(.1,3,ge),Be=u._showOverdrawInspector;if(!Be){let Re=new Ot({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Ge=new Jt([x.ONE,x.ONE,x.ONE,x.ONE],n.aj.transparent,[!1,!1,!1,!0],x.MIN);Dl(u,t,i,d,le,Re,Ge,kt.disabled,he,"sdf",V,Z,G,Y,ee,we,R,!1)}{let Re=Be?Ot.disabled:new Ot({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ge=Be?u.colorModeForRenderPass():new Jt([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],n.aj.transparent,[!0,!0,!0,!0]);Dl(u,t,i,d,le,Re,Ge,kt.disabled,he,"color",V,Z,G,Y,ee,we,R,!1)}};if(A){let he=(le,ge,we)=>{let Be=u.depthModeForSublayer(1,It.ReadOnly,x.LEQUAL,!1),Re=i.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ge=fe(.1,3,Re);{let He=new Jt([x.ONE,x.ONE,x.ONE,x.ONE],n.aj.transparent,[!1,!1,!1,!0]);Dl(u,t,i,d,Be,Ot.disabled,He,kt.disabled,le,"clear",V,Z,G,Y,ee,Ge,R,ge)}{let He=new Ot({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Me=new Jt([x.ONE,x.ONE,x.ONE,x.ONE],n.aj.transparent,[!1,!1,!1,!0],x.MIN);Dl(u,t,i,d,Be,He,Me,kt.disabled,le,"sdf",V,Z,G,Y,ee,Ge,R,ge)}{let He=le?x.ZERO:x.ONE_MINUS_DST_ALPHA,Me=new Ot({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ve=new Jt([He,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],n.aj.transparent,[!0,!0,!0,!0]);Dl(u,t,i,d,Be,Me,Ve,kt.disabled,le,"color",V,Z,G,Y,ee,Ge,R,ge)}{let He=new Jt([x.ONE,x.ONE,x.ONE,le?x.ZERO:x.ONE],n.aj.transparent,[!1,!1,!1,!0],le?x.FUNC_ADD:x.MAX);Dl(u,t,i,d,Be,Ot.disabled,He,kt.disabled,le,"clear",V,Z,G,Y,ee,Ge,R,ge,we)}};if(se||oe){let le;if(u.prepareDrawTile(),S){let ge=S.drapeBufferSize[0],we=S.drapeBufferSize[1];le=S.framebufferCopyTexture,le&&(!le||le.size[0]===ge&&le.size[1]===we)||(le&&le.destroy(),le=S.framebufferCopyTexture=new n.T(y,new n.r({width:ge,height:we}),x.RGBA8)),le.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,ge,we)}se&&he(!0,!1,le),oe&&he(!1,!0,le)}}else se&&ce(!0),oe&&ce(!1),(se||oe)&&u.resetStencilClippingMasks()}}},hillshade:function(u,t,i,d){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;let m=u.context,y=u.terrain&&u.terrain.renderingToTexture,[x,S]=u.renderPass!=="translucent"||y?[{},d]:u.stencilConfigForOverlap(d);for(let A of S){let R=t.getTile(A);if(R.needsHillshadePrepare&&u.renderPass==="offscreen")r0(u,R,i);else if(u.renderPass==="translucent"){let P=u.depthModeForSublayer(0,It.ReadOnly),k=i.paint.get("hillshade-emissive-strength"),N=u.colorModeForDrapableLayerRenderPass(k),V=y&&u.terrain?u.terrain.stencilModeForRTTOverlap(A):x[A.overscaledZ];cg(u,A,R,i,P,V,N)}}m.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,i,d,m,y){if(u.renderPass!=="translucent"||i.paint.get("raster-opacity")===0)return;let x=u.transform.projection.name==="globe",S=i.paint.get("raster-elevation")!==0,A=S&&x;if(u.renderElevatedRasterBackface&&!A)return;let R=u.context,P=R.gl,k=t.getSource(),N=function(ce,he,le,ge){let we=he.paint.get("raster-color"),Be=ce.type==="raster-array",Re=[],Ge=he.paint.get("raster-resampling"),He=he.paint.get("raster-color-mix"),Me=he.paint.get("raster-color-range"),Ve=[He[0],He[1],He[2],0],Qe=He[3],De=Ge==="nearest"?ge.NEAREST:ge.LINEAR;if(Be&&(Re.push("RASTER_ARRAY"),we||Re.push("RASTER_COLOR"),Ge==="linear"&&Re.push("RASTER_ARRAY_LINEAR"),De=ge.NEAREST,!Me&&ce.rasterLayers)){let We=ce.rasterLayers.find(({id:je})=>je===he.sourceLayer);We&&We.fields&&We.fields.range&&(Me=We.fields.range)}if(Me=Me||[0,1],we){Re.push("RASTER_COLOR"),le.activeTexture.set(ge.TEXTURE2),he.updateColorRamp(Me);let We=he.colorRampTexture;We||(We=he.colorRampTexture=new n.T(le,he.colorRamp,ge.RGBA8)),We.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}return{mix:Ve,range:Me,offset:Qe,defines:Re,resampling:De}}(k,i,R,P);if(k instanceof n.aJ&&!d.length&&!x)return;let V=i.paint.get("raster-emissive-strength"),Z=u.colorModeForDrapableLayerRenderPass(V),G=u.terrain&&u.terrain.renderingToTexture,Y=!u.options.moving,X=i.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(k instanceof n.aJ&&!d.length&&(k.onNorthPole||k.onSouthPole)){let ce=S?u.stencilModeFor3D():Ot.disabled;return void Pe(!!k.onNorthPole,null,u,t,i,V,N,kt.disabled,ce)}if(!d.length)return;let[ee,se]=k instanceof n.aJ||G?[{},d]:u.stencilConfigForOverlap(d),oe=se[se.length-1].overscaledZ;A&&N.defines.push("PROJECTION_GLOBE_VIEW"),S&&N.defines.push("RENDER_CUTOFF");let fe=(ce,he,le)=>{for(let ge of ce){let we=ge.toUnwrapped(),Be=t.getTile(ge);if(G&&(!Be||!Be.hasData()))continue;R.activeTexture.set(P.TEXTURE0);let Re=vh(Be,k,i,N);if(!Re||!Re.texture)continue;let{texture:Ge,mix:He,offset:Me,tileSize:Ve,buffer:Qe}=Re,De,We;G?(De=It.disabled,We=ge.projMatrix):S?(De=new It(P.LEQUAL,It.ReadWrite,u.depthRangeFor3D),We=x?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(we,Y)):(De=u.depthModeForSublayer(ge.overscaledZ-oe,i.paint.get("raster-opacity")===1?It.ReadWrite:It.ReadOnly,P.LESS),We=u.transform.calculateProjMatrix(we,Y));let je=u.terrain&&G?u.terrain.stencilModeForRTTOverlap(ge):ee[ge.overscaledZ],it=y?0:i.paint.get("raster-fade-duration");Be.registerFadeDuration(it);let Ye=t.findLoadedParent(ge,0),qe=Ac(Be,Ye,t,u.transform,it),et,rt;u.terrain&&u.terrain.prepareDrawTile(),R.activeTexture.set(P.TEXTURE0),Ge.bind(X,P.CLAMP_TO_EDGE),R.activeTexture.set(P.TEXTURE1),Ye?(Ye.texture&&Ye.texture.bind(X,P.CLAMP_TO_EDGE),et=Math.pow(2,Ye.tileID.overscaledZ-Be.tileID.overscaledZ),rt=[Be.tileID.canonical.x*et%1,Be.tileID.canonical.y*et%1]):Ge.bind(X,P.CLAMP_TO_EDGE),Ge.useMipmap&&R.extTextureFilterAnisotropic&&u.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);let dt=u.transform,gt,Pt=S?Tg(dt):[0,0,0,0],Et,St,Nt,an,An,ir=0;if(A&&k instanceof n.aJ&&k.coordinates.length>3)Et=Float32Array.from(n.bb(n.cH(new n.bT(0,0,0)))),St=Float32Array.from(dt.globeMatrix),Nt=Float32Array.from(n.cD(dt)),an=[n.at(dt.center.lng),n.aA(dt.center.lat)],gt=k.elevatedGlobePerspectiveTransform,An=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){let wt=n.cE(ge.canonical);ir=n.cF(wt.getCenter().lat),Et=Float32Array.from(n.bb(n.cH(ge.canonical))),St=Float32Array.from(dt.globeMatrix),Nt=Float32Array.from(n.cD(dt)),an=[n.at(dt.center.lng),n.aA(dt.center.lat)],gt=[0,0],An=Float32Array.from(n.cG(ge.canonical,wt,ir,dt.worldSize/dt._pixelsPerMercatorPixel))}else gt=k instanceof n.aJ?k.perspectiveTransform:[0,0],Et=new Float32Array(16),St=new Float32Array(9),Nt=new Float32Array(16),an=[0,0],An=new Float32Array(9);let Wn=Vs(We,Et,St,Nt,An,rt||[0,0],n.ae(u.transform.zoom),an,Pt,et||1,qe,i,gt,S?i.paint.get("raster-elevation"):0,2,He,Me,N.range,Ve,Qe,V),jt=u.isTileAffectedByFog(ge),fn=u.getOrCreateProgram("raster",{defines:N.defines,overrideFog:jt});if(u.uploadCommonUniforms(R,fn,we),k instanceof n.aJ){let wt=k.elevatedGlobeVertexBuffer,on=k.elevatedGlobeIndexBuffer;if(G||!x)k.boundsBuffer&&k.boundsSegments&&fn.draw(u,P.TRIANGLES,De,Ot.disabled,Z,kt.disabled,Wn,i.id,k.boundsBuffer,u.quadTriangleIndexBuffer,k.boundsSegments);else if(wt&&on){let yn=dt.zoom<=n.c6?k.elevatedGlobeSegments:k.getSegmentsForLongitude(dt.center.lng);yn&&fn.draw(u,P.TRIANGLES,De,Ot.disabled,Z,he,Wn,i.id,wt,on,yn)}}else if(A){De=new It(P.LEQUAL,It.ReadOnly,u.depthRangeFor3D);let wt=u.globeSharedBuffers;if(wt){let[on,yn,bn]=wt.getGridBuffers(ir,!1);fn.draw(u,P.TRIANGLES,De,le||je,u.colorModeForRenderPass(),he,Wn,i.id,on,yn,bn)}}else{let{tileBoundsBuffer:wt,tileBoundsIndexBuffer:on,tileBoundsSegments:yn}=u.getTileBoundsBuffers(Be);fn.draw(u,P.TRIANGLES,De,je,Z,kt.disabled,Wn,i.id,wt,on,yn)}}if(!(k instanceof n.aJ)&&A)for(let ge of ce){let we=ge.canonical.y===(1<<ge.canonical.z)-1;ge.canonical.y===0&&Pe(!0,ge,u,t,i,V,N,he,le||Ot.disabled),we&&Pe(!1,ge,u,t,i,V,N,he===kt.frontCW?kt.backCW:kt.frontCW,le||Ot.disabled)}};A?fe(se,u.renderElevatedRasterBackface?kt.backCW:kt.frontCW,u.stencilModeFor3D()):fe(se,kt.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,i,d,m,y){u.renderPass==="offscreen"&&function(x,S,A,R){if(!R.length)return;let P=x.context,k=P.gl,N=S.getSource();if(!(N instanceof Mr))return;let V=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count"))),Z=A.particlePositionRGBAImage;if(!Z||Z.width!==V){let se=function(oe){let fe=oe*oe,ce=new Uint8Array(4*fe),he=function(ge){return ge|=0,ge=Math.imul(2747636419^ge,2654435769),ge=Math.imul(ge^ge>>>16,2654435769),((ge=Math.imul(ge^ge>>>16,2654435769))>>>0)/4294967296},le=1/1.1;for(let ge=0;ge<fe;ge++){let we=le*(he(2*ge+0)+bt),Be=le*(he(2*ge+1)+bt),Re=255*we%1,Ge=255*Be%1,He=Re,Me=Be-Ge/255,Ve=Ge;ce[4*ge+0]=255*(we-Re/255),ce[4*ge+1]=255*He,ce[4*ge+2]=255*Me,ce[4*ge+3]=255*Ve}return ce}(V);Z=A.particlePositionRGBAImage=new n.r({width:V,height:V},se)}let G=A.particleFramebuffer;G?G.width!==V&&(G.destroy(),G=A.particleFramebuffer=P.createFramebuffer(V,V,!0,null)):G=A.particleFramebuffer=P.createFramebuffer(V,V,!0,null);let Y=[];for(let se of R){let oe=S.getTile(se);if(!(oe instanceof ks))continue;let fe=Sg(oe,N,A);if(!fe)continue;let ce=[oe.tileSize,oe.tileSize],he=A.tileFramebuffer;he||(he=A.tileFramebuffer=P.createFramebuffer(ce[0],ce[1],!0,null));let le=oe.rasterParticleState;le||(le=oe.rasterParticleState=new Ig(P,se,ce,Z));let ge=le.update(A.lastInvalidatedAt);le.particleTextureDimension!==V&&le.updateParticleTexture(se,Z);let we=le.targetColorTexture;le.targetColorTexture=le.backgroundColorTexture,le.backgroundColorTexture=we;let Be=le.particleTexture0;le.particleTexture0=le.particleTexture1,le.particleTexture1=Be,Y.push([se,fe,le,ge])}if(Y.length===0)return;let X=n.q.now(),ee=A.previousDrawTimestamp?.001*(X-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=X,A.hasColorMap()){P.activeTexture.set(k.TEXTURE0+2);let se=A.colorRampTexture;se||(se=A.colorRampTexture=new n.T(P,A.colorRamp,k.RGBA8)),se.bind(k.LINEAR,k.CLAMP_TO_EDGE)}P.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(se,oe,fe){let ce=se.context,he=ce.gl,le=oe.tileFramebuffer;ce.activeTexture.set(he.TEXTURE0);let ge={u_texture:0,u_opacity:1.05*(Be=oe.paint.get("raster-particle-fade-opacity-factor"))/(Be+.05)},we=se.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Be;for(let Re of fe){let[,,Ge,He]=Re;le.colorAttachment.set(Ge.targetColorTexture.texture),ce.viewport.set([0,0,le.width,le.height]),ce.clear({color:n.aj.transparent}),He&&(Ge.backgroundColorTexture.bind(he.NEAREST,he.CLAMP_TO_EDGE),we.draw(se,he.TRIANGLES,It.disabled,Ot.disabled,Jt.alphaBlended,kt.disabled,ge,oe.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments))}}(x,A,Y),function(se,oe,fe,ce){let he=se.context,le=he.gl,ge=fe.tileFramebuffer,we=se.transform.projection.name==="globe",Be=fe.paint.get("raster-particle-max-speed");for(let Re of ce){let[Ge,He,Me]=Re;he.activeTexture.set(le.TEXTURE0+0),He.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),ge.colorAttachment.set(Me.targetColorTexture.texture);let Ve=se.getOrCreateProgram("rasterParticleDraw",{defines:He.defines,overrideFog:!1});he.activeTexture.set(le.TEXTURE0+1);let Qe=He.scalarData?[]:[0,1,2,3].map(je=>n.d4[je](Ge));Qe.push(Ge);let De=Ge.canonical.x,We=Ge.canonical.y;for(let je of Qe){let it=oe.getTile(we?je.wrapped():je);if(!it)continue;let Ye=it.rasterParticleState;if(!Ye)continue;let qe=je.canonical.x+(1<<je.canonical.z)*(je.wrap-Ge.wrap),et=je.canonical.y;Ye.particleTexture0.bind(le.NEAREST,le.CLAMP_TO_EDGE);let rt=m0(1,Ye.particleTexture0.size[0],[qe-De,et-We],0,He.texture.size,2,Be,He.textureOffset,He.scale,He.offset);Ve.draw(se,le.POINTS,It.disabled,Ot.disabled,Jt.alphaBlended,kt.disabled,rt,fe.id,Ye.particleIndexBuffer,void 0,Ye.particleSegment)}}}(x,S,A,Y),P.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(se,oe,fe,ce){let he=se.context,le=he.gl,ge=oe.paint.get("raster-particle-max-speed"),we=ce*oe.paint.get("raster-particle-speed-factor")*.15,Be=function(Ge){return Math.pow(Ge,6)}(.01+1*oe.paint.get("raster-particle-reset-rate-factor")),Re=oe.particleFramebuffer;he.viewport.set([0,0,Re.width,Re.height]);for(let Ge of fe){let[,He,Me]=Ge;he.activeTexture.set(le.TEXTURE0+0),He.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),he.activeTexture.set(le.TEXTURE0+1);let Ve=Me.particleTexture0;Ve.bind(le.NEAREST,le.CLAMP_TO_EDGE);let Qe=g0(1,Ve.size[0],0,He.texture.size,ge,we,Be,He.textureOffset,He.scale,He.offset);Re.colorAttachment.set(Me.particleTexture1.texture),he.clear({color:n.aj.transparent}),se.getOrCreateProgram("rasterParticleUpdate",{defines:He.defines}).draw(se,le.TRIANGLES,It.disabled,Ot.disabled,Jt.unblended,kt.disabled,Qe,oe.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments)}}(x,A,Y,ee)}(u,t,i,d),u.renderPass==="translucent"&&(function(x,S,A,R,P){let k=x.context,N=k.gl,V=S.getSource().tileSize,Z=5*(1-n.ac(n.bY,n.bY+1,x.transform.zoom))*V+A.paint.get("raster-particle-elevation"),G=!x.options.moving,Y=x.transform.projection.name==="globe";if(!R.length)return;let[X,ee]=x.stencilConfigForOverlap(R),se=[];Y&&se.push("PROJECTION_GLOBE_VIEW");let oe=x.stencilModeFor3D();for(let fe of ee){let ce=fe.toUnwrapped(),he=S.getTile(fe);if(!he.rasterParticleState)continue;let le=he.rasterParticleState,ge=100;he.registerFadeDuration(ge);let we=S.findLoadedParent(fe,0),Be=Ac(he,we,S,x.transform,ge),Re,Ge;x.terrain&&x.terrain.prepareDrawTile(),k.activeTexture.set(N.TEXTURE0),le.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),k.activeTexture.set(N.TEXTURE1),we&&we.rasterParticleState?(we.rasterParticleState.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Re=Math.pow(2,we.tileID.overscaledZ-he.tileID.overscaledZ),Ge=[he.tileID.canonical.x*Re%1,he.tileID.canonical.y*Re%1]):le.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);let He=Y?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(ce,G),Me=x.transform,Ve=Dg(Me),Qe=n.cE(fe.canonical),De=n.cF(Qe.getCenter().lat),We,je,it,Ye,qe;Y?(We=Float32Array.from(n.bb(n.cH(fe.canonical))),je=Float32Array.from(Me.globeMatrix),it=Float32Array.from(n.cD(Me)),Ye=[n.at(Me.center.lng),n.aA(Me.center.lat)],qe=Float32Array.from(n.cG(fe.canonical,Qe,De,Me.worldSize/Me._pixelsPerMercatorPixel))):(We=new Float32Array(16),je=new Float32Array(9),it=new Float32Array(16),Ye=[0,0],qe=new Float32Array(9));let et=Ff(He,We,je,it,qe,Ge||[0,0],n.ae(x.transform.zoom),Ye,Ve,Re||1,Be,Z),rt=x.isTileAffectedByFog(fe),dt=x.getOrCreateProgram("rasterParticle",{defines:se,overrideFog:rt});if(x.uploadCommonUniforms(k,dt,ce),Y){let gt=new It(N.LEQUAL,It.ReadOnly,x.depthRangeFor3D),Pt=0,Et=x.globeSharedBuffers;if(Et){let[St,Nt,an]=Et.getGridBuffers(De,Pt!==0);dt.draw(x,N.TRIANGLES,gt,oe,Jt.alphaBlended,x.renderElevatedRasterBackface?kt.frontCCW:kt.backCCW,et,A.id,St,Nt,an)}}else{let gt=x.depthModeForSublayer(0,It.ReadOnly),Pt=X[fe.overscaledZ],{tileBoundsBuffer:Et,tileBoundsIndexBuffer:St,tileBoundsSegments:Nt}=x.getTileBoundsBuffers(he);dt.draw(x,N.TRIANGLES,gt,Pt,Jt.alphaBlended,kt.disabled,et,A.id,Et,St,Nt)}}x.resetStencilClippingMasks()}(u,t,i,d),u.style.map.triggerRepaint())},background:function(u,t,i,d){let m=i.paint.get("background-color"),y=i.paint.get("background-color-use-theme").constantOr("default")==="none",x=i.paint.get("background-opacity"),S=i.paint.get("background-emissive-strength"),A=i.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;let R=u.context,P=R.gl,k=u.transform,N=k.tileSize,V=i.paint.get("background-pattern"),Z;if(V!==void 0&&(V===null||(Z=u.imageManager.getPattern(V.toString(),i.scope,u.style.getLut(i.scope)),!Z)))return;let G=!V&&m.a===1&&x===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==G)return;let Y=Ot.disabled,X=u.depthModeForSublayer(0,G==="opaque"?It.ReadWrite:It.ReadOnly),ee=u.colorModeForDrapableLayerRenderPass(S),se=V?"backgroundPattern":"background",oe,fe=d;if(fe||(oe=u.getBackgroundTiles(),fe=Object.values(oe).map(ce=>ce.tileID)),V&&(R.activeTexture.set(P.TEXTURE0),u.imageManager.bind(u.context,i.scope)),A){let ce=u.getOrCreateProgram(se,{overrideFog:!1,overrideRtt:!0}),he=new Float32Array(n.ab.mat4.identity([])),le=new n.aG(0,0,0,0,0),ge=V?Eg(he,S,x,u,0,i.scope,Z,A,{tileID:le,tileSize:N}):zf(he,S,x,m.toRenderColor(y?null:i.lut));ce.draw(u,P.TRIANGLES,X,Y,ee,kt.disabled,ge,i.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(let ce of fe){let he=u.isTileAffectedByFog(ce),le=u.getOrCreateProgram(se,{overrideFog:he}),ge=ce.toUnwrapped(),we=d?ce.projMatrix:u.transform.calculateProjMatrix(ge);u.prepareDrawTile();let Be=t?t.getTile(ce):oe?oe[ce.key]:new Ls(ce,N,k.zoom,u),Re=V?Eg(we,S,x,u,0,i.scope,Z,A,{tileID:ce,tileSize:N}):zf(we,S,x,m.toRenderColor(y?null:i.lut));u.uploadCommonUniforms(R,le,ge);let{tileBoundsBuffer:Ge,tileBoundsIndexBuffer:He,tileBoundsSegments:Me}=u.getTileBoundsBuffers(Be);le.draw(u,P.TRIANGLES,X,Y,ee,kt.disabled,Re,i.id,Ge,He,Me)}},sky:function(u,t,i){let d=u._atmosphere?n.ae(u.transform.zoom):1,m=i.paint.get("sky-opacity")*d;if(m===0)return;let y=u.context,x=i.paint.get("sky-type"),S=new It(y.gl.LEQUAL,It.ReadOnly,[0,1]),A=u.frameCounter/1e3%1;x==="atmosphere"?u.renderPass==="offscreen"?i.needsSkyboxCapture(u)&&(function(R,P,k,N){let V=R.context,Z=V.gl,G=P.skyboxFbo;if(!G){G=P.skyboxFbo=V.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new Cg(V),P.skyboxTexture=V.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,P.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let se=0;se<6;++se)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(G.framebuffer),V.viewport.set([0,0,32,32]);let Y=P.getCenter(R,!0),X=R.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);n.ab.mat4.identity(ee),n.ab.mat4.rotateY(ee,ee,.5*-Math.PI),kr(R,P,X,ee,Y,0),n.ab.mat4.identity(ee),n.ab.mat4.rotateY(ee,ee,.5*Math.PI),kr(R,P,X,ee,Y,1),n.ab.mat4.identity(ee),n.ab.mat4.rotateX(ee,ee,.5*-Math.PI),kr(R,P,X,ee,Y,2),n.ab.mat4.identity(ee),n.ab.mat4.rotateX(ee,ee,.5*Math.PI),kr(R,P,X,ee,Y,3),n.ab.mat4.identity(ee),kr(R,P,X,ee,Y,4),n.ab.mat4.identity(ee),n.ab.mat4.rotateY(ee,ee,Math.PI),kr(R,P,X,ee,Y,5),V.viewport.set([0,0,R.width,R.height])}(u,i),i.markSkyboxValid(u)):u.renderPass==="sky"&&function(R,P,k,N,V){let Z=R.context,G=Z.gl,Y=R.transform,X=R.getOrCreateProgram("skybox");Z.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,P.skyboxTexture);let ee=((se,oe,fe,ce,he)=>({u_matrix:se,u_sun_direction:oe,u_cubemap:0,u_opacity:ce,u_temporal_offset:he}))(Y.skyboxMatrix,P.getCenter(R,!1),0,N,V);R.uploadCommonUniforms(Z,X),X.draw(R,G.TRIANGLES,k,Ot.disabled,R.colorModeForRenderPass(),kt.backCW,ee,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(u,i,S,m,A):x==="gradient"&&u.renderPass==="sky"&&function(R,P,k,N,V){let Z=R.context,G=Z.gl,Y=R.transform,X=R.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new Cg(Z)),Z.activeTexture.set(G.TEXTURE0);let ee=P.colorRampTexture;ee||(ee=P.colorRampTexture=new n.T(Z,P.colorRamp,G.RGBA8)),ee.bind(G.LINEAR,G.CLAMP_TO_EDGE);let se=((oe,fe,ce,he,le)=>({u_matrix:oe,u_color_ramp:0,u_center_direction:fe,u_radius:n.ai(ce),u_opacity:he,u_temporal_offset:le}))(Y.skyboxMatrix,P.getCenter(R,!1),P.paint.get("sky-gradient-radius"),N,V);R.uploadCommonUniforms(Z,X),X.draw(R,G.TRIANGLES,k,Ot.disabled,R.colorModeForRenderPass(),kt.backCW,se,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(u,i,S,m,A)},debug:function(u,t,i,d,m,y){for(let x=0;x<i.length;x++)if(m){let R=new n.aj(d.r*.8,d.g*.8,d.b*.8,1);Us(u,t,i[x],d,-1,-1,y),Us(u,t,i[x],d,-1,1,y),Us(u,t,i[x],d,1,1,y),Us(u,t,i[x],d,1,-1,y),Us(u,t,i[x],R,0,0,y)}else Us(u,t,i[x],d,0,0,y)},custom:function(u,t,i,d){let m=u.context,y=i.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&i.isDraped(t)){if(u.renderPass==="offscreen"){let x=y.prerender;if(x){if(u.setCustomLayerDefaults(),m.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){let S=u.transform.pointMerc;x.call(y,m.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.ae(u.transform.zoom),[S.x,S.y],u.transform.pixelsPerMeterRatio)}else x.call(y,m.gl,u.transform.customLayerMatrix());m.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){let S=y.renderToTile;if(S){let A=d[0].canonical,R=new n.aa(A.x+d[0].wrap*(1<<A.z),A.y,A.z);m.setDepthMode(It.disabled),m.setStencilMode(Ot.disabled),m.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),S.call(y,m.gl,R),m.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),m.setColorMode(u.colorModeForRenderPass()),m.setStencilMode(Ot.disabled);let x=y.renderingMode==="3d"?new It(u.context.gl.LEQUAL,It.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,It.ReadOnly);if(m.setDepthMode(x),u.transform.projection.name==="globe"){let S=u.transform.pointMerc;y.render(m.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.ae(u.transform.zoom),[S.x,S.y],u.transform.pixelsPerMeterRatio)}else y.render(m.gl,u.transform.customLayerMatrix());m.setDirty(),u.setBaseState(),m.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,i,d){if(u.renderPass==="opaque")return;let m=i.paint.get("model-opacity").constantOr(1);if(m===0)return;let y=i.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!y||u.terrain&&m<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof n.a9))return;let x=u.shadowRenderer,S=i.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,S||(x.enabled=!1));let A=()=>{x&&(x.useNormalOffset=!0,S||(x.enabled=!0))},R=t.getSource();if(u.renderPass==="light-beam"&&R.type!=="batched-model")return;if(R.type==="vector"||R.type==="geojson")return function(X,ee,se,oe,fe){let ce=X.transform;if(ce.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${ce.projection.name} projection is not yet implemented`);let he=ce.getFreeCameraOptions().position;if(!X.modelManager)return;let le=X.modelManager;se.modelManager=le;let ge=X.shadowRenderer;if(!se._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let we=se._unevaluatedLayout._values["model-id"],Be=Object.assign({},se.layout.get("model-id").parameters),Re=X.style.order.indexOf(se.fqid);for(let Ge of oe){let He=ee.getTile(Ge).getBucket(se);if(!He||He.projection.name!==ce.projection.name)continue;let Me=He.getModelUris();Me&&!He.modelsRequested&&(le.addModelsFromBucket(Me,fe),He.modelsRequested=!0);let Ve=Eh(Ge,ce);Be.zoom=Ve;let Qe=we.possiblyEvaluate(Be);if(ko(X,He,Ge),Yr.shadowUniformsInitialized=!1,Yr.useSingleShadowCascade=!!ge&&ge.getMaxCascadeForTile(Ge.toUnwrapped())===0,X.renderPass==="shadow"&&ge){if(X.currentShadowCascade===1&&He.isInsideFirstShadowMapFrustum)continue;let je=ce.calculatePosMatrix(Ge.toUnwrapped(),ce.worldSize);if(Yr.tileMatrix.set(je),Yr.shadowTileMatrix=Float32Array.from(ge.calculateShadowPassMatrixFromMatrix(je)),Yr.aabb.min.fill(0),Yr.aabb.max[0]=Yr.aabb.max[1]=n.ag,Yr.aabb.max[2]=0,Zf(He,Yr,X,se.scope))continue}let De=1<<Ge.canonical.z,We=[((he.x-Ge.wrap)*De-Ge.canonical.x)*n.ag,(he.y*De-Ge.canonical.y)*n.ag,he.z*De*n.ag];X.conflationActive&&Object.keys(He.instancesPerModel).length>0&&X.style.isLayerClipped(se,ee.getSource())&&He.updateReplacement(Ge,X.replacementSource,Re,fe)&&(He.uploaded=!1,He.upload(X.context));for(let je in He.instancesPerModel){let it=He.instancesPerModel[je];it.features.length>0&&(je=Qe.evaluate(it.features[0].feature,{}));let Ye=le.getModel(je,fe);if(Ye&&Ye.uploaded)for(let qe of Ye.nodes)Vc(X,se,qe,it,We,Ge,Yr)}}}(u,t,i,d,R.type==="vector"?i.scope:""),void A();if(!R.loaded())return;if(R.type==="batched-model")return function(X,ee,se,oe){se.resetLayerRenderingStats(X);let fe=X.context,ce=X.transform,he=X.style.fog,le=X.shadowRenderer;if(ce.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${ce.projection.name} projection is not yet implemented`);let ge=X.transform.getFreeCameraOptions().position,we=n.ab.vec3.scale([],[ge.x,ge.y,ge.z],X.transform.worldSize),Be=n.ab.vec3.negate([],we),Re=n.ab.mat4.identity([]),Ge=n.dj(ce.center.lat,ce.zoom),He=n.ab.mat4.fromScaling([],[1,1,1/Ge]);n.ab.mat4.translate(Re,Re,Be);let Me=se.paint.get("model-opacity").constantOr(1),Ve=new It(fe.gl.LEQUAL,It.ReadWrite,X.depthRangeFor3D),Qe=new It(fe.gl.LEQUAL,It.ReadOnly,X.depthRangeFor3D),De=new n.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),We=X.renderPass==="shadow",je=We&&le?le.getCurrentCascadeFrustum():ce.getFrustum(ce.scaleZoom(ce.worldSize)),it=se.paint.get("model-front-cutoff"),Ye=it[2]<1,qe=Ns(X,se.paint.get("model-cutoff-fade-range")),et=se.getLayerRenderingStats();(function(rt,dt,gt,Pt){let Et=rt.terrain?rt.terrain.exaggeration():0,St=rt.transform.zoom;for(let Nt of Pt){let an=dt.getTile(Nt).getBucket(gt);an&&(rt.conflationActive&&an.updateReplacement(Nt,rt.replacementSource),an.evaluateScale(rt,gt),rt.terrain&&Et>0&&an.elevationUpdate(rt.terrain,Et,Nt,gt.source),an.needsReEvaluation(rt,St,gt)&&an.evaluate(gt))}})(X,ee,se,oe),function(){let rt,dt,gt;Ye?(rt=oe.length-1,dt=-1,gt=-1):(rt=0,dt=oe.length,gt=1);let Pt=new Float64Array(16),Et=n.ab.vec3.create(),St=new n.P(0,0);for(let Nt=rt;Nt!==dt;Nt+=gt){let an=oe[Nt],An=ee.getTile(an).getBucket(se);if(!An||!An.uploaded)continue;let ir=!1;le&&(ir=le.getMaxCascadeForTile(an.toUnwrapped())===0);let Wn=ce.calculatePosMatrix(an.toUnwrapped(),ce.worldSize),jt=An.modelTraits;!We&&Ye&&(n.ab.mat4.invert(Pt,Wn),n.ab.vec3.transformMat4(Et,we,Pt),St.x=Et[0],St.y=Et[1]);let fn=[];for(let wt of An.getNodesInfo()){if(wt.hiddenByReplacement||!wt.node.meshes)continue;let on=wt.node,yn=0;X.terrain&&on.elevation&&(yn=on.elevation*X.terrain.exaggeration());let bn=(()=>{let un=wt.aabb;return De.min=[...un.min],De.max=[...un.max],De.min[2]+=yn,De.max[2]+=yn,n.ab.vec3.transformMat4(De.min,De.min,Wn),n.ab.vec3.transformMat4(De.max,De.max,Wn),De})(),tr=wt.evaluatedScale;if(tr[0]<=1&&tr[1]<=1&&tr[2]<=1&&bn.intersects(je)===0)continue;if(!We&&Ye){let un=.16666666666666666;wt.cameraCollisionOpacity=we[0]>bn.min[0]&&we[0]<bn.max[0]&&we[1]>bn.min[1]&&we[1]<bn.max[1]&&we[2]*Ge<bn.max[2]&&on.footprint&&n.bA(St,on.footprint)?Math.max(wt.cameraCollisionOpacity-un,0):Math.min(1,wt.cameraCollisionOpacity+un)}let Rr=[...Wn],Er=on.anchor?on.anchor[0]:0,Tr=on.anchor?on.anchor[1]:0;n.ab.mat4.translate(Rr,Rr,[Er*(tr[0]-1),Tr*(tr[1]-1),yn]),n.ab.vec3.exactEquals(tr,n.dm)||n.ab.mat4.scale(Rr,Rr,tr);let Ui=n.ab.mat4.multiply([],Rr,on.matrix),Kr=n.ab.mat4.multiply([],ce.expandedFarZProjMatrix,Ui),nr=n.ab.mat4.multiply([],ce.expandedFarZProjMatrix,Rr),Un=n.ab.vec4.transformMat4([],[Er,Tr,yn,1],Kr)[2];on.hidden=!1;let zn=Me;We||(Ye&&(zn*=wt.cameraCollisionOpacity,zn*=Xf(Rr,ce,wt.aabb,it)),zn*=Ea(qe,Un)),zn!==0?fn.push({nodeInfo:wt,depth:Un,opacity:zn,wvpForNode:Kr,wvpForTile:nr,nodeModelMatrix:Ui,tileModelMatrix:Rr}):on.hidden=!0}We||fn.sort((wt,on)=>!Ye||wt.opacity===1&&on.opacity===1?wt.depth<on.depth?-1:1:wt.opacity===1?-1:on.opacity===1?1:wt.depth>on.depth?-1:1);for(let wt of fn){let on=wt.nodeInfo,yn=on.node,bn=n.ab.mat4.multiply([],He,wt.tileModelMatrix);n.ab.mat4.multiply(bn,Re,bn);let tr=n.ab.mat4.invert([],bn);n.ab.mat4.transpose(tr,tr),n.ab.mat4.scale(tr,tr,Wf),bn=n.ab.mat4.multiply(bn,bn,yn.matrix);let Rr=X.renderPass==="light-beam",Er=se.paint.get("model-color-use-theme").constantOr("default")==="none",Tr=jt&n.dp.HasMapboxMeshFeatures,Ui=Tr?0:on.evaluatedRMEA[0][2];for(let Kr=0;Kr<yn.meshes.length;++Kr){let nr=yn.meshes[Kr],Un=Kr===yn.lightMeshIndex,zn=wt.wvpForNode;if(Un){if(!Rr&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}zn=wt.wvpForTile}else if(Rr)continue;let un={defines:[]},mr=[];if(!We&&le&&(le.useNormalOffset=!!nr.normalBuffer),Pl(un.defines,mr,nr,X,Er?null:se.lut),Tr||un.defines.push("DIFFUSE_SHADED"),ir&&un.defines.push("SHADOWS_SINGLE_CASCADE"),et&&(We?et.numRenderedVerticesInShadowPass+=nr.vertexArray.length:et.numRenderedVerticesInTransparentPass+=nr.vertexArray.length),We){Bc(nr,wt.nodeModelMatrix,X,se);continue}let Pr=null;if(he){let Bo=hs(wt.nodeModelMatrix,X.transform);if(Pr=new Float32Array(Bo),ce.projection.name!=="globe"){let eo=nr.aabb.min,$i=nr.aabb.max,[Ca,Vo]=he.getOpacityForBounds(Bo,eo[0],eo[1],$i[0],$i[1]);un.overrideFog=Ca>=de||Vo>=de}}let Vn=nr.material,Jr;Vn.occlusionTexture&&Vn.occlusionTexture.offsetScale&&(Jr=Vn.occlusionTexture.offsetScale,un.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let Qi=X.getOrCreateProgram("model",un);!We&&le&&le.setupShadowsFromMatrix(wt.tileModelMatrix,Qi,le.useNormalOffset),X.uploadCommonUniforms(fe,Qi,null,Pr);let Oi=Vn.pbrMetallicRoughness;Oi.metallicFactor=.9,Oi.roughnessFactor=.5;let wi=Lc(new Float32Array(zn),new Float32Array(bn),new Float32Array(tr),new Float32Array(yn.matrix),X,wt.opacity,Oi.baseColorFactor.toRenderColor(null),Vn.emissiveFactor,Oi.metallicFactor,Oi.roughnessFactor,Vn,Ui,se,[0,0,0],Jr);!Un&&(on.hasTranslucentParts||wt.opacity<1)&&Qi.draw(X,fe.gl.TRIANGLES,Ve,Ot.disabled,Jt.disabled,kt.backCCW,wi,se.id,nr.vertexBuffer,nr.indexBuffer,nr.segments,se.paint,X.transform.zoom,void 0,mr),Qi.draw(X,fe.gl.TRIANGLES,Un?Qe:Ve,Ot.disabled,Un||wt.opacity<1||on.hasTranslucentParts?Jt.alphaBlended:Jt.unblended,kt.backCCW,wi,se.id,nr.vertexBuffer,nr.indexBuffer,nr.segments,se.paint,X.transform.zoom,void 0,mr)}}}}()}(u,t,i,d),void A();if(R.type!=="model")return;let P=R.getModels(),k=[],N=u.transform.getFreeCameraOptions().position,V=n.ab.vec3.scale([],[N.x,N.y,N.z],u.transform.worldSize);n.ab.vec3.negate(V,V);let Z=[],G=[],Y=0;for(let X of P){let ee=i.paint.get("model-rotation").constantOr(null),se=i.paint.get("model-scale").constantOr(null),oe=i.paint.get("model-translation").constantOr(null);X.computeModelMatrix(u,ee,se,oe,!0,!0,!1);let fe=n.ab.mat4.identity([]),ce=n.dj(X.position.lat,u.transform.zoom),he=n.ab.mat4.fromScaling([],[1,1,1/ce]);n.ab.mat4.translate(fe,fe,V),k.push({zScaleMatrix:he,negCameraPosMatrix:fe});for(let le of X.nodes)wh(u.transform,le,X.matrix,u.transform.expandedFarZProjMatrix,Y,Z,G);Y++}if(Z.sort((X,ee)=>ee.depth-X.depth),u.renderPass!=="shadow"){if(m===1)for(let X of G)ds(X,u,i,k[X.modelIndex],Ot.disabled,u.colorModeForRenderPass());else{for(let X of G)ds(X,u,i,k[X.modelIndex],Ot.disabled,Jt.disabled);for(let X of G)ds(X,u,i,k[X.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(let X of Z)ds(X,u,i,k[X.modelIndex],Ot.disabled,u.colorModeForRenderPass());A()}else{for(let X of G)Bc(X.mesh,X.nodeModelMatrix,u,i);for(let X of Z)Bc(X.mesh,X.nodeModelMatrix,u,i);A()}}},$c={line:function(u,t,i){if(u.hasElevatedBuckets=!1,u.hasNonElevatedBuckets=!1,u._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||u._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){let d=t.getVisibleCoordinates();for(let m of d){let y=t.getTile(m).getBucket(u);if(y&&(y.hasZOffset?u.hasElevatedBuckets=!0:u.hasNonElevatedBuckets=!0,u.hasElevatedBuckets&&u.hasNonElevatedBuckets))break}}}else u.hasNonElevatedBuckets=!0},model:function(u,t,i){let d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(i.modelManager&&i.modelManager.upload(i,d.type==="vector"?u.scope:""));if(d.type==="batched-model"||d.type!=="model")return;let m=d.getModels();for(let y of m)y.upload(i.context)},raster:function(u,t,i){let d=t.getSource();if(!(d instanceof Mr&&d.loaded()))return;let m=u.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!m)return;let y=u.paint.get("raster-array-band")||d.getInitialBand(m);if(y==null)return;let x=t.getIds().map(S=>t.getTileByID(S));for(let S of x)S.updateNeeded(m,y)&&d.prepareTile(S,m,y)},"raster-particle":function(u,t,i){let d=t.getSource();if(!(d instanceof Mr&&d.loaded()))return;let m=u.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!m)return;let y=u.paint.get("raster-particle-array-band")||d.getInitialBand(m);if(y==null)return;let x=t.getIds().map(S=>t.getTileByID(S));for(let S of x)S.updateNeeded(m,y)&&d.prepareTile(S,m,y)}};class rp{constructor(t,i,d,m,y){this.context=new Uf(t,i),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let A of x)this._debugParams.enabledLayers[A]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let A of x)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],A);this.occlusionParams=new Th(y),this.setup(),this.numSublayers=Xi.maxUnderzooming+Xi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new da(this),this._wireframeDebugCache=new Yf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let S=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,S,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m}updateTerrain(t,i){let d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new El(this,t));let m=this._terrain;this.transform.elevation=d?m:null,m.update(t,this.transform,i),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){let i=t.fog;if(!i||this.transform.projection.name==="globe"||i.getOpacity(this.transform.pitch)<1||i.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[d,m]=i.getFovAdjustedRange(this.transform._fov);if(d>m)return void(this.transform.fogCullDistSq=null);let y=d+.78*(m-d);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new El(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*n.q.devicePixelRatio,this.height=i*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let d of this.style.order)this.style._mergedLayers[d].resize()}setup(){let t=this.context,i=new n.b4;i.emplaceBack(0,0),i.emplaceBack(n.ag,0),i.emplaceBack(0,n.ag),i.emplaceBack(n.ag,n.ag),this.tileExtentBuffer=t.createVertexBuffer(i,n.b6.members),this.tileExtentSegments=n.b7.simpleSegment(0,0,4,2);let d=new n.b4;d.emplaceBack(0,0),d.emplaceBack(n.ag,0),d.emplaceBack(0,n.ag),d.emplaceBack(n.ag,n.ag),this.debugBuffer=t.createVertexBuffer(d,n.b6.members),this.debugSegments=n.b7.simpleSegment(0,0,4,5);let m=new n.b4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,n.b6.members),this.viewportSegments=n.b7.simpleSegment(0,0,4,2);let y=new n.aT;y.emplaceBack(0,0,0,0),y.emplaceBack(n.ag,0,n.ag,0),y.emplaceBack(0,n.ag,0,n.ag),y.emplaceBack(n.ag,n.ag,n.ag,n.ag),this.mercatorBoundsBuffer=t.createVertexBuffer(y,n.b9.members),this.mercatorBoundsSegments=n.b7.simpleSegment(0,0,4,2);let x=new n.aU;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);let S=new n.b5;for(let R of[0,1,3,2,0])S.emplaceBack(R);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new n.T(t,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.ab.mat4.create();let A=this.context.gl;this.stencilClearMode=new Ot({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,It.disabled,this.stencilClearMode,Jt.disabled,kt.disabled,ch(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,d){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(let A of d)if(this._tileClippingMaskIDs[A.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=i.id;let m=this.context,y=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(Jt.disabled),m.setDepthMode(It.disabled);let x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let S of d){let A=i.getTile(S),R=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:k,tileBoundsSegments:N}=this.getTileBoundsBuffers(A);x.draw(this,y.TRIANGLES,It.disabled,new Ot({func:y.ALWAYS,mask:0},R,255,y.KEEP,y.KEEP,y.REPLACE),Jt.disabled,kt.disabled,ch(S.projMatrix),"$clipping",P,k,N)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,i=this.context.gl;return new Ot({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);let i=this.context.gl;return new Ot({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){let i=this.context.gl,d=t.sort((x,S)=>S.overscaledZ-x.overscaledZ),m=d[d.length-1].overscaledZ,y=d[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();let x={};for(let S=0;S<y;S++)x[S+m]=new Ot({func:i.GEQUAL,mask:255},S+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=y,[x,d]}return[{[m]:Ot.disabled},d]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new Jt([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Jt.unblended:Jt.alphaBlended}colorModeForDrapableLayerRenderPass(t){let i=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Jt([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new n.aj(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,i,d,m=!1){if(this.depthOcclusion)return new It(this.context.gl.GREATER,It.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return It.disabled;let y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new It(d||this.context.gl.LEQUAL,i,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let t=this.context.gl,i=Math.ceil(this.width),d=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===i&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),i!==0&&d!==0&&(this.depthFBO=new jf(this.context,i,d,!1,"texture"),this.depthTexture=new n.T(this.context,{width:i,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,i,d,0,0,i,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,i)=>t+i/this._fpsHistory.length,0))}render(t,i){let d=n.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=i;let m=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(y).filter(Me=>{let Ve=m[Me];return!(Ve.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ve.type]}),S=x(),A=!1,R=!1;for(let Me of S){let Ve=m[Me];Ve.type==="circle"&&(A=!0),Ve.type==="symbol"&&(Ve.hasInitialOcclusionOpacityProperties?R=!0:A=!0)}let P=S.map(Me=>m[Me]),k=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let N=0,V=!1;for(let Me in k){let Ve=k[Me];Ve.used&&(Ve.prepare(this.context),Ve.getSource().usedInConflation&&++N)}let Z=!1;for(let Me of P)Me.isHidden(this.transform.zoom)||(Me.type==="clip"&&(Z=!0),this.prepareLayer(Me));let G={},Y={},X={},ee={},se={};for(let Me in k){let Ve=k[Me];G[Me]=Ve.getVisibleCoordinates(),Y[Me]=G[Me].slice().reverse(),X[Me]=Ve.getVisibleCoordinates(!0).reverse(),ee[Me]=Ve.getShadowCasterCoordinates(),se[Me]=Ve.sortCoordinatesByDistance(G[Me])}let oe=Me=>{let Ve=this.style.getLayerSourceCache(Me);return Ve&&Ve.used?Ve.getSource():null};if(N||Z||this._clippingActiveLastFrame){let Me=[],Ve=[],Qe=0;for(let De of P)this.isSourceForClippingOrConflation(De,oe(De))&&(Me.push(De),Ve.push(Qe)),Qe++;if(Me&&(Z||Me.length>1)||this._clippingActiveLastFrame){Z=!1;let De=[];for(let We=0;We<Me.length;We++){let je=Me[We],it=Ve[We],Ye=this.style.getLayerSourceCache(je);if(!Ye||!Ye.used||!Ye.getSource().usedInConflation&&je.type!=="clip")continue;let qe=n.dx,et=n.by.None,rt=[],dt=!0;if(je.type==="clip"){qe=it;for(let gt of je.layout.get("clip-layer-types"))et|=gt==="model"?n.by.Model:gt==="symbol"?n.by.Symbol:n.by.FillExtrusion;for(let gt of je.layout.get("clip-layer-scope"))rt.push(gt);je.isHidden(this.transform.zoom)?dt=!1:Z=!0}dt&&De.push({layer:je.fqid,cache:Ye,order:qe,clipMask:et,clipScope:rt})}this.replacementSource.setSources(De),V=!0}}this._clippingActiveLastFrame=Z,V||this.replacementSource.clear(),this.conflationActive=V,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Me=0;Me<P.length;Me++){let Ve=P[Me],Qe=Ve.cutoffRange();if(this.longestCutoffRange=Math.max(Qe,this.longestCutoffRange),Qe>0){let De=oe(Ve);De&&(this.minCutoffZoom=Math.max(De.minzoom,this.minCutoffZoom)),Ve.minzoom&&(this.minCutoffZoom=Math.max(Ve.minzoom,this.minCutoffZoom))}Ve.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Me),this._lastOcclusionLayer=Me)}let fe=this.style&&this.style.fog;fe?(this._fogVisible=fe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=fe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(X),this.opaquePassCutoff=0,S=x(),P=S.map(Me=>m[Me]));let ce=this._shadowRenderer;if(ce){ce.updateShadowParameters(this.transform,this.style.directionalLight);for(let Me in k)for(let Ve of G[Me]){let Qe={min:0,max:0};this.terrain&&(Qe=this.terrain.getMinMaxForTile(Ve)||Qe),ce.addShadowReceiver(Ve.toUnwrapped(),Qe.min,Qe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ag(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);let he=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),le=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(he&&!this._snow&&(this._snow=new np(this)),!he&&this._snow&&(this._snow.destroy(),delete this._snow),le&&!this._rain&&(this._rain=new Ol(this)),!le&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!rl.has(this.context.gl))return;this.renderPass="offscreen";for(let Me of P){let Ve=t.getLayerSourceCache(Me);if(!Me.hasOffscreenPass()||Me.isHidden(this.transform.zoom))continue;let Qe=Ve?Y[Ve.id]:void 0;(Me.type==="custom"||Me.type==="raster"||Me.type==="raster-particle"||Me.isSky()||Qe&&Qe.length)&&this.renderLayer(this,Ve,Me,Qe)}this.depthRangeFor3D=[0,1-(P.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ee)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ge=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),we=(()=>{if(i.showOverdrawInspector)return n.aj.black;let Me=this.style.fog;if(Me&&this.transform.projection.supportsFog){let Ve=this.style.getLut(Me.scope);if(!ge){let Qe=Me.properties.get("color-use-theme")==="none",De=Me.properties.get("color").toRenderColor(Qe?null:Ve).toArray01();return new n.aj(...De)}if(ge){let Qe=Me.properties.get("space-color-use-theme")==="none",De=Me.properties.get("space-color").toRenderColor(Qe?null:Ve).toArray01();return new n.aj(...De)}}return n.aj.transparent})();if(this.context.clear({color:we,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ge&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){let Me=P[this.currentLayer],Ve=t.getLayerSourceCache(Me);if(Me.isSky())continue;let Qe=Ve?(Me.is3D()?se:Y)[Ve.id]:void 0;this._renderTileClippingMasks(Me,Ve,Qe),this.renderLayer(this,Ve,Me,Qe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ge&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){let Me=P[this.currentLayer],Ve=t.getLayerSourceCache(Me);Me.isSky()&&this.renderLayer(this,Ve,Me,Ve?Y[Ve.id]:void 0)}function Be(Me,Ve){let Qe;return Ve&&(Qe=(Me.type==="symbol"?X:Me.is3D()?se:Y)[Ve.id]),Qe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){let Me=P[this.currentLayer];if(Me.type==="raster"||Me.type==="raster-particle"){let Ve=t.getLayerSourceCache(Me);this.renderLayer(this,Ve,Me,Be(Me,Ve))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Re=0;ce&&(Re=ce.getShadowCastingLayerCount());let Ge=!1,He=-1;for(let Me=0;Me<S.length;++Me){let Ve=P[Me];Ve.isHidden(this.transform.zoom)||Ve.is3D()&&(He=Me)}for(R&&He===-1&&(A=!0);this.currentLayer<S.length;){let Me=P[this.currentLayer],Ve=t.getLayerSourceCache(Me);if(Me.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Me)){if(Me.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(A&&!Ge&&this.terrain&&!this.transform.isOrthographic&&(Ge=!0,this.blitDepth()),R&&He!==-1&&this.currentLayer===He+1&&!this.transform.isOrthographic&&this.blitDepth(),Me.is3D()||this.terrain||this._renderTileClippingMasks(Me,Ve,Ve?G[Ve.id]:void 0),this.renderLayer(this,Ve,Me,Be(Me,Ve)),!this.terrain&&ce&&Re>0&&Me.hasShadowPass()&&--Re==0&&(ce.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let Qe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Qe;this.currentLayer++){let De=P[this.currentLayer];if(!De.hasLightBeamPass())continue;let We=t.getLayerSourceCache(De);this.renderLayer(this,We,De,We?Y[We.id]:void 0)}this.currentLayer=Qe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Qe=this.currentLayer;this.depthOcclusion=!0;for(let De of this.layersWithOcclusionOpacity){this.currentLayer=De;let We=P[this.currentLayer],je=t.getLayerSourceCache(We),it=je?Y[je.id]:void 0;We.is3D()||this.terrain||this._renderTileClippingMasks(We,je,je?G[je.id]:void 0),this.renderLayer(this,je,We,it)}this.depthOcclusion=!1,this.currentLayer=Qe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Me=null;P.forEach(Ve=>{let Qe=t.getLayerSourceCache(Ve);Qe&&!Ve.isHidden(this.transform.zoom)&&Qe.getVisibleCoordinates().length&&(!Me||Me.getSource().maxzoom<Qe.getSource().maxzoom)&&(Me=Qe)}),Me&&this.options.showTileBoundaries&&Uc.debug(this,Me,Me.getVisibleCoordinates(),n.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Uc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Me){let Ve=Me.transform.padding;Gf(Me,Me.transform.height-(Ve.top||0),3,Rl),Gf(Me,Ve.bottom||0,3,_0),qf(Me,Ve.left||0,3,y0),qf(Me,Me.transform.width-(Ve.right||0),3,Mg);let Qe=Me.transform.centerPoint;(function(De,We,je,it){wa(De,We-1,je-10,2,20,it),wa(De,We-10,je-1,20,2,it)})(Me,Qe.x,Me.transform.height-Qe.y,xh)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),V||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);let{unsupportedLayers:i}=this.transform.projection,d=!i||!i.includes(t.type);if($c[t.type]&&(d||this.terrain&&t.type==="custom")){let m=this.style.getLayerSourceCache(t);$c[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,i,d,m){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||m&&m.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||Uc[d.type](t,i,d,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;let i=this.context.extTimerQuery,d=this.context.gl,m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),m.calls++,d.beginQuery(i.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let t=this.context.extTimerQuery,i=this.context.gl,d=i.createQuery();this.deferredRenderGpuTimeQueries.push(d),i.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){let t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){let i={};for(let d in t){let m=t[d],y=this.context.extTimerQuery,x=y.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(m.query),i[d]=x}return i}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;let i=this.context.gl,d=0;for(let m of t)d+=i.getQueryParameter(m,i.QUERY_RESULT)/1e6,i.deleteQuery(m);return d}translatePosMatrix(t,i,d,m,y){if(!d[0]&&!d[1])return t;let x=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(x){let R=Math.sin(x),P=Math.cos(x);d=[d[0]*P-d[1]*R,d[0]*R+d[1]*P]}let S=[y?d[0]:n.ar(i,d[0],this.transform.zoom),y?d[1]:n.ar(i,d[1],this.transform.zoom),0],A=new Float32Array(16);return n.ab.mat4.translate(A,t,S),A}saveTileTexture(t){let i=t.size[0],d=this._tileTextures[i];d?d.push(t):this._tileTextures[i]=[t]}getTileTexture(t){let i=this._tileTextures[t];return i&&i.length>0?i.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,i,d){let m=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||m||i!==void 0&&!i||y.push("FOG","FOG_DITHERING"),m&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,i){this.cache=this.cache||{};let d=i&&i.defines||[],m=i&&i.config,y=this.currentGlobalDefines(t,i&&i.overrideFog,i&&i.overrideRtt).concat(d),x=xg.cacheKey(vl[t],t,y,m);return this.cache[x]||(this.cache[x]=new xg(this.context,t,vl[t],m,Vf[t],y)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){let d=this.style.directionalLight,m=this.style.ambientLight;if(d&&m){let y=((x,S,A)=>{let R=x.properties.get("direction"),P=x.properties.get("color-use-theme")==="none",k=x.properties.get("color").toRenderColor(P?null:A.getLut(x.scope)).toArray01(),N=x.properties.get("intensity"),V=S.properties.get("color-use-theme")==="none",Z=S.properties.get("color").toRenderColor(V?null:A.getLut(S.scope)).toArray01(),G=S.properties.get("intensity"),Y=[R.x,R.y,R.z],X=n.cM(Z,G),ee=n.cM(k,N);return{u_lighting_ambient_color:X,u_lighting_directional_dir:Y,u_lighting_directional_color:ee,u_ground_radiance:d0(Y,ee,X)}})(d,m,this.style);i.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,i,d,m,y){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;let x=this.style.fog;if(x){let S=x.getOpacity(this.transform.pitch),A=((R,P,k,N,V,Z,G,Y,X,ee,se,oe)=>{let fe=R.transform,ce=P.properties.get("color-use-theme")==="none",he=P.properties.get("color").toRenderColor(ce?null:R.style.getLut(P.scope)).toArray01();he[3]=N;let le=R.frameCounter/1e3%1,[ge,we]=P.properties.get("vertical-range");return{u_fog_matrix:k?fe.calculateFogTileMatrix(k):oe||R.identityMat,u_fog_range:P.getFovAdjustedRange(fe._fov),u_fog_color:he,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ge,we),we],u_fog_temporal_offset:le,u_frustum_tl:V,u_frustum_tr:Z,u_frustum_br:G,u_frustum_bl:Y,u_globe_pos:X,u_globe_radius:ee,u_viewport:se,u_globe_transition:n.ae(fe.zoom),u_is_globe:+(fe.projection.name==="globe")}})(this,x,d,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],m);i.setFogUniformValues(t,A)}y&&i.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){let t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){let t=this.context.gl,i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let t=this._backgroundTiles,i=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(let m of d)i[m.key]=t[m.key]||new Ls(m,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,i){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!i||i.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let i=this._cachedTileFogOpacities[t.key];return i||(this._cachedTileFogOpacities[t.key]=i=this.style.fog.getOpacityForTile(t)),i[0]>=de||i[1]>=de}setupDepthForOcclusion(t,i,d){let m=this.context,y=m.gl,x=!!d;var S;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),m.activeTexture.set(y.TEXTURE0),x||i.setTerrainUniformValues(m,d)}}function Dh(u,t){let i=!1,d=null,m=()=>{d=null,i&&(u(),d=setTimeout(m,t),i=!1)};return()=>(i=!0,d||m(),d)}class Rg{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Dh(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let t=this._map;if(!t)return"";let i=ip(t);if(this._hashName){let d=this._hashName,m=!1,y=location.hash.slice(1).split("&").map(x=>{let S=x.split("=")[0];return S===d?(m=!0,`${S}=${i}`):x}).filter(x=>x);return m||y.push(`${d}=${i}`),`#${y.join("&")}`}return`#${i}`}_getCurrentHash(){let t=location.hash.replace("#","");if(this._hashName){let i;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(i=d)}),(i&&i[1]||"").split("/")}return t.split("/")}_onHashChange(){let t=this._map;if(!t)return!1;let i=this._getCurrentHash();if(i.length>=3&&!i.some(d=>isNaN(d))){let d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(i[3]||0):t.getBearing();return t.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:d,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ip(u,t){let i=u.getCenter(),d=Math.round(100*u.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),x=Math.round(i.lng*y)/y,S=Math.round(i.lat*y)/y,A=u.getBearing(),R=u.getPitch(),P=t?`/${x}/${S}/${d}`:`${d}/${S}/${x}`;return(A||R)&&(P+="/"+Math.round(10*A)/10),R&&(P+=`/${Math.round(R)}`),P}let Hc={linearity:.3,easing:n.dy(0,0,.3,1)},Pg=n.l({deceleration:2500,maxSpeed:1400},Hc),Og=n.l({deceleration:20,maxSpeed:1400},Hc),Lg=n.l({deceleration:1e3,maxSpeed:360},Hc),kg=n.l({deceleration:1e3,maxSpeed:90},Hc);class Fg{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,i=n.q.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let i={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:y}of this._inertiaBuffer)i.zoom+=y.zoomDelta||0,i.bearing+=y.bearingDelta||0,i.pitch+=y.pitchDelta||0,y.panDelta&&i.pan._add(y.panDelta),y.around&&(i.around=y.around),y.pinchAround&&(i.pinchAround=y.pinchAround);let d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(i.pan.mag()){let y=qc(i.pan.mag(),d,n.l({},Pg,t||{}));m.offset=i.pan.mult(y.amount/i.pan.mag()),m.center=this._map.transform.center,Gc(m,y)}if(i.zoom){let y=qc(i.zoom,d,Og);m.zoom=this._map.transform.zoom+y.amount,Gc(m,y)}if(i.bearing){let y=qc(i.bearing,d,Lg);m.bearing=this._map.transform.bearing+n.aw(y.amount,-179,179),Gc(m,y)}if(i.pitch){let y=qc(i.pitch,d,kg);m.pitch=this._map.transform.pitch+y.amount,Gc(m,y)}if(m.zoom||m.bearing){let y=i.pinchAround===void 0?i.around:i.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Gc(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function qc(u,t,i){let{maxSpeed:d,linearity:m,deceleration:y}=i,x=n.aw(u*m/(t/1e3),-d,d),S=Math.abs(x)/(y*m);return{easing:i.easing,duration:1e3*S,amount:x*(S/2)}}class Ri extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,d,m={}){let y=To(i.getCanvasContainer(),d),x=i.unproject(y);super(t,n.l({point:y,lngLat:x,originalEvent:d},m)),this._defaultPrevented=!1,this.target=i}}class Wc extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,d){let m=t==="touchend"?d.changedTouches:d.touches,y=Jo(i.getCanvasContainer(),m),x=y.map(A=>i.unproject(A)),S=y.reduce((A,R,P,k)=>A.add(R.div(k.length)),new n.P(0,0));super(t,{points:y,point:S,lngLats:x,lngLat:i.unproject(S),originalEvent:d}),this._defaultPrevented=!1}}class Ng extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i){super("wheel",{originalEvent:i}),this._defaultPrevented=!1}}class x0{constructor(t,i){this._map=t,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Ng(this._map,t))}mousedown(t,i){return this._mousedownPos=i,this._firePreventable(new Ri(t.type,this._map,t))}mouseup(t){this._map.fire(new Ri(t.type,this._map,t))}preclick(t){let i=n.l({},t);i.type="preclick",this._map.fire(new Ri(i.type,this._map,i))}click(t,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Ri(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Ri(t.type,this._map,t))}mouseover(t){this._map.fire(new Ri(t.type,this._map,t))}mouseout(t){this._map.fire(new Ri(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Wc(t.type,this._map,t))}touchmove(t){this._map.fire(new Wc(t.type,this._map,t))}touchend(t){this._map.fire(new Wc(t.type,this._map,t))}touchcancel(t){this._map.fire(new Wc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class b0{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Ri(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ri("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Ri(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ur{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,i){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ft(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(t,i){if(!this._active)return;let d=i,m=this._startPos,y=this._lastPos;if(!m||!y||y.equals(d)||!this._box&&d.dist(m)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=ze("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));let x=Math.min(m.x,d.x),S=Math.max(m.x,d.x),A=Math.min(m.y,d.y),R=Math.max(m.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${A}px)`,this._box.style.width=S-x+"px",this._box.style.height=R-A+"px")})}mouseupWindow(t,i){if(!this._active)return;let d=this._startPos,m=i;if(d&&t.button===0){if(this.reset(),Bt(),d.x!==m.x||d.y!==m.y)return this._map.fire(new n.z("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(d,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),mi(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new n.z(t,{originalEvent:i}))}}function Mh(u,t){let i={};for(let d=0;d<u.length;d++)i[u[d].identifier]=t[d];return i}class w0{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){let y=new n.P(0,0);for(let x of m)y._add(x);return y.div(m.length)}(i),this.touches=Mh(d,i)))}touchmove(t,i,d){if(this.aborted||!this.centroid)return;let m=Mh(d,i);for(let y in this.touches){let x=m[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,i,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){let m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class op{constructor(t){this.singleTap=new w0(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,i,d){this.singleTap.touchstart(t,i,d)}touchmove(t,i,d){this.singleTap.touchmove(t,i,d)}touchend(t,i,d){let m=this.singleTap.touchend(t,i,d);if(m){let y=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(m)<30;if(y&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Zc{constructor(){this._zoomIn=new op({numTouches:1,numTaps:2}),this._zoomOut=new op({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,i,d){this._zoomIn.touchstart(t,i,d),this._zoomOut.touchstart(t,i,d)}touchmove(t,i,d){this._zoomIn.touchmove(t,i,d),this._zoomOut.touchmove(t,i,d)}touchend(t,i,d){let m=this._zoomIn.touchend(t,i,d),y=this._zoomOut.touchend(t,i,d);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(m)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let zg={0:1,2:2};class Xc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,i){return!1}_move(t,i){return{}}mousedown(t,i){if(this._lastPoint)return;let d=Vt(t);this._correctButton(t,d)&&(this._lastPoint=i,this._eventButton=d)}mousemoveWindow(t,i){let d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(m,y){let x=zg[y];return m.buttons===void 0||(m.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(i.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(d,i)}}mouseupWindow(t){this._lastPoint&&Vt(t)===this._eventButton&&(this._moved&&Bt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ch extends Xc{mousedown(t,i){super.mousedown(t,i),this._lastPoint&&(this._active=!0)}_correctButton(t,i){return i===0&&!t.ctrlKey}_move(t,i){return{around:i,panDelta:i.sub(t)}}}class No extends Xc{_correctButton(t,i){return i===0&&t.ctrlKey||i===2}_move(t,i){let d=.8*(i.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){t.preventDefault()}}class Yc extends Xc{_correctButton(t,i){return i===0&&t.ctrlKey||i===2}_move(t,i){let d=-.5*(i.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){t.preventDefault()}}class pr{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),n.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,i,d){return this._calculateTransform(t,i,d)}touchmove(t,i,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!n.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,d)}}touchend(t,i,d){this._calculateTransform(t,i,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,d){d.length>0&&(this._active=!0);let m=Mh(d,i),y=new n.P(0,0),x=new n.P(0,0),S=0;for(let R in m){let P=m[R],k=this._touches[R];k&&(y._add(P),x._add(P.sub(k)),S++,m[R]=P)}if(this._touches=m,S<this._minTouches||!x.mag())return;let A=x.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ze("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ji{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,i,d){return{}}touchstart(t,i,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([i[0],i[1]]))}touchmove(t,i,d){let m=this._firstTwoTouches;if(!m)return;t.preventDefault();let[y,x]=m,S=Ll(d,i,y),A=Ll(d,i,x);if(!S||!A)return;let R=this._aroundCenter?null:S.add(A).div(2);return this._move([S,A],R,t)}touchend(t,i,d){if(!this._firstTwoTouches)return;let[m,y]=this._firstTwoTouches,x=Ll(d,i,m),S=Ll(d,i,y);x&&S||(this._active&&Bt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ll(u,t,i){for(let d=0;d<u.length;d++)if(u[d].identifier===i)return t[d]}function Kc(u,t){return Math.log(u/t)/Math.LN2}class Bg extends Ji{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,i){let d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,d),pinchAround:i}}}function Vg(u,t){return 180*u.angleWith(t)/Math.PI}class Jc extends Ji{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,i){let d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Vg(this._vector,d),pinchAround:i}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let i=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;let m=Vg(t,d);return Math.abs(m)<i}}function sp(u){return Math.abs(u.y)>Math.abs(u.x)}class E0 extends Ji{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,sp(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,i,d){let m=this._lastPoints;if(!m)return;let y=t[0].sub(m[0]),x=t[1].sub(m[1]);return this._map._cooperativeGestures&&!n.dz()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(y,x,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5})}gestureBeginsVertically(t,i,d){if(this._valid!==void 0)return this._valid;let m=t.mag()>=2,y=i.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;let x=t.y>0==i.y>0;return sp(t)&&sp(i)&&x}}let ap={panStep:100,bearingStep:15,pitchStep:10};class lp{constructor(){let t=ap;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let i=0,d=0,m=0,y=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:S=>{let A=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Ta,zoom:i?Math.round(A)+i*(t.shiftKey?2:1):A,bearing:S.getBearing()+d*this._bearingStep,pitch:S.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ta(u){return u*(2-u)}let Ia=4.000244140625,fs=1/450;class fo{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=fs,n.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,d=n.q.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,i!==0&&i%Ia==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=i,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let i=To(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){let R=this._type==="wheel"&&Math.abs(this._delta)>Ia?this._wheelZoomRate:this._defaultZoomRate,P=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&P!==0&&(P=1/P);let k=i(),N=Math.pow(2,k),V=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(V*P))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let d=typeof this._targetZoom=="number"?this._targetZoom:i(),m=this._startZoom,y=this._easing,x,S=!1;if(this._type==="wheel"&&m&&y){let R=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),P=y(R);x=n.af(m,d,P),R<1?this._frameId||(this._frameId=!0):S=!0}else x=d,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=x-i();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=n.dA;if(this._prevEase){let d=this._prevEase,m=(n.q.now()-d.start)/d.duration,y=d.easing(m+.01)-d.easing(m),x=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-x*x);i=n.dy(x,S,.25,1)}return this._prevEase={start:n.q.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ze("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Gs{constructor(t,i){this._clickZoom=t,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sa{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,i){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(i)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qs{constructor(){this._tap=new op({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,i,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=i[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,i,d))}touchmove(t,i,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;let m=i[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,i,d)}touchend(t,i,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,i,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class T0{constructor(t,i,d){this._el=t,this._mousePan=i,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class I0{constructor(t,i,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=i,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class S0{constructor(t,i,d,m){this._el=t,this._touchZoom=i,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Ah=u=>u.zoom||u.drag||u.pitch||u.rotate;class jg extends n.z{}class ui{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){let d=n.ab.vec3.sub([],i,t);this.radius=n.ab.vec3.length(d[2]<0?n.ab.vec3.div([],d,this.constants):[d[0],d[1],0])}projectRay(t){n.ab.vec3.div(t,t,this.constants),n.ab.vec3.normalize(t,t),n.ab.vec3.mul(t,t,this.constants);let i=n.ab.vec3.scale([],t,this.radius);if(i[2]>0){let d=n.ab.vec3.scale([],[0,0,1],n.ab.vec3.dot(i,[0,0,1])),m=n.ab.vec3.scale([],n.ab.vec3.normalize([],[i[0],i[1],0]),this.radius),y=n.ab.vec3.add([],i,n.ab.vec3.scale([],n.ab.vec3.sub([],n.ab.vec3.add([],m,d),i),2));i[0]=y[0],i[1]=y[1]}return i}}function kl(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Ug{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fg(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ui,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),n.aP(["handleEvent","handleWindowEvent"],this);let d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(let[m,y,x]of this._listeners){let S=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(y,S,x)}}destroy(){for(let[t,i,d]of this._listeners){let m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(i,m,d)}}_addDefaultHandlers(t){let i=this._map,d=i.getCanvasContainer();this._add("mapEvent",new x0(i,t));let m=i.boxZoom=new ur(i,t);this._add("boxZoom",m);let y=new Zc,x=new Sa;i.doubleClickZoom=new Gs(x,y),this._add("tapZoom",y),this._add("clickZoom",x);let S=new qs;this._add("tapDragZoom",S);let A=i.touchPitch=new E0(i);this._add("touchPitch",A);let R=new No(t),P=new Yc(t);i.dragRotate=new I0(t,R,P),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);let k=new Ch(t),N=new pr(i,t);i.dragPan=new T0(d,k,N),this._add("mousePan",k),this._add("touchPan",N,["touchZoom","touchRotate"]);let V=new Jc,Z=new Bg;i.touchZoomRotate=new S0(d,Z,V,S),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new b0(i));let G=i.scrollZoom=new fo(i,this);this._add("scrollZoom",G,["mousePan"]);let Y=i.keyboard=new lp;this._add("keyboard",Y);for(let X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[X]&&i[X].enable(t[X])}_add(t,i,d){this._handlers.push({handlerName:t,handler:i,allowed:d}),this._handlersById[t]=i}stop(t){if(!this._updatingCamera){for(let{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ah(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,i,d){for(let m in t)if(m!==d&&(!i||i.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){let i=[];for(let d of t)this._el.contains(d.target)&&i.push(d);return i}handleEvent(t,i){this._updatingCamera=!0;let d=t.type==="renderFrame",m=d?void 0:t,y={needsRenderFrame:!1},x={},S={},A=t.touches?this._getMapTouches(t.touches):void 0,R=A?Jo(this._el,A):d?void 0:To(this._el,t);for(let{handlerName:N,handler:V,allowed:Z}of this._handlers){if(!V.isEnabled())continue;let G;this._blockedByActive(S,Z,N)?V.reset():V[i||t.type]&&(G=V[i||t.type](t,R,A),this.mergeHandlerResult(y,x,G,N,m),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||V.isActive())&&(S[N]=V)}let P={};for(let N in this._previousActiveHandlers)S[N]||(P[N]=m);this._previousActiveHandlers=S,(Object.keys(P).length||kl(y))&&(this._changes.push([y,x,P]),this._triggerRenderFrame()),(Object.keys(S).length||kl(y))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:k}=y;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(t,i,d,m,y){if(!d)return;n.l(t,d);let x={handlerName:m,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(i.zoom=x),d.panDelta!==void 0&&(i.drag=x),d.pitchDelta!==void 0&&(i.pitch=x),d.bearingDelta!==void 0&&(i.rotate=x)}_applyChanges(){let t={},i={},d={};for(let[m,y,x]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),n.l(i,y),n.l(d,x);this._updateMapTransform(t,i,d),this._changes=[]}_updateMapTransform(t,i,d){let m=this._map,y=m.transform,x=ee=>[ee.x,ee.y,ee.z];if((ee=>{let se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!kl(t)){let ee=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),ee!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&m._stop(!0),!kl(t))return void this._fireEvents(i,d,!0);let{panDelta:S,zoomDelta:A,bearingDelta:R,pitchDelta:P,around:k,aroundCoord:N,pinchAround:V}=t;y._isCameraConstrained&&(A>0&&(A=0),y._isCameraConstrained=!1),V!==void 0&&(k=V),(A||(ee=>i[ee]&&!this._eventsInProgress[ee])("drag"))&&k&&(this._dragOrigin=x(y.pointCoordinate3D(k)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",m._stop(!0),k=k||m.transform.centerPoint,R&&(y.bearing+=R),P&&(y.pitch+=P),y._updateCameraState();let Z=[0,0,0];if(S)if(y.projection.name==="mercator"){let ee=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(k).dir),se=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(k.sub(S)).dir);Z[0]=se[0]-ee[0],Z[1]=se[1]-ee[1]}else{let ee=y.pointCoordinate(k);if(y.projection.name==="globe"){S=S.rotate(-y.angle);let se=y._pixelsPerMercatorPixel/y.worldSize;Z[0]=-S.x*n.dB(n.aS(ee.y))*se,Z[1]=-S.y*n.dB(y.center.lat)*se}else{let se=y.pointCoordinate(k.sub(S));ee&&se&&(Z[0]=se.x-ee.x,Z[1]=se.y-ee.y)}}let G=y.zoom,Y=[0,0,0];if(A){let ee=x(N||y.pointCoordinate3D(k)),se={dir:n.ab.vec3.normalize([],n.ab.vec3.sub([],ee,y._camera.position))};if(se.dir[2]<0){let oe=y.zoomDeltaToMovement(ee,A);n.ab.vec3.scale(Y,se.dir,oe)}}let X=n.ab.vec3.add(Z,Z,Y);y._translateCameraConstrained(X),A&&Math.abs(y.zoom-G)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,d,!0)}_fireEvents(t,i,d){let m=Ah(this._eventsInProgress),y=Ah(t),x={};for(let P in t){let{originalEvent:k}=t[P];this._eventsInProgress[P]||(x[`${P}start`]=k),this._eventsInProgress[P]=t[P]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(let P in x)this._fireEvent(P,x[P]);y&&this._fireEvent("move",y.originalEvent);for(let P in t){let{originalEvent:k}=t[P];this._fireEvent(P,k)}let S={},A;for(let P in this._eventsInProgress){let{handlerName:k,originalEvent:N}=this._eventsInProgress[P];this._handlersById[k].isActive()||(delete this._eventsInProgress[P],A=i[k]||N,S[`${P}end`]=A)}for(let P in S)this._fireEvent(P,S[P]);let R=Ah(this._eventsInProgress);if(d&&(m||y)&&!R){this._updatingCamera=!0;let P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;P?(k(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:A})):(this._map.fire(new n.z("moveend",{originalEvent:A})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new n.z(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new jg("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let $g="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Fl extends n.E{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=i.respectPrefersReducedMotion!==!1,n.aP(["_renderFrameCallback"],this)}getCenter(){return new n.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,i){return this.jumpTo({center:t},i)}panBy(t,i,d){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,n.l({offset:t},i),d)}panTo(t,i,d){return this.easeTo(n.l({center:t},i),d)}getZoom(){return this.transform.zoom}setZoom(t,i){return this.jumpTo({zoom:t},i),this}zoomTo(t,i,d){return this.easeTo(n.l({zoom:t},i),d)}zoomIn(t,i){return this.zoomTo(this.getZoom()+1,t,i),this}zoomOut(t,i){return this.zoomTo(this.getZoom()-1,t,i),this}getBearing(){return this.transform.bearing}setBearing(t,i){return this.jumpTo({bearing:t},i),this}getPadding(){return this.transform.padding}setPadding(t,i){return this.jumpTo({padding:t},i),this}rotateTo(t,i,d){return this.easeTo(n.l({bearing:t},i),d)}resetNorth(t,i){return this.rotateTo(0,n.l({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(n.l({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(t,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,i):this}getPitch(){return this.transform.pitch}setPitch(t,i){return this.jumpTo({pitch:t},i),this}cameraForBounds(t,i){t=n.az.convert(t);let d=i&&i.bearing||0,m=i&&i.pitch||0,y=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,y,x,d,m,i)}_extendPadding(t){let i={top:0,right:0,bottom:0,left:0};return t==null?n.l({},i,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:n.l({},i,t)}_extendCameraOptions(t){return(t=n.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,i){let d=i.max[0]-i.min[0],m=i.max[1]-i.min[1];return d/m>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,i,d,m,y,x){let S=t.clone(),A=this._extendCameraOptions(x);S.bearing=m,S.pitch=y;let R=n.bO.convert(i),P=n.bO.convert(d),k=.5*(R.lat+P.lat),N=.5*(R.lng+P.lng),V=n.dC(k,N),Z=n.ab.vec3.normalize([],V),G=n.ab.vec3.normalize([],n.ab.vec3.cross([],Z,[0,1,0])),Y=n.ab.vec3.cross([],G,Z),X=[G[0],G[1],G[2],0,Y[0],Y[1],Y[2],0,Z[0],Z[1],Z[2],0,0,0,0,1],ee=[V,n.dC(R.lat,R.lng),n.dC(P.lat,R.lng),n.dC(P.lat,P.lng),n.dC(R.lat,P.lng),n.dC(k,R.lng),n.dC(k,P.lng),n.dC(R.lat,N),n.dC(P.lat,N)],se=n.cd.fromPoints(ee.map(je=>[n.ab.vec3.dot(G,je),n.ab.vec3.dot(Y,je),n.ab.vec3.dot(Z,je)])),oe=n.ab.vec3.transformMat4([],se.center,X);n.ab.vec3.squaredLength(oe)===0&&n.ab.vec3.set(oe,0,0,1),n.ab.vec3.normalize(oe,oe),n.ab.vec3.scale(oe,oe,n.ax),S.center=n.dD(oe);let fe=S.getWorldToCameraMatrix(),ce=n.ab.mat4.invert(new Float64Array(16),fe);se=n.cd.applyTransform(se,n.ab.mat4.multiply([],fe,X));let he=this._extendAABB(se,S,A,m);if(!he)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");se=he,n.ab.vec3.transformMat4(oe,oe,fe);let le=.5*(se.max[2]-se.min[2]),ge=this._minimumAABBFrustumDistance(S,se),we=n.ab.vec3.scale([],[0,0,1],le),Be=n.ab.vec3.add(we,oe,we),Re=ge+(S.pitch===0?0:n.ab.vec3.distance(oe,Be)),Ge=S.globeCenterInViewSpace,He=n.ab.vec3.sub([],oe,[Ge[0],Ge[1],Ge[2]]);n.ab.vec3.normalize(He,He),n.ab.vec3.scale(He,He,Re);let Me=n.ab.vec3.add([],oe,He);n.ab.vec3.transformMat4(Me,Me,ce);let Ve=n.ds/n.ax,Qe=n.ab.vec3.length(Me),De=n.bH(Math.max(Qe*Ve-n.ds,Number.EPSILON),0),We=Math.min(S.zoomFromMercatorZAdjusted(De),A.maxZoom);return We>.5*(n.c6+n.bY)?(S.setProjection({name:"mercator"}),S.zoom=We,this._cameraForBounds(S,i,d,m,y,x)):{center:S.center,zoom:We,bearing:m,pitch:y}}_extendAABB(t,i,d,m){let y=.5*((d.padding.left||0)+(d.padding.right||0)),x=.5*((d.padding.top||0)+(d.padding.bottom||0)),S=x,A=y,R=y,P=x,k=i.width-(A+R),N=i.height-(S+P),V=n.ab.vec3.sub([],t.max,t.min),Z=Math.min(k/V[0],N/V[1]),G=Math.min(i.scaleZoom(i.scale*Z),d.maxZoom);if(isNaN(G))return null;let Y=i.scale/i.zoomScale(G),X=new n.cd([t.min[0]-A*Y,t.min[1]-P*Y,t.min[2]],[t.max[0]+R*Y,t.max[1]+S*Y,t.max[2]]),ee=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new n.P(d.offset.x,d.offset.y):n.P.convert(d.offset)).rotate(-n.ai(m));return X.center[0]-=ee.x*Y,X.center[1]+=ee.y*Y,X}queryTerrainElevation(t,i){let d=this.transform.elevation;return d?(i=n.l({},{exaggerated:!0},i),d.getAtPoint(n.aa.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,d,m,y,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,i,d,m,y,x);let S=t.clone(),A=this._extendCameraOptions(x);S.bearing=m,S.pitch=y;let R=n.bO.convert(i),P=n.bO.convert(d),k=new n.bO(R.lng,P.lat),N=new n.bO(P.lng,R.lat),V=S.project(R),Z=S.project(P),G=this.queryTerrainElevation(R),Y=this.queryTerrainElevation(P),X=this.queryTerrainElevation(k),ee=this.queryTerrainElevation(N),se=[[V.x,V.y,Math.min(G||0,Y||0,X||0,ee||0)],[Z.x,Z.y,Math.max(G||0,Y||0,X||0,ee||0)]],oe=n.cd.fromPoints(se),fe=S.getWorldToCameraMatrix(),ce=n.ab.mat4.invert(new Float64Array(16),fe);oe=n.cd.applyTransform(oe,fe);let he=this._extendAABB(oe,S,A,m);if(!he)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=he;let le=.5*n.ab.vec3.sub([],oe.max,oe.min)[2],ge=this._minimumAABBFrustumDistance(S,oe),we=[0,0,1,0];n.ab.vec4.transformMat4(we,we,fe),n.ab.vec4.normalize(we,we);let Be=n.ab.vec3.scale([],we,ge+le),Re=n.ab.vec3.add([],oe.center,Be);n.ab.vec3.transformMat4(oe.center,oe.center,ce),n.ab.vec3.transformMat4(Re,Re,ce);let Ge=S.unproject(new n.P(oe.center[0],oe.center[1])),He=n.dE(S.projection,Ge),Me=Math.pow(2,He),Ve=Math.min(S._zoomFromMercatorZ(Re[2]*S.pixelsPerMeter*Me/S.worldSize),A.maxZoom);return S.mercatorFromTransition&&Ve<.5*(n.c6+n.bY)?(S.setProjection({name:"globe"}),S.zoom=Ve,this._cameraForBounds(S,i,d,m,y,x)):{center:Ge,zoom:Ve,bearing:m,pitch:y}}fitBounds(t,i,d){let m=this.cameraForBounds(t,i);return this._fitInternal(m,i,d)}fitScreenCoordinates(t,i,d,m,y){let x=n.P.convert(t),S=n.P.convert(i),A=new n.P(Math.min(x.x,S.x),Math.min(x.y,S.y)),R=new n.P(Math.max(x.x,S.x),Math.max(x.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,S))return this;let P=this.transform.pointLocation3D(A),k=this.transform.pointLocation3D(R),N=this.transform.pointLocation3D(new n.P(A.x,R.y)),V=this.transform.pointLocation3D(new n.P(R.x,A.y)),Z=[Math.min(P.lng,k.lng,N.lng,V.lng),Math.min(P.lat,k.lat,N.lat,V.lat)],G=[Math.max(P.lng,k.lng,N.lng,V.lng),Math.max(P.lat,k.lat,N.lat,V.lat)],Y=m&&m.pitch?m.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,Z,G,d,Y,m);return this._fitInternal(X,m,y)}_fitInternal(t,i,d){return t?(i=n.l(t,i)).linear?this.easeTo(i,d):this.flyTo(i,d):this}jumpTo(t,i){this.stop();let d=t.preloadOnly?this.transform.clone():this.transform,m=!1,y=!1,x=!1;"zoom"in t&&d.zoom!==+t.zoom&&(m=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=n.bO.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(y=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(x=!0,d.pitch=+t.pitch);let S=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(S))if(t.retainPadding===!1){let A=d.clone();A.padding=S,d.setLocationAtPoint(d.center,A.centerPoint)}else d.padding=S;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new n.z("movestart",i)).fire(new n.z("move",i)),m&&this.fire(new n.z("zoomstart",i)).fire(new n.z("zoom",i)).fire(new n.z("zoomend",i)),y&&this.fire(new n.z("rotatestart",i)).fire(new n.z("rotate",i)).fire(new n.z("rotateend",i)),x&&this.fire(new n.z("pitchstart",i)).fire(new n.z("pitch",i)).fire(new n.z("pitchend",i)),this.fire(new n.z("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w($g),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){let d=this.transform;if(!d.projection.supportsFreeCamera)return n.w($g),this;this.stop();let m=d.zoom,y=d.pitch,x=d.bearing;d.setFreeCameraOptions(t);let S=m!==d.zoom,A=y!==d.pitch,R=x!==d.bearing;return this.fire(new n.z("movestart",i)).fire(new n.z("move",i)),S&&this.fire(new n.z("zoomstart",i)).fire(new n.z("zoom",i)).fire(new n.z("zoomend",i)),R&&this.fire(new n.z("rotatestart",i)).fire(new n.z("rotate",i)).fire(new n.z("rotateend",i)),A&&this.fire(new n.z("pitchstart",i)).fire(new n.z("pitch",i)).fire(new n.z("pitchend",i)),this.fire(new n.z("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),((t=n.l({offset:[0,0],duration:500,easing:n.dA},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);let d=this.transform,m=this.getZoom(),y=this.getBearing(),x=this.getPitch(),S=this.getPadding(),A="zoom"in t?+t.zoom:m,R="bearing"in t?this._normalizeBearing(t.bearing,y):y,P="pitch"in t?+t.pitch:x,k=this._extendPadding(t.padding),N=n.P.convert(t.offset),V,Z,G;if(d.projection.name==="globe"){let we=n.aa.fromLngLat(d.center),Be=N.rotate(-d.angle);we.x+=Be.x/d.worldSize,we.y+=Be.y/d.worldSize;let Re=we.toLngLat(),Ge=n.bO.convert(t.center||Re);this._normalizeCenter(Ge),V=d.centerPoint.add(Be),Z=new n.P(we.x,we.y).mult(d.worldSize),G=new n.P(n.at(Ge.lng),n.aA(Ge.lat)).mult(d.worldSize).sub(Z)}else{V=d.centerPoint.add(N);let we=d.pointLocation(V),Be=n.bO.convert(t.center||we);this._normalizeCenter(Be),Z=d.project(we),G=d.project(Be).sub(Z)}let Y=d.zoomScale(A-m),X,ee;t.around&&(X=n.bO.convert(t.around),ee=d.locationPoint(X));let se=this._zooming||A!==m,oe=this._rotating||y!==R,fe=this._pitching||P!==x,ce=!d.isPaddingEqual(k),he=t.retainPadding===!1?d.clone():d,le=we=>Be=>{if(se&&(we.zoom=n.af(m,A,Be)),oe&&(we.bearing=n.af(y,R,Be)),fe&&(we.pitch=n.af(x,P,Be)),ce&&(he.interpolatePadding(S,k,Be),V=he.centerPoint.add(N)),X)we.setLocationAtPoint(X,ee);else{let Re=we.zoomScale(we.zoom-m),Ge=A>m?Math.min(2,Y):Math.max(.5,Y),He=Math.pow(Ge,1-Be),Me=we.unproject(Z.add(G.mult(Be*He)).mult(Re));we.setLocationAtPoint(we.renderWorldCopies?Me.wrap():Me,V)}return t.preloadOnly||this._fireMoveEvents(i),we};if(t.preloadOnly){let we=this._emulate(le,t.duration,d);return this._preloadTiles(we),this}let ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=se,this._rotating=oe,this._pitching=fe,this._padding=ce,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,ge),this._ease(le(d),we=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(i,we)},t),this}_prepareEase(t,i,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),i||d.moving||this.fire(new n.z("movestart",t)),this._zooming&&!d.zooming&&this.fire(new n.z("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new n.z("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new n.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.z("move",t)),this._zooming&&this.fire(new n.z("zoom",t)),this._rotating&&this.fire(new n.z("rotate",t)),this._pitching&&this.fire(new n.z("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let d=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new n.z("zoomend",t)),m&&this.fire(new n.z("rotateend",t)),y&&this.fire(new n.z("pitchend",t)),this.fire(new n.z("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){let je=n.ay(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(je,i)}this.stop(),t=n.l({offset:[0,0],speed:1.2,curve:1.42,easing:n.dA},t);let d=this.transform,m=this.getZoom(),y=this.getBearing(),x=this.getPitch(),S=this.getPadding(),A="zoom"in t?n.aw(+t.zoom,d.minZoom,d.maxZoom):m,R="bearing"in t?this._normalizeBearing(t.bearing,y):y,P="pitch"in t?+t.pitch:x,k=this._extendPadding(t.padding),N=d.zoomScale(A-m),V=n.P.convert(t.offset),Z=d.centerPoint.add(V),G=d.pointLocation(Z),Y=n.bO.convert(t.center||G);this._normalizeCenter(Y);let X=d.project(G),ee=d.project(Y).sub(X),se=t.curve,oe=Math.max(d.width,d.height),fe=oe/N,ce=ee.mag();if("minZoom"in t){let je=n.aw(Math.min(t.minZoom,m,A),d.minZoom,d.maxZoom),it=oe/d.zoomScale(je-m);se=Math.sqrt(it/ce*2)}let he=se*se;function le(je){let it=(fe*fe-oe*oe+(je?-1:1)*he*he*ce*ce)/(2*(je?fe:oe)*he*ce);return Math.log(Math.sqrt(it*it+1)-it)}function ge(je){return(Math.exp(je)-Math.exp(-je))/2}function we(je){return(Math.exp(je)+Math.exp(-je))/2}let Be=le(0),Re=function(je){return we(Be)/we(Be+se*je)},Ge=function(je){return oe*((we(Be)*(ge(it=Be+se*je)/we(it))-ge(Be))/he)/ce;var it},He=(le(1)-Be)/se;if(Math.abs(ce)<1e-6||!isFinite(He)){if(Math.abs(oe-fe)<1e-6)return this.easeTo(t,i);let je=fe<oe?-1:1;He=Math.abs(Math.log(fe/oe))/se,Ge=function(){return 0},Re=function(it){return Math.exp(je*se*it)}}t.duration="duration"in t?+t.duration:1e3*He/("screenSpeed"in t?+t.screenSpeed/se:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);let Me=y!==R,Ve=P!==x,Qe=!d.isPaddingEqual(k),De=t.retainPadding===!1?d.clone():d,We=je=>it=>{let Ye=it*He,qe=1/Re(Ye);je.zoom=it===1?A:m+je.scaleZoom(qe),Me&&(je.bearing=n.af(y,R,it)),Ve&&(je.pitch=n.af(x,P,it)),Qe&&(De.interpolatePadding(S,k,it),Z=De.centerPoint.add(V));let et=it===1?Y:je.unproject(X.add(ee.mult(Ge(Ye))).mult(qe));return je.setLocationAtPoint(je.renderWorldCopies?et.wrap():et,Z),je._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),je};if(t.preloadOnly){let je=this._emulate(We,t.duration,d);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=Me,this._pitching=Ve,this._padding=Qe,this._prepareEase(i,!1),this._ease(We(d),()=>this._afterEase(i),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,i)}if(!t){let d=this.handlers;d&&d.stop(!1)}return this}_ease(t,i,d){d.animate===!1||d.duration===0?(t(1),i()):(this._easeStart=n.q.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let t=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=n.bF(t,-180,180);let d=Math.abs(t-i);return Math.abs(t-360-i)<d&&(t-=360),Math.abs(t+360-i)<d&&(t+=360),t}_normalizeCenter(t){let i=this.transform;if(i.maxBounds||i.projection.name!=="globe"&&!i.renderWorldCopies)return;let d=t.lng-i.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,i,d){let m=Math.ceil(15*i/1e3),y=[],x=t(d.clone());for(let S=0;S<=m;S++){let A=x(S/m);y.push(A.clone())}return y}_preloadTiles(t,i){}}class Rh{constructor(t={}){this.options=t,n.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){let i=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ze("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);let m=ze("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",d),this._innerContainer=ze("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),i===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));let i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){let d=i.reduce((m,y,x)=>(y.value&&(m+=`${y.key}=${y.value}${x<i.length-1?"&":""}`),m),"?");t.href=`${n.e.FEEDBACK_URL}/${d}#${ip(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){let m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}let i=this._map.style._mergedSourceCaches;for(let m in i){let y=i[m];if(y.used){let x=y.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((m,y)=>m.length-y.length),t=t.filter((m,y)=>{for(let x=y+1;x<t.length;x++)if(t[x].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));let d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Vi{constructor(){n.aP(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=ze("div","mapboxgl-ctrl");let i=ze("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(let i in t){let d=t[i].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){let t=this._container.children;if(t.length){let i=t[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class ji{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let i=++this._id;return this._queue.push({callback:t,id:i,cancelled:!1}),i}remove(t){let i=this._currentlyRunning,d=i?this._queue.concat(i):this._queue;for(let m of d)if(m.id===t)return void(m.cancelled=!0)}run(t=0){let i=this._currentlyRunning=this._queue;this._queue=[];for(let d of i)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Nl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;let i=n.cB((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,i,d){this._start=this.getValue(i),this._end=t,this._startTime=i,this._endTime=i+d}}let Da={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ma extends n.z{constructor(t,i,d,m){let{point:y,lngLat:x,originalEvent:S,target:A}=t;super(t.type,{point:y,lngLat:x,originalEvent:S,target:A}),this.preventDefault=()=>{t.preventDefault()},this.id=i,this.interaction=d,this.feature=m}}class cp{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,i){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);let d=i.filter,m=i.type;d&&this.filters.set(t,n.aZ(d)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");let y=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,i)):y.size===0&&this.map.on(m,this.handleType),y.size===0&&this.interactionsByType.set(m,y),y.set(t,i),this.typeById.set(t,m)}get(t){let i=this.typeById.get(t);if(!i)return;let d=this.interactionsByType.get(i);return d?d.get(t):void 0}remove(t){let i=this.typeById.get(t);if(!i)return;this.typeById.delete(t),this.filters.delete(t);let d=this.interactionsByType.get(i);d&&(d.delete(t),i==="mouseenter"||i==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(i,this.handleType))}queryTargets(t,i){let d=[];for(let[m,y]of i)y.target&&d.push({targetId:m,target:y.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;let i=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());i.length&&(t.type="mouseenter",this.handleType(t,i));let d=new Map;for(let[m,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||d.set(y.id,y);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){let i=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);i.length&&(t.type="mouseleave",this.handleType(t,i)),this.hoveredFeatures.clear()}handleType(t,i){let d=Array.from(this.interactionsByType.get(t.type)).reverse(),m=!!i;i=i||this.queryTargets(t.point,d);let y=t.type==="mouseenter",x=!1,S=new Set;for(let A of i){for(let[R,P]of d){if(!P.target)continue;let k=A.variants?A.variants[R]:null;if(k){for(let N of k){if(rs(N,A,S,R))continue;let V=new n.cw(A,N),Z=lc(N,A,R);m&&(V.state=this.map.getFeatureState(V));let G=y?this.prevHoveredFeatures.get(Z):null,Y=new Ma(t,R,P,V),X=G?G.stop:P.handler(Y);if(y&&this.hoveredFeatures.set(Z,{feature:A,stop:X}),X!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(let[A,R]of d){let{handler:P,target:k}=R;if(!k&&P(new Ma(t,A,R,null))!==!1)break}}}function mn(u,t){if(Array.isArray(u)&&Array.isArray(t)){let i=new Set(u),d=new Set(t);return i.size===d.size&&u.every(m=>d.has(m))}return n.bn(u,t)}let Ws={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},D0={showCompass:!0,showZoom:!0,visualizePitch:!1};class M0{constructor(t,i,d=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new No({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new Yc({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,i){this.mouseRotate.mousedown(t,i),this.mousePitch&&this.mousePitch.mousedown(t,i),Ft()}move(t,i){let d=this.map,m=this.mouseRotate.mousemoveWindow(t,i),y=m&&m.bearingDelta;if(y&&d.setBearing(d.getBearing()+y),this.mousePitch){let x=this.mousePitch.mousemoveWindow(t,i),S=x&&x.pitchDelta;S&&d.setPitch(d.getPitch()+S)}}off(){let t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){mi(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(n.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),To(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,To(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Jo(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Jo(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ph(u,t,i){if(u=new n.bO(u.lng,u.lat),t){let d=new n.bO(u.lng-360,u.lat),m=new n.bO(u.lng+360,u.lat),y=360*Math.ceil(Math.abs(u.lng-i.center.lng)/360),x=i.locationPoint(u).distSqr(t),S=t.x<0||t.y<0||t.x>i.width||t.y>i.height;i.locationPoint(d).distSqr(t)<x&&(S||Math.abs(d.lng-i.center.lng)<y)?u=d:i.locationPoint(m).distSqr(t)<x&&(S||Math.abs(m.lng-i.center.lng)<y)&&(u=m)}for(;Math.abs(u.lng-i.center.lng)>180;){let d=i.locationPoint(u);if(d.x>=0&&d.y>=0&&d.x<=i.width&&d.y<=i.height)break;u.lng>i.center.lng?u.lng-=360:u.lng+=360}return u}let zo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class po extends n.E{constructor(t,i){if(super(),(t instanceof HTMLElement||i)&&(t=n.l({element:t},i)),n.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ze("div");let y=41,x=27,S=pt("svg",{display:"block",height:y*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${y}`},this._element),A=pt("radialGradient",{id:"shadowGradient"},pt("defs",{},S));pt("stop",{offset:"10%","stop-opacity":.4},A),pt("stop",{offset:"100%","stop-opacity":.05},A),pt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),pt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),pt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),pt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=n.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});let d=this._element.classList;for(let y in zo)d.remove(`mapboxgl-marker-anchor-${y}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);let m=t&&t.className?t.className.trim().split(/\s+/):[];d.add(...m),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){let t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){let i=t.code,d=t.charCode||t.keyCode;i!=="Space"&&i!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){let i=t.originalEvent.target,d=this._element;this._popup&&(i===d||d.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let t=this._map,i=this._pos;if(!t||!i)return!1;let d=t.unproject(i),m=t.getFreeCameraOptions();if(!m.position)return!1;let y=m.position.toLngLat();return y.distanceTo(d)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){let t=this._map;if(!t)return;let i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();let d=t.unproject(i),m;t._showingGlobe()&&n.dH(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let t=this._pos;if(!t||!this._map)return;let i=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${zo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${i.x}px,${i.y}px)
        `}_calculateXYTransform(){let t=this._pos,i=this._map,d=this.getPitchAlignment();if(!i||!t||d!=="map")return"";if(!i._showingGlobe()){let A=i.getPitch();return A?`rotateX(${A}deg)`:""}let m=n.c4(n.dI(i.transform,this._lngLat)),y=t.sub(n.dJ(i.transform)),x=Math.abs(y.x)+Math.abs(y.y);if(x===0)return"";let S=m/x;return`rotateX(${-y.y*S}deg) rotateY(${y.x*S}deg)`}_calculateZTransform(){let t=this._pos,i=this._map;if(!i||!t)return"";let d=0,m=this.getRotationAlignment();if(m==="map")if(i._showingGlobe()){let y=i.project(new n.bO(this._lngLat.lng,this._lngLat.lat+.001)),x=i.project(new n.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);d=n.c4(Math.atan2(x.y,x.x))-90}else d=-i.getBearing();else if(m==="horizon"){let y=n.ac(4,6,i.getZoom()),x=n.dJ(i.transform);x.y+=y*i.transform.height;let S=t.sub(x),A=n.c4(Math.atan2(S.y,S.x));d=(A>90?A-270:A+90)*(1-y)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);let i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=Ph(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){let i=this._map;if(!i)return;let d=this._pointerdownPos,m=this._positionDelta;if(d&&m){if(!this._isDragging){let y=this._clickTolerance||i._clickTolerance;if(t.point.dist(d)<y)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.z("dragstart"))),this.fire(new n.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.z("dragend")),this._state="inactive"}_addDragHandler(t){let i=this._map,d=this._pos;i&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;let i=this._map;return i&&(t?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let hi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Pi={maxWidth:100,unit:"metric"},jr={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Hg={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},hr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function up(u=new n.P(0,0),t="bottom"){if(typeof u=="number"){let i=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new n.P(0,u);case"top-left":return new n.P(i,i);case"top-right":return new n.P(-i,i);case"bottom":return new n.P(0,-u);case"bottom-left":return new n.P(i,-i);case"bottom-right":return new n.P(-i,-i);case"left":return new n.P(u,0);case"right":return new n.P(-u,0)}return new n.P(0,0)}return u instanceof n.P||Array.isArray(u)?n.P.convert(u):n.P.convert(u[t]||[0,0])}return{version:F,supported:Ze.supported,setRTLTextPlugin:n.dK,getRTLTextPluginStatus:n.dL,Map:class extends Fl{constructor(u){$.mark(H.create);let t=u;if((u=n.l({},Ws,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&n.dF(window)&&(u.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new xc(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new ji,this._domRenderTaskQueue=new ji,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.aV(),this._locale=n.l({},Da,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Nl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new Fu(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Object.assign({},u.contextCreateOptions):{},typeof u.container=="string"){let i=document.getElementById(u.container);if(!i)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=i}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,n.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Jf),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ug(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||n.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new pf(this),u.hash&&(this._hash=new Rg(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});let i=u.bounds;i&&(this.resize(),this.fitBounds(i,n.l({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new Rh({customAttribution:u.customAttribution})),this._logoControl=new Vi,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new n.z(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new n.z(`${i.dataType}dataloading`,i))}),this._interactions=new cp(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new n.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let i=u.onAdd(this);this._controls.push(u);let d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(i,d.firstChild):d.appendChild(i),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new n.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let t=!this._moving;return t&&this.fire(new n.z("movestart",u)).fire(new n.z("move",u)),this.fire(new n.z("resize",u)),t&&this.fire(new n.z("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(n.az.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){let t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(let i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let u=this.transform,t=u.projection.name,i;t==="globe"&&u.zoom>=n.bY?(u.setMercatorFromTransition(),i=!0):t==="mercator"&&u.zoom<n.bY&&(u.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;return t=u.name==="globe"&&this.transform.zoom>=n.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u){return this.transform.locationPoint3D(n.bO.convert(u))}unproject(u){return this.transform.pointLocation3D(n.P.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,i){let d=m=>{let y=[];if(Array.isArray(t)){let x=t.filter(S=>this.getLayer(S));y=x.length?this.queryRenderedFeatures(m,{layers:x}):[]}else y=this.queryRenderedFeatures(m,{target:t});return y};if(u==="mouseenter"||u==="mouseover"){let m=!1;return{listener:i,targets:t,delegates:{mousemove:x=>{let S=d(x.point);S.length?m||(m=!0,i.call(this,new Ri(u,this,x.originalEvent,{features:S}))):m=!1},mouseout:()=>{m=!1}}}}if(u==="mouseleave"||u==="mouseout"){let m=!1;return{listener:i,targets:t,delegates:{mousemove:S=>{d(S.point).length?m=!0:m&&(m=!1,i.call(this,new Ri(u,this,S.originalEvent)))},mouseout:S=>{m&&(m=!1,i.call(this,new Ri(u,this,S.originalEvent)))}}}}{let m=y=>{let x=d(y.point);x.length&&(y.features=x,i.call(this,y),delete y.features)};return{listener:i,targets:t,delegates:{[u]:m}}}}on(u,t,i){if(typeof t=="function"||i===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let d=this._createDelegatedListener(u,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(d);for(let m in d.delegates)this.on(m,d.delegates[m]);return this}once(u,t,i){if(typeof t=="function"||i===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let d=this._createDelegatedListener(u,t,i);for(let m in d.delegates)this.once(m,d.delegates[m]);return this}off(u,t,i){if(typeof t=="function"||i===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let d=this._delegatedListeners?this._delegatedListeners[u]:void 0;return d&&(m=>{for(let y=0;y<m.length;y++){let x=m[y];if(x.listener===i&&mn(x.targets,t)){for(let S in x.delegates)this.off(S,x.delegates[S]);return m.splice(y,1),this}}})(d),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof n.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){let y=this.style.queryRenderedFeatures(u,void 0,this.transform),x=this.style.queryRenderedFeatureset(u,void 0,this.transform);return y.concat(x)}let i=!0;if(t.target&&(i=this._isTargetValid(t.target),i&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(let y of t.layers)if(!this._isValidId(y)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let m=[];return d&&(m=m.concat(this.style.queryRenderedFeatures(u,t,this.transform))),i&&(m=m.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),m}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}isPointOnSurface(u){let{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}setStyle(u,t){return t=n.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(i,d)=>{i?(n.w(`Unable to perform style diff: ${String(i.message||i.error||i)}. Rebuilding the style from scratch.`),this._updateStyle(u,t)):d&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){let t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){let i=n.l({},t);t&&t.config&&(i.initialConfig=t.config,delete i.config),this.style=new Ki(this,i).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ki(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new n.y(new Error("IDs can't be empty."))),!1):!n.cr(u)||(this.fire(new n.y(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(let t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,i)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:i=1,sdf:d=!1,stretchX:m,stretchY:y,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){let{width:S,height:A,data:R}=n.q.getImageData(t);this.style.addImage(u,{data:new n.r({width:S,height:A},R),pixelRatio:i,stretchX:m,stretchY:y,content:x,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new n.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:S,height:A}=t,R=t;this.style.addImage(u,{data:new n.r({width:S,height:A},new Uint8Array(R.data)),pixelRatio:i,stretchX:m,stretchY:y,content:x,sdf:d,usvg:!1,version:0,userImage:R}),R.onAdd&&R.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();let i=this.style.getImage(u);if(!i)return void this.fire(new n.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let d=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.q.getImageData(t):t,{width:m,height:y,data:x}=d;if(m===void 0||y===void 0)return void this.fire(new n.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==(i.usvg?i.icon.usvg_tree.width:i.data.width)||y!==(i.usvg?i.icon.usvg_tree.height:i.data.height))return void this.fire(new n.y(new Error(`The width and height of the updated image (${m}, ${y})
                must be that same as the previous version of the image
                (${i.data.width}, ${i.data.height})`)));let S=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap),A=!1;i.usvg?(i.data=new n.r({width:m,height:y},new Uint8Array(x)),i.usvg=!1,i.icon=void 0,A=!0):i.data.replace(x,S),this.style.updateImage(u,i,A)}hasImage(u){return u?!!this.style&&!!this.style.getImage(u):(this.fire(new n.y(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){n.o(this._requestManager.transformRequest(u,n.R.Image),(i,d)=>{t(i,d instanceof HTMLImageElement?n.q.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new n.y(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){let t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;let t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,i){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,i),this._update(!0)):this}setFilter(u,t,i={}){return this._isValidId(u)?(this.style.setFilter(u,t,i),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,i,d={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,i,d),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,i,d={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,i,d),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,i){return this.style.setConfigProperty(u,t,i),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){let t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.bO.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;let u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300,i,d,m,y=this._container;for(;y&&(!d||!m);){let x=window.getComputedStyle(y).transform;x&&x!=="none"&&(i=x.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&i[0]!=="0"&&i[0]!=="1"&&(d=i[0]),i[3]&&i[3]!=="0"&&i[3]!=="1"&&(m=i[3])),y=y.parentElement}this._containerWidth=d?Math.abs(u/d):u,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=ze("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();let t=this._canvasContainer=ze("div","mapboxgl-canvas-container",u);this._canvas=ze("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let i=this._controlContainer=ze("div","mapboxgl-control-container",u),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{d[m]=ze("div",`mapboxgl-ctrl-${m}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){let i=n.q.devicePixelRatio||1;this._canvas.width=i*Math.ceil(u),this._canvas.height=i*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){let t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){let t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){let u=n.l({},Ze.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(il(t,!0),this.painter=new rp(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",i=>{i.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.m.testSupport(t)):this.fire(new n.y(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.z("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new n.z("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new n.z("renderstart")),++this._frameId;let i=this.painter.context.extTimerQuery,d=n.q.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(i.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();let y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let R=this.transform.zoom,P=this.transform.pitch,k=n.q.now(),N=new n.a8(R,{now:k,fadeDuration:y,pitch:P,transition:this.style.transition});this.style.update(N)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(d);let S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,$.mark(H.load),this.fire(new n.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){let R=n.q.now()-d;m.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{let P=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new n.z("gpu-timing-frame",{cpuTime:R,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){let R=this.painter.collectGpuTimers();setTimeout(()=>{let P=this.painter.queryGpuTimers(R);this.fire(new n.z("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){let R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let P=this.painter.queryGpuTimeDeferredRender(R);this.fire(new n.z("gpu-timing-deferred-render",{gpuTime:P}))},50)}let A=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(A||this._repaint)this.triggerRepaint();else{let R=this.idle();if(R&&(x=this._updateAverageElevation(d,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new n.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let P=this._calculateSpeedIndex();this.fire(new n.z("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,$.mark(H.fullLoad),this._performanceMetricsCollection&&Io(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(let t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(let t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){let i=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&i(0);let d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){let m=this.transform.averageElevation,y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=u;let x=Math.abs(m-y);if(x>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(y),i(y);this._averageElevation.easeTo(y,u,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),i(y)}return!!this._averageElevation.isEasing(u)&&i(this._averageElevation.getValue(u))}_authenticate(){Ee(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===Ya||u.status===401)){let t=this.painter.context.gl;il(t,!1),this._logoControl instanceof Vi&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),qd(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&el(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){let u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());let i=this.painter.context.gl,d=i.createFramebuffer();function m(y){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,y,0);let x=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,x),x}return i.bindFramebuffer(i.FRAMEBUFFER,d),this._canvasPixelComparison(m(u),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(u,t,i){let d=i[1]-i[0],m=u.length/4;for(let y=0;y<t.length;y++){let x=t[y],S=0;for(let A=0;A<x.length;A+=4)x[A]===u[A]&&x[A+1]===u[A+1]&&x[A+2]===u[A+2]&&x[A+3]===u[A+3]&&(S+=1);d+=(i[y+2]-i[y+1])*(1-S/m)}return d}remove(){this._hash&&this._hash.remove();for(let t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),rl.delete(this.painter.context.gl),nl.remove(),Gt.remove(),this._removed=!0,this.fire(new n.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=n.q.frame(t=>{let i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(t)}))}_preloadTiles(u){let t=this.style?this.style.getSourceCaches():[];return n.bl(t,(i,d)=>i._preloadTiles(u,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,t){n.dG(u,t)}get version(){return F}},NavigationControl:class{constructor(u={}){this.options=n.l({},D0,u),this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),ze("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),ze("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{let i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:t}):i.resetNorth({},{originalEvent:t}))}),this._compassIcon=ze("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let u=this._map;if(!u)return;let t=u.getZoom(),i=t===u.getMaxZoom(),d=t===u.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){let u=this._map;if(!u)return;let t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new M0(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){let u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){let i=ze("button",u,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(u,t){if(!this._map)return;let i=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",i),u.firstElementChild&&u.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends n.E{constructor(u={}){super();let t=navigator.geolocation;this.options=n.l({geolocation:t},hi,u),n.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Dh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){let t=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,u(i)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(i=>t(i.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){let t=this._map.getMaxBounds(),i=u.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new n.z("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("geolocate",u)),this._finish()}}_updateCamera(u){let t=new n.bO(u.coords.longitude,u.coords.latitude),i=u.coords.accuracy,d=this._map.getBearing(),m=n.l({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(i),m,{geolocateSource:!0})}_updateMarker(u){if(u){let t=new n.bO(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let u=this._map.transform,t=n.bH(1,u._center.lat)*u.worldSize,i=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ze("button","mapboxgl-ctrl-geolocate",this._container),ze("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{let t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ze("div","mapboxgl-user-location"),this._dotElement.appendChild(ze("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ze("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new po({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ze("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new po({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.z("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Rh,ScaleControl:class{constructor(u={}){this.options=n.l({},Pi,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let u=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,d=t._containerWidth/2-u/2,m=t.unproject([d,i]),y=t.unproject([d+u,i]),x=m.distanceTo(y);if(this.options.unit==="imperial"){let S=3.2808*x;S>5280?this._setScale(u,S/5280,"mile"):this._setScale(u,S,"foot")}else this.options.unit==="nautical"?this._setScale(u,x/1852,"nautical-mile"):x>=1e3?this._setScale(u,x/1e3,"kilometer"):this._setScale(u,x,"meter")}_setScale(u,t,i){this._map._requestDomTask(()=>{let d=function(y){let x=Math.pow(10,`${Math.floor(y)}`.length-1),S=y/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(A){let R=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*R)/R}(S),x*S}(t),m=d/t;this._container.innerHTML=this._isNumberFormatSupported&&i!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(d):`${d}&nbsp;${jr[i]}`,this._container.style.width=u*m+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:n.w("Full screen control 'container' must be a DOM element.")),n.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let u=this._fullscreenButton=ze("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ze("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(u){super(),this.options=n.l(Object.create(Hg),u),n.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new n.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new n.z("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=n.bO.convert(u),this._pos=null,this._trackPointer=!1,this._update();let t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){let t=document.createDocumentFragment(),i=document.createElement("body"),d;for(i.innerHTML=u;d=i.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ze("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){let i=this._closeButton=ze("button","mapboxgl-popup-close-button",t);i.type="button",i.setAttribute("aria-label","Close popup"),i.innerHTML='<span aria-hidden="true">&#215;</span>',i.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;let t=this._map,i=this._container,d=this._pos;if(!t||!i||!d)return"bottom";let m=i.offsetWidth,y=i.offsetHeight,x=d.x<m/2,S=d.x>t.transform.width-m/2;if(d.y+u<y)return x?"top-left":S?"top-right":"top";if(d.y>t.transform.height-y){if(x)return"bottom-left";if(S)return"bottom-right"}return x?"left":S?"right":"bottom"}_updateClassList(){let u=this._container;if(!u)return;let t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){let t=this._map,i=this._content;if(!t||!this._lngLat&&!this._trackPointer||!i)return;let d=this._container;if(d||(d=this._container=ze("div","mapboxgl-popup",t.getContainer()),this._tip=ze("div","mapboxgl-popup-tip",d),d.appendChild(i)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ph(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){let m=this._pos=this._trackPointer&&u instanceof n.P?u:t.project(this._lngLat),y=up(this.options.offset),x=this._anchor=this._getAnchor(y.y),S=up(this.options.offset,x),A=m.add(S).round();t._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${zo[x]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._showingGlobe()){let m=n.dH(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let u=this._container.querySelector(hr);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:po,Style:Ki,LngLat:n.bO,LngLatBounds:n.az,Point:n.P,MercatorCoordinate:n.aa,FreeCameraOptions:Ku,Evented:n.E,config:n.e,prewarm:n.dM,clearPrewarmedResources:n.dN,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(u){n.e.ACCESS_TOKEN=u},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(u){n.e.API_URL=u},get workerCount(){return n.dO.workerCount},set workerCount(u){n.dO.workerCount=u},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){n.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){n.dP(u)},get workerUrl(){return n.dQ.workerUrl},set workerUrl(u){n.dQ.workerUrl=u},get workerClass(){return n.dQ.workerClass},set workerClass(u){n.dQ.workerClass=u},get workerParams(){return n.dQ.workerParams},set workerParams(u){n.dQ.workerParams=u},get dracoUrl(){return n.dR()},set dracoUrl(u){n.dS(u)},get meshoptUrl(){return n.dT()},set meshoptUrl(u){n.dU(u)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var I=h;return I})});function YS(s,l){return Object.is(s,l)}var ti=null,k_=!1,Yx=1,to=Symbol("SIGNAL");function jn(s){let l=ti;return ti=s,l}function KS(){return ti}var Yh={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function N_(s){if(k_)throw new Error("");if(ti===null)return;ti.consumerOnSignalRead(s);let l=ti.nextProducerIndex++;if(j_(ti),l<ti.producerNode.length&&ti.producerNode[l]!==s&&Wp(ti)){let h=ti.producerNode[l];V_(h,ti.producerIndexOfThis[l])}ti.producerNode[l]!==s&&(ti.producerNode[l]=s,ti.producerIndexOfThis[l]=Wp(ti)?tD(s,ti,l):0),ti.producerLastReadVersion[l]=s.version}function EL(){Yx++}function JS(s){if(!(Wp(s)&&!s.dirty)&&!(!s.dirty&&s.lastCleanEpoch===Yx)){if(!s.producerMustRecompute(s)&&!B_(s)){XS(s);return}s.producerRecomputeValue(s),XS(s)}}function QS(s){if(s.liveConsumerNode===void 0)return;let l=k_;k_=!0;try{for(let h of s.liveConsumerNode)h.dirty||TL(h)}finally{k_=l}}function eD(){return ti?.consumerAllowSignalWrites!==!1}function TL(s){s.dirty=!0,QS(s),s.consumerMarkedDirty?.(s)}function XS(s){s.dirty=!1,s.lastCleanEpoch=Yx}function Zp(s){return s&&(s.nextProducerIndex=0),jn(s)}function z_(s,l){if(jn(l),!(!s||s.producerNode===void 0||s.producerIndexOfThis===void 0||s.producerLastReadVersion===void 0)){if(Wp(s))for(let h=s.nextProducerIndex;h<s.producerNode.length;h++)V_(s.producerNode[h],s.producerIndexOfThis[h]);for(;s.producerNode.length>s.nextProducerIndex;)s.producerNode.pop(),s.producerLastReadVersion.pop(),s.producerIndexOfThis.pop()}}function B_(s){j_(s);for(let l=0;l<s.producerNode.length;l++){let h=s.producerNode[l],g=s.producerLastReadVersion[l];if(g!==h.version||(JS(h),g!==h.version))return!0}return!1}function Xp(s){if(j_(s),Wp(s))for(let l=0;l<s.producerNode.length;l++)V_(s.producerNode[l],s.producerIndexOfThis[l]);s.producerNode.length=s.producerLastReadVersion.length=s.producerIndexOfThis.length=0,s.liveConsumerNode&&(s.liveConsumerNode.length=s.liveConsumerIndexOfThis.length=0)}function tD(s,l,h){if(nD(s),s.liveConsumerNode.length===0&&rD(s))for(let g=0;g<s.producerNode.length;g++)s.producerIndexOfThis[g]=tD(s.producerNode[g],s,g);return s.liveConsumerIndexOfThis.push(h),s.liveConsumerNode.push(l)-1}function V_(s,l){if(nD(s),s.liveConsumerNode.length===1&&rD(s))for(let g=0;g<s.producerNode.length;g++)V_(s.producerNode[g],s.producerIndexOfThis[g]);let h=s.liveConsumerNode.length-1;if(s.liveConsumerNode[l]=s.liveConsumerNode[h],s.liveConsumerIndexOfThis[l]=s.liveConsumerIndexOfThis[h],s.liveConsumerNode.length--,s.liveConsumerIndexOfThis.length--,l<s.liveConsumerNode.length){let g=s.liveConsumerIndexOfThis[l],I=s.liveConsumerNode[l];j_(I),I.producerIndexOfThis[g]=l}}function Wp(s){return s.consumerIsAlwaysLive||(s?.liveConsumerNode?.length??0)>0}function j_(s){s.producerNode??=[],s.producerIndexOfThis??=[],s.producerLastReadVersion??=[]}function nD(s){s.liveConsumerNode??=[],s.liveConsumerIndexOfThis??=[]}function rD(s){return s.producerNode!==void 0}function Kx(s){let l=Object.create(IL);l.computation=s;let h=()=>{if(JS(l),N_(l),l.value===F_)throw l.error;return l.value};return h[to]=l,h}var Zx=Symbol("UNSET"),Xx=Symbol("COMPUTING"),F_=Symbol("ERRORED"),IL=lr($t({},Yh),{value:Zx,dirty:!0,error:null,equal:YS,kind:"computed",producerMustRecompute(s){return s.value===Zx||s.value===Xx},producerRecomputeValue(s){if(s.value===Xx)throw new Error("Detected cycle in computations.");let l=s.value;s.value=Xx;let h=Zp(s),g,I=!1;try{g=s.computation(),jn(null),I=l!==Zx&&l!==F_&&g!==F_&&s.equal(l,g)}catch(n){g=F_,s.error=n}finally{z_(s,h)}if(I){s.value=l;return}s.value=g,s.version++}});function SL(){throw new Error}var iD=SL;function oD(s){iD(s)}function sD(s){iD=s}var DL=null;function aD(s){let l=Object.create(Jx);l.value=s;let h=()=>(N_(l),l.value);return h[to]=l,h}function U_(s,l){eD()||oD(s),s.equal(s.value,l)||(s.value=l,ML(s))}function lD(s,l){eD()||oD(s),U_(s,l(s.value))}var Jx=lr($t({},Yh),{equal:YS,value:void 0,kind:"signal"});function ML(s){s.version++,EL(),QS(s),DL?.()}var Qx;function Yp(){return Qx}function Pa(s){let l=Qx;return Qx=s,l}var eb=Symbol("NotFound");function Sn(s){return typeof s=="function"}function Kh(s){let h=s(g=>{Error.call(g),g.stack=new Error().stack});return h.prototype=Object.create(Error.prototype),h.prototype.constructor=h,h}var $_=Kh(s=>function(h){s(this),this.message=h?`${h.length} errors occurred during unsubscription:
${h.map((g,I)=>`${I+1}) ${g.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=h});function Kp(s,l){if(s){let h=s.indexOf(l);0<=h&&s.splice(h,1)}}var Wr=class s{constructor(l){this.initialTeardown=l,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let l;if(!this.closed){this.closed=!0;let{_parentage:h}=this;if(h)if(this._parentage=null,Array.isArray(h))for(let n of h)n.remove(this);else h.remove(this);let{initialTeardown:g}=this;if(Sn(g))try{g()}catch(n){l=n instanceof $_?n.errors:[n]}let{_finalizers:I}=this;if(I){this._finalizers=null;for(let n of I)try{cD(n)}catch(F){l=l??[],F instanceof $_?l=[...l,...F.errors]:l.push(F)}}if(l)throw new $_(l)}}add(l){var h;if(l&&l!==this)if(this.closed)cD(l);else{if(l instanceof s){if(l.closed||l._hasParent(this))return;l._addParent(this)}(this._finalizers=(h=this._finalizers)!==null&&h!==void 0?h:[]).push(l)}}_hasParent(l){let{_parentage:h}=this;return h===l||Array.isArray(h)&&h.includes(l)}_addParent(l){let{_parentage:h}=this;this._parentage=Array.isArray(h)?(h.push(l),h):h?[h,l]:l}_removeParent(l){let{_parentage:h}=this;h===l?this._parentage=null:Array.isArray(h)&&Kp(h,l)}remove(l){let{_finalizers:h}=this;h&&Kp(h,l),l instanceof s&&l._removeParent(this)}};Wr.EMPTY=(()=>{let s=new Wr;return s.closed=!0,s})();var tb=Wr.EMPTY;function H_(s){return s instanceof Wr||s&&"closed"in s&&Sn(s.remove)&&Sn(s.add)&&Sn(s.unsubscribe)}function cD(s){Sn(s)?s():s.unsubscribe()}var xs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Jh={setTimeout(s,l,...h){let{delegate:g}=Jh;return g?.setTimeout?g.setTimeout(s,l,...h):setTimeout(s,l,...h)},clearTimeout(s){let{delegate:l}=Jh;return(l?.clearTimeout||clearTimeout)(s)},delegate:void 0};function G_(s){Jh.setTimeout(()=>{let{onUnhandledError:l}=xs;if(l)l(s);else throw s})}function Jp(){}var uD=nb("C",void 0,void 0);function hD(s){return nb("E",void 0,s)}function dD(s){return nb("N",s,void 0)}function nb(s,l,h){return{kind:s,value:l,error:h}}var lu=null;function Qh(s){if(xs.useDeprecatedSynchronousErrorHandling){let l=!lu;if(l&&(lu={errorThrown:!1,error:null}),s(),l){let{errorThrown:h,error:g}=lu;if(lu=null,h)throw g}}else s()}function fD(s){xs.useDeprecatedSynchronousErrorHandling&&lu&&(lu.errorThrown=!0,lu.error=s)}var cu=class extends Wr{constructor(l){super(),this.isStopped=!1,l?(this.destination=l,H_(l)&&l.add(this)):this.destination=RL}static create(l,h,g){return new ed(l,h,g)}next(l){this.isStopped?ib(dD(l),this):this._next(l)}error(l){this.isStopped?ib(hD(l),this):(this.isStopped=!0,this._error(l))}complete(){this.isStopped?ib(uD,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(l){this.destination.next(l)}_error(l){try{this.destination.error(l)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},CL=Function.prototype.bind;function rb(s,l){return CL.call(s,l)}var ob=class{constructor(l){this.partialObserver=l}next(l){let{partialObserver:h}=this;if(h.next)try{h.next(l)}catch(g){q_(g)}}error(l){let{partialObserver:h}=this;if(h.error)try{h.error(l)}catch(g){q_(g)}else q_(l)}complete(){let{partialObserver:l}=this;if(l.complete)try{l.complete()}catch(h){q_(h)}}},ed=class extends cu{constructor(l,h,g){super();let I;if(Sn(l)||!l)I={next:l??void 0,error:h??void 0,complete:g??void 0};else{let n;this&&xs.useDeprecatedNextContext?(n=Object.create(l),n.unsubscribe=()=>this.unsubscribe(),I={next:l.next&&rb(l.next,n),error:l.error&&rb(l.error,n),complete:l.complete&&rb(l.complete,n)}):I=l}this.destination=new ob(I)}};function q_(s){xs.useDeprecatedSynchronousErrorHandling?fD(s):G_(s)}function AL(s){throw s}function ib(s,l){let{onStoppedNotification:h}=xs;h&&Jh.setTimeout(()=>h(s,l))}var RL={closed:!0,next:Jp,error:AL,complete:Jp};var td=typeof Symbol=="function"&&Symbol.observable||"@@observable";function yo(s){return s}function sb(...s){return ab(s)}function ab(s){return s.length===0?yo:s.length===1?s[0]:function(h){return s.reduce((g,I)=>I(g),h)}}var dr=(()=>{class s{constructor(h){h&&(this._subscribe=h)}lift(h){let g=new s;return g.source=this,g.operator=h,g}subscribe(h,g,I){let n=OL(h)?h:new ed(h,g,I);return Qh(()=>{let{operator:F,source:H}=this;n.add(F?F.call(n,H):H?this._subscribe(n):this._trySubscribe(n))}),n}_trySubscribe(h){try{return this._subscribe(h)}catch(g){h.error(g)}}forEach(h,g){return g=pD(g),new g((I,n)=>{let F=new ed({next:H=>{try{h(H)}catch($){n($),F.unsubscribe()}},error:n,complete:I});this.subscribe(F)})}_subscribe(h){var g;return(g=this.source)===null||g===void 0?void 0:g.subscribe(h)}[td](){return this}pipe(...h){return ab(h)(this)}toPromise(h){return h=pD(h),new h((g,I)=>{let n;this.subscribe(F=>n=F,F=>I(F),()=>g(n))})}}return s.create=l=>new s(l),s})();function pD(s){var l;return(l=s??xs.Promise)!==null&&l!==void 0?l:Promise}function PL(s){return s&&Sn(s.next)&&Sn(s.error)&&Sn(s.complete)}function OL(s){return s&&s instanceof cu||PL(s)&&H_(s)}function lb(s){return Sn(s?.lift)}function Kn(s){return l=>{if(lb(l))return l.lift(function(h){try{return s(h,this)}catch(g){this.error(g)}});throw new TypeError("Unable to lift unknown Observable type")}}function Jn(s,l,h,g,I){return new cb(s,l,h,g,I)}var cb=class extends cu{constructor(l,h,g,I,n,F){super(l),this.onFinalize=n,this.shouldUnsubscribe=F,this._next=h?function(H){try{h(H)}catch($){l.error($)}}:super._next,this._error=I?function(H){try{I(H)}catch($){l.error($)}finally{this.unsubscribe()}}:super._error,this._complete=g?function(){try{g()}catch(H){l.error(H)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var l;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:h}=this;super.unsubscribe(),!h&&((l=this.onFinalize)===null||l===void 0||l.call(this))}}};function nd(){return Kn((s,l)=>{let h=null;s._refCount++;let g=Jn(l,void 0,void 0,void 0,()=>{if(!s||s._refCount<=0||0<--s._refCount){h=null;return}let I=s._connection,n=h;h=null,I&&(!n||I===n)&&I.unsubscribe(),l.unsubscribe()});s.subscribe(g),g.closed||(h=s.connect())})}var rd=class extends dr{constructor(l,h){super(),this.source=l,this.subjectFactory=h,this._subject=null,this._refCount=0,this._connection=null,lb(l)&&(this.lift=l.lift)}_subscribe(l){return this.getSubject().subscribe(l)}getSubject(){let l=this._subject;return(!l||l.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:l}=this;this._subject=this._connection=null,l?.unsubscribe()}connect(){let l=this._connection;if(!l){l=this._connection=new Wr;let h=this.getSubject();l.add(this.source.subscribe(Jn(h,void 0,()=>{this._teardown(),h.complete()},g=>{this._teardown(),h.error(g)},()=>this._teardown()))),l.closed&&(this._connection=null,l=Wr.EMPTY)}return l}refCount(){return nd()(this)}};var mD=Kh(s=>function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var di=(()=>{class s extends dr{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(h){let g=new W_(this,this);return g.operator=h,g}_throwIfClosed(){if(this.closed)throw new mD}next(h){Qh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let g of this.currentObservers)g.next(h)}})}error(h){Qh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=h;let{observers:g}=this;for(;g.length;)g.shift().error(h)}})}complete(){Qh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:h}=this;for(;h.length;)h.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var h;return((h=this.observers)===null||h===void 0?void 0:h.length)>0}_trySubscribe(h){return this._throwIfClosed(),super._trySubscribe(h)}_subscribe(h){return this._throwIfClosed(),this._checkFinalizedStatuses(h),this._innerSubscribe(h)}_innerSubscribe(h){let{hasError:g,isStopped:I,observers:n}=this;return g||I?tb:(this.currentObservers=null,n.push(h),new Wr(()=>{this.currentObservers=null,Kp(n,h)}))}_checkFinalizedStatuses(h){let{hasError:g,thrownError:I,isStopped:n}=this;g?h.error(I):n&&h.complete()}asObservable(){let h=new dr;return h.source=this,h}}return s.create=(l,h)=>new W_(l,h),s})(),W_=class extends di{constructor(l,h){super(),this.destination=l,this.source=h}next(l){var h,g;(g=(h=this.destination)===null||h===void 0?void 0:h.next)===null||g===void 0||g.call(h,l)}error(l){var h,g;(g=(h=this.destination)===null||h===void 0?void 0:h.error)===null||g===void 0||g.call(h,l)}complete(){var l,h;(h=(l=this.destination)===null||l===void 0?void 0:l.complete)===null||h===void 0||h.call(l)}_subscribe(l){var h,g;return(g=(h=this.source)===null||h===void 0?void 0:h.subscribe(l))!==null&&g!==void 0?g:tb}};var Ei=class extends di{constructor(l){super(),this._value=l}get value(){return this.getValue()}_subscribe(l){let h=super._subscribe(l);return!h.closed&&l.next(this._value),h}getValue(){let{hasError:l,thrownError:h,_value:g}=this;if(l)throw h;return this._throwIfClosed(),g}next(l){super.next(this._value=l)}};var no=new dr(s=>s.complete());function gD(s){return s&&Sn(s.schedule)}function _D(s){return s[s.length-1]}function yD(s){return Sn(_D(s))?s.pop():void 0}function Yl(s){return gD(_D(s))?s.pop():void 0}function xD(s,l,h,g){function I(n){return n instanceof h?n:new h(function(F){F(n)})}return new(h||(h=Promise))(function(n,F){function H(Te){try{ae(g.next(Te))}catch(Fe){F(Fe)}}function $(Te){try{ae(g.throw(Te))}catch(Fe){F(Fe)}}function ae(Te){Te.done?n(Te.value):I(Te.value).then(H,$)}ae((g=g.apply(s,l||[])).next())})}function vD(s){var l=typeof Symbol=="function"&&Symbol.iterator,h=l&&s[l],g=0;if(h)return h.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&g>=s.length&&(s=void 0),{value:s&&s[g++],done:!s}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")}function uu(s){return this instanceof uu?(this.v=s,this):new uu(s)}function bD(s,l,h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=h.apply(s,l||[]),I,n=[];return I=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),H("next"),H("throw"),H("return",F),I[Symbol.asyncIterator]=function(){return this},I;function F(ze){return function(pt){return Promise.resolve(pt).then(ze,Fe)}}function H(ze,pt){g[ze]&&(I[ze]=function(vt){return new Promise(function(Cn,En){n.push([ze,vt,Cn,En])>1||$(ze,vt)})},pt&&(I[ze]=pt(I[ze])))}function $(ze,pt){try{ae(g[ze](pt))}catch(vt){Ze(n[0][3],vt)}}function ae(ze){ze.value instanceof uu?Promise.resolve(ze.value.v).then(Te,Fe):Ze(n[0][2],ze)}function Te(ze){$("next",ze)}function Fe(ze){$("throw",ze)}function Ze(ze,pt){ze(pt),n.shift(),n.length&&$(n[0][0],n[0][1])}}function wD(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=s[Symbol.asyncIterator],h;return l?l.call(s):(s=typeof vD=="function"?vD(s):s[Symbol.iterator](),h={},g("next"),g("throw"),g("return"),h[Symbol.asyncIterator]=function(){return this},h);function g(n){h[n]=s[n]&&function(F){return new Promise(function(H,$){F=s[n](F),I(H,$,F.done,F.value)})}}function I(n,F,H,$){Promise.resolve($).then(function(ae){n({value:ae,done:H})},F)}}var Z_=s=>s&&typeof s.length=="number"&&typeof s!="function";function X_(s){return Sn(s?.then)}function Y_(s){return Sn(s[td])}function K_(s){return Symbol.asyncIterator&&Sn(s?.[Symbol.asyncIterator])}function J_(s){return new TypeError(`You provided ${s!==null&&typeof s=="object"?"an invalid object":`'${s}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function LL(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Q_=LL();function ey(s){return Sn(s?.[Q_])}function ty(s){return bD(this,arguments,function*(){let h=s.getReader();try{for(;;){let{value:g,done:I}=yield uu(h.read());if(I)return yield uu(void 0);yield yield uu(g)}}finally{h.releaseLock()}})}function ny(s){return Sn(s?.getReader)}function fi(s){if(s instanceof dr)return s;if(s!=null){if(Y_(s))return kL(s);if(Z_(s))return FL(s);if(X_(s))return NL(s);if(K_(s))return ED(s);if(ey(s))return zL(s);if(ny(s))return BL(s)}throw J_(s)}function kL(s){return new dr(l=>{let h=s[td]();if(Sn(h.subscribe))return h.subscribe(l);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function FL(s){return new dr(l=>{for(let h=0;h<s.length&&!l.closed;h++)l.next(s[h]);l.complete()})}function NL(s){return new dr(l=>{s.then(h=>{l.closed||(l.next(h),l.complete())},h=>l.error(h)).then(null,G_)})}function zL(s){return new dr(l=>{for(let h of s)if(l.next(h),l.closed)return;l.complete()})}function ED(s){return new dr(l=>{VL(s,l).catch(h=>l.error(h))})}function BL(s){return ED(ty(s))}function VL(s,l){var h,g,I,n;return xD(this,void 0,void 0,function*(){try{for(h=wD(s);g=yield h.next(),!g.done;){let F=g.value;if(l.next(F),l.closed)return}}catch(F){I={error:F}}finally{try{g&&!g.done&&(n=h.return)&&(yield n.call(h))}finally{if(I)throw I.error}}l.complete()})}function ro(s,l,h,g=0,I=!1){let n=l.schedule(function(){h(),I?s.add(this.schedule(null,g)):this.unsubscribe()},g);if(s.add(n),!I)return n}function ry(s,l=0){return Kn((h,g)=>{h.subscribe(Jn(g,I=>ro(g,s,()=>g.next(I),l),()=>ro(g,s,()=>g.complete(),l),I=>ro(g,s,()=>g.error(I),l)))})}function iy(s,l=0){return Kn((h,g)=>{g.add(s.schedule(()=>h.subscribe(g),l))})}function TD(s,l){return fi(s).pipe(iy(l),ry(l))}function ID(s,l){return fi(s).pipe(iy(l),ry(l))}function SD(s,l){return new dr(h=>{let g=0;return l.schedule(function(){g===s.length?h.complete():(h.next(s[g++]),h.closed||this.schedule())})})}function DD(s,l){return new dr(h=>{let g;return ro(h,l,()=>{g=s[Q_](),ro(h,l,()=>{let I,n;try{({value:I,done:n}=g.next())}catch(F){h.error(F);return}n?h.complete():h.next(I)},0,!0)}),()=>Sn(g?.return)&&g.return()})}function oy(s,l){if(!s)throw new Error("Iterable cannot be null");return new dr(h=>{ro(h,l,()=>{let g=s[Symbol.asyncIterator]();ro(h,l,()=>{g.next().then(I=>{I.done?h.complete():h.next(I.value)})},0,!0)})})}function MD(s,l){return oy(ty(s),l)}function CD(s,l){if(s!=null){if(Y_(s))return TD(s,l);if(Z_(s))return SD(s,l);if(X_(s))return ID(s,l);if(K_(s))return oy(s,l);if(ey(s))return DD(s,l);if(ny(s))return MD(s,l)}throw J_(s)}function ni(s,l){return l?CD(s,l):fi(s)}function Pn(...s){let l=Yl(s);return ni(s,l)}function id(s,l){let h=Sn(s)?s:()=>s,g=I=>I.error(h());return new dr(l?I=>l.schedule(g,0,I):g)}function ub(s){return!!s&&(s instanceof dr||Sn(s.lift)&&Sn(s.subscribe))}var Oa=Kh(s=>function(){s(this),this.name="EmptyError",this.message="no elements in sequence"});function Nn(s,l){return Kn((h,g)=>{let I=0;h.subscribe(Jn(g,n=>{g.next(s.call(l,n,I++))}))})}var{isArray:jL}=Array;function UL(s,l){return jL(l)?s(...l):s(l)}function AD(s){return Nn(l=>UL(s,l))}var{isArray:$L}=Array,{getPrototypeOf:HL,prototype:GL,keys:qL}=Object;function RD(s){if(s.length===1){let l=s[0];if($L(l))return{args:l,keys:null};if(WL(l)){let h=qL(l);return{args:h.map(g=>l[g]),keys:h}}}return{args:s,keys:null}}function WL(s){return s&&typeof s=="object"&&HL(s)===GL}function PD(s,l){return s.reduce((h,g,I)=>(h[g]=l[I],h),{})}function sy(...s){let l=Yl(s),h=yD(s),{args:g,keys:I}=RD(s);if(g.length===0)return ni([],l);let n=new dr(ZL(g,l,I?F=>PD(I,F):yo));return h?n.pipe(AD(h)):n}function ZL(s,l,h=yo){return g=>{OD(l,()=>{let{length:I}=s,n=new Array(I),F=I,H=I;for(let $=0;$<I;$++)OD(l,()=>{let ae=ni(s[$],l),Te=!1;ae.subscribe(Jn(g,Fe=>{n[$]=Fe,Te||(Te=!0,H--),H||g.next(h(n.slice()))},()=>{--F||g.complete()}))},g)},g)}}function OD(s,l,h){s?ro(h,s,l):l()}function LD(s,l,h,g,I,n,F,H){let $=[],ae=0,Te=0,Fe=!1,Ze=()=>{Fe&&!$.length&&!ae&&l.complete()},ze=vt=>ae<g?pt(vt):$.push(vt),pt=vt=>{n&&l.next(vt),ae++;let Cn=!1;fi(h(vt,Te++)).subscribe(Jn(l,En=>{I?.(En),n?ze(En):l.next(En)},()=>{Cn=!0},void 0,()=>{if(Cn)try{for(ae--;$.length&&ae<g;){let En=$.shift();F?ro(l,F,()=>pt(En)):pt(En)}Ze()}catch(En){l.error(En)}}))};return s.subscribe(Jn(l,ze,()=>{Fe=!0,Ze()})),()=>{H?.()}}function ri(s,l,h=1/0){return Sn(l)?ri((g,I)=>Nn((n,F)=>l(g,n,I,F))(fi(s(g,I))),h):(typeof l=="number"&&(h=l),Kn((g,I)=>LD(g,I,s,h)))}function hb(s=1/0){return ri(yo,s)}function kD(){return hb(1)}function od(...s){return kD()(ni(s,Yl(s)))}function ay(s){return new dr(l=>{fi(s()).subscribe(l)})}function qi(s,l){return Kn((h,g)=>{let I=0;h.subscribe(Jn(g,n=>s.call(l,n,I++)&&g.next(n)))})}function Kl(s){return Kn((l,h)=>{let g=null,I=!1,n;g=l.subscribe(Jn(h,void 0,void 0,F=>{n=fi(s(F,Kl(s)(l))),g?(g.unsubscribe(),g=null,n.subscribe(h)):I=!0})),I&&(g.unsubscribe(),g=null,n.subscribe(h))})}function FD(s,l,h,g,I){return(n,F)=>{let H=h,$=l,ae=0;n.subscribe(Jn(F,Te=>{let Fe=ae++;$=H?s($,Te,Fe):(H=!0,Te),g&&F.next($)},I&&(()=>{H&&F.next($),F.complete()})))}}function sd(s,l){return Sn(l)?ri(s,l,1):ri(s,1)}function Jl(s){return Kn((l,h)=>{let g=!1;l.subscribe(Jn(h,I=>{g=!0,h.next(I)},()=>{g||h.next(s),h.complete()}))})}function La(s){return s<=0?()=>no:Kn((l,h)=>{let g=0;l.subscribe(Jn(h,I=>{++g<=s&&(h.next(I),s<=g&&h.complete())}))})}function ly(s=XL){return Kn((l,h)=>{let g=!1;l.subscribe(Jn(h,I=>{g=!0,h.next(I)},()=>g?h.complete():h.error(s())))})}function XL(){return new Oa}function Qp(s){return Kn((l,h)=>{try{l.subscribe(h)}finally{h.add(s)}})}function ka(s,l){let h=arguments.length>=2;return g=>g.pipe(s?qi((I,n)=>s(I,n,g)):yo,La(1),h?Jl(l):ly(()=>new Oa))}function ad(s){return s<=0?()=>no:Kn((l,h)=>{let g=[];l.subscribe(Jn(h,I=>{g.push(I),s<g.length&&g.shift()},()=>{for(let I of g)h.next(I);h.complete()},void 0,()=>{g=null}))})}function db(s,l){let h=arguments.length>=2;return g=>g.pipe(s?qi((I,n)=>s(I,n,g)):yo,ad(1),h?Jl(l):ly(()=>new Oa))}function fb(s,l){return Kn(FD(s,l,arguments.length>=2,!0))}function pb(...s){let l=Yl(s);return Kn((h,g)=>{(l?od(s,h,l):od(s,h)).subscribe(g)})}function bs(s,l){return Kn((h,g)=>{let I=null,n=0,F=!1,H=()=>F&&!I&&g.complete();h.subscribe(Jn(g,$=>{I?.unsubscribe();let ae=0,Te=n++;fi(s($,Te)).subscribe(I=Jn(g,Fe=>g.next(l?l($,Fe,Te,ae++):Fe),()=>{I=null,H()}))},()=>{F=!0,H()}))})}function mb(s){return Kn((l,h)=>{fi(s).subscribe(Jn(h,()=>h.complete(),Jp)),!h.closed&&l.subscribe(h)})}function Ur(s,l,h){let g=Sn(s)||l||h?{next:s,error:l,complete:h}:s;return g?Kn((I,n)=>{var F;(F=g.subscribe)===null||F===void 0||F.call(g);let H=!0;I.subscribe(Jn(n,$=>{var ae;(ae=g.next)===null||ae===void 0||ae.call(g,$),n.next($)},()=>{var $;H=!1,($=g.complete)===null||$===void 0||$.call(g),n.complete()},$=>{var ae;H=!1,(ae=g.error)===null||ae===void 0||ae.call(g,$),n.error($)},()=>{var $,ae;H&&(($=g.unsubscribe)===null||$===void 0||$.call(g)),(ae=g.finalize)===null||ae===void 0||ae.call(g)}))}):yo}var EM="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",tn=class extends Error{code;constructor(l,h){super(E1(l,h)),this.code=l}};function E1(s,l){return`${`NG0${Math.abs(s)}`}${l?": "+l:""}`}var TM=Symbol("InputSignalNode#UNSET"),YL=lr($t({},Jx),{transformFn:void 0,applyValueToInputSignal(s,l){U_(s,l)}});function IM(s,l){let h=Object.create(YL);h.value=s,h.transformFn=l?.transform;function g(){if(N_(h),h.value===TM)throw new tn(-950,!1);return h.value}return g[to]=h,g}function T1(s){return{toString:s}.toString()}var du=globalThis;function yr(s){for(let l in s)if(s[l]===yr)return l;throw Error("Could not find renamed property on target object.")}function xo(s){if(typeof s=="string")return s;if(Array.isArray(s))return`[${s.map(xo).join(", ")}]`;if(s==null)return""+s;let l=s.overriddenName||s.name;if(l)return`${l}`;let h=s.toString();if(h==null)return""+h;let g=h.indexOf(`
`);return g>=0?h.slice(0,g):h}function Cb(s,l){return s?l?`${s} ${l}`:s:l||""}var KL=yr({__forward_ref__:yr});function SM(s){return s.__forward_ref__=SM,s.toString=function(){return xo(this())},s}function Ho(s){return DM(s)?s():s}function DM(s){return typeof s=="function"&&s.hasOwnProperty(KL)&&s.__forward_ref__===SM}function Mn(s){return{token:s.token,providedIn:s.providedIn||null,factory:s.factory,value:void 0}}function Uy(s){return ND(s,CM)||ND(s,AM)}function MM(s){return Uy(s)!==null}function ND(s,l){return s.hasOwnProperty(l)?s[l]:null}function JL(s){let l=s&&(s[CM]||s[AM]);return l||null}function zD(s){return s&&(s.hasOwnProperty(BD)||s.hasOwnProperty(QL))?s[BD]:null}var CM=yr({\u0275prov:yr}),BD=yr({\u0275inj:yr}),AM=yr({ngInjectableDef:yr}),QL=yr({ngInjectorDef:yr}),Dn=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(l,h){this._desc=l,this.\u0275prov=void 0,typeof h=="number"?this.__NG_ELEMENT_ID__=h:h!==void 0&&(this.\u0275prov=Mn({token:this,providedIn:h.providedIn||"root",factory:h.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function RM(s){return s&&!!s.\u0275providers}var ek=yr({\u0275cmp:yr}),tk=yr({\u0275dir:yr}),nk=yr({\u0275pipe:yr}),rk=yr({\u0275mod:yr}),_y=yr({\u0275fac:yr}),rm=yr({__NG_ELEMENT_ID__:yr}),VD=yr({__NG_ENV_ID__:yr});function $y(s){return typeof s=="string"?s:s==null?"":String(s)}function ik(s){return typeof s=="function"?s.name||s.toString():typeof s=="object"&&s!=null&&typeof s.type=="function"?s.type.name||s.type.toString():$y(s)}function PM(s,l){throw new tn(-200,s)}function I1(s,l){throw new tn(-201,!1)}var Bn=function(s){return s[s.Default=0]="Default",s[s.Host=1]="Host",s[s.Self=2]="Self",s[s.SkipSelf=4]="SkipSelf",s[s.Optional=8]="Optional",s}(Bn||{}),Ab;function OM(){return Ab}function io(s){let l=Ab;return Ab=s,l}function LM(s,l,h){let g=Uy(s);if(g&&g.providedIn=="root")return g.value===void 0?g.value=g.factory():g.value;if(h&Bn.Optional)return null;if(l!==void 0)return l;I1(s,"Injector")}var ok={},fu=ok,sk="__NG_DI_FLAG__",yy=class{injector;constructor(l){this.injector=l}retrieve(l,h){let g=h;return this.injector.get(l,g.optional?eb:fu,g)}},vy="ngTempTokenPath",ak="ngTokenPath",lk=/\n/gm,ck="\u0275",jD="__source";function uk(s,l=Bn.Default){if(Yp()===void 0)throw new tn(-203,!1);if(Yp()===null)return LM(s,void 0,l);{let h=Yp(),g;return h instanceof yy?g=h.injector:g=h,g.get(s,l&Bn.Optional?null:void 0,l)}}function Hn(s,l=Bn.Default){return(OM()||uk)(Ho(s),l)}function Rt(s,l=Bn.Default){return Hn(s,Hy(l))}function Hy(s){return typeof s>"u"||typeof s=="number"?s:0|(s.optional&&8)|(s.host&&1)|(s.self&&2)|(s.skipSelf&&4)}function Rb(s){let l=[];for(let h=0;h<s.length;h++){let g=Ho(s[h]);if(Array.isArray(g)){if(g.length===0)throw new tn(900,!1);let I,n=Bn.Default;for(let F=0;F<g.length;F++){let H=g[F],$=hk(H);typeof $=="number"?$===-1?I=H.token:n|=$:I=H}l.push(Hn(I,n))}else l.push(Hn(g))}return l}function hk(s){return s[sk]}function dk(s,l,h,g){let I=s[vy];throw l[jD]&&I.unshift(l[jD]),s.message=fk(`
`+s.message,I,h,g),s[ak]=I,s[vy]=null,s}function fk(s,l,h,g=null){s=s&&s.charAt(0)===`
`&&s.charAt(1)==ck?s.slice(2):s;let I=xo(l);if(Array.isArray(l))I=l.map(xo).join(" -> ");else if(typeof l=="object"){let n=[];for(let F in l)if(l.hasOwnProperty(F)){let H=l[F];n.push(F+":"+(typeof H=="string"?JSON.stringify(H):xo(H)))}I=`{${n.join(", ")}}`}return`${h}${g?"("+g+")":""}[${I}]: ${s.replace(lk,`
  `)}`}function mu(s,l){let h=s.hasOwnProperty(_y);return h?s[_y]:null}function pk(s,l,h){if(s.length!==l.length)return!1;for(let g=0;g<s.length;g++){let I=s[g],n=l[g];if(h&&(I=h(I),n=h(n)),n!==I)return!1}return!0}function mk(s){return s.flat(Number.POSITIVE_INFINITY)}function S1(s,l){s.forEach(h=>Array.isArray(h)?S1(h,l):l(h))}function kM(s,l,h){l>=s.length?s.push(h):s.splice(l,0,h)}function xy(s,l){return l>=s.length-1?s.pop():s.splice(l,1)[0]}function gk(s,l,h,g){let I=s.length;if(I==l)s.push(h,g);else if(I===1)s.push(g,s[0]),s[0]=h;else{for(I--,s.push(s[I-1],s[I]);I>l;){let n=I-2;s[I]=s[n],I--}s[l]=h,s[l+1]=g}}function FM(s,l,h){let g=_m(s,l);return g>=0?s[g|1]=h:(g=~g,gk(s,g,l,h)),g}function gb(s,l){let h=_m(s,l);if(h>=0)return s[h|1]}function _m(s,l){return _k(s,l,1)}function _k(s,l,h){let g=0,I=s.length>>h;for(;I!==g;){let n=g+(I-g>>1),F=s[n<<h];if(l===F)return n<<h;F>l?I=n:g=n+1}return~(I<<h)}var dd={},Ks=[],fd=new Dn(""),NM=new Dn("",-1),zM=new Dn(""),by=class{get(l,h=fu){if(h===fu){let g=new Error(`NullInjectorError: No provider for ${xo(l)}!`);throw g.name="NullInjectorError",g}return h}};function BM(s,l){let h=s[rk]||null;if(!h&&l===!0)throw new Error(`Type ${xo(s)} does not have '\u0275mod' property.`);return h}function pd(s){return s[ek]||null}function yk(s){return s[tk]||null}function vk(s){return s[nk]||null}function Gy(s){return{\u0275providers:s}}function xk(...s){return{\u0275providers:VM(!0,s),\u0275fromNgModule:!0}}function VM(s,...l){let h=[],g=new Set,I,n=F=>{h.push(F)};return S1(l,F=>{let H=F;Pb(H,n,[],g)&&(I||=[],I.push(H))}),I!==void 0&&jM(I,n),h}function jM(s,l){for(let h=0;h<s.length;h++){let{ngModule:g,providers:I}=s[h];D1(I,n=>{l(n,g)})}}function Pb(s,l,h,g){if(s=Ho(s),!s)return!1;let I=null,n=zD(s),F=!n&&pd(s);if(!n&&!F){let $=s.ngModule;if(n=zD($),n)I=$;else return!1}else{if(F&&!F.standalone)return!1;I=s}let H=g.has(I);if(F){if(H)return!1;if(g.add(I),F.dependencies){let $=typeof F.dependencies=="function"?F.dependencies():F.dependencies;for(let ae of $)Pb(ae,l,h,g)}}else if(n){if(n.imports!=null&&!H){g.add(I);let ae;try{S1(n.imports,Te=>{Pb(Te,l,h,g)&&(ae||=[],ae.push(Te))})}finally{}ae!==void 0&&jM(ae,l)}if(!H){let ae=mu(I)||(()=>new I);l({provide:I,useFactory:ae,deps:Ks},I),l({provide:zM,useValue:I,multi:!0},I),l({provide:fd,useValue:()=>Hn(I),multi:!0},I)}let $=n.providers;if($!=null&&!H){let ae=s;D1($,Te=>{l(Te,ae)})}}else return!1;return I!==s&&s.providers!==void 0}function D1(s,l){for(let h of s)RM(h)&&(h=h.\u0275providers),Array.isArray(h)?D1(h,l):l(h)}var bk=yr({provide:String,useValue:yr});function UM(s){return s!==null&&typeof s=="object"&&bk in s}function wk(s){return!!(s&&s.useExisting)}function Ek(s){return!!(s&&s.useFactory)}function Ob(s){return typeof s=="function"}var qy=new Dn(""),hy={},UD={},_b;function M1(){return _b===void 0&&(_b=new by),_b}var qo=class{},im=class extends qo{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(l,h,g,I){super(),this.parent=h,this.source=g,this.scopes=I,kb(l,F=>this.processProvider(F)),this.records.set(NM,ld(void 0,this)),I.has("environment")&&this.records.set(qo,ld(void 0,this));let n=this.records.get(qy);n!=null&&typeof n.value=="string"&&this.scopes.add(n.value),this.injectorDefTypes=new Set(this.get(zM,Ks,Bn.Self))}retrieve(l,h){let g=h;return this.get(l,g.optional?eb:fu,g)}destroy(){tm(this),this._destroyed=!0;let l=jn(null);try{for(let g of this._ngOnDestroyHooks)g.ngOnDestroy();let h=this._onDestroyHooks;this._onDestroyHooks=[];for(let g of h)g()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),jn(l)}}onDestroy(l){return tm(this),this._onDestroyHooks.push(l),()=>this.removeOnDestroy(l)}runInContext(l){tm(this);let h=Pa(this),g=io(void 0),I;try{return l()}finally{Pa(h),io(g)}}get(l,h=fu,g=Bn.Default){if(tm(this),l.hasOwnProperty(VD))return l[VD](this);g=Hy(g);let I,n=Pa(this),F=io(void 0);try{if(!(g&Bn.SkipSelf)){let $=this.records.get(l);if($===void 0){let ae=Ck(l)&&Uy(l);ae&&this.injectableDefInScope(ae)?$=ld(Lb(l),hy):$=null,this.records.set(l,$)}if($!=null)return this.hydrate(l,$)}let H=g&Bn.Self?M1():this.parent;return h=g&Bn.Optional&&h===fu?null:h,H.get(l,h)}catch(H){if(H.name==="NullInjectorError"){if((H[vy]=H[vy]||[]).unshift(xo(l)),n)throw H;return dk(H,l,"R3InjectorError",this.source)}else throw H}finally{io(F),Pa(n)}}resolveInjectorInitializers(){let l=jn(null),h=Pa(this),g=io(void 0),I;try{let n=this.get(fd,Ks,Bn.Self);for(let F of n)F()}finally{Pa(h),io(g),jn(l)}}toString(){let l=[],h=this.records;for(let g of h.keys())l.push(xo(g));return`R3Injector[${l.join(", ")}]`}processProvider(l){l=Ho(l);let h=Ob(l)?l:Ho(l&&l.provide),g=Ik(l);if(!Ob(l)&&l.multi===!0){let I=this.records.get(h);I||(I=ld(void 0,hy,!0),I.factory=()=>Rb(I.multi),this.records.set(h,I)),h=l,I.multi.push(l)}this.records.set(h,g)}hydrate(l,h){let g=jn(null);try{return h.value===UD?PM(xo(l)):h.value===hy&&(h.value=UD,h.value=h.factory()),typeof h.value=="object"&&h.value&&Mk(h.value)&&this._ngOnDestroyHooks.add(h.value),h.value}finally{jn(g)}}injectableDefInScope(l){if(!l.providedIn)return!1;let h=Ho(l.providedIn);return typeof h=="string"?h==="any"||this.scopes.has(h):this.injectorDefTypes.has(h)}removeOnDestroy(l){let h=this._onDestroyHooks.indexOf(l);h!==-1&&this._onDestroyHooks.splice(h,1)}};function Lb(s){let l=Uy(s),h=l!==null?l.factory:mu(s);if(h!==null)return h;if(s instanceof Dn)throw new tn(204,!1);if(s instanceof Function)return Tk(s);throw new tn(204,!1)}function Tk(s){if(s.length>0)throw new tn(204,!1);let h=JL(s);return h!==null?()=>h.factory(s):()=>new s}function Ik(s){if(UM(s))return ld(void 0,s.useValue);{let l=Sk(s);return ld(l,hy)}}function Sk(s,l,h){let g;if(Ob(s)){let I=Ho(s);return mu(I)||Lb(I)}else if(UM(s))g=()=>Ho(s.useValue);else if(Ek(s))g=()=>s.useFactory(...Rb(s.deps||[]));else if(wk(s))g=()=>Hn(Ho(s.useExisting));else{let I=Ho(s&&(s.useClass||s.provide));if(Dk(s))g=()=>new I(...Rb(s.deps));else return mu(I)||Lb(I)}return g}function tm(s){if(s.destroyed)throw new tn(205,!1)}function ld(s,l,h=!1){return{factory:s,value:l,multi:h?[]:void 0}}function Dk(s){return!!s.deps}function Mk(s){return s!==null&&typeof s=="object"&&typeof s.ngOnDestroy=="function"}function Ck(s){return typeof s=="function"||typeof s=="object"&&s instanceof Dn}function kb(s,l){for(let h of s)Array.isArray(h)?kb(h,l):h&&RM(h)?kb(h.\u0275providers,l):l(h)}function Is(s,l){let h;s instanceof im?(tm(s),h=s):h=new yy(s);let g,I=Pa(h),n=io(void 0);try{return l()}finally{Pa(I),io(n)}}function $M(){return OM()!==void 0||Yp()!=null}function C1(s){if(!$M())throw new tn(-203,!1)}function Ak(s){return typeof s=="function"}var Va=0,Ln=1,wn=2,ki=3,Es=4,Ss=5,om=6,wy=7,ii=8,sm=9,Fa=10,Ii=11,am=12,$D=13,bd=14,Ts=15,gu=16,cd=17,Na=18,Wy=19,HM=20,Ql=21,yb=22,_u=23,Go=24,vb=25,Fi=26,GM=1;var yu=7,Ey=8,md=9,Li=10;function ec(s){return Array.isArray(s)&&typeof s[GM]=="object"}function ja(s){return Array.isArray(s)&&s[GM]===!0}function qM(s){return(s.flags&4)!==0}function wd(s){return s.componentOffset>-1}function A1(s){return(s.flags&1)===1}function wu(s){return!!s.template}function Ty(s){return(s[wn]&512)!==0}function ym(s){return(s[wn]&256)===256}var Fb=class{previousValue;currentValue;firstChange;constructor(l,h,g){this.previousValue=l,this.currentValue=h,this.firstChange=g}isFirstChange(){return this.firstChange}};function WM(s,l,h,g){l!==null?l.applyValueToInputSignal(l,g):s[h]=g}var Zy=(()=>{let s=()=>ZM;return s.ngInherit=!0,s})();function ZM(s){return s.type.prototype.ngOnChanges&&(s.setInput=Pk),Rk}function Rk(){let s=YM(this),l=s?.current;if(l){let h=s.previous;if(h===dd)s.previous=l;else for(let g in l)h[g]=l[g];s.current=null,this.ngOnChanges(l)}}function Pk(s,l,h,g,I){let n=this.declaredInputs[g],F=YM(s)||Ok(s,{previous:dd,current:null}),H=F.current||(F.current={}),$=F.previous,ae=$[n];H[n]=new Fb(ae&&ae.currentValue,h,$===dd),WM(s,l,I,h)}var XM="__ngSimpleChanges__";function YM(s){return s[XM]||null}function Ok(s,l){return s[XM]=l}var HD=null;var wr=function(s,l=null,h){HD?.(s,l,h)},KM="svg",Lk="math";function Js(s){for(;Array.isArray(s);)s=s[Va];return s}function JM(s,l){return Js(l[s])}function ta(s,l){return Js(l[s.index])}function R1(s,l){return s.data[l]}function P1(s,l){return s[l]}function Qs(s,l){let h=l[s];return ec(h)?h:h[Va]}function O1(s){return(s[wn]&128)===128}function kk(s){return ja(s[ki])}function gd(s,l){return l==null?null:s[l]}function QM(s){s[cd]=0}function eC(s){s[wn]&1024||(s[wn]|=1024,O1(s)&&vm(s))}function Fk(s,l){for(;s>0;)l=l[bd],s--;return l}function Xy(s){return!!(s[wn]&9216||s[Go]?.dirty)}function Nb(s){s[Fa].changeDetectionScheduler?.notify(8),s[wn]&64&&(s[wn]|=1024),Xy(s)&&vm(s)}function vm(s){s[Fa].changeDetectionScheduler?.notify(0);let l=vu(s);for(;l!==null&&!(l[wn]&8192||(l[wn]|=8192,!O1(l)));)l=vu(l)}function tC(s,l){if(ym(s))throw new tn(911,!1);s[Ql]===null&&(s[Ql]=[]),s[Ql].push(l)}function Nk(s,l){if(s[Ql]===null)return;let h=s[Ql].indexOf(l);h!==-1&&s[Ql].splice(h,1)}function vu(s){let l=s[ki];return ja(l)?l[ki]:l}function nC(s){return s[wy]??=[]}function rC(s){return s.cleanup??=[]}function zk(s,l,h,g){let I=nC(l);I.push(h),s.firstCreatePass&&rC(s).push(g,I.length-1)}var kn={lFrame:uC(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var zb=!1;function Bk(){return kn.lFrame.elementDepthCount}function Vk(){kn.lFrame.elementDepthCount++}function jk(){kn.lFrame.elementDepthCount--}function iC(){return kn.bindingsEnabled}function Uk(){return kn.skipHydrationRootTNode!==null}function $k(s){return kn.skipHydrationRootTNode===s}function Hk(){kn.skipHydrationRootTNode=null}function Qn(){return kn.lFrame.lView}function Zo(){return kn.lFrame.tView}function xm(s){return kn.lFrame.contextLView=s,s[ii]}function bm(s){return kn.lFrame.contextLView=null,s}function Xo(){let s=oC();for(;s!==null&&s.type===64;)s=s.parent;return s}function oC(){return kn.lFrame.currentTNode}function Gk(){let s=kn.lFrame,l=s.currentTNode;return s.isParent?l:l.parent}function wm(s,l){let h=kn.lFrame;h.currentTNode=s,h.isParent=l}function sC(){return kn.lFrame.isParent}function qk(){kn.lFrame.isParent=!1}function Wk(){return kn.lFrame.contextLView}function aC(){return zb}function Iy(s){let l=zb;return zb=s,l}function Yy(){let s=kn.lFrame,l=s.bindingRootIndex;return l===-1&&(l=s.bindingRootIndex=s.tView.bindingStartIndex),l}function Zk(s){return kn.lFrame.bindingIndex=s}function Em(){return kn.lFrame.bindingIndex++}function Xk(s){let l=kn.lFrame,h=l.bindingIndex;return l.bindingIndex=l.bindingIndex+s,h}function Yk(){return kn.lFrame.inI18n}function Kk(s,l){let h=kn.lFrame;h.bindingIndex=h.bindingRootIndex=s,Bb(l)}function Jk(){return kn.lFrame.currentDirectiveIndex}function Bb(s){kn.lFrame.currentDirectiveIndex=s}function Qk(s){let l=kn.lFrame.currentDirectiveIndex;return l===-1?null:s[l]}function eF(){return kn.lFrame.currentQueryIndex}function L1(s){kn.lFrame.currentQueryIndex=s}function tF(s){let l=s[Ln];return l.type===2?l.declTNode:l.type===1?s[Ss]:null}function lC(s,l,h){if(h&Bn.SkipSelf){let I=l,n=s;for(;I=I.parent,I===null&&!(h&Bn.Host);)if(I=tF(n),I===null||(n=n[bd],I.type&10))break;if(I===null)return!1;l=I,s=n}let g=kn.lFrame=cC();return g.currentTNode=l,g.lView=s,!0}function k1(s){let l=cC(),h=s[Ln];kn.lFrame=l,l.currentTNode=h.firstChild,l.lView=s,l.tView=h,l.contextLView=s,l.bindingIndex=h.bindingStartIndex,l.inI18n=!1}function cC(){let s=kn.lFrame,l=s===null?null:s.child;return l===null?uC(s):l}function uC(s){let l={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:s,child:null,inI18n:!1};return s!==null&&(s.child=l),l}function hC(){let s=kn.lFrame;return kn.lFrame=s.parent,s.currentTNode=null,s.lView=null,s}var dC=hC;function F1(){let s=hC();s.isParent=!0,s.tView=null,s.selectedIndex=-1,s.contextLView=null,s.elementDepthCount=0,s.currentDirectiveIndex=-1,s.currentNamespace=null,s.bindingRootIndex=-1,s.bindingIndex=-1,s.currentQueryIndex=0}function nF(s){return(kn.lFrame.contextLView=Fk(s,kn.lFrame.contextLView))[ii]}function Eu(){return kn.lFrame.selectedIndex}function xu(s){kn.lFrame.selectedIndex=s}function fC(){let s=kn.lFrame;return R1(s.tView,s.selectedIndex)}function pC(){kn.lFrame.currentNamespace=KM}function mC(){rF()}function rF(){kn.lFrame.currentNamespace=null}function iF(){return kn.lFrame.currentNamespace}var gC=!0;function N1(){return gC}function z1(s){gC=s}function oF(s,l,h){let{ngOnChanges:g,ngOnInit:I,ngDoCheck:n}=l.type.prototype;if(g){let F=ZM(l);(h.preOrderHooks??=[]).push(s,F),(h.preOrderCheckHooks??=[]).push(s,F)}I&&(h.preOrderHooks??=[]).push(0-s,I),n&&((h.preOrderHooks??=[]).push(s,n),(h.preOrderCheckHooks??=[]).push(s,n))}function _C(s,l){for(let h=l.directiveStart,g=l.directiveEnd;h<g;h++){let n=s.data[h].type.prototype,{ngAfterContentInit:F,ngAfterContentChecked:H,ngAfterViewInit:$,ngAfterViewChecked:ae,ngOnDestroy:Te}=n;F&&(s.contentHooks??=[]).push(-h,F),H&&((s.contentHooks??=[]).push(h,H),(s.contentCheckHooks??=[]).push(h,H)),$&&(s.viewHooks??=[]).push(-h,$),ae&&((s.viewHooks??=[]).push(h,ae),(s.viewCheckHooks??=[]).push(h,ae)),Te!=null&&(s.destroyHooks??=[]).push(h,Te)}}function dy(s,l,h){yC(s,l,3,h)}function fy(s,l,h,g){(s[wn]&3)===h&&yC(s,l,h,g)}function xb(s,l){let h=s[wn];(h&3)===l&&(h&=16383,h+=1,s[wn]=h)}function yC(s,l,h,g){let I=g!==void 0?s[cd]&65535:0,n=g??-1,F=l.length-1,H=0;for(let $=I;$<F;$++)if(typeof l[$+1]=="number"){if(H=l[$],g!=null&&H>=g)break}else l[$]<0&&(s[cd]+=65536),(H<n||n==-1)&&(sF(s,h,l,$),s[cd]=(s[cd]&4294901760)+$+2),$++}function GD(s,l){wr(4,s,l);let h=jn(null);try{l.call(s)}finally{jn(h),wr(5,s,l)}}function sF(s,l,h,g){let I=h[g]<0,n=h[g+1],F=I?-h[g]:h[g],H=s[F];I?s[wn]>>14<s[cd]>>16&&(s[wn]&3)===l&&(s[wn]+=16384,GD(H,n)):GD(H,n)}var hd=-1,lm=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(l,h,g){this.factory=l,this.canSeeViewProviders=h,this.injectImpl=g}};function aF(s){return(s.flags&8)!==0}function lF(s){return(s.flags&16)!==0}function cF(s,l,h){let g=0;for(;g<h.length;){let I=h[g];if(typeof I=="number"){if(I!==0)break;g++;let n=h[g++],F=h[g++],H=h[g++];s.setAttribute(l,F,H,n)}else{let n=I,F=h[++g];uF(n)?s.setProperty(l,n,F):s.setAttribute(l,n,F),g++}}return g}function vC(s){return s===3||s===4||s===6}function uF(s){return s.charCodeAt(0)===64}function B1(s,l){if(!(l===null||l.length===0))if(s===null||s.length===0)s=l.slice();else{let h=-1;for(let g=0;g<l.length;g++){let I=l[g];typeof I=="number"?h=I:h===0||(h===-1||h===2?qD(s,h,I,null,l[++g]):qD(s,h,I,null,null))}}return s}function qD(s,l,h,g,I){let n=0,F=s.length;if(l===-1)F=-1;else for(;n<s.length;){let H=s[n++];if(typeof H=="number"){if(H===l){F=-1;break}else if(H>l){F=n-1;break}}}for(;n<s.length;){let H=s[n];if(typeof H=="number")break;if(H===h){I!==null&&(s[n+1]=I);return}n++,I!==null&&n++}F!==-1&&(s.splice(F,0,l),n=F+1),s.splice(n++,0,h),I!==null&&s.splice(n++,0,I)}var bb={},Vb=class{injector;parentInjector;constructor(l,h){this.injector=l,this.parentInjector=h}get(l,h,g){g=Hy(g);let I=this.injector.get(l,bb,g);return I!==bb||h===bb?I:this.parentInjector.get(l,h,g)}};function xC(s){return s!==hd}function Sy(s){return s&32767}function hF(s){return s>>16}function Dy(s,l){let h=hF(s),g=l;for(;h>0;)g=g[bd],h--;return g}var jb=!0;function My(s){let l=jb;return jb=s,l}var dF=256,bC=dF-1,wC=5,fF=0,Ys={};function pF(s,l,h){let g;typeof h=="string"?g=h.charCodeAt(0)||0:h.hasOwnProperty(rm)&&(g=h[rm]),g==null&&(g=h[rm]=fF++);let I=g&bC,n=1<<I;l.data[s+(I>>wC)]|=n}function EC(s,l){let h=TC(s,l);if(h!==-1)return h;let g=l[Ln];g.firstCreatePass&&(s.injectorIndex=l.length,wb(g.data,s),wb(l,null),wb(g.blueprint,null));let I=V1(s,l),n=s.injectorIndex;if(xC(I)){let F=Sy(I),H=Dy(I,l),$=H[Ln].data;for(let ae=0;ae<8;ae++)l[n+ae]=H[F+ae]|$[F+ae]}return l[n+8]=I,n}function wb(s,l){s.push(0,0,0,0,0,0,0,0,l)}function TC(s,l){return s.injectorIndex===-1||s.parent&&s.parent.injectorIndex===s.injectorIndex||l[s.injectorIndex+8]===null?-1:s.injectorIndex}function V1(s,l){if(s.parent&&s.parent.injectorIndex!==-1)return s.parent.injectorIndex;let h=0,g=null,I=l;for(;I!==null;){if(g=CC(I),g===null)return hd;if(h++,I=I[bd],g.injectorIndex!==-1)return g.injectorIndex|h<<16}return hd}function mF(s,l,h){pF(s,l,h)}function gF(s,l){if(l==="class")return s.classes;if(l==="style")return s.styles;let h=s.attrs;if(h){let g=h.length,I=0;for(;I<g;){let n=h[I];if(vC(n))break;if(n===0)I=I+2;else if(typeof n=="number")for(I++;I<g&&typeof h[I]=="string";)I++;else{if(n===l)return h[I+1];I=I+2}}}return null}function IC(s,l,h){if(h&Bn.Optional||s!==void 0)return s;I1(l,"NodeInjector")}function SC(s,l,h,g){if(h&Bn.Optional&&g===void 0&&(g=null),(h&(Bn.Self|Bn.Host))===0){let I=s[sm],n=io(void 0);try{return I?I.get(l,g,h&Bn.Optional):LM(l,g,h&Bn.Optional)}finally{io(n)}}return IC(g,l,h)}function DC(s,l,h,g=Bn.Default,I){if(s!==null){if(l[wn]&2048&&!(g&Bn.Self)){let F=xF(s,l,h,g,Ys);if(F!==Ys)return F}let n=MC(s,l,h,g,Ys);if(n!==Ys)return n}return SC(l,h,g,I)}function MC(s,l,h,g,I){let n=yF(h);if(typeof n=="function"){if(!lC(l,s,g))return g&Bn.Host?IC(I,h,g):SC(l,h,g,I);try{let F;if(F=n(g),F==null&&!(g&Bn.Optional))I1(h);else return F}finally{dC()}}else if(typeof n=="number"){let F=null,H=TC(s,l),$=hd,ae=g&Bn.Host?l[Ts][Ss]:null;for((H===-1||g&Bn.SkipSelf)&&($=H===-1?V1(s,l):l[H+8],$===hd||!ZD(g,!1)?H=-1:(F=l[Ln],H=Sy($),l=Dy($,l)));H!==-1;){let Te=l[Ln];if(WD(n,H,Te.data)){let Fe=_F(H,l,h,F,g,ae);if(Fe!==Ys)return Fe}$=l[H+8],$!==hd&&ZD(g,l[Ln].data[H+8]===ae)&&WD(n,H,l)?(F=Te,H=Sy($),l=Dy($,l)):H=-1}}return I}function _F(s,l,h,g,I,n){let F=l[Ln],H=F.data[s+8],$=g==null?wd(H)&&jb:g!=F&&(H.type&3)!==0,ae=I&Bn.Host&&n===H,Te=py(H,F,h,$,ae);return Te!==null?Cy(l,F,Te,H):Ys}function py(s,l,h,g,I){let n=s.providerIndexes,F=l.data,H=n&1048575,$=s.directiveStart,ae=s.directiveEnd,Te=n>>20,Fe=g?H:H+Te,Ze=I?H+Te:ae;for(let ze=Fe;ze<Ze;ze++){let pt=F[ze];if(ze<$&&h===pt||ze>=$&&pt.type===h)return ze}if(I){let ze=F[$];if(ze&&wu(ze)&&ze.type===h)return $}return null}function Cy(s,l,h,g){let I=s[h],n=l.data;if(I instanceof lm){let F=I;F.resolving&&PM(ik(n[h]));let H=My(F.canSeeViewProviders);F.resolving=!0;let $,ae=F.injectImpl?io(F.injectImpl):null,Te=lC(s,g,Bn.Default);try{I=s[h]=F.factory(void 0,n,s,g),l.firstCreatePass&&h>=g.directiveStart&&oF(h,n[h],l)}finally{ae!==null&&io(ae),My(H),F.resolving=!1,dC()}}return I}function yF(s){if(typeof s=="string")return s.charCodeAt(0)||0;let l=s.hasOwnProperty(rm)?s[rm]:void 0;return typeof l=="number"?l>=0?l&bC:vF:l}function WD(s,l,h){let g=1<<s;return!!(h[l+(s>>wC)]&g)}function ZD(s,l){return!(s&Bn.Self)&&!(s&Bn.Host&&l)}var pu=class{_tNode;_lView;constructor(l,h){this._tNode=l,this._lView=h}get(l,h,g){return DC(this._tNode,this._lView,l,Hy(g),h)}};function vF(){return new pu(Xo(),Qn())}function j1(s){return T1(()=>{let l=s.prototype.constructor,h=l[_y]||Ub(l),g=Object.prototype,I=Object.getPrototypeOf(s.prototype).constructor;for(;I&&I!==g;){let n=I[_y]||Ub(I);if(n&&n!==h)return n;I=Object.getPrototypeOf(I)}return n=>new n})}function Ub(s){return DM(s)?()=>{let l=Ub(Ho(s));return l&&l()}:mu(s)}function xF(s,l,h,g,I){let n=s,F=l;for(;n!==null&&F!==null&&F[wn]&2048&&!Ty(F);){let H=MC(n,F,h,g|Bn.Self,Ys);if(H!==Ys)return H;let $=n.parent;if(!$){let ae=F[HM];if(ae){let Te=ae.get(h,Ys,g);if(Te!==Ys)return Te}$=CC(F),F=F[bd]}n=$}return I}function CC(s){let l=s[Ln],h=l.type;return h===2?l.declTNode:h===1?s[Ss]:null}function U1(s){return gF(Xo(),s)}function XD(s,l=null,h=null,g){let I=AC(s,l,h,g);return I.resolveInjectorInitializers(),I}function AC(s,l=null,h=null,g,I=new Set){let n=[h||Ks,xk(s)];return g=g||(typeof s=="object"?void 0:xo(s)),new im(n,l||M1(),g||null,I)}var Wo=class s{static THROW_IF_NOT_FOUND=fu;static NULL=new by;static create(l,h){if(Array.isArray(l))return XD({name:""},h,l,"");{let g=l.name??"";return XD({name:g},l.parent,l.providers,g)}}static \u0275prov=Mn({token:s,providedIn:"any",factory:()=>Hn(NM)});static __NG_ELEMENT_ID__=-1};var bF=new Dn("");bF.__NG_ELEMENT_ID__=s=>{let l=Xo();if(l===null)throw new tn(204,!1);if(l.type&2)return l.value;if(s&Bn.Optional)return null;throw new tn(204,!1)};var RC=!1,rc=(()=>{class s{static __NG_ELEMENT_ID__=wF;static __NG_ENV_ID__=h=>h}return s})(),Ay=class extends rc{_lView;constructor(l){super(),this._lView=l}onDestroy(l){return tC(this._lView,l),()=>Nk(this._lView,l)}};function wF(){return new Ay(Qn())}var _d=class{},Ky=new Dn("",{providedIn:"root",factory:()=>!1});var PC=new Dn(""),OC=new Dn(""),Ed=(()=>{class s{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new Ei(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let h=this.taskId++;return this.pendingTasks.add(h),h}has(h){return this.pendingTasks.has(h)}remove(h){this.pendingTasks.delete(h),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=Mn({token:s,providedIn:"root",factory:()=>new s})}return s})();var $b=class extends di{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(l=!1){super(),this.__isAsync=l,$M()&&(this.destroyRef=Rt(rc,{optional:!0})??void 0,this.pendingTasks=Rt(Ed,{optional:!0})??void 0)}emit(l){let h=jn(null);try{super.next(l)}finally{jn(h)}}subscribe(l,h,g){let I=l,n=h||(()=>null),F=g;if(l&&typeof l=="object"){let $=l;I=$.next?.bind($),n=$.error?.bind($),F=$.complete?.bind($)}this.__isAsync&&(n=this.wrapInTimeout(n),I&&(I=this.wrapInTimeout(I)),F&&(F=this.wrapInTimeout(F)));let H=super.subscribe({next:I,error:n,complete:F});return l instanceof Wr&&l.add(H),H}wrapInTimeout(l){return h=>{let g=this.pendingTasks?.add();setTimeout(()=>{l(h),g!==void 0&&this.pendingTasks?.remove(g)})}}},vo=$b;function cm(...s){}function LC(s){let l,h;function g(){s=cm;try{h!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(h),l!==void 0&&clearTimeout(l)}catch{}}return l=setTimeout(()=>{s(),g()}),typeof requestAnimationFrame=="function"&&(h=requestAnimationFrame(()=>{s(),g()})),()=>g()}function YD(s){return queueMicrotask(()=>s()),()=>{s=cm}}var $1="isAngularZone",Ry=$1+"_ID",EF=0,Ti=class s{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new vo(!1);onMicrotaskEmpty=new vo(!1);onStable=new vo(!1);onError=new vo(!1);constructor(l){let{enableLongStackTrace:h=!1,shouldCoalesceEventChangeDetection:g=!1,shouldCoalesceRunChangeDetection:I=!1,scheduleInRootZone:n=RC}=l;if(typeof Zone>"u")throw new tn(908,!1);Zone.assertZonePatched();let F=this;F._nesting=0,F._outer=F._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(F._inner=F._inner.fork(new Zone.TaskTrackingZoneSpec)),h&&Zone.longStackTraceZoneSpec&&(F._inner=F._inner.fork(Zone.longStackTraceZoneSpec)),F.shouldCoalesceEventChangeDetection=!I&&g,F.shouldCoalesceRunChangeDetection=I,F.callbackScheduled=!1,F.scheduleInRootZone=n,SF(F)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get($1)===!0}static assertInAngularZone(){if(!s.isInAngularZone())throw new tn(909,!1)}static assertNotInAngularZone(){if(s.isInAngularZone())throw new tn(909,!1)}run(l,h,g){return this._inner.run(l,h,g)}runTask(l,h,g,I){let n=this._inner,F=n.scheduleEventTask("NgZoneEvent: "+I,l,TF,cm,cm);try{return n.runTask(F,h,g)}finally{n.cancelTask(F)}}runGuarded(l,h,g){return this._inner.runGuarded(l,h,g)}runOutsideAngular(l){return this._outer.run(l)}},TF={};function H1(s){if(s._nesting==0&&!s.hasPendingMicrotasks&&!s.isStable)try{s._nesting++,s.onMicrotaskEmpty.emit(null)}finally{if(s._nesting--,!s.hasPendingMicrotasks)try{s.runOutsideAngular(()=>s.onStable.emit(null))}finally{s.isStable=!0}}}function IF(s){if(s.isCheckStableRunning||s.callbackScheduled)return;s.callbackScheduled=!0;function l(){LC(()=>{s.callbackScheduled=!1,Hb(s),s.isCheckStableRunning=!0,H1(s),s.isCheckStableRunning=!1})}s.scheduleInRootZone?Zone.root.run(()=>{l()}):s._outer.run(()=>{l()}),Hb(s)}function SF(s){let l=()=>{IF(s)},h=EF++;s._inner=s._inner.fork({name:"angular",properties:{[$1]:!0,[Ry]:h,[Ry+h]:!0},onInvokeTask:(g,I,n,F,H,$)=>{if(DF($))return g.invokeTask(n,F,H,$);try{return KD(s),g.invokeTask(n,F,H,$)}finally{(s.shouldCoalesceEventChangeDetection&&F.type==="eventTask"||s.shouldCoalesceRunChangeDetection)&&l(),JD(s)}},onInvoke:(g,I,n,F,H,$,ae)=>{try{return KD(s),g.invoke(n,F,H,$,ae)}finally{s.shouldCoalesceRunChangeDetection&&!s.callbackScheduled&&!MF($)&&l(),JD(s)}},onHasTask:(g,I,n,F)=>{g.hasTask(n,F),I===n&&(F.change=="microTask"?(s._hasPendingMicrotasks=F.microTask,Hb(s),H1(s)):F.change=="macroTask"&&(s.hasPendingMacrotasks=F.macroTask))},onHandleError:(g,I,n,F)=>(g.handleError(n,F),s.runOutsideAngular(()=>s.onError.emit(F)),!1)})}function Hb(s){s._hasPendingMicrotasks||(s.shouldCoalesceEventChangeDetection||s.shouldCoalesceRunChangeDetection)&&s.callbackScheduled===!0?s.hasPendingMicrotasks=!0:s.hasPendingMicrotasks=!1}function KD(s){s._nesting++,s.isStable&&(s.isStable=!1,s.onUnstable.emit(null))}function JD(s){s._nesting--,H1(s)}var Gb=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new vo;onMicrotaskEmpty=new vo;onStable=new vo;onError=new vo;run(l,h,g){return l.apply(h,g)}runGuarded(l,h,g){return l.apply(h,g)}runOutsideAngular(l){return l()}runTask(l,h,g,I){return l.apply(h,g)}};function DF(s){return kC(s,"__ignore_ng_zone__")}function MF(s){return kC(s,"__scheduler_tick__")}function kC(s,l){return!Array.isArray(s)||s.length!==1?!1:s[0]?.data?.[l]===!0}var tc=class{_console=console;handleError(l){this._console.error("ERROR",l)}},CF=new Dn("",{providedIn:"root",factory:()=>{let s=Rt(Ti),l=Rt(tc);return h=>s.runOutsideAngular(()=>l.handleError(h))}});function QD(s,l){return IM(s,l)}function AF(s){return IM(TM,s)}var Tm=(QD.required=AF,QD);function RF(){return Td(Xo(),Qn())}function Td(s,l){return new ic(ta(s,l))}var ic=(()=>{class s{nativeElement;constructor(h){this.nativeElement=h}static __NG_ELEMENT_ID__=RF}return s})();function PF(s){return s instanceof ic?s.nativeElement:s}function oo(s,l){let h=aD(s),g=h[to];return l?.equal&&(g.equal=l.equal),h.set=I=>U_(g,I),h.update=I=>lD(g,I),h.asReadonly=OF.bind(h),h}function OF(){let s=this[to];if(s.readonlyFn===void 0){let l=()=>this();l[to]=s,s.readonlyFn=l}return s.readonlyFn}function LF(){return this._results[Symbol.iterator]()}var qb=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new di}constructor(l=!1){this._emitDistinctChangesOnly=l}get(l){return this._results[l]}map(l){return this._results.map(l)}filter(l){return this._results.filter(l)}find(l){return this._results.find(l)}reduce(l,h){return this._results.reduce(l,h)}forEach(l){this._results.forEach(l)}some(l){return this._results.some(l)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(l,h){this.dirty=!1;let g=mk(l);(this._changesDetected=!pk(this._results,g,h))&&(this._results=g,this.length=g.length,this.last=g[this.length-1],this.first=g[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(l){this._onDirty=l}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=LF};function FC(s){return(s.flags&128)===128}var NC=function(s){return s[s.OnPush=0]="OnPush",s[s.Default=1]="Default",s}(NC||{}),zC=new Map,kF=0;function FF(){return kF++}function NF(s){zC.set(s[Wy],s)}function Wb(s){zC.delete(s[Wy])}var eM="__ngContext__";function Im(s,l){ec(l)?(s[eM]=l[Wy],NF(l)):s[eM]=l}function BC(s){return jC(s[am])}function VC(s){return jC(s[Es])}function jC(s){for(;s!==null&&!ja(s);)s=s[Es];return s}var Zb;function UC(s){Zb=s}function zF(){if(Zb!==void 0)return Zb;if(typeof document<"u")return document;throw new tn(210,!1)}var G1=new Dn("",{providedIn:"root",factory:()=>BF}),BF="ng",q1=new Dn(""),Sm=new Dn("",{providedIn:"platform",factory:()=>"unknown"});var W1=new Dn("",{providedIn:"root",factory:()=>zF().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var VF="h",jF="b";var $C=!1,UF=new Dn("",{providedIn:"root",factory:()=>$C});var HC=function(s){return s[s.CHANGE_DETECTION=0]="CHANGE_DETECTION",s[s.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",s}(HC||{}),Jy=new Dn(""),tM=new Set;function Dm(s){tM.has(s)||(tM.add(s),performance?.mark?.("mark_feature_usage",{detail:{feature:s}}))}var GC=(()=>{class s{view;node;constructor(h,g){this.view=h,this.node=g}static __NG_ELEMENT_ID__=$F}return s})();function $F(){return new GC(Qn(),Xo())}var HF=(()=>{class s{impl=null;execute(){this.impl?.execute()}static \u0275prov=Mn({token:s,providedIn:"root",factory:()=>new s})}return s})();var GF=()=>null;function qC(s,l,h=!1){return GF(s,l,h)}function WC(s,l){let h=s.contentQueries;if(h!==null){let g=jn(null);try{for(let I=0;I<h.length;I+=2){let n=h[I],F=h[I+1];if(F!==-1){let H=s.data[F];L1(n),H.contentQueries(2,l[F],F)}}}finally{jn(g)}}}function Xb(s,l,h){L1(0);let g=jn(null);try{l(s,h)}finally{jn(g)}}function ZC(s,l,h){if(qM(l)){let g=jn(null);try{let I=l.directiveStart,n=l.directiveEnd;for(let F=I;F<n;F++){let H=s.data[F];if(H.contentQueries){let $=h[F];H.contentQueries(1,$,F)}}}finally{jn(g)}}}var ea=function(s){return s[s.Emulated=0]="Emulated",s[s.None=2]="None",s[s.ShadowDom=3]="ShadowDom",s}(ea||{});var cy;function qF(){if(cy===void 0&&(cy=null,du.trustedTypes))try{cy=du.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:s=>s,createScript:s=>s,createScriptURL:s=>s})}catch{}return cy}function nM(s){return qF()?.createScriptURL(s)||s}var Py=class{changingThisBreaksApplicationSecurity;constructor(l){this.changingThisBreaksApplicationSecurity=l}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${EM})`}};function Id(s){return s instanceof Py?s.changingThisBreaksApplicationSecurity:s}function Z1(s,l){let h=WF(s);if(h!=null&&h!==l){if(h==="ResourceURL"&&l==="URL")return!0;throw new Error(`Required a safe ${l}, got a ${h} (see ${EM})`)}return h===l}function WF(s){return s instanceof Py&&s.getTypeName()||null}var ZF=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function XC(s){return s=String(s),s.match(ZF)?s:"unsafe:"+s}var Qy=function(s){return s[s.NONE=0]="NONE",s[s.HTML=1]="HTML",s[s.STYLE=2]="STYLE",s[s.SCRIPT=3]="SCRIPT",s[s.URL=4]="URL",s[s.RESOURCE_URL=5]="RESOURCE_URL",s}(Qy||{});function XF(s){let l=KC();return l?l.sanitize(Qy.URL,s)||"":Z1(s,"URL")?Id(s):XC($y(s))}function YF(s){let l=KC();if(l)return nM(l.sanitize(Qy.RESOURCE_URL,s)||"");if(Z1(s,"ResourceURL"))return nM(Id(s));throw new tn(904,!1)}function KF(s,l){return l==="src"&&(s==="embed"||s==="frame"||s==="iframe"||s==="media"||s==="script")||l==="href"&&(s==="base"||s==="link")?YF:XF}function YC(s,l,h){return KF(l,h)(s)}function KC(){let s=Qn();return s&&s[Fa].sanitizer}function JC(s){return s instanceof Function?s():s}function JF(s,l,h){let g=s.length;for(;;){let I=s.indexOf(l,h);if(I===-1)return I;if(I===0||s.charCodeAt(I-1)<=32){let n=l.length;if(I+n===g||s.charCodeAt(I+n)<=32)return I}h=I+1}}var QC="ng-template";function QF(s,l,h,g){let I=0;if(g){for(;I<l.length&&typeof l[I]=="string";I+=2)if(l[I]==="class"&&JF(l[I+1].toLowerCase(),h,0)!==-1)return!0}else if(X1(s))return!1;if(I=l.indexOf(1,I),I>-1){let n;for(;++I<l.length&&typeof(n=l[I])=="string";)if(n.toLowerCase()===h)return!0}return!1}function X1(s){return s.type===4&&s.value!==QC}function eN(s,l,h){let g=s.type===4&&!h?QC:s.value;return l===g}function tN(s,l,h){let g=4,I=s.attrs,n=I!==null?iN(I):0,F=!1;for(let H=0;H<l.length;H++){let $=l[H];if(typeof $=="number"){if(!F&&!ws(g)&&!ws($))return!1;if(F&&ws($))continue;F=!1,g=$|g&1;continue}if(!F)if(g&4){if(g=2|g&1,$!==""&&!eN(s,$,h)||$===""&&l.length===1){if(ws(g))return!1;F=!0}}else if(g&8){if(I===null||!QF(s,I,$,h)){if(ws(g))return!1;F=!0}}else{let ae=l[++H],Te=nN($,I,X1(s),h);if(Te===-1){if(ws(g))return!1;F=!0;continue}if(ae!==""){let Fe;if(Te>n?Fe="":Fe=I[Te+1].toLowerCase(),g&2&&ae!==Fe){if(ws(g))return!1;F=!0}}}}return ws(g)||F}function ws(s){return(s&1)===0}function nN(s,l,h,g){if(l===null)return-1;let I=0;if(g||!h){let n=!1;for(;I<l.length;){let F=l[I];if(F===s)return I;if(F===3||F===6)n=!0;else if(F===1||F===2){let H=l[++I];for(;typeof H=="string";)H=l[++I];continue}else{if(F===4)break;if(F===0){I+=4;continue}}I+=n?1:2}return-1}else return oN(l,s)}function rN(s,l,h=!1){for(let g=0;g<l.length;g++)if(tN(s,l[g],h))return!0;return!1}function iN(s){for(let l=0;l<s.length;l++){let h=s[l];if(vC(h))return l}return s.length}function oN(s,l){let h=s.indexOf(4);if(h>-1)for(h++;h<s.length;){let g=s[h];if(typeof g=="number")return-1;if(g===l)return h;h++}return-1}function rM(s,l){return s?":not("+l.trim()+")":l}function sN(s){let l=s[0],h=1,g=2,I="",n=!1;for(;h<s.length;){let F=s[h];if(typeof F=="string")if(g&2){let H=s[++h];I+="["+F+(H.length>0?'="'+H+'"':"")+"]"}else g&8?I+="."+F:g&4&&(I+=" "+F);else I!==""&&!ws(F)&&(l+=rM(n,I),I=""),g=F,n=n||!ws(g);h++}return I!==""&&(l+=rM(n,I)),l}function aN(s){return s.map(sN).join(",")}function lN(s){let l=[],h=[],g=1,I=2;for(;g<s.length;){let n=s[g];if(typeof n=="string")I===2?n!==""&&l.push(n,s[++g]):I===8&&h.push(n);else{if(!ws(I))break;I=n}g++}return h.length&&l.push(1,...h),l}var Ua={};function cN(s,l){return s.createText(l)}function uN(s,l,h){s.setValue(l,h)}function eA(s,l,h){return s.createElement(l,h)}function Oy(s,l,h,g,I){s.insertBefore(l,h,g,I)}function tA(s,l,h){s.appendChild(l,h)}function iM(s,l,h,g,I){g!==null?Oy(s,l,h,g,I):tA(s,l,h)}function hN(s,l,h){s.removeChild(null,l,h)}function dN(s,l,h){s.setAttribute(l,"style",h)}function fN(s,l,h){h===""?s.removeAttribute(l,"class"):s.setAttribute(l,"class",h)}function nA(s,l,h){let{mergedAttrs:g,classes:I,styles:n}=h;g!==null&&cF(s,l,g),I!==null&&fN(s,l,I),n!==null&&dN(s,l,n)}function Y1(s,l,h,g,I,n,F,H,$,ae,Te){let Fe=Fi+g,Ze=Fe+I,ze=pN(Fe,Ze),pt=typeof ae=="function"?ae():ae;return ze[Ln]={type:s,blueprint:ze,template:h,queries:null,viewQuery:H,declTNode:l,data:ze.slice().fill(null,Fe),bindingStartIndex:Fe,expandoStartIndex:Ze,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof n=="function"?n():n,pipeRegistry:typeof F=="function"?F():F,firstChild:null,schemas:$,consts:pt,incompleteFirstPass:!1,ssrId:Te}}function pN(s,l){let h=[];for(let g=0;g<l;g++)h.push(g<s?null:Ua);return h}function mN(s){let l=s.tView;return l===null||l.incompleteFirstPass?s.tView=Y1(1,null,s.template,s.decls,s.vars,s.directiveDefs,s.pipeDefs,s.viewQuery,s.schemas,s.consts,s.id):l}function K1(s,l,h,g,I,n,F,H,$,ae,Te){let Fe=l.blueprint.slice();return Fe[Va]=I,Fe[wn]=g|4|128|8|64|1024,(ae!==null||s&&s[wn]&2048)&&(Fe[wn]|=2048),QM(Fe),Fe[ki]=Fe[bd]=s,Fe[ii]=h,Fe[Fa]=F||s&&s[Fa],Fe[Ii]=H||s&&s[Ii],Fe[sm]=$||s&&s[sm]||null,Fe[Ss]=n,Fe[Wy]=FF(),Fe[om]=Te,Fe[HM]=ae,Fe[Ts]=l.type==2?s[Ts]:Fe,Fe}function gN(s,l,h){let g=ta(l,s),I=mN(h),n=s[Fa].rendererFactory,F=J1(s,K1(s,I,null,rA(h),g,l,null,n.createRenderer(g,h),null,null,null));return s[l.index]=F}function rA(s){let l=16;return s.signals?l=4096:s.onPush&&(l=64),l}function iA(s,l,h,g){if(h===0)return-1;let I=l.length;for(let n=0;n<h;n++)l.push(g),s.blueprint.push(g),s.data.push(null);return I}function J1(s,l){return s[am]?s[$D][Es]=l:s[am]=l,s[$D]=l,l}function Lr(s=1){oA(Zo(),Qn(),Eu()+s,!1)}function oA(s,l,h,g){if(!g)if((l[wn]&3)===3){let n=s.preOrderCheckHooks;n!==null&&dy(l,n,h)}else{let n=s.preOrderHooks;n!==null&&fy(l,n,0,h)}xu(h)}var ev=function(s){return s[s.None=0]="None",s[s.SignalBased=1]="SignalBased",s[s.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",s}(ev||{});function Yb(s,l,h,g){let I=jn(null);try{let[n,F,H]=s.inputs[h],$=null;(F&ev.SignalBased)!==0&&($=l[n][to]),$!==null&&$.transformFn!==void 0?g=$.transformFn(g):H!==null&&(g=H.call(l,g)),s.setInput!==null?s.setInput(l,$,g,h,n):WM(l,$,n,g)}finally{jn(I)}}function sA(s,l,h,g,I){let n=Eu(),F=g&2;try{xu(-1),F&&l.length>Fi&&oA(s,l,Fi,!1),wr(F?2:0,I),h(g,I)}finally{xu(n),wr(F?3:1,I)}}function Q1(s,l,h){EN(s,l,h),(h.flags&64)===64&&TN(s,l,h)}function aA(s,l,h=ta){let g=l.localNames;if(g!==null){let I=l.index+1;for(let n=0;n<g.length;n+=2){let F=g[n+1],H=F===-1?h(l,s):s[F];s[I++]=H}}}function _N(s,l,h,g){let n=g.get(UF,$C)||h===ea.ShadowDom,F=s.selectRootElement(l,n);return yN(F),F}function yN(s){vN(s)}var vN=()=>null;function xN(s){return s==="class"?"className":s==="for"?"htmlFor":s==="formaction"?"formAction":s==="innerHtml"?"innerHTML":s==="readonly"?"readOnly":s==="tabindex"?"tabIndex":s}function bN(s,l,h,g,I,n,F,H){if(!H&&ew(l,s,h,g,I)){wd(l)&&wN(h,l.index);return}if(l.type&3){let $=ta(l,h);g=xN(g),I=F!=null?F(I,l.value||"",g):I,n.setProperty($,g,I)}else l.type&12}function wN(s,l){let h=Qs(l,s);h[wn]&16||(h[wn]|=64)}function EN(s,l,h){let g=h.directiveStart,I=h.directiveEnd;wd(h)&&gN(l,h,s.data[g+h.componentOffset]),s.firstCreatePass||EC(h,l);let n=h.initialInputs;for(let F=g;F<I;F++){let H=s.data[F],$=Cy(l,s,F,h);if(Im($,l),n!==null&&MN(l,F-g,$,H,h,n),wu(H)){let ae=Qs(h.index,l);ae[ii]=Cy(l,s,F,h)}}}function TN(s,l,h){let g=h.directiveStart,I=h.directiveEnd,n=h.index,F=Jk();try{xu(n);for(let H=g;H<I;H++){let $=s.data[H],ae=l[H];Bb(H),($.hostBindings!==null||$.hostVars!==0||$.hostAttrs!==null)&&IN($,ae)}}finally{xu(-1),Bb(F)}}function IN(s,l){s.hostBindings!==null&&s.hostBindings(1,l)}function lA(s,l){let h=s.directiveRegistry,g=null;if(h)for(let I=0;I<h.length;I++){let n=h[I];rN(l,n.selectors,!1)&&(g??=[],wu(n)?g.unshift(n):g.push(n))}return g}function SN(s,l,h,g,I,n){let F=ta(s,l);DN(l[Ii],F,n,s.value,h,g,I)}function DN(s,l,h,g,I,n,F){if(n==null)s.removeAttribute(l,I,h);else{let H=F==null?$y(n):F(n,g||"",I);s.setAttribute(l,I,H,h)}}function MN(s,l,h,g,I,n){let F=n[l];if(F!==null)for(let H=0;H<F.length;H+=2){let $=F[H],ae=F[H+1];Yb(g,h,$,ae)}}function cA(s,l){let h=s[sm],g=h?h.get(tc,null):null;g&&g.handleError(l)}function ew(s,l,h,g,I){let n=s.inputs?.[g],F=s.hostDirectiveInputs?.[g],H=!1;if(F)for(let $=0;$<F.length;$+=2){let ae=F[$],Te=F[$+1],Fe=l.data[ae];Yb(Fe,h[ae],Te,I),H=!0}if(n)for(let $ of n){let ae=h[$],Te=l.data[$];Yb(Te,ae,g,I),H=!0}return H}function CN(s,l){let h=Qs(l,s),g=h[Ln];AN(g,h);let I=h[Va];I!==null&&h[om]===null&&(h[om]=qC(I,h[sm])),wr(18),tw(g,h,h[ii]),wr(19,h[ii])}function AN(s,l){for(let h=l.length;h<s.blueprint.length;h++)l.push(s.blueprint[h])}function tw(s,l,h){k1(l);try{let g=s.viewQuery;g!==null&&Xb(1,g,h);let I=s.template;I!==null&&sA(s,l,I,1,h),s.firstCreatePass&&(s.firstCreatePass=!1),l[Na]?.finishViewCreation(s),s.staticContentQueries&&WC(s,l),s.staticViewQueries&&Xb(2,s.viewQuery,h);let n=s.components;n!==null&&RN(l,n)}catch(g){throw s.firstCreatePass&&(s.incompleteFirstPass=!0,s.firstCreatePass=!1),g}finally{l[wn]&=-5,F1()}}function RN(s,l){for(let h=0;h<l.length;h++)CN(s,l[h])}function tv(s,l,h,g){let I=jn(null);try{let n=l.tView,H=s[wn]&4096?4096:16,$=K1(s,n,h,H,null,l,null,null,g?.injector??null,g?.embeddedViewInjector??null,g?.dehydratedView??null),ae=s[l.index];$[gu]=ae;let Te=s[Na];return Te!==null&&($[Na]=Te.createEmbeddedView(n)),tw(n,$,h),$}finally{jn(I)}}function um(s,l){return!l||l.firstChild===null||FC(s)}var PN;function nw(s,l){return PN(s,l)}var za=function(s){return s[s.Important=1]="Important",s[s.DashCase=2]="DashCase",s}(za||{});function uA(s){return(s.flags&32)===32}function ud(s,l,h,g,I){if(g!=null){let n,F=!1;ja(g)?n=g:ec(g)&&(F=!0,g=g[Va]);let H=Js(g);s===0&&h!==null?I==null?tA(l,h,H):Oy(l,h,H,I||null,!0):s===1&&h!==null?Oy(l,h,H,I||null,!0):s===2?hN(l,H,F):s===3&&l.destroyNode(H),n!=null&&HN(l,s,n,h,I)}}function ON(s,l){hA(s,l),l[Va]=null,l[Ss]=null}function LN(s,l,h,g,I,n){g[Va]=I,g[Ss]=l,rv(s,g,h,1,I,n)}function hA(s,l){l[Fa].changeDetectionScheduler?.notify(9),rv(s,l,l[Ii],2,null,null)}function kN(s){let l=s[am];if(!l)return Eb(s[Ln],s);for(;l;){let h=null;if(ec(l))h=l[am];else{let g=l[Li];g&&(h=g)}if(!h){for(;l&&!l[Es]&&l!==s;)ec(l)&&Eb(l[Ln],l),l=l[ki];l===null&&(l=s),ec(l)&&Eb(l[Ln],l),h=l&&l[Es]}l=h}}function rw(s,l){let h=s[md],g=h.indexOf(l);h.splice(g,1)}function nv(s,l){if(ym(l))return;let h=l[Ii];h.destroyNode&&rv(s,l,h,3,null,null),kN(l)}function Eb(s,l){if(ym(l))return;let h=jn(null);try{l[wn]&=-129,l[wn]|=256,l[Go]&&Xp(l[Go]),NN(s,l),FN(s,l),l[Ln].type===1&&l[Ii].destroy();let g=l[gu];if(g!==null&&ja(l[ki])){g!==l[ki]&&rw(g,l);let I=l[Na];I!==null&&I.detachView(s)}Wb(l)}finally{jn(h)}}function FN(s,l){let h=s.cleanup,g=l[wy];if(h!==null)for(let F=0;F<h.length-1;F+=2)if(typeof h[F]=="string"){let H=h[F+3];H>=0?g[H]():g[-H].unsubscribe(),F+=2}else{let H=g[h[F+1]];h[F].call(H)}g!==null&&(l[wy]=null);let I=l[Ql];if(I!==null){l[Ql]=null;for(let F=0;F<I.length;F++){let H=I[F];H()}}let n=l[_u];if(n!==null){l[_u]=null;for(let F of n)F.destroy()}}function NN(s,l){let h;if(s!=null&&(h=s.destroyHooks)!=null)for(let g=0;g<h.length;g+=2){let I=l[h[g]];if(!(I instanceof lm)){let n=h[g+1];if(Array.isArray(n))for(let F=0;F<n.length;F+=2){let H=I[n[F]],$=n[F+1];wr(4,H,$);try{$.call(H)}finally{wr(5,H,$)}}else{wr(4,I,n);try{n.call(I)}finally{wr(5,I,n)}}}}}function zN(s,l,h){return BN(s,l.parent,h)}function BN(s,l,h){let g=l;for(;g!==null&&g.type&168;)l=g,g=l.parent;if(g===null)return h[Va];if(wd(g)){let{encapsulation:I}=s.data[g.directiveStart+g.componentOffset];if(I===ea.None||I===ea.Emulated)return null}return ta(g,h)}function VN(s,l,h){return UN(s,l,h)}function jN(s,l,h){return s.type&40?ta(s,h):null}var UN=jN,oM;function iw(s,l,h,g){let I=zN(s,g,l),n=l[Ii],F=g.parent||l[Ss],H=VN(F,g,l);if(I!=null)if(Array.isArray(h))for(let $=0;$<h.length;$++)iM(n,I,h[$],H,!1);else iM(n,I,h,H,!1);oM!==void 0&&oM(n,g,l,h,I)}function nm(s,l){if(l!==null){let h=l.type;if(h&3)return ta(l,s);if(h&4)return Kb(-1,s[l.index]);if(h&8){let g=l.child;if(g!==null)return nm(s,g);{let I=s[l.index];return ja(I)?Kb(-1,I):Js(I)}}else{if(h&128)return nm(s,l.next);if(h&32)return nw(l,s)()||Js(s[l.index]);{let g=dA(s,l);if(g!==null){if(Array.isArray(g))return g[0];let I=vu(s[Ts]);return nm(I,g)}else return nm(s,l.next)}}}return null}function dA(s,l){if(l!==null){let g=s[Ts][Ss],I=l.projection;return g.projection[I]}return null}function Kb(s,l){let h=Li+s+1;if(h<l.length){let g=l[h],I=g[Ln].firstChild;if(I!==null)return nm(g,I)}return l[yu]}function ow(s,l,h,g,I,n,F){for(;h!=null;){if(h.type===128){h=h.next;continue}let H=g[h.index],$=h.type;if(F&&l===0&&(H&&Im(Js(H),g),h.flags|=2),!uA(h))if($&8)ow(s,l,h.child,g,I,n,!1),ud(l,s,I,H,n);else if($&32){let ae=nw(h,g),Te;for(;Te=ae();)ud(l,s,I,Te,n);ud(l,s,I,H,n)}else $&16?$N(s,l,g,h,I,n):ud(l,s,I,H,n);h=F?h.projectionNext:h.next}}function rv(s,l,h,g,I,n){ow(h,g,s.firstChild,l,I,n,!1)}function $N(s,l,h,g,I,n){let F=h[Ts],$=F[Ss].projection[g.projection];if(Array.isArray($))for(let ae=0;ae<$.length;ae++){let Te=$[ae];ud(l,s,I,Te,n)}else{let ae=$,Te=F[ki];FC(g)&&(ae.flags|=128),ow(s,l,ae,Te,I,n,!0)}}function HN(s,l,h,g,I){let n=h[yu],F=Js(h);n!==F&&ud(l,s,g,n,I);for(let H=Li;H<h.length;H++){let $=h[H];rv($[Ln],$,s,l,g,n)}}function GN(s,l,h,g,I){if(l)I?s.addClass(h,g):s.removeClass(h,g);else{let n=g.indexOf("-")===-1?void 0:za.DashCase;I==null?s.removeStyle(h,g,n):(typeof I=="string"&&I.endsWith("!important")&&(I=I.slice(0,-10),n|=za.Important),s.setStyle(h,g,I,n))}}function Ly(s,l,h,g,I=!1){for(;h!==null;){if(h.type===128){h=I?h.projectionNext:h.next;continue}let n=l[h.index];n!==null&&g.push(Js(n)),ja(n)&&qN(n,g);let F=h.type;if(F&8)Ly(s,l,h.child,g);else if(F&32){let H=nw(h,l),$;for(;$=H();)g.push($)}else if(F&16){let H=dA(l,h);if(Array.isArray(H))g.push(...H);else{let $=vu(l[Ts]);Ly($[Ln],$,H,g,!0)}}h=I?h.projectionNext:h.next}return g}function qN(s,l){for(let h=Li;h<s.length;h++){let g=s[h],I=g[Ln].firstChild;I!==null&&Ly(g[Ln],g,I,l)}s[yu]!==s[Va]&&l.push(s[yu])}function fA(s){if(s[vb]!==null){for(let l of s[vb])l.impl.addSequence(l);s[vb].length=0}}var pA=[];function WN(s){return s[Go]??ZN(s)}function ZN(s){let l=pA.pop()??Object.create(YN);return l.lView=s,l}function XN(s){s.lView[Go]!==s&&(s.lView=null,pA.push(s))}var YN=lr($t({},Yh),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:s=>{vm(s.lView)},consumerOnSignalRead(){this.lView[Go]=this}});function KN(s){let l=s[Go]??Object.create(JN);return l.lView=s,l}var JN=lr($t({},Yh),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:s=>{let l=vu(s.lView);for(;l&&!mA(l[Ln]);)l=vu(l);l&&eC(l)},consumerOnSignalRead(){this.lView[Go]=this}});function mA(s){return s.type!==2}function gA(s){if(s[_u]===null)return;let l=!0;for(;l;){let h=!1;for(let g of s[_u])g.dirty&&(h=!0,g.zone===null||Zone.current===g.zone?g.run():g.zone.run(()=>g.run()));l=h&&!!(s[wn]&8192)}}var QN=100;function _A(s,l=!0,h=0){let I=s[Fa].rendererFactory,n=!1;n||I.begin?.();try{e3(s,h)}catch(F){throw l&&cA(s,F),F}finally{n||I.end?.()}}function e3(s,l){let h=aC();try{Iy(!0),Jb(s,l);let g=0;for(;Xy(s);){if(g===QN)throw new tn(103,!1);g++,Jb(s,1)}}finally{Iy(h)}}function t3(s,l,h,g){if(ym(l))return;let I=l[wn],n=!1,F=!1;k1(l);let H=!0,$=null,ae=null;n||(mA(s)?(ae=WN(l),$=Zp(ae)):KS()===null?(H=!1,ae=KN(l),$=Zp(ae)):l[Go]&&(Xp(l[Go]),l[Go]=null));try{QM(l),Zk(s.bindingStartIndex),h!==null&&sA(s,l,h,2,g);let Te=(I&3)===3;if(!n)if(Te){let ze=s.preOrderCheckHooks;ze!==null&&dy(l,ze,null)}else{let ze=s.preOrderHooks;ze!==null&&fy(l,ze,0,null),xb(l,0)}if(F||n3(l),gA(l),yA(l,0),s.contentQueries!==null&&WC(s,l),!n)if(Te){let ze=s.contentCheckHooks;ze!==null&&dy(l,ze)}else{let ze=s.contentHooks;ze!==null&&fy(l,ze,1),xb(l,1)}i3(s,l);let Fe=s.components;Fe!==null&&xA(l,Fe,0);let Ze=s.viewQuery;if(Ze!==null&&Xb(2,Ze,g),!n)if(Te){let ze=s.viewCheckHooks;ze!==null&&dy(l,ze)}else{let ze=s.viewHooks;ze!==null&&fy(l,ze,2),xb(l,2)}if(s.firstUpdatePass===!0&&(s.firstUpdatePass=!1),l[yb]){for(let ze of l[yb])ze();l[yb]=null}n||(fA(l),l[wn]&=-73)}catch(Te){throw n||vm(l),Te}finally{ae!==null&&(z_(ae,$),H&&XN(ae)),F1()}}function yA(s,l){for(let h=BC(s);h!==null;h=VC(h))for(let g=Li;g<h.length;g++){let I=h[g];vA(I,l)}}function n3(s){for(let l=BC(s);l!==null;l=VC(l)){if(!(l[wn]&2))continue;let h=l[md];for(let g=0;g<h.length;g++){let I=h[g];eC(I)}}}function r3(s,l,h){wr(18);let g=Qs(l,s);vA(g,h),wr(19,g[ii])}function vA(s,l){O1(s)&&Jb(s,l)}function Jb(s,l){let g=s[Ln],I=s[wn],n=s[Go],F=!!(l===0&&I&16);if(F||=!!(I&64&&l===0),F||=!!(I&1024),F||=!!(n?.dirty&&B_(n)),F||=!1,n&&(n.dirty=!1),s[wn]&=-9217,F)t3(g,s,g.template,s[ii]);else if(I&8192){gA(s),yA(s,1);let H=g.components;H!==null&&xA(s,H,1),fA(s)}}function xA(s,l,h){for(let g=0;g<l.length;g++)r3(s,l[g],h)}function i3(s,l){let h=s.hostBindingOpCodes;if(h!==null)try{for(let g=0;g<h.length;g++){let I=h[g];if(I<0)xu(~I);else{let n=I,F=h[++g],H=h[++g];Kk(F,n);let $=l[n];wr(24,$),H(2,$),wr(25,$)}}}finally{xu(-1)}}function sw(s,l){let h=aC()?64:1088;for(s[Fa].changeDetectionScheduler?.notify(l);s;){s[wn]|=h;let g=vu(s);if(Ty(s)&&!g)return s;s=g}return null}function bA(s,l,h,g){return[s,!0,0,l,null,g,null,h,null,null]}function wA(s,l){let h=Li+l;if(h<s.length)return s[h]}function iv(s,l,h,g=!0){let I=l[Ln];if(o3(I,l,s,h),g){let F=Kb(h,s),H=l[Ii],$=H.parentNode(s[yu]);$!==null&&LN(I,s[Ss],H,l,$,F)}let n=l[om];n!==null&&n.firstChild!==null&&(n.firstChild=null)}function EA(s,l){let h=hm(s,l);return h!==void 0&&nv(h[Ln],h),h}function hm(s,l){if(s.length<=Li)return;let h=Li+l,g=s[h];if(g){let I=g[gu];I!==null&&I!==s&&rw(I,g),l>0&&(s[h-1][Es]=g[Es]);let n=xy(s,Li+l);ON(g[Ln],g);let F=n[Na];F!==null&&F.detachView(n[Ln]),g[ki]=null,g[Es]=null,g[wn]&=-129}return g}function o3(s,l,h,g){let I=Li+g,n=h.length;g>0&&(h[I-1][Es]=l),g<n-Li?(l[Es]=h[I],kM(h,Li+g,l)):(h.push(l),l[Es]=null),l[ki]=h;let F=l[gu];F!==null&&h!==F&&TA(F,l);let H=l[Na];H!==null&&H.insertView(s),Nb(l),l[wn]|=128}function TA(s,l){let h=s[md],g=l[ki];if(ec(g))s[wn]|=2;else{let I=g[ki][Ts];l[Ts]!==I&&(s[wn]|=2)}h===null?s[md]=[l]:h.push(l)}var dm=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let l=this._lView,h=l[Ln];return Ly(h,l,h.firstChild,[])}constructor(l,h,g=!0){this._lView=l,this._cdRefInjectingView=h,this.notifyErrorHandler=g}get context(){return this._lView[ii]}set context(l){this._lView[ii]=l}get destroyed(){return ym(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let l=this._lView[ki];if(ja(l)){let h=l[Ey],g=h?h.indexOf(this):-1;g>-1&&(hm(l,g),xy(h,g))}this._attachedToViewContainer=!1}nv(this._lView[Ln],this._lView)}onDestroy(l){tC(this._lView,l)}markForCheck(){sw(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[wn]&=-129}reattach(){Nb(this._lView),this._lView[wn]|=128}detectChanges(){this._lView[wn]|=1024,_A(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new tn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let l=Ty(this._lView),h=this._lView[gu];h!==null&&!l&&rw(h,this._lView),hA(this._lView[Ln],this._lView)}attachToAppRef(l){if(this._attachedToViewContainer)throw new tn(902,!1);this._appRef=l;let h=Ty(this._lView),g=this._lView[gu];g!==null&&!h&&TA(g,this._lView),Nb(this._lView)}};var fm=(()=>{class s{static __NG_ELEMENT_ID__=l3}return s})(),s3=fm,a3=class extends s3{_declarationLView;_declarationTContainer;elementRef;constructor(l,h,g){super(),this._declarationLView=l,this._declarationTContainer=h,this.elementRef=g}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(l,h){return this.createEmbeddedViewImpl(l,h)}createEmbeddedViewImpl(l,h,g){let I=tv(this._declarationLView,this._declarationTContainer,l,{embeddedViewInjector:h,dehydratedView:g});return new dm(I)}};function l3(){return aw(Xo(),Qn())}function aw(s,l){return s.type&4?new a3(l,s,Td(s,l)):null}function lw(s,l,h,g,I){let n=s.data[l];if(n===null)n=c3(s,l,h,g,I),Yk()&&(n.flags|=32);else if(n.type&64){n.type=h,n.value=g,n.attrs=I;let F=Gk();n.injectorIndex=F===null?-1:F.injectorIndex}return wm(n,!0),n}function c3(s,l,h,g,I){let n=oC(),F=sC(),H=F?n:n&&n.parent,$=s.data[l]=h3(s,H,h,l,g,I);return u3(s,$,n,F),$}function u3(s,l,h,g){s.firstChild===null&&(s.firstChild=l),h!==null&&(g?h.child==null&&l.parent!==null&&(h.child=l):h.next===null&&(h.next=l,l.prev=h))}function h3(s,l,h,g,I,n){let F=l?l.injectorIndex:-1,H=0;return Uk()&&(H|=128),{type:h,index:g,insertBeforeIndex:null,injectorIndex:F,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:H,providerIndexes:0,value:I,attrs:n,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:l,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var QH=new RegExp(`^(\\d+)*(${jF}|${VF})*(.*)`);var d3=()=>null;function pm(s,l){return d3(s,l)}var f3=class{},IA=class{},Qb=class{resolveComponentFactory(l){throw Error(`No component factory found for ${xo(l)}.`)}},ov=class{static NULL=new Qb},yd=class{},sv=(()=>{class s{destroyNode=null;static __NG_ELEMENT_ID__=()=>p3()}return s})();function p3(){let s=Qn(),l=Xo(),h=Qs(l.index,s);return(ec(h)?h:s)[Ii]}var m3=(()=>{class s{static \u0275prov=Mn({token:s,providedIn:"root",factory:()=>null})}return s})();function sM(s,l,h){let g=h?s.styles:null,I=h?s.classes:null,n=0;if(l!==null)for(let F=0;F<l.length;F++){let H=l[F];if(typeof H=="number")n=H;else if(n==1)I=Cb(I,H);else if(n==2){let $=H,ae=l[++F];g=Cb(g,$+": "+ae+";")}}h?s.styles=g:s.stylesWithoutHost=g,h?s.classes=I:s.classesWithoutHost=I}function Ds(s,l=Bn.Default){let h=Qn();if(h===null)return Hn(s,l);let g=Xo();return DC(g,h,Ho(s),l)}function SA(s,l,h,g,I){let n=g===null?null:{"":-1},F=I(s,h);if(F!==null){let H,$=null,ae=null,Te=_3(F);Te===null?H=F:[H,$,ae]=Te,x3(s,l,h,H,n,$,ae)}n!==null&&g!==null&&g3(h,g,n)}function g3(s,l,h){let g=s.localNames=[];for(let I=0;I<l.length;I+=2){let n=h[l[I+1]];if(n==null)throw new tn(-301,!1);g.push(l[I],n)}}function _3(s){let l=null,h=!1;for(let F=0;F<s.length;F++){let H=s[F];if(F===0&&wu(H)&&(l=H),H.findHostDirectiveDefs!==null){h=!0;break}}if(!h)return null;let g=null,I=null,n=null;for(let F of s)F.findHostDirectiveDefs!==null&&(g??=[],I??=new Map,n??=new Map,y3(F,g,n,I)),F===l&&(g??=[],g.push(F));return g!==null?(g.push(...l===null?s:s.slice(1)),[g,I,n]):null}function y3(s,l,h,g){let I=l.length;s.findHostDirectiveDefs(s,l,g),h.set(s,[I,l.length-1])}function v3(s,l,h){l.componentOffset=h,(s.components??=[]).push(l.index)}function x3(s,l,h,g,I,n,F){let H=g.length,$=!1;for(let Ze=0;Ze<H;Ze++){let ze=g[Ze];!$&&wu(ze)&&($=!0,v3(s,h,Ze)),mF(EC(h,l),s,ze.type)}S3(h,s.data.length,H);for(let Ze=0;Ze<H;Ze++){let ze=g[Ze];ze.providersResolver&&ze.providersResolver(ze)}let ae=!1,Te=!1,Fe=iA(s,l,H,null);H>0&&(h.directiveToIndex=new Map);for(let Ze=0;Ze<H;Ze++){let ze=g[Ze];if(h.mergedAttrs=B1(h.mergedAttrs,ze.hostAttrs),w3(s,h,l,Fe,ze),I3(Fe,ze,I),F!==null&&F.has(ze)){let[vt,Cn]=F.get(ze);h.directiveToIndex.set(ze.type,[Fe,vt+h.directiveStart,Cn+h.directiveStart])}else(n===null||!n.has(ze))&&h.directiveToIndex.set(ze.type,Fe);ze.contentQueries!==null&&(h.flags|=4),(ze.hostBindings!==null||ze.hostAttrs!==null||ze.hostVars!==0)&&(h.flags|=64);let pt=ze.type.prototype;!ae&&(pt.ngOnChanges||pt.ngOnInit||pt.ngDoCheck)&&((s.preOrderHooks??=[]).push(h.index),ae=!0),!Te&&(pt.ngOnChanges||pt.ngDoCheck)&&((s.preOrderCheckHooks??=[]).push(h.index),Te=!0),Fe++}b3(s,h,n)}function b3(s,l,h){for(let g=l.directiveStart;g<l.directiveEnd;g++){let I=s.data[g];if(h===null||!h.has(I))aM(0,l,I,g),aM(1,l,I,g),cM(l,g,!1);else{let n=h.get(I);lM(0,l,n,g),lM(1,l,n,g),cM(l,g,!0)}}}function aM(s,l,h,g){let I=s===0?h.inputs:h.outputs;for(let n in I)if(I.hasOwnProperty(n)){let F;s===0?F=l.inputs??={}:F=l.outputs??={},F[n]??=[],F[n].push(g),DA(l,n)}}function lM(s,l,h,g){let I=s===0?h.inputs:h.outputs;for(let n in I)if(I.hasOwnProperty(n)){let F=I[n],H;s===0?H=l.hostDirectiveInputs??={}:H=l.hostDirectiveOutputs??={},H[F]??=[],H[F].push(g,n),DA(l,F)}}function DA(s,l){l==="class"?s.flags|=8:l==="style"&&(s.flags|=16)}function cM(s,l,h){let{attrs:g,inputs:I,hostDirectiveInputs:n}=s;if(g===null||!h&&I===null||h&&n===null||X1(s)){s.initialInputs??=[],s.initialInputs.push(null);return}let F=null,H=0;for(;H<g.length;){let $=g[H];if($===0){H+=4;continue}else if($===5){H+=2;continue}else if(typeof $=="number")break;if(!h&&I.hasOwnProperty($)){let ae=I[$];for(let Te of ae)if(Te===l){F??=[],F.push($,g[H+1]);break}}else if(h&&n.hasOwnProperty($)){let ae=n[$];for(let Te=0;Te<ae.length;Te+=2)if(ae[Te]===l){F??=[],F.push(ae[Te+1],g[H+1]);break}}H+=2}s.initialInputs??=[],s.initialInputs.push(F)}function w3(s,l,h,g,I){s.data[g]=I;let n=I.factory||(I.factory=mu(I.type,!0)),F=new lm(n,wu(I),Ds);s.blueprint[g]=F,h[g]=F,E3(s,l,g,iA(s,h,I.hostVars,Ua),I)}function E3(s,l,h,g,I){let n=I.hostBindings;if(n){let F=s.hostBindingOpCodes;F===null&&(F=s.hostBindingOpCodes=[]);let H=~l.index;T3(F)!=H&&F.push(H),F.push(h,g,n)}}function T3(s){let l=s.length;for(;l>0;){let h=s[--l];if(typeof h=="number"&&h<0)return h}return 0}function I3(s,l,h){if(h){if(l.exportAs)for(let g=0;g<l.exportAs.length;g++)h[l.exportAs[g]]=s;wu(l)&&(h[""]=s)}}function S3(s,l,h){s.flags|=1,s.directiveStart=l,s.directiveEnd=l+h,s.providerIndexes=l}function MA(s,l,h,g,I,n,F,H){let $=l.consts,ae=gd($,F),Te=lw(l,s,2,g,ae);return n&&SA(l,h,Te,gd($,H),I),Te.mergedAttrs=B1(Te.mergedAttrs,Te.attrs),Te.attrs!==null&&sM(Te,Te.attrs,!1),Te.mergedAttrs!==null&&sM(Te,Te.mergedAttrs,!0),l.queries!==null&&l.queries.elementStart(l,Te),Te}function CA(s,l){_C(s,l),qM(l)&&s.queries.elementEnd(l)}var ky=class extends ov{ngModule;constructor(l){super(),this.ngModule=l}resolveComponentFactory(l){let h=pd(l);return new mm(h,this.ngModule)}};function D3(s){return Object.keys(s).map(l=>{let[h,g,I]=s[l],n={propName:h,templateName:l,isSignal:(g&ev.SignalBased)!==0};return I&&(n.transform=I),n})}function M3(s){return Object.keys(s).map(l=>({propName:s[l],templateName:l}))}function C3(s,l,h){let g=l instanceof qo?l:l?.injector;return g&&s.getStandaloneInjector!==null&&(g=s.getStandaloneInjector(g)||g),g?new Vb(h,g):h}function A3(s){let l=s.get(yd,null);if(l===null)throw new tn(407,!1);let h=s.get(m3,null),g=s.get(_d,null);return{rendererFactory:l,sanitizer:h,changeDetectionScheduler:g}}function R3(s,l){let h=(s.selectors[0][0]||"div").toLowerCase();return eA(l,h,h==="svg"?KM:h==="math"?Lk:null)}var mm=class extends IA{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=D3(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=M3(this.componentDef.outputs),this.cachedOutputs}constructor(l,h){super(),this.componentDef=l,this.ngModule=h,this.componentType=l.type,this.selector=aN(l.selectors),this.ngContentSelectors=l.ngContentSelectors??[],this.isBoundToModule=!!h}create(l,h,g,I){wr(22);let n=jn(null);try{let F=this.componentDef,H=g?["ng-version","19.2.2"]:lN(this.componentDef.selectors[0]),$=Y1(0,null,null,1,0,null,null,null,null,[H],null),ae=C3(F,I||this.ngModule,l),Te=A3(ae),Fe=Te.rendererFactory.createRenderer(null,F),Ze=g?_N(Fe,g,F.encapsulation,ae):R3(F,Fe),ze=K1(null,$,null,512|rA(F),null,null,Te,Fe,ae,null,qC(Ze,ae,!0));ze[Fi]=Ze,k1(ze);let pt=null;try{let vt=MA(Fi,$,ze,"#host",()=>[this.componentDef],!0,0);Ze&&(nA(Fe,Ze,vt),Im(Ze,ze)),Q1($,ze,vt),ZC($,vt,ze),CA($,vt),h!==void 0&&P3(vt,this.ngContentSelectors,h),pt=Qs(vt.index,ze),ze[ii]=pt[ii],tw($,ze,null)}catch(vt){throw pt!==null&&Wb(pt),Wb(ze),vt}finally{wr(23),F1()}return new e1(this.componentType,ze)}finally{jn(n)}}},e1=class extends f3{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(l,h){super(),this._rootLView=h,this._tNode=R1(h[Ln],Fi),this.location=Td(this._tNode,h),this.instance=Qs(this._tNode.index,h)[ii],this.hostView=this.changeDetectorRef=new dm(h,void 0,!1),this.componentType=l}setInput(l,h){let g=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(l)&&Object.is(this.previousInputValues.get(l),h))return;let I=this._rootLView,n=ew(g,I[Ln],I,l,h);this.previousInputValues.set(l,h);let F=Qs(g.index,I);sw(F,1)}get injector(){return new pu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(l){this.hostView.onDestroy(l)}};function P3(s,l,h){let g=s.projection=[];for(let I=0;I<l.length;I++){let n=h[I];g.push(n!=null&&n.length?Array.from(n):null)}}var Sd=(()=>{class s{static __NG_ELEMENT_ID__=O3}return s})();function O3(){let s=Xo();return RA(s,Qn())}var L3=Sd,AA=class extends L3{_lContainer;_hostTNode;_hostLView;constructor(l,h,g){super(),this._lContainer=l,this._hostTNode=h,this._hostLView=g}get element(){return Td(this._hostTNode,this._hostLView)}get injector(){return new pu(this._hostTNode,this._hostLView)}get parentInjector(){let l=V1(this._hostTNode,this._hostLView);if(xC(l)){let h=Dy(l,this._hostLView),g=Sy(l),I=h[Ln].data[g+8];return new pu(I,h)}else return new pu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(l){let h=uM(this._lContainer);return h!==null&&h[l]||null}get length(){return this._lContainer.length-Li}createEmbeddedView(l,h,g){let I,n;typeof g=="number"?I=g:g!=null&&(I=g.index,n=g.injector);let F=pm(this._lContainer,l.ssrId),H=l.createEmbeddedViewImpl(h||{},n,F);return this.insertImpl(H,I,um(this._hostTNode,F)),H}createComponent(l,h,g,I,n){let F=l&&!Ak(l),H;if(F)H=h;else{let pt=h||{};H=pt.index,g=pt.injector,I=pt.projectableNodes,n=pt.environmentInjector||pt.ngModuleRef}let $=F?l:new mm(pd(l)),ae=g||this.parentInjector;if(!n&&$.ngModule==null){let vt=(F?ae:this.parentInjector).get(qo,null);vt&&(n=vt)}let Te=pd($.componentType??{}),Fe=pm(this._lContainer,Te?.id??null),Ze=Fe?.firstChild??null,ze=$.create(ae,I,Ze,n);return this.insertImpl(ze.hostView,H,um(this._hostTNode,Fe)),ze}insert(l,h){return this.insertImpl(l,h,!0)}insertImpl(l,h,g){let I=l._lView;if(kk(I)){let H=this.indexOf(l);if(H!==-1)this.detach(H);else{let $=I[ki],ae=new AA($,$[Ss],$[ki]);ae.detach(ae.indexOf(l))}}let n=this._adjustIndex(h),F=this._lContainer;return iv(F,I,n,g),l.attachToViewContainerRef(),kM(Tb(F),n,l),l}move(l,h){return this.insert(l,h)}indexOf(l){let h=uM(this._lContainer);return h!==null?h.indexOf(l):-1}remove(l){let h=this._adjustIndex(l,-1),g=hm(this._lContainer,h);g&&(xy(Tb(this._lContainer),h),nv(g[Ln],g))}detach(l){let h=this._adjustIndex(l,-1),g=hm(this._lContainer,h);return g&&xy(Tb(this._lContainer),h)!=null?new dm(g):null}_adjustIndex(l,h=0){return l??this.length+h}};function uM(s){return s[Ey]}function Tb(s){return s[Ey]||(s[Ey]=[])}function RA(s,l){let h,g=l[s.index];return ja(g)?h=g:(h=bA(g,l,null,s),l[s.index]=h,J1(l,h)),F3(h,l,s,g),new AA(h,s,l)}function k3(s,l){let h=s[Ii],g=h.createComment(""),I=ta(l,s),n=h.parentNode(I);return Oy(h,n,g,h.nextSibling(I),!1),g}var F3=B3,N3=()=>!1;function z3(s,l,h){return N3(s,l,h)}function B3(s,l,h,g){if(s[yu])return;let I;h.type&8?I=Js(g):I=k3(l,h),s[yu]=I}var t1=class s{queryList;matches=null;constructor(l){this.queryList=l}clone(){return new s(this.queryList)}setDirty(){this.queryList.setDirty()}},n1=class s{queries;constructor(l=[]){this.queries=l}createEmbeddedView(l){let h=l.queries;if(h!==null){let g=l.contentQueries!==null?l.contentQueries[0]:h.length,I=[];for(let n=0;n<g;n++){let F=h.getByIndex(n),H=this.queries[F.indexInDeclarationView];I.push(H.clone())}return new s(I)}return null}insertView(l){this.dirtyQueriesWithMatches(l)}detachView(l){this.dirtyQueriesWithMatches(l)}finishViewCreation(l){this.dirtyQueriesWithMatches(l)}dirtyQueriesWithMatches(l){for(let h=0;h<this.queries.length;h++)LA(l,h).matches!==null&&this.queries[h].setDirty()}},r1=class{flags;read;predicate;constructor(l,h,g=null){this.flags=h,this.read=g,typeof l=="string"?this.predicate=q3(l):this.predicate=l}},i1=class s{queries;constructor(l=[]){this.queries=l}elementStart(l,h){for(let g=0;g<this.queries.length;g++)this.queries[g].elementStart(l,h)}elementEnd(l){for(let h=0;h<this.queries.length;h++)this.queries[h].elementEnd(l)}embeddedTView(l){let h=null;for(let g=0;g<this.length;g++){let I=h!==null?h.length:0,n=this.getByIndex(g).embeddedTView(l,I);n&&(n.indexInDeclarationView=g,h!==null?h.push(n):h=[n])}return h!==null?new s(h):null}template(l,h){for(let g=0;g<this.queries.length;g++)this.queries[g].template(l,h)}getByIndex(l){return this.queries[l]}get length(){return this.queries.length}track(l){this.queries.push(l)}},o1=class s{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(l,h=-1){this.metadata=l,this._declarationNodeIndex=h}elementStart(l,h){this.isApplyingToNode(h)&&this.matchTNode(l,h)}elementEnd(l){this._declarationNodeIndex===l.index&&(this._appliesToNextNode=!1)}template(l,h){this.elementStart(l,h)}embeddedTView(l,h){return this.isApplyingToNode(l)?(this.crossesNgTemplate=!0,this.addMatch(-l.index,h),new s(this.metadata)):null}isApplyingToNode(l){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let h=this._declarationNodeIndex,g=l.parent;for(;g!==null&&g.type&8&&g.index!==h;)g=g.parent;return h===(g!==null?g.index:-1)}return this._appliesToNextNode}matchTNode(l,h){let g=this.metadata.predicate;if(Array.isArray(g))for(let I=0;I<g.length;I++){let n=g[I];this.matchTNodeWithReadOption(l,h,V3(h,n)),this.matchTNodeWithReadOption(l,h,py(h,l,n,!1,!1))}else g===fm?h.type&4&&this.matchTNodeWithReadOption(l,h,-1):this.matchTNodeWithReadOption(l,h,py(h,l,g,!1,!1))}matchTNodeWithReadOption(l,h,g){if(g!==null){let I=this.metadata.read;if(I!==null)if(I===ic||I===Sd||I===fm&&h.type&4)this.addMatch(h.index,-2);else{let n=py(h,l,I,!1,!1);n!==null&&this.addMatch(h.index,n)}else this.addMatch(h.index,g)}}addMatch(l,h){this.matches===null?this.matches=[l,h]:this.matches.push(l,h)}};function V3(s,l){let h=s.localNames;if(h!==null){for(let g=0;g<h.length;g+=2)if(h[g]===l)return h[g+1]}return null}function j3(s,l){return s.type&11?Td(s,l):s.type&4?aw(s,l):null}function U3(s,l,h,g){return h===-1?j3(l,s):h===-2?$3(s,l,g):Cy(s,s[Ln],h,l)}function $3(s,l,h){if(h===ic)return Td(l,s);if(h===fm)return aw(l,s);if(h===Sd)return RA(l,s)}function PA(s,l,h,g){let I=l[Na].queries[g];if(I.matches===null){let n=s.data,F=h.matches,H=[];for(let $=0;F!==null&&$<F.length;$+=2){let ae=F[$];if(ae<0)H.push(null);else{let Te=n[ae];H.push(U3(l,Te,F[$+1],h.metadata.read))}}I.matches=H}return I.matches}function s1(s,l,h,g){let I=s.queries.getByIndex(h),n=I.matches;if(n!==null){let F=PA(s,l,I,h);for(let H=0;H<n.length;H+=2){let $=n[H];if($>0)g.push(F[H/2]);else{let ae=n[H+1],Te=l[-$];for(let Fe=Li;Fe<Te.length;Fe++){let Ze=Te[Fe];Ze[gu]===Ze[ki]&&s1(Ze[Ln],Ze,ae,g)}if(Te[md]!==null){let Fe=Te[md];for(let Ze=0;Ze<Fe.length;Ze++){let ze=Fe[Ze];s1(ze[Ln],ze,ae,g)}}}}}return g}function OA(s,l){return s[Na].queries[l].queryList}function H3(s,l,h){let g=new qb((h&4)===4);return zk(s,l,g,g.destroy),(l[Na]??=new n1).queries.push(new t1(g))-1}function G3(s,l,h){let g=Zo();return g.firstCreatePass&&(W3(g,new r1(s,l,h),-1),(l&2)===2&&(g.staticViewQueries=!0)),H3(g,Qn(),l)}function q3(s){return s.split(",").map(l=>l.trim())}function W3(s,l,h){s.queries===null&&(s.queries=new i1),s.queries.track(new o1(l,h))}function LA(s,l){return s.queries.getByIndex(l)}function Z3(s,l){let h=s[Ln],g=LA(h,l);return g.crossesNgTemplate?s1(h,s,l,[]):PA(h,s,g,l)}function kA(s,l,h){let g,I=Kx(()=>{g._dirtyCounter();let n=J3(g,s);if(l&&n===void 0)throw new tn(-951,!1);return n});return g=I[to],g._dirtyCounter=oo(0),g._flatValue=void 0,I}function X3(s){return kA(!0,!1,s)}function Y3(s){return kA(!0,!0,s)}function K3(s,l){let h=s[to];h._lView=Qn(),h._queryIndex=l,h._queryList=OA(h._lView,l),h._queryList.onDirty(()=>h._dirtyCounter.update(g=>g+1))}function J3(s,l){let h=s._lView,g=s._queryIndex;if(h===void 0||g===void 0||h[wn]&4)return l?void 0:Ks;let I=OA(h,g),n=Z3(h,g);return I.reset(n,PF),l?I.first:I._changesDetected||s._flatValue===void 0?s._flatValue=I.toArray():s._flatValue}function hM(s,l){return X3(l)}function Q3(s,l){return Y3(l)}var Dd=(hM.required=Q3,hM);var vd=class{},cw=class{};var a1=class extends vd{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new ky(this);constructor(l,h,g,I=!0){super(),this.ngModuleType=l,this._parent=h;let n=BM(l);this._bootstrapComponents=JC(n.bootstrap),this._r3Injector=AC(l,h,[{provide:vd,useValue:this},{provide:ov,useValue:this.componentFactoryResolver},...g],xo(l),new Set(["environment"])),I&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let l=this._r3Injector;!l.destroyed&&l.destroy(),this.destroyCbs.forEach(h=>h()),this.destroyCbs=null}onDestroy(l){this.destroyCbs.push(l)}},l1=class extends cw{moduleType;constructor(l){super(),this.moduleType=l}create(l){return new a1(this.moduleType,l,[])}};var Fy=class extends vd{injector;componentFactoryResolver=new ky(this);instance=null;constructor(l){super();let h=new im([...l.providers,{provide:vd,useValue:this},{provide:ov,useValue:this.componentFactoryResolver}],l.parent||M1(),l.debugName,new Set(["environment"]));this.injector=h,l.runEnvironmentInitializers&&h.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(l){this.injector.onDestroy(l)}};function uw(s,l,h=null){return new Fy({providers:s,parent:l,debugName:h,runEnvironmentInitializers:!0}).injector}var ez=(()=>{class s{_injector;cachedInjectors=new Map;constructor(h){this._injector=h}getOrCreateStandaloneInjector(h){if(!h.standalone)return null;if(!this.cachedInjectors.has(h)){let g=VM(!1,h.type),I=g.length>0?uw([g],this._injector,`Standalone[${h.type.name}]`):null;this.cachedInjectors.set(h,I)}return this.cachedInjectors.get(h)}ngOnDestroy(){try{for(let h of this.cachedInjectors.values())h!==null&&h.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Mn({token:s,providedIn:"environment",factory:()=>new s(Hn(qo))})}return s})();function so(s){return T1(()=>{let l=FA(s),h=lr($t({},l),{decls:s.decls,vars:s.vars,template:s.template,consts:s.consts||null,ngContentSelectors:s.ngContentSelectors,onPush:s.changeDetection===NC.OnPush,directiveDefs:null,pipeDefs:null,dependencies:l.standalone&&s.dependencies||null,getStandaloneInjector:l.standalone?I=>I.get(ez).getOrCreateStandaloneInjector(h):null,getExternalStyles:null,signals:s.signals??!1,data:s.data||{},encapsulation:s.encapsulation||ea.Emulated,styles:s.styles||Ks,_:null,schemas:s.schemas||null,tView:null,id:""});l.standalone&&Dm("NgStandalone"),NA(h);let g=s.dependencies;return h.directiveDefs=dM(g,!1),h.pipeDefs=dM(g,!0),h.id=oz(h),h})}function tz(s){return pd(s)||yk(s)}function nz(s){return s!==null}function rz(s,l){if(s==null)return dd;let h={};for(let g in s)if(s.hasOwnProperty(g)){let I=s[g],n,F,H,$;Array.isArray(I)?(H=I[0],n=I[1],F=I[2]??n,$=I[3]||null):(n=I,F=I,H=ev.None,$=null),h[n]=[g,H,$],l[n]=F}return h}function iz(s){if(s==null)return dd;let l={};for(let h in s)s.hasOwnProperty(h)&&(l[s[h]]=h);return l}function av(s){return T1(()=>{let l=FA(s);return NA(l),l})}function lv(s){return{type:s.type,name:s.name,factory:null,pure:s.pure!==!1,standalone:s.standalone??!0,onDestroy:s.type.prototype.ngOnDestroy||null}}function FA(s){let l={};return{type:s.type,providersResolver:null,factory:null,hostBindings:s.hostBindings||null,hostVars:s.hostVars||0,hostAttrs:s.hostAttrs||null,contentQueries:s.contentQueries||null,declaredInputs:l,inputConfig:s.inputs||dd,exportAs:s.exportAs||null,standalone:s.standalone??!0,signals:s.signals===!0,selectors:s.selectors||Ks,viewQuery:s.viewQuery||null,features:s.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:rz(s.inputs,l),outputs:iz(s.outputs),debugInfo:null}}function NA(s){s.features?.forEach(l=>l(s))}function dM(s,l){if(!s)return null;let h=l?vk:tz;return()=>(typeof s=="function"?s():s).map(g=>h(g)).filter(nz)}function oz(s){let l=0,h=typeof s.consts=="function"?"":s.consts,g=[s.selectors,s.ngContentSelectors,s.hostVars,s.hostAttrs,h,s.vars,s.decls,s.encapsulation,s.standalone,s.signals,s.exportAs,JSON.stringify(s.inputs),JSON.stringify(s.outputs),Object.getOwnPropertyNames(s.type.prototype),!!s.contentQueries,!!s.viewQuery];for(let n of g.join("|"))l=Math.imul(31,l)+n.charCodeAt(0)<<0;return l+=2147483648,"c"+l}function zA(s,l,h){return s[l]=h}function Ba(s,l,h){let g=s[l];return Object.is(g,h)?!1:(s[l]=h,!0)}function sz(s,l,h,g){let I=Ba(s,l,h);return Ba(s,l+1,g)||I}function az(s,l,h,g,I,n,F,H,$){let ae=l.consts,Te=lw(l,s,4,F||null,H||null);iC()&&SA(l,h,Te,gd(ae,$),lA),Te.mergedAttrs=B1(Te.mergedAttrs,Te.attrs),_C(l,Te);let Fe=Te.tView=Y1(2,Te,g,I,n,l.directiveRegistry,l.pipeRegistry,null,l.schemas,ae,null);return l.queries!==null&&(l.queries.template(l,Te),Fe.queries=l.queries.embeddedTView(Te)),Te}function c1(s,l,h,g,I,n,F,H,$,ae){let Te=h+Fi,Fe=l.firstCreatePass?az(Te,l,s,g,I,n,F,H,$):l.data[Te];wm(Fe,!1);let Ze=lz(l,s,Fe,h);N1()&&iw(l,s,Ze,Fe),Im(Ze,s);let ze=bA(Ze,s,Ze,Fe);return s[Te]=ze,J1(s,ze),z3(ze,Fe,s),A1(Fe)&&Q1(l,s,Fe),$!=null&&aA(s,Fe,ae),Fe}function hw(s,l,h,g,I,n,F,H){let $=Qn(),ae=Zo(),Te=gd(ae.consts,n);return c1($,ae,s,l,h,g,I,Te,F,H),hw}var lz=cz;function cz(s,l,h,g){return z1(!0),l[Ii].createComment("")}var dw=(()=>{class s{log(h){console.log(h)}warn(h){console.warn(h)}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"platform"})}return s})();var BA=new Dn("");var VA=(()=>{class s{static \u0275prov=Mn({token:s,providedIn:"root",factory:()=>new u1})}return s})(),u1=class{queuedEffectCount=0;queues=new Map;schedule(l){this.enqueue(l)}remove(l){let h=l.zone,g=this.queues.get(h);g.has(l)&&(g.delete(l),this.queuedEffectCount--)}enqueue(l){let h=l.zone;this.queues.has(h)||this.queues.set(h,new Set);let g=this.queues.get(h);g.has(l)||(this.queuedEffectCount++,g.add(l))}flush(){for(;this.queuedEffectCount>0;)for(let[l,h]of this.queues)l===null?this.flushQueue(h):l.run(()=>this.flushQueue(h))}flushQueue(l){for(let h of l)l.delete(h),this.queuedEffectCount--,h.run()}};function Md(s){return!!s&&typeof s.then=="function"}function fw(s){return!!s&&typeof s.subscribe=="function"}var jA=new Dn("");var UA=(()=>{class s{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((h,g)=>{this.resolve=h,this.reject=g});appInits=Rt(jA,{optional:!0})??[];injector=Rt(Wo);constructor(){}runInitializers(){if(this.initialized)return;let h=[];for(let I of this.appInits){let n=Is(this.injector,I);if(Md(n))h.push(n);else if(fw(n)){let F=new Promise((H,$)=>{n.subscribe({complete:H,error:$})});h.push(F)}}let g=()=>{this.done=!0,this.resolve()};Promise.all(h).then(()=>{g()}).catch(I=>{this.reject(I)}),h.length===0&&g(),this.initialized=!0}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),pw=new Dn("");function uz(){sD(()=>{throw new tn(600,!1)})}function hz(s){return s.isBoundToModule}var dz=10;var nc=(()=>{class s{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=Rt(CF);afterRenderManager=Rt(HF);zonelessEnabled=Rt(Ky);rootEffectScheduler=Rt(VA);dirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new di;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=Rt(Ed).hasPendingTasks.pipe(Nn(h=>!h));constructor(){Rt(Jy,{optional:!0})}whenStable(){let h;return new Promise(g=>{h=this.isStable.subscribe({next:I=>{I&&g()}})}).finally(()=>{h.unsubscribe()})}_injector=Rt(qo);_rendererFactory=null;get injector(){return this._injector}bootstrap(h,g){wr(10);let I=h instanceof IA;if(!this._injector.get(UA).done){let Ze="";throw new tn(405,Ze)}let F;I?F=h:F=this._injector.get(ov).resolveComponentFactory(h),this.componentTypes.push(F.componentType);let H=hz(F)?void 0:this._injector.get(vd),$=g||F.selector,ae=F.create(Wo.NULL,[],$,H),Te=ae.location.nativeElement,Fe=ae.injector.get(BA,null);return Fe?.registerApplication(Te),ae.onDestroy(()=>{this.detachView(ae.hostView),my(this.components,ae),Fe?.unregisterApplication(Te)}),this._loadComponent(ae),wr(11,ae),ae}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){wr(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(HC.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new tn(101,!1);let h=jn(null);try{this._runningTick=!0,this.synchronize()}catch(g){this.internalErrorHandler(g)}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,jn(h),this.afterTick.next(),wr(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(yd,null,{optional:!0}));let h=0;for(;this.dirtyFlags!==0&&h++<dz;)wr(14),this.synchronizeOnce(),wr(15)}synchronizeOnce(){if(this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let h=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:g,notifyErrorHandler:I}of this.allViews)fz(g,I,h,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:h})=>Xy(h))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(h){let g=h;this._views.push(g),g.attachToAppRef(this)}detachView(h){let g=h;my(this._views,g),g.detachFromAppRef()}_loadComponent(h){this.attachView(h.hostView),this.tick(),this.components.push(h),this._injector.get(pw,[]).forEach(I=>I(h))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(h=>h()),this._views.slice().forEach(h=>h.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(h){return this._destroyListeners.push(h),()=>my(this._destroyListeners,h)}destroy(){if(this._destroyed)throw new tn(406,!1);let h=this._injector;h.destroy&&!h.destroyed&&h.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function my(s,l){let h=s.indexOf(l);h>-1&&s.splice(h,1)}function fz(s,l,h,g){if(!h&&!Xy(s))return;_A(s,l,h&&!g?0:1)}function mw(s,l,h,g){let I=Qn(),n=Em();if(Ba(I,n,l)){let F=Zo(),H=fC();SN(H,I,s,l,h,g)}return mw}function pz(s,l,h,g){return Ba(s,Em(),h)?l+$y(h)+g:Ua}function uy(s,l){return s<<17|l<<2}function bu(s){return s>>17&32767}function mz(s){return(s&2)==2}function gz(s,l){return s&131071|l<<17}function h1(s){return s|2}function xd(s){return(s&131068)>>2}function Ib(s,l){return s&-131069|l<<2}function _z(s){return(s&1)===1}function d1(s){return s|1}function yz(s,l,h,g,I,n){let F=n?l.classBindings:l.styleBindings,H=bu(F),$=xd(F);s[g]=h;let ae=!1,Te;if(Array.isArray(h)){let Fe=h;Te=Fe[1],(Te===null||_m(Fe,Te)>0)&&(ae=!0)}else Te=h;if(I)if($!==0){let Ze=bu(s[H+1]);s[g+1]=uy(Ze,H),Ze!==0&&(s[Ze+1]=Ib(s[Ze+1],g)),s[H+1]=gz(s[H+1],g)}else s[g+1]=uy(H,0),H!==0&&(s[H+1]=Ib(s[H+1],g)),H=g;else s[g+1]=uy($,0),H===0?H=g:s[$+1]=Ib(s[$+1],g),$=g;ae&&(s[g+1]=h1(s[g+1])),fM(s,Te,g,!0),fM(s,Te,g,!1),vz(l,Te,s,g,n),F=uy(H,$),n?l.classBindings=F:l.styleBindings=F}function vz(s,l,h,g,I){let n=I?s.residualClasses:s.residualStyles;n!=null&&typeof l=="string"&&_m(n,l)>=0&&(h[g+1]=d1(h[g+1]))}function fM(s,l,h,g){let I=s[h+1],n=l===null,F=g?bu(I):xd(I),H=!1;for(;F!==0&&(H===!1||n);){let $=s[F],ae=s[F+1];xz($,l)&&(H=!0,s[F+1]=g?d1(ae):h1(ae)),F=g?bu(ae):xd(ae)}H&&(s[h+1]=g?h1(I):d1(I))}function xz(s,l){return s===null||l==null||(Array.isArray(s)?s[1]:s)===l?!0:Array.isArray(s)&&typeof l=="string"?_m(s,l)>=0:!1}var Wi={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function bz(s){return s.substring(Wi.key,Wi.keyEnd)}function wz(s){return s.substring(Wi.value,Wi.valueEnd)}function Ez(s){return Tz(s),$A(s,Ny(s,0,Wi.textEnd))}function $A(s,l){let h=Wi.textEnd,g=Wi.key=Ny(s,l,h);return h===g?-1:(g=Wi.keyEnd=Iz(s,g,h),g=pM(s,g,h,58),g=Wi.value=Ny(s,g,h),g=Wi.valueEnd=Sz(s,g,h),pM(s,g,h,59))}function Tz(s){Wi.key=0,Wi.keyEnd=0,Wi.value=0,Wi.valueEnd=0,Wi.textEnd=s.length}function Ny(s,l,h){for(;l<h&&s.charCodeAt(l)<=32;)l++;return l}function Iz(s,l,h){let g;for(;l<h&&((g=s.charCodeAt(l))===45||g===95||(g&-33)>=65&&(g&-33)<=90||g>=48&&g<=57);)l++;return l}function pM(s,l,h,g){return l=Ny(s,l,h),l<h&&l++,l}function Sz(s,l,h){let g=-1,I=-1,n=-1,F=l,H=F;for(;F<h;){let $=s.charCodeAt(F++);if($===59)return H;$===34||$===39?H=F=mM(s,$,F,h):l===F-4&&n===85&&I===82&&g===76&&$===40?H=F=mM(s,41,F,h):$>32&&(H=F),n=I,I=g,g=$&-33}return H}function mM(s,l,h,g){let I=-1,n=h;for(;n<g;){let F=s.charCodeAt(n++);if(F==l&&I!==92)return n;F==92&&I===92?I=0:I=F}throw new Error}function Tu(s,l,h){let g=Qn(),I=Em();if(Ba(g,I,l)){let n=Zo(),F=fC();bN(n,F,g,s,l,g[Ii],h,!1)}return Tu}function f1(s,l,h,g,I){ew(l,s,h,I?"class":"style",g)}function HA(s){Mz(qA,Dz,s,!1)}function Dz(s,l){for(let h=Ez(l);h>=0;h=$A(l,h))qA(s,bz(l),wz(l))}function Mz(s,l,h,g){let I=Zo(),n=Xk(2);I.firstUpdatePass&&Cz(I,null,n,g);let F=Qn();if(h!==Ua&&Ba(F,n,h)){let H=I.data[Eu()];if(WA(H,g)&&!GA(I,n)){let $=g?H.classesWithoutHost:H.stylesWithoutHost;$!==null&&(h=Cb($,h||"")),f1(I,H,F,h,g)}else kz(I,H,F,F[Ii],F[n+1],F[n+1]=Lz(s,l,h),g,n)}}function GA(s,l){return l>=s.expandoStartIndex}function Cz(s,l,h,g){let I=s.data;if(I[h+1]===null){let n=I[Eu()],F=GA(s,h);WA(n,g)&&l===null&&!F&&(l=!1),l=Az(I,n,l,g),yz(I,n,l,h,F,g)}}function Az(s,l,h,g){let I=Qk(s),n=g?l.residualClasses:l.residualStyles;if(I===null)(g?l.classBindings:l.styleBindings)===0&&(h=Sb(null,s,l,h,g),h=gm(h,l.attrs,g),n=null);else{let F=l.directiveStylingLast;if(F===-1||s[F]!==I)if(h=Sb(I,s,l,h,g),n===null){let $=Rz(s,l,g);$!==void 0&&Array.isArray($)&&($=Sb(null,s,l,$[1],g),$=gm($,l.attrs,g),Pz(s,l,g,$))}else n=Oz(s,l,g)}return n!==void 0&&(g?l.residualClasses=n:l.residualStyles=n),h}function Rz(s,l,h){let g=h?l.classBindings:l.styleBindings;if(xd(g)!==0)return s[bu(g)]}function Pz(s,l,h,g){let I=h?l.classBindings:l.styleBindings;s[bu(I)]=g}function Oz(s,l,h){let g,I=l.directiveEnd;for(let n=1+l.directiveStylingLast;n<I;n++){let F=s[n].hostAttrs;g=gm(g,F,h)}return gm(g,l.attrs,h)}function Sb(s,l,h,g,I){let n=null,F=h.directiveEnd,H=h.directiveStylingLast;for(H===-1?H=h.directiveStart:H++;H<F&&(n=l[H],g=gm(g,n.hostAttrs,I),n!==s);)H++;return s!==null&&(h.directiveStylingLast=H),g}function gm(s,l,h){let g=h?1:2,I=-1;if(l!==null)for(let n=0;n<l.length;n++){let F=l[n];typeof F=="number"?I=F:I===g&&(Array.isArray(s)||(s=s===void 0?[]:["",s]),FM(s,F,h?!0:l[++n]))}return s===void 0?null:s}function Lz(s,l,h){if(h==null||h==="")return Ks;let g=[],I=Id(h);if(Array.isArray(I))for(let n=0;n<I.length;n++)s(g,I[n],!0);else if(typeof I=="object")for(let n in I)I.hasOwnProperty(n)&&s(g,n,I[n]);else typeof I=="string"&&l(g,I);return g}function qA(s,l,h){FM(s,l,Id(h))}function kz(s,l,h,g,I,n,F,H){I===Ua&&(I=Ks);let $=0,ae=0,Te=0<I.length?I[0]:null,Fe=0<n.length?n[0]:null;for(;Te!==null||Fe!==null;){let Ze=$<I.length?I[$+1]:void 0,ze=ae<n.length?n[ae+1]:void 0,pt=null,vt;Te===Fe?($+=2,ae+=2,Ze!==ze&&(pt=Fe,vt=ze)):Fe===null||Te!==null&&Te<Fe?($+=2,pt=Te):(ae+=2,pt=Fe,vt=ze),pt!==null&&Fz(s,l,h,g,pt,vt,F,H),Te=$<I.length?I[$]:null,Fe=ae<n.length?n[ae]:null}}function Fz(s,l,h,g,I,n,F,H){if(!(l.type&3))return;let $=s.data,ae=$[H+1],Te=_z(ae)?gM($,l,h,I,xd(ae),F):void 0;if(!zy(Te)){zy(n)||mz(ae)&&(n=gM($,null,h,I,H,F));let Fe=JM(Eu(),h);GN(g,F,Fe,I,n)}}function gM(s,l,h,g,I,n){let F=l===null,H;for(;I>0;){let $=s[I],ae=Array.isArray($),Te=ae?$[1]:$,Fe=Te===null,Ze=h[I+1];Ze===Ua&&(Ze=Fe?Ks:void 0);let ze=Fe?gb(Ze,g):Te===g?Ze:void 0;if(ae&&!zy(ze)&&(ze=gb($,g)),zy(ze)&&(H=ze,F))return H;let pt=s[I+1];I=F?bu(pt):xd(pt)}if(l!==null){let $=n?l.residualClasses:l.residualStyles;$!=null&&(H=gb($,g))}return H}function zy(s){return s!==void 0}function WA(s,l){return(s.flags&(l?8:16))!==0}var p1=class{destroy(l){}updateValue(l,h){}swap(l,h){let g=Math.min(l,h),I=Math.max(l,h),n=this.detach(I);if(I-g>1){let F=this.detach(g);this.attach(g,n),this.attach(I,F)}else this.attach(g,n)}move(l,h){this.attach(h,this.detach(l))}};function Db(s,l,h,g,I){return s===h&&Object.is(l,g)?1:Object.is(I(s,l),I(h,g))?-1:0}function Nz(s,l,h){let g,I,n=0,F=s.length-1,H=void 0;if(Array.isArray(l)){let $=l.length-1;for(;n<=F&&n<=$;){let ae=s.at(n),Te=l[n],Fe=Db(n,ae,n,Te,h);if(Fe!==0){Fe<0&&s.updateValue(n,Te),n++;continue}let Ze=s.at(F),ze=l[$],pt=Db(F,Ze,$,ze,h);if(pt!==0){pt<0&&s.updateValue(F,ze),F--,$--;continue}let vt=h(n,ae),Cn=h(F,Ze),En=h(n,Te);if(Object.is(En,Cn)){let Ft=h($,ze);Object.is(Ft,vt)?(s.swap(n,F),s.updateValue(F,ze),$--,F--):s.move(F,n),s.updateValue(n,Te),n++;continue}if(g??=new By,I??=yM(s,n,F,h),m1(s,g,n,En))s.updateValue(n,Te),n++,F++;else if(I.has(En))g.set(vt,s.detach(n)),F--;else{let Ft=s.create(n,l[n]);s.attach(n,Ft),n++,F++}}for(;n<=$;)_M(s,g,h,n,l[n]),n++}else if(l!=null){let $=l[Symbol.iterator](),ae=$.next();for(;!ae.done&&n<=F;){let Te=s.at(n),Fe=ae.value,Ze=Db(n,Te,n,Fe,h);if(Ze!==0)Ze<0&&s.updateValue(n,Fe),n++,ae=$.next();else{g??=new By,I??=yM(s,n,F,h);let ze=h(n,Fe);if(m1(s,g,n,ze))s.updateValue(n,Fe),n++,F++,ae=$.next();else if(!I.has(ze))s.attach(n,s.create(n,Fe)),n++,F++,ae=$.next();else{let pt=h(n,Te);g.set(pt,s.detach(n)),F--}}}for(;!ae.done;)_M(s,g,h,s.length,ae.value),ae=$.next()}for(;n<=F;)s.destroy(s.detach(F--));g?.forEach($=>{s.destroy($)})}function m1(s,l,h,g){return l!==void 0&&l.has(g)?(s.attach(h,l.get(g)),l.delete(g),!0):!1}function _M(s,l,h,g,I){if(m1(s,l,g,h(g,I)))s.updateValue(g,I);else{let n=s.create(g,I);s.attach(g,n)}}function yM(s,l,h,g){let I=new Set;for(let n=l;n<=h;n++)I.add(g(n,s.at(n)));return I}var By=class{kvMap=new Map;_vMap=void 0;has(l){return this.kvMap.has(l)}delete(l){if(!this.has(l))return!1;let h=this.kvMap.get(l);return this._vMap!==void 0&&this._vMap.has(h)?(this.kvMap.set(l,this._vMap.get(h)),this._vMap.delete(h)):this.kvMap.delete(l),!0}get(l){return this.kvMap.get(l)}set(l,h){if(this.kvMap.has(l)){let g=this.kvMap.get(l);this._vMap===void 0&&(this._vMap=new Map);let I=this._vMap;for(;I.has(g);)g=I.get(g);I.set(g,h)}else this.kvMap.set(l,h)}forEach(l){for(let[h,g]of this.kvMap)if(l(g,h),this._vMap!==void 0){let I=this._vMap;for(;I.has(g);)g=I.get(g),l(g,h)}}};function ZA(s,l){Dm("NgControlFlow");let h=Qn(),g=Em(),I=h[g]!==Ua?h[g]:-1,n=I!==-1?Vy(h,Fi+I):void 0,F=0;if(Ba(h,g,s)){let H=jn(null);try{if(n!==void 0&&EA(n,F),s!==-1){let $=Fi+s,ae=Vy(h,$),Te=v1(h[Ln],$),Fe=pm(ae,Te.tView.ssrId),Ze=tv(h,Te,l,{dehydratedView:Fe});iv(ae,Ze,F,um(Te,Fe))}}finally{jn(H)}}else if(n!==void 0){let H=wA(n,F);H!==void 0&&(H[ii]=l)}}var g1=class{lContainer;$implicit;$index;constructor(l,h,g){this.lContainer=l,this.$implicit=h,this.$index=g}get $count(){return this.lContainer.length-Li}};function XA(s){return s}var _1=class{hasEmptyBlock;trackByFn;liveCollection;constructor(l,h,g){this.hasEmptyBlock=l,this.trackByFn=h,this.liveCollection=g}};function Iu(s,l,h,g,I,n,F,H,$,ae,Te,Fe,Ze){Dm("NgControlFlow");let ze=Qn(),pt=Zo(),vt=$!==void 0,Cn=Qn(),En=H?F.bind(Cn[Ts][ii]):F,Ft=new _1(vt,En);Cn[Fi+s]=Ft,c1(ze,pt,s+1,l,h,g,I,gd(pt.consts,n)),vt&&c1(ze,pt,s+2,$,ae,Te,Fe,gd(pt.consts,Ze))}var y1=class extends p1{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(l,h,g){super(),this.lContainer=l,this.hostLView=h,this.templateTNode=g}get length(){return this.lContainer.length-Li}at(l){return this.getLView(l)[ii].$implicit}attach(l,h){let g=h[om];this.needsIndexUpdate||=l!==this.length,iv(this.lContainer,h,l,um(this.templateTNode,g))}detach(l){return this.needsIndexUpdate||=l!==this.length-1,zz(this.lContainer,l)}create(l,h){let g=pm(this.lContainer,this.templateTNode.tView.ssrId),I=tv(this.hostLView,this.templateTNode,new g1(this.lContainer,h,l),{dehydratedView:g});return this.operationsCounter?.recordCreate(),I}destroy(l){nv(l[Ln],l),this.operationsCounter?.recordDestroy()}updateValue(l,h){this.getLView(l)[ii].$implicit=h}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let l=0;l<this.length;l++)this.getLView(l)[ii].$index=l}getLView(l){return Bz(this.lContainer,l)}};function Su(s){let l=jn(null),h=Eu();try{let g=Qn(),I=g[Ln],n=g[h],F=h+1,H=Vy(g,F);if(n.liveCollection===void 0){let ae=v1(I,F);n.liveCollection=new y1(H,g,ae)}else n.liveCollection.reset();let $=n.liveCollection;if(Nz($,s,n.trackByFn),$.updateIndexes(),n.hasEmptyBlock){let ae=Em(),Te=$.length===0;if(Ba(g,ae,Te)){let Fe=h+2,Ze=Vy(g,Fe);if(Te){let ze=v1(I,Fe),pt=pm(Ze,ze.tView.ssrId),vt=tv(g,ze,void 0,{dehydratedView:pt});iv(Ze,vt,0,um(ze,pt))}else EA(Ze,0)}}}finally{jn(l)}}function Vy(s,l){return s[l]}function zz(s,l){return hm(s,l)}function Bz(s,l){return wA(s,l)}function v1(s,l){return R1(s,l)}function rr(s,l,h,g){let I=Qn(),n=Zo(),F=Fi+s,H=I[Ii],$=n.firstCreatePass?MA(F,n,I,l,lA,iC(),h,g):n.data[F],ae=Vz(n,I,$,H,l,s);I[F]=ae;let Te=A1($);return wm($,!0),nA(H,ae,$),!uA($)&&N1()&&iw(n,I,ae,$),(Bk()===0||Te)&&Im(ae,I),Vk(),Te&&(Q1(n,I,$),ZC(n,$,I)),g!==null&&aA(I,$),rr}function fr(){let s=Xo();sC()?qk():(s=s.parent,wm(s,!1));let l=s;$k(l)&&Hk(),jk();let h=Zo();return h.firstCreatePass&&CA(h,l),l.classesWithoutHost!=null&&aF(l)&&f1(h,l,Qn(),l.classesWithoutHost,!0),l.stylesWithoutHost!=null&&lF(l)&&f1(h,l,Qn(),l.stylesWithoutHost,!1),fr}function pi(s,l,h,g){return rr(s,l,h,g),fr(),pi}var Vz=(s,l,h,g,I,n)=>(z1(!0),eA(g,I,iF()));function cv(){return Qn()}var hu=void 0;function jz(s){let l=Math.floor(Math.abs(s)),h=s.toString().replace(/^[^.]*\.?/,"").length;return l===1&&h===0?1:5}var Uz=["en",[["a","p"],["AM","PM"],hu],[["AM","PM"],hu,hu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],hu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],hu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",hu,"{1} 'at' {0}",hu],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",jz],Mb={};function gw(s){let l=$z(s),h=vM(l);if(h)return h;let g=l.split("-")[0];if(h=vM(g),h)return h;if(g==="en")return Uz;throw new tn(701,!1)}function vM(s){return s in Mb||(Mb[s]=du.ng&&du.ng.common&&du.ng.common.locales&&du.ng.common.locales[s]),Mb[s]}var Cd=function(s){return s[s.LocaleId=0]="LocaleId",s[s.DayPeriodsFormat=1]="DayPeriodsFormat",s[s.DayPeriodsStandalone=2]="DayPeriodsStandalone",s[s.DaysFormat=3]="DaysFormat",s[s.DaysStandalone=4]="DaysStandalone",s[s.MonthsFormat=5]="MonthsFormat",s[s.MonthsStandalone=6]="MonthsStandalone",s[s.Eras=7]="Eras",s[s.FirstDayOfWeek=8]="FirstDayOfWeek",s[s.WeekendRange=9]="WeekendRange",s[s.DateFormat=10]="DateFormat",s[s.TimeFormat=11]="TimeFormat",s[s.DateTimeFormat=12]="DateTimeFormat",s[s.NumberSymbols=13]="NumberSymbols",s[s.NumberFormats=14]="NumberFormats",s[s.CurrencyCode=15]="CurrencyCode",s[s.CurrencySymbol=16]="CurrencySymbol",s[s.CurrencyName=17]="CurrencyName",s[s.Currencies=18]="Currencies",s[s.Directionality=19]="Directionality",s[s.PluralCase=20]="PluralCase",s[s.ExtraData=21]="ExtraData",s}(Cd||{});function $z(s){return s.toLowerCase().replace(/_/g,"-")}var jy="en-US";var Hz=jy;function Gz(s){typeof s=="string"&&(Hz=s.toLowerCase().replace(/_/g,"-"))}var qz=(s,l,h)=>{};function Du(s,l,h,g){let I=Qn(),n=Zo(),F=Xo();return Zz(n,I,I[Ii],F,s,l,g),Du}function Wz(s,l,h,g){let I=s.cleanup;if(I!=null)for(let n=0;n<I.length-1;n+=2){let F=I[n];if(F===h&&I[n+1]===g){let H=l[wy],$=I[n+2];return H.length>$?H[$]:null}typeof F=="string"&&(n+=2)}return null}function Zz(s,l,h,g,I,n,F){let H=A1(g),ae=s.firstCreatePass?rC(s):null,Te=l[ii],Fe=nC(l),Ze=!0;if(g.type&3||F){let ze=ta(g,l),pt=F?F(ze):ze,vt=Fe.length,Cn=F?Ft=>F(Js(Ft[g.index])):g.index,En=null;if(!F&&H&&(En=Wz(s,l,I,g.index)),En!==null){let Ft=En.__ngLastListenerFn__||En;Ft.__ngNextListenerFn__=n,En.__ngLastListenerFn__=n,Ze=!1}else{n=wM(g,l,Te,n),qz(pt,I,n);let Ft=h.listen(pt,I,n);Fe.push(n,Ft),ae&&ae.push(I,Cn,vt,vt+1)}}else n=wM(g,l,Te,n);if(Ze){let ze=g.outputs?.[I],pt=g.hostDirectiveOutputs?.[I];if(pt&&pt.length)for(let vt=0;vt<pt.length;vt+=2){let Cn=pt[vt],En=pt[vt+1];xM(g,s,l,Cn,En,I,n,Fe,ae)}if(ze&&ze.length)for(let vt of ze)xM(g,s,l,vt,I,I,n,Fe,ae)}}function xM(s,l,h,g,I,n,F,H,$){let ae=h[g],Fe=l.data[g].outputs[I],ze=ae[Fe].subscribe(F),pt=H.length;H.push(F,ze),$&&$.push(n,s.index,pt,-(pt+1))}function bM(s,l,h,g){let I=jn(null);try{return wr(6,l,h),h(g)!==!1}catch(n){return cA(s,n),!1}finally{wr(7,l,h),jn(I)}}function wM(s,l,h,g){return function I(n){if(n===Function)return g;let F=wd(s)?Qs(s.index,l):l;sw(F,5);let H=bM(l,h,g,n),$=I.__ngNextListenerFn__;for(;$;)H=bM(l,h,$,n)&&H,$=$.__ngNextListenerFn__;return H}}function _w(s=1){return nF(s)}function Ad(s,l,h,g){K3(s,G3(l,h,g))}function Rd(s=1){L1(eF()+s)}function Xz(s,l,h,g){h>=s.data.length&&(s.data[h]=null,s.blueprint[h]=null),l[h]=g}function YA(s){let l=Wk();return P1(l,Fi+s)}function oi(s,l=""){let h=Qn(),g=Zo(),I=s+Fi,n=g.firstCreatePass?lw(g,I,1,l,null):g.data[I],F=Yz(g,h,n,l,s);h[I]=F,N1()&&iw(g,h,F,n),wm(n,!1)}var Yz=(s,l,h,g,I)=>(z1(!0),cN(l[Ii],g));function $a(s){return Ms("",s,""),$a}function Ms(s,l,h){let g=Qn(),I=pz(g,s,l,h);return I!==Ua&&Kz(g,Eu(),I),Ms}function Kz(s,l,h){let g=JM(l,s);uN(s[Ii],g,h)}function KA(s,l,h,g){return e2(Qn(),Yy(),s,l,h,g)}function JA(s,l,h,g,I){return t2(Qn(),Yy(),s,l,h,g,I)}function QA(s,l){let h=s[l];return h===Ua?void 0:h}function e2(s,l,h,g,I,n){let F=l+h;return Ba(s,F,I)?zA(s,F+1,n?g.call(n,I):g(I)):QA(s,F+1)}function t2(s,l,h,g,I,n,F){let H=l+h;return sz(s,H,I,n)?zA(s,H+2,F?g.call(F,I,n):g(I,n)):QA(s,H+2)}function Ha(s,l){let h=Zo(),g,I=s+Fi;h.firstCreatePass?(g=Jz(l,h.pipeRegistry),h.data[I]=g,g.onDestroy&&(h.destroyHooks??=[]).push(I,g.onDestroy)):g=h.data[I];let n=g.factory||(g.factory=mu(g.type,!0)),F,H=io(Ds);try{let $=My(!1),ae=n();return My($),Xz(h,Qn(),I,ae),ae}finally{io(H)}}function Jz(s,l){if(l)for(let h=l.length-1;h>=0;h--){let g=l[h];if(s===g.name)return g}}function Pd(s,l,h){let g=s+Fi,I=Qn(),n=P1(I,g);return n2(I,g)?e2(I,Yy(),l,n.transform,h,n):n.transform(h)}function uv(s,l,h,g){let I=s+Fi,n=Qn(),F=P1(n,I);return n2(n,I)?t2(n,Yy(),l,F.transform,h,g,F):F.transform(h,g)}function n2(s,l){return s[Ln].data[l].pure}var x1=class{ngModuleFactory;componentFactories;constructor(l,h){this.ngModuleFactory=l,this.componentFactories=h}},yw=(()=>{class s{compileModuleSync(h){return new l1(h)}compileModuleAsync(h){return Promise.resolve(this.compileModuleSync(h))}compileModuleAndAllComponentsSync(h){let g=this.compileModuleSync(h),I=BM(h),n=JC(I.declarations).reduce((F,H)=>{let $=pd(H);return $&&F.push(new mm($)),F},[]);return new x1(g,n)}compileModuleAndAllComponentsAsync(h){return Promise.resolve(this.compileModuleAndAllComponentsSync(h))}clearCache(){}clearCacheFor(h){}getModuleId(h){}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var Qz=(()=>{class s{zone=Rt(Ti);changeDetectionScheduler=Rt(_d);applicationRef=Rt(nc);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),eB=new Dn("",{factory:()=>!1});function r2({ngZoneFactory:s,ignoreChangesOutsideZone:l,scheduleInRootZone:h}){return s??=()=>new Ti(lr($t({},o2()),{scheduleInRootZone:h})),[{provide:Ti,useFactory:s},{provide:fd,multi:!0,useFactory:()=>{let g=Rt(Qz,{optional:!0});return()=>g.initialize()}},{provide:fd,multi:!0,useFactory:()=>{let g=Rt(tB);return()=>{g.initialize()}}},l===!0?{provide:PC,useValue:!0}:[],{provide:OC,useValue:h??RC}]}function i2(s){let l=s?.ignoreChangesOutsideZone,h=s?.scheduleInRootZone,g=r2({ngZoneFactory:()=>{let I=o2(s);return I.scheduleInRootZone=h,I.shouldCoalesceEventChangeDetection&&Dm("NgZone_CoalesceEvent"),new Ti(I)},ignoreChangesOutsideZone:l,scheduleInRootZone:h});return Gy([{provide:eB,useValue:!0},{provide:Ky,useValue:!1},g])}function o2(s){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:s?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:s?.runCoalescing??!1}}var tB=(()=>{class s{subscription=new Wr;initialized=!1;zone=Rt(Ti);pendingTasks=Rt(Ed);initialize(){if(this.initialized)return;this.initialized=!0;let h=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(h=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Ti.assertNotInAngularZone(),queueMicrotask(()=>{h!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(h),h=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Ti.assertInAngularZone(),h??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var nB=(()=>{class s{appRef=Rt(nc);taskService=Rt(Ed);ngZone=Rt(Ti);zonelessEnabled=Rt(Ky);tracing=Rt(Jy,{optional:!0});disableScheduling=Rt(PC,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Wr;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Ry):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Rt(OC,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Gb||!this.zoneIsDefined)}notify(h){if(!this.zonelessEnabled&&h===5)return;let g=!1;switch(h){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,g=!0;break}case 12:{this.appRef.dirtyFlags|=16,g=!0;break}case 13:{this.appRef.dirtyFlags|=2,g=!0;break}case 11:{g=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(g))return;let I=this.useMicrotaskScheduler?YD:LC;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>I(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>I(()=>this.tick()))}shouldScheduleTick(h){return!(this.disableScheduling&&!h||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Ry+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let h=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(g){throw this.taskService.remove(h),g}finally{this.cleanup()}this.useMicrotaskScheduler=!0,YD(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(h)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let h=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(h)}}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function rB(){return typeof $localize<"u"&&$localize.locale||jy}var hv=new Dn("",{providedIn:"root",factory:()=>Rt(hv,Bn.Optional|Bn.SkipSelf)||rB()});var b1=new Dn(""),iB=new Dn("");function em(s){return!s.moduleRef}function oB(s){let l=em(s)?s.r3Injector:s.moduleRef.injector,h=l.get(Ti);return h.run(()=>{em(s)?s.r3Injector.resolveInjectorInitializers():s.moduleRef.resolveInjectorInitializers();let g=l.get(tc,null),I;if(h.runOutsideAngular(()=>{I=h.onError.subscribe({next:n=>{g.handleError(n)}})}),em(s)){let n=()=>l.destroy(),F=s.platformInjector.get(b1);F.add(n),l.onDestroy(()=>{I.unsubscribe(),F.delete(n)})}else{let n=()=>s.moduleRef.destroy(),F=s.platformInjector.get(b1);F.add(n),s.moduleRef.onDestroy(()=>{my(s.allPlatformModules,s.moduleRef),I.unsubscribe(),F.delete(n)})}return aB(g,h,()=>{let n=l.get(UA);return n.runInitializers(),n.donePromise.then(()=>{let F=l.get(hv,jy);if(Gz(F||jy),!l.get(iB,!0))return em(s)?l.get(nc):(s.allPlatformModules.push(s.moduleRef),s.moduleRef);if(em(s)){let $=l.get(nc);return s.rootComponent!==void 0&&$.bootstrap(s.rootComponent),$}else return sB(s.moduleRef,s.allPlatformModules),s.moduleRef})})})}function sB(s,l){let h=s.injector.get(nc);if(s._bootstrapComponents.length>0)s._bootstrapComponents.forEach(g=>h.bootstrap(g));else if(s.instance.ngDoBootstrap)s.instance.ngDoBootstrap(h);else throw new tn(-403,!1);l.push(s)}function aB(s,l,h){try{let g=h();return Md(g)?g.catch(I=>{throw l.runOutsideAngular(()=>s.handleError(I)),I}):g}catch(g){throw l.runOutsideAngular(()=>s.handleError(g)),g}}var gy=null;function lB(s=[],l){return Wo.create({name:l,providers:[{provide:qy,useValue:"platform"},{provide:b1,useValue:new Set([()=>gy=null])},...s]})}function cB(s=[]){if(gy)return gy;let l=lB(s);return gy=l,uz(),uB(l),l}function uB(s){let l=s.get(q1,null);Is(s,()=>{l?.forEach(h=>h())})}var Od=(()=>{class s{static __NG_ELEMENT_ID__=hB}return s})();function hB(s){return dB(Xo(),Qn(),(s&16)===16)}function dB(s,l,h){if(wd(s)&&!h){let g=Qs(s.index,l);return new dm(g,g)}else if(s.type&175){let g=l[Ts];return new dm(g,l)}return null}function s2(s){wr(8);try{let{rootComponent:l,appProviders:h,platformProviders:g}=s,I=cB(g),n=[r2({}),{provide:_d,useExisting:nB},...h||[]],F=new Fy({providers:n,parent:I,debugName:"",runEnvironmentInitializers:!1});return oB({r3Injector:F.injector,platformInjector:I,rootComponent:l})}catch(l){return Promise.reject(l)}finally{wr(9)}}function Mm(s){return typeof s=="boolean"?s:s!=null&&s!=="false"}function dv(s){let l=jn(null);try{return s()}finally{jn(l)}}function a2(s,l){let h=Kx(s);return l?.equal&&(h[to].equal=l.equal),h}var w1=class{[to];constructor(l){this[to]=l}destroy(){this[to].destroy()}};function fv(s,l){!l?.injector&&C1(fv);let h=l?.injector??Rt(Wo),g=l?.manualCleanup!==!0?h.get(rc):null,I,n=h.get(GC,null,{optional:!0}),F=h.get(_d);return n!==null&&!l?.forceRoot?(I=mB(n.view,F,s),g instanceof Ay&&g._lView===n.view&&(g=null)):I=gB(s,h.get(VA),F),I.injector=h,g!==null&&(I.onDestroyFn=g.onDestroy(()=>I.destroy())),new w1(I)}var l2=lr($t({},Yh),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,hasRun:!1,cleanupFns:void 0,zone:null,kind:"effect",onDestroyFn:cm,run(){if(this.dirty=!1,this.hasRun&&!B_(this))return;this.hasRun=!0;let s=g=>(this.cleanupFns??=[]).push(g),l=Zp(this),h=Iy(!1);try{this.maybeCleanup(),this.fn(s)}finally{Iy(h),z_(this,l)}},maybeCleanup(){if(this.cleanupFns?.length)try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[]}}}),fB=lr($t({},l2),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(12)},destroy(){Xp(this),this.onDestroyFn(),this.maybeCleanup(),this.scheduler.remove(this)}}),pB=lr($t({},l2),{consumerMarkedDirty(){this.view[wn]|=8192,vm(this.view),this.notifier.notify(13)},destroy(){Xp(this),this.onDestroyFn(),this.maybeCleanup(),this.view[_u]?.delete(this)}});function mB(s,l,h){let g=Object.create(pB);return g.view=s,g.zone=typeof Zone<"u"?Zone.current:null,g.notifier=l,g.fn=h,s[_u]??=new Set,s[_u].add(g),g.consumerMarkedDirty(g),g}function gB(s,l,h){let g=Object.create(fB);return g.fn=s,g.scheduler=l,g.notifier=h,g.zone=typeof Zone<"u"?Zone.current:null,g.scheduler.schedule(g),g.notifier.notify(12),g}var m2=null;function Ld(){return m2}function g2(s){m2??=s}var pv=class{};var Yo=new Dn(""),_2=(()=>{class s{historyGo(h){throw new Error("")}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:()=>Rt(_B),providedIn:"platform"})}return s})();var _B=(()=>{class s extends _2{_location;_history;_doc=Rt(Yo);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ld().getBaseHref(this._doc)}onPopState(h){let g=Ld().getGlobalEventTarget(this._doc,"window");return g.addEventListener("popstate",h,!1),()=>g.removeEventListener("popstate",h)}onHashChange(h){let g=Ld().getGlobalEventTarget(this._doc,"window");return g.addEventListener("hashchange",h,!1),()=>g.removeEventListener("hashchange",h)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(h){this._location.pathname=h}pushState(h,g,I){this._history.pushState(h,g,I)}replaceState(h,g,I){this._history.replaceState(h,g,I)}forward(){this._history.forward()}back(){this._history.back()}historyGo(h=0){this._history.go(h)}getState(){return this._history.state}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:()=>new s,providedIn:"platform"})}return s})();function y2(s,l){return s?l?s.endsWith("/")?l.startsWith("/")?s+l.slice(1):s+l:l.startsWith("/")?s+l:`${s}/${l}`:s:l}function c2(s){let l=s.search(/#|\?|$/);return s[l-1]==="/"?s.slice(0,l-1)+s.slice(l):s}function Mu(s){return s&&s[0]!=="?"?`?${s}`:s}var kd=(()=>{class s{historyGo(h){throw new Error("")}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:()=>Rt(v2),providedIn:"root"})}return s})(),yB=new Dn(""),v2=(()=>{class s extends kd{_platformLocation;_baseHref;_removeListenerFns=[];constructor(h,g){super(),this._platformLocation=h,this._baseHref=g??this._platformLocation.getBaseHrefFromDOM()??Rt(Yo).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(h){this._removeListenerFns.push(this._platformLocation.onPopState(h),this._platformLocation.onHashChange(h))}getBaseHref(){return this._baseHref}prepareExternalUrl(h){return y2(this._baseHref,h)}path(h=!1){let g=this._platformLocation.pathname+Mu(this._platformLocation.search),I=this._platformLocation.hash;return I&&h?`${g}${I}`:g}pushState(h,g,I,n){let F=this.prepareExternalUrl(I+Mu(n));this._platformLocation.pushState(h,g,F)}replaceState(h,g,I,n){let F=this.prepareExternalUrl(I+Mu(n));this._platformLocation.replaceState(h,g,F)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(h=0){this._platformLocation.historyGo?.(h)}static \u0275fac=function(g){return new(g||s)(Hn(_2),Hn(yB,8))};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var Rm=(()=>{class s{_subject=new di;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(h){this._locationStrategy=h;let g=this._locationStrategy.getBaseHref();this._basePath=bB(c2(u2(g))),this._locationStrategy.onPopState(I=>{this._subject.next({url:this.path(!0),pop:!0,state:I.state,type:I.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(h=!1){return this.normalize(this._locationStrategy.path(h))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(h,g=""){return this.path()==this.normalize(h+Mu(g))}normalize(h){return s.stripTrailingSlash(xB(this._basePath,u2(h)))}prepareExternalUrl(h){return h&&h[0]!=="/"&&(h="/"+h),this._locationStrategy.prepareExternalUrl(h)}go(h,g="",I=null){this._locationStrategy.pushState(I,"",h,g),this._notifyUrlChangeListeners(this.prepareExternalUrl(h+Mu(g)),I)}replaceState(h,g="",I=null){this._locationStrategy.replaceState(I,"",h,g),this._notifyUrlChangeListeners(this.prepareExternalUrl(h+Mu(g)),I)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(h=0){this._locationStrategy.historyGo?.(h)}onUrlChange(h){return this._urlChangeListeners.push(h),this._urlChangeSubscription??=this.subscribe(g=>{this._notifyUrlChangeListeners(g.url,g.state)}),()=>{let g=this._urlChangeListeners.indexOf(h);this._urlChangeListeners.splice(g,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(h="",g){this._urlChangeListeners.forEach(I=>I(h,g))}subscribe(h,g,I){return this._subject.subscribe({next:h,error:g??void 0,complete:I??void 0})}static normalizeQueryParams=Mu;static joinWithSlash=y2;static stripTrailingSlash=c2;static \u0275fac=function(g){return new(g||s)(Hn(kd))};static \u0275prov=Mn({token:s,factory:()=>vB(),providedIn:"root"})}return s})();function vB(){return new Rm(Hn(kd))}function xB(s,l){if(!s||!l.startsWith(s))return l;let h=l.substring(s.length);return h===""||["/",";","?","#"].includes(h[0])?h:l}function u2(s){return s.replace(/\/index.html$/,"")}function bB(s){if(new RegExp("^(https?:)?//").test(s)){let[,h]=s.split(/\/\/[^\/]+/);return h}return s}var x2=function(s){return s[s.Decimal=0]="Decimal",s[s.Percent=1]="Percent",s[s.Currency=2]="Currency",s[s.Scientific=3]="Scientific",s}(x2||{});var qa={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function Cm(s,l){let h=gw(s),g=h[Cd.NumberSymbols][l];if(typeof g>"u"){if(l===qa.CurrencyDecimal)return h[Cd.NumberSymbols][qa.Decimal];if(l===qa.CurrencyGroup)return h[Cd.NumberSymbols][qa.Group]}return g}function wB(s,l){return gw(s)[Cd.NumberFormats][l]}var EB=/^(\d+)?\.((\d+)(-(\d+))?)?$/,h2=22,mv=".",Am="0",TB=";",IB=",",vw="#";function SB(s,l,h,g,I,n,F=!1){let H="",$=!1;if(!isFinite(s))H=Cm(h,qa.Infinity);else{let ae=AB(s);F&&(ae=CB(ae));let Te=l.minInt,Fe=l.minFrac,Ze=l.maxFrac;if(n){let Ft=n.match(EB);if(Ft===null)throw new Error(`${n} is not a valid digit info`);let mi=Ft[1],Eo=Ft[3],Bt=Ft[5];mi!=null&&(Te=xw(mi)),Eo!=null&&(Fe=xw(Eo)),Bt!=null?Ze=xw(Bt):Eo!=null&&Fe>Ze&&(Ze=Fe)}RB(ae,Fe,Ze);let ze=ae.digits,pt=ae.integerLen,vt=ae.exponent,Cn=[];for($=ze.every(Ft=>!Ft);pt<Te;pt++)ze.unshift(0);for(;pt<0;pt++)ze.unshift(0);pt>0?Cn=ze.splice(pt,ze.length):(Cn=ze,ze=[0]);let En=[];for(ze.length>=l.lgSize&&En.unshift(ze.splice(-l.lgSize,ze.length).join(""));ze.length>l.gSize;)En.unshift(ze.splice(-l.gSize,ze.length).join(""));ze.length&&En.unshift(ze.join("")),H=En.join(Cm(h,g)),Cn.length&&(H+=Cm(h,I)+Cn.join("")),vt&&(H+=Cm(h,qa.Exponential)+"+"+vt)}return s<0&&!$?H=l.negPre+H+l.negSuf:H=l.posPre+H+l.posSuf,H}function DB(s,l,h){let g=wB(l,x2.Decimal),I=MB(g,Cm(l,qa.MinusSign));return SB(s,I,l,qa.Group,qa.Decimal,h)}function MB(s,l="-"){let h={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},g=s.split(TB),I=g[0],n=g[1],F=I.indexOf(mv)!==-1?I.split(mv):[I.substring(0,I.lastIndexOf(Am)+1),I.substring(I.lastIndexOf(Am)+1)],H=F[0],$=F[1]||"";h.posPre=H.substring(0,H.indexOf(vw));for(let Te=0;Te<$.length;Te++){let Fe=$.charAt(Te);Fe===Am?h.minFrac=h.maxFrac=Te+1:Fe===vw?h.maxFrac=Te+1:h.posSuf+=Fe}let ae=H.split(IB);if(h.gSize=ae[1]?ae[1].length:0,h.lgSize=ae[2]||ae[1]?(ae[2]||ae[1]).length:0,n){let Te=I.length-h.posPre.length-h.posSuf.length,Fe=n.indexOf(vw);h.negPre=n.substring(0,Fe).replace(/'/g,""),h.negSuf=n.slice(Fe+Te).replace(/'/g,"")}else h.negPre=l+h.posPre,h.negSuf=h.posSuf;return h}function CB(s){if(s.digits[0]===0)return s;let l=s.digits.length-s.integerLen;return s.exponent?s.exponent+=2:(l===0?s.digits.push(0,0):l===1&&s.digits.push(0),s.integerLen+=2),s}function AB(s){let l=Math.abs(s)+"",h=0,g,I,n,F,H;for((I=l.indexOf(mv))>-1&&(l=l.replace(mv,"")),(n=l.search(/e/i))>0?(I<0&&(I=n),I+=+l.slice(n+1),l=l.substring(0,n)):I<0&&(I=l.length),n=0;l.charAt(n)===Am;n++);if(n===(H=l.length))g=[0],I=1;else{for(H--;l.charAt(H)===Am;)H--;for(I-=n,g=[],F=0;n<=H;n++,F++)g[F]=Number(l.charAt(n))}return I>h2&&(g=g.splice(0,h2-1),h=I-1,I=1),{digits:g,exponent:h,integerLen:I}}function RB(s,l,h){if(l>h)throw new Error(`The minimum number of digits after fraction (${l}) is higher than the maximum (${h}).`);let g=s.digits,I=g.length-s.integerLen,n=Math.min(Math.max(l,I),h),F=n+s.integerLen,H=g[F];if(F>0){g.splice(Math.max(s.integerLen,F));for(let Fe=F;Fe<g.length;Fe++)g[Fe]=0}else{I=Math.max(0,I),s.integerLen=1,g.length=Math.max(1,F=n+1),g[0]=0;for(let Fe=1;Fe<F;Fe++)g[Fe]=0}if(H>=5)if(F-1<0){for(let Fe=0;Fe>F;Fe--)g.unshift(0),s.integerLen++;g.unshift(1),s.integerLen++}else g[F-1]++;for(;I<Math.max(0,n);I++)g.push(0);let $=n!==0,ae=l+s.integerLen,Te=g.reduceRight(function(Fe,Ze,ze,pt){return Ze=Ze+Fe,pt[ze]=Ze<10?Ze:Ze-10,$&&(pt[ze]===0&&ze>=ae?pt.pop():$=!1),Ze>=10?1:0},0);Te&&(g.unshift(Te),s.integerLen++)}function xw(s){let l=parseInt(s);if(isNaN(l))throw new Error("Invalid integer literal when parsing "+s);return l}function b2(s,l){l=encodeURIComponent(l);for(let h of s.split(";")){let g=h.indexOf("="),[I,n]=g==-1?[h,""]:[h.slice(0,g),h.slice(g+1)];if(I.trim()===l)return decodeURIComponent(n)}return null}function w2(s,l){return new tn(2100,!1)}var bw=class{createSubscription(l,h){return dv(()=>l.subscribe({next:h,error:g=>{throw g}}))}dispose(l){dv(()=>l.unsubscribe())}},ww=class{createSubscription(l,h){return l.then(h,g=>{throw g})}dispose(l){}},PB=new ww,OB=new bw,E2=(()=>{class s{_ref;_latestValue=null;markForCheckOnValueUpdate=!0;_subscription=null;_obj=null;_strategy=null;constructor(h){this._ref=h}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(h){if(!this._obj){if(h)try{this.markForCheckOnValueUpdate=!1,this._subscribe(h)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return h!==this._obj?(this._dispose(),this.transform(h)):this._latestValue}_subscribe(h){this._obj=h,this._strategy=this._selectStrategy(h),this._subscription=this._strategy.createSubscription(h,g=>this._updateLatestValue(h,g))}_selectStrategy(h){if(Md(h))return PB;if(fw(h))return OB;throw w2(s,h)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(h,g){h===this._obj&&(this._latestValue=g,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static \u0275fac=function(g){return new(g||s)(Ds(Od,16))};static \u0275pipe=lv({name:"async",type:s,pure:!1})}return s})();var _v=(()=>{class s{transform(h){return JSON.stringify(h,null,2)}static \u0275fac=function(g){return new(g||s)};static \u0275pipe=lv({name:"json",type:s,pure:!1})}return s})();var T2=(()=>{class s{_locale;constructor(h){this._locale=h}transform(h,g,I){if(!LB(h))return null;I||=this._locale;try{let n=kB(h);return DB(n,I,g)}catch(n){throw w2(s,n.message)}}static \u0275fac=function(g){return new(g||s)(Ds(hv,16))};static \u0275pipe=lv({name:"number",type:s,pure:!0})}return s})();function LB(s){return!(s==null||s===""||s!==s)}function kB(s){if(typeof s=="string"&&!isNaN(Number(s)-parseFloat(s)))return Number(s);if(typeof s!="number")throw new Error(`${s} is not a number`);return s}var I2="browser",FB="server";function Ew(s){return s===FB}var gv=class{};var Iw=class extends pv{supportsDOMEvents=!0},Sw=class s extends Iw{static makeCurrent(){g2(new s)}onAndCancel(l,h,g,I){return l.addEventListener(h,g,I),()=>{l.removeEventListener(h,g,I)}}dispatchEvent(l,h){l.dispatchEvent(h)}remove(l){l.remove()}createElement(l,h){return h=h||this.getDefaultDocument(),h.createElement(l)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(l){return l.nodeType===Node.ELEMENT_NODE}isShadowRoot(l){return l instanceof DocumentFragment}getGlobalEventTarget(l,h){return h==="window"?window:h==="document"?l:h==="body"?l.body:null}getBaseHref(l){let h=zB();return h==null?null:BB(h)}resetBaseElement(){Pm=null}getUserAgent(){return window.navigator.userAgent}getCookie(l){return b2(document.cookie,l)}},Pm=null;function zB(){return Pm=Pm||document.querySelector("base"),Pm?Pm.getAttribute("href"):null}function BB(s){return new URL(s,document.baseURI).pathname}var VB=(()=>{class s{build(){return new XMLHttpRequest}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac})}return s})(),Dw=new Dn(""),R2=(()=>{class s{_zone;_plugins;_eventNameToPlugin=new Map;constructor(h,g){this._zone=g,h.forEach(I=>{I.manager=this}),this._plugins=h.slice().reverse()}addEventListener(h,g,I,n){return this._findPluginFor(g).addEventListener(h,g,I,n)}getZone(){return this._zone}_findPluginFor(h){let g=this._eventNameToPlugin.get(h);if(g)return g;if(g=this._plugins.find(n=>n.supports(h)),!g)throw new tn(5101,!1);return this._eventNameToPlugin.set(h,g),g}static \u0275fac=function(g){return new(g||s)(Hn(Dw),Hn(Ti))};static \u0275prov=Mn({token:s,factory:s.\u0275fac})}return s})(),vv=class{_doc;constructor(l){this._doc=l}manager},yv="ng-app-id";function S2(s){for(let l of s)l.remove()}function D2(s,l){let h=l.createElement("style");return h.textContent=s,h}function jB(s,l,h,g){let I=s.head?.querySelectorAll(`style[${yv}="${l}"],link[${yv}="${l}"]`);if(I)for(let n of I)n.removeAttribute(yv),n instanceof HTMLLinkElement?g.set(n.href.slice(n.href.lastIndexOf("/")+1),{usage:0,elements:[n]}):n.textContent&&h.set(n.textContent,{usage:0,elements:[n]})}function Mw(s,l){let h=l.createElement("link");return h.setAttribute("rel","stylesheet"),h.setAttribute("href",s),h}var P2=(()=>{class s{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(h,g,I,n={}){this.doc=h,this.appId=g,this.nonce=I,this.isServer=Ew(n),jB(h,g,this.inline,this.external),this.hosts.add(h.head)}addStyles(h,g){for(let I of h)this.addUsage(I,this.inline,D2);g?.forEach(I=>this.addUsage(I,this.external,Mw))}removeStyles(h,g){for(let I of h)this.removeUsage(I,this.inline);g?.forEach(I=>this.removeUsage(I,this.external))}addUsage(h,g,I){let n=g.get(h);n?n.usage++:g.set(h,{usage:1,elements:[...this.hosts].map(F=>this.addElement(F,I(h,this.doc)))})}removeUsage(h,g){let I=g.get(h);I&&(I.usage--,I.usage<=0&&(S2(I.elements),g.delete(h)))}ngOnDestroy(){for(let[,{elements:h}]of[...this.inline,...this.external])S2(h);this.hosts.clear()}addHost(h){this.hosts.add(h);for(let[g,{elements:I}]of this.inline)I.push(this.addElement(h,D2(g,this.doc)));for(let[g,{elements:I}]of this.external)I.push(this.addElement(h,Mw(g,this.doc)))}removeHost(h){this.hosts.delete(h)}addElement(h,g){return this.nonce&&g.setAttribute("nonce",this.nonce),this.isServer&&g.setAttribute(yv,this.appId),h.appendChild(g)}static \u0275fac=function(g){return new(g||s)(Hn(Yo),Hn(G1),Hn(W1,8),Hn(Sm))};static \u0275prov=Mn({token:s,factory:s.\u0275fac})}return s})(),Tw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Aw=/%COMP%/g;var O2="%COMP%",UB=`_nghost-${O2}`,$B=`_ngcontent-${O2}`,HB=!0,GB=new Dn("",{providedIn:"root",factory:()=>HB});function qB(s){return $B.replace(Aw,s)}function WB(s){return UB.replace(Aw,s)}function L2(s,l){return l.map(h=>h.replace(Aw,s))}var M2=(()=>{class s{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(h,g,I,n,F,H,$,ae=null,Te=null){this.eventManager=h,this.sharedStylesHost=g,this.appId=I,this.removeStylesOnCompDestroy=n,this.doc=F,this.platformId=H,this.ngZone=$,this.nonce=ae,this.tracingService=Te,this.platformIsServer=Ew(H),this.defaultRenderer=new Om(h,F,$,this.platformIsServer,this.tracingService)}createRenderer(h,g){if(!h||!g)return this.defaultRenderer;this.platformIsServer&&g.encapsulation===ea.ShadowDom&&(g=lr($t({},g),{encapsulation:ea.Emulated}));let I=this.getOrCreateRenderer(h,g);return I instanceof xv?I.applyToHost(h):I instanceof Lm&&I.applyStyles(),I}getOrCreateRenderer(h,g){let I=this.rendererByCompId,n=I.get(g.id);if(!n){let F=this.doc,H=this.ngZone,$=this.eventManager,ae=this.sharedStylesHost,Te=this.removeStylesOnCompDestroy,Fe=this.platformIsServer,Ze=this.tracingService;switch(g.encapsulation){case ea.Emulated:n=new xv($,ae,g,this.appId,Te,F,H,Fe,Ze);break;case ea.ShadowDom:return new Cw($,ae,h,g,F,H,this.nonce,Fe,Ze);default:n=new Lm($,ae,g,Te,F,H,Fe,Ze);break}I.set(g.id,n)}return n}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(h){this.rendererByCompId.delete(h)}static \u0275fac=function(g){return new(g||s)(Hn(R2),Hn(P2),Hn(G1),Hn(GB),Hn(Yo),Hn(Sm),Hn(Ti),Hn(W1),Hn(Jy,8))};static \u0275prov=Mn({token:s,factory:s.\u0275fac})}return s})(),Om=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(l,h,g,I,n){this.eventManager=l,this.doc=h,this.ngZone=g,this.platformIsServer=I,this.tracingService=n}destroy(){}destroyNode=null;createElement(l,h){return h?this.doc.createElementNS(Tw[h]||h,l):this.doc.createElement(l)}createComment(l){return this.doc.createComment(l)}createText(l){return this.doc.createTextNode(l)}appendChild(l,h){(C2(l)?l.content:l).appendChild(h)}insertBefore(l,h,g){l&&(C2(l)?l.content:l).insertBefore(h,g)}removeChild(l,h){h.remove()}selectRootElement(l,h){let g=typeof l=="string"?this.doc.querySelector(l):l;if(!g)throw new tn(-5104,!1);return h||(g.textContent=""),g}parentNode(l){return l.parentNode}nextSibling(l){return l.nextSibling}setAttribute(l,h,g,I){if(I){h=I+":"+h;let n=Tw[I];n?l.setAttributeNS(n,h,g):l.setAttribute(h,g)}else l.setAttribute(h,g)}removeAttribute(l,h,g){if(g){let I=Tw[g];I?l.removeAttributeNS(I,h):l.removeAttribute(`${g}:${h}`)}else l.removeAttribute(h)}addClass(l,h){l.classList.add(h)}removeClass(l,h){l.classList.remove(h)}setStyle(l,h,g,I){I&(za.DashCase|za.Important)?l.style.setProperty(h,g,I&za.Important?"important":""):l.style[h]=g}removeStyle(l,h,g){g&za.DashCase?l.style.removeProperty(h):l.style[h]=""}setProperty(l,h,g){l!=null&&(l[h]=g)}setValue(l,h){l.nodeValue=h}listen(l,h,g,I){if(typeof l=="string"&&(l=Ld().getGlobalEventTarget(this.doc,l),!l))throw new tn(5102,!1);let n=this.decoratePreventDefault(g);return this.tracingService?.wrapEventListener&&(n=this.tracingService.wrapEventListener(l,h,n)),this.eventManager.addEventListener(l,h,n,I)}decoratePreventDefault(l){return h=>{if(h==="__ngUnwrap__")return l;(this.platformIsServer?this.ngZone.runGuarded(()=>l(h)):l(h))===!1&&h.preventDefault()}}};function C2(s){return s.tagName==="TEMPLATE"&&s.content!==void 0}var Cw=class extends Om{sharedStylesHost;hostEl;shadowRoot;constructor(l,h,g,I,n,F,H,$,ae){super(l,n,F,$,ae),this.sharedStylesHost=h,this.hostEl=g,this.shadowRoot=g.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let Te=I.styles;Te=L2(I.id,Te);for(let Ze of Te){let ze=document.createElement("style");H&&ze.setAttribute("nonce",H),ze.textContent=Ze,this.shadowRoot.appendChild(ze)}let Fe=I.getExternalStyles?.();if(Fe)for(let Ze of Fe){let ze=Mw(Ze,n);H&&ze.setAttribute("nonce",H),this.shadowRoot.appendChild(ze)}}nodeOrShadowRoot(l){return l===this.hostEl?this.shadowRoot:l}appendChild(l,h){return super.appendChild(this.nodeOrShadowRoot(l),h)}insertBefore(l,h,g){return super.insertBefore(this.nodeOrShadowRoot(l),h,g)}removeChild(l,h){return super.removeChild(null,h)}parentNode(l){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(l)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Lm=class extends Om{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(l,h,g,I,n,F,H,$,ae){super(l,n,F,H,$),this.sharedStylesHost=h,this.removeStylesOnCompDestroy=I;let Te=g.styles;this.styles=ae?L2(ae,Te):Te,this.styleUrls=g.getExternalStyles?.(ae)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},xv=class extends Lm{contentAttr;hostAttr;constructor(l,h,g,I,n,F,H,$,ae){let Te=I+"-"+g.id;super(l,h,g,n,F,H,$,ae,Te),this.contentAttr=qB(Te),this.hostAttr=WB(Te)}applyToHost(l){this.applyStyles(),this.setAttribute(l,this.hostAttr,"")}createElement(l,h){let g=super.createElement(l,h);return super.setAttribute(g,this.contentAttr,""),g}},ZB=(()=>{class s extends vv{constructor(h){super(h)}supports(h){return!0}addEventListener(h,g,I,n){return h.addEventListener(g,I,n),()=>this.removeEventListener(h,g,I,n)}removeEventListener(h,g,I,n){return h.removeEventListener(g,I,n)}static \u0275fac=function(g){return new(g||s)(Hn(Yo))};static \u0275prov=Mn({token:s,factory:s.\u0275fac})}return s})(),A2=["alt","control","meta","shift"],XB={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},YB={alt:s=>s.altKey,control:s=>s.ctrlKey,meta:s=>s.metaKey,shift:s=>s.shiftKey},KB=(()=>{class s extends vv{constructor(h){super(h)}supports(h){return s.parseEventName(h)!=null}addEventListener(h,g,I,n){let F=s.parseEventName(g),H=s.eventCallback(F.fullKey,I,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ld().onAndCancel(h,F.domEventName,H,n))}static parseEventName(h){let g=h.toLowerCase().split("."),I=g.shift();if(g.length===0||!(I==="keydown"||I==="keyup"))return null;let n=s._normalizeKey(g.pop()),F="",H=g.indexOf("code");if(H>-1&&(g.splice(H,1),F="code."),A2.forEach(ae=>{let Te=g.indexOf(ae);Te>-1&&(g.splice(Te,1),F+=ae+".")}),F+=n,g.length!=0||n.length===0)return null;let $={};return $.domEventName=I,$.fullKey=F,$}static matchEventFullKeyCode(h,g){let I=XB[h.key]||h.key,n="";return g.indexOf("code.")>-1&&(I=h.code,n="code."),I==null||!I?!1:(I=I.toLowerCase(),I===" "?I="space":I==="."&&(I="dot"),A2.forEach(F=>{if(F!==I){let H=YB[F];H(h)&&(n+=F+".")}}),n+=I,n===g)}static eventCallback(h,g,I){return n=>{s.matchEventFullKeyCode(n,h)&&I.runGuarded(()=>g(n))}}static _normalizeKey(h){return h==="esc"?"escape":h}static \u0275fac=function(g){return new(g||s)(Hn(Yo))};static \u0275prov=Mn({token:s,factory:s.\u0275fac})}return s})();function k2(s,l){return s2($t({rootComponent:s},JB(l)))}function JB(s){return{appProviders:[...r4,...s?.providers??[]],platformProviders:n4}}function QB(){Sw.makeCurrent()}function e4(){return new tc}function t4(){return UC(document),document}var n4=[{provide:Sm,useValue:I2},{provide:q1,useValue:QB,multi:!0},{provide:Yo,useFactory:t4,deps:[]}];var r4=[{provide:qy,useValue:"root"},{provide:tc,useFactory:e4,deps:[]},{provide:Dw,useClass:ZB,multi:!0,deps:[Yo]},{provide:Dw,useClass:KB,multi:!0,deps:[Yo]},M2,P2,R2,{provide:yd,useExisting:M2},{provide:gv,useClass:VB,deps:[]},[]];var F2=(()=>{class s{_doc;constructor(h){this._doc=h}getTitle(){return this._doc.title}setTitle(h){this._doc.title=h||""}static \u0275fac=function(g){return new(g||s)(Hn(Yo))};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var Fn="primary",Xm=Symbol("RouteTitle"),kw=class{params;constructor(l){this.params=l||{}}has(l){return Object.prototype.hasOwnProperty.call(this.params,l)}get(l){if(this.has(l)){let h=this.params[l];return Array.isArray(h)?h[0]:h}return null}getAll(l){if(this.has(l)){let h=this.params[l];return Array.isArray(h)?h:[h]}return[]}get keys(){return Object.keys(this.params)}};function jd(s){return new kw(s)}function o4(s,l,h){let g=h.path.split("/");if(g.length>s.length||h.pathMatch==="full"&&(l.hasChildren()||g.length<s.length))return null;let I={};for(let n=0;n<g.length;n++){let F=g[n],H=s[n];if(F[0]===":")I[F.substring(1)]=H;else if(F!==H.path)return null}return{consumed:s.slice(0,g.length),posParams:I}}function s4(s,l){if(s.length!==l.length)return!1;for(let h=0;h<s.length;++h)if(!na(s[h],l[h]))return!1;return!0}function na(s,l){let h=s?Fw(s):void 0,g=l?Fw(l):void 0;if(!h||!g||h.length!=g.length)return!1;let I;for(let n=0;n<h.length;n++)if(I=h[n],!H2(s[I],l[I]))return!1;return!0}function Fw(s){return[...Object.keys(s),...Object.getOwnPropertySymbols(s)]}function H2(s,l){if(Array.isArray(s)&&Array.isArray(l)){if(s.length!==l.length)return!1;let h=[...s].sort(),g=[...l].sort();return h.every((I,n)=>g[n]===I)}else return s===l}function G2(s){return s.length>0?s[s.length-1]:null}function oc(s){return ub(s)?s:Md(s)?ni(Promise.resolve(s)):Pn(s)}var a4={exact:W2,subset:Z2},q2={exact:l4,subset:c4,ignored:()=>!0};function N2(s,l,h){return a4[h.paths](s.root,l.root,h.matrixParams)&&q2[h.queryParams](s.queryParams,l.queryParams)&&!(h.fragment==="exact"&&s.fragment!==l.fragment)}function l4(s,l){return na(s,l)}function W2(s,l,h){if(!Au(s.segments,l.segments)||!Ev(s.segments,l.segments,h)||s.numberOfChildren!==l.numberOfChildren)return!1;for(let g in l.children)if(!s.children[g]||!W2(s.children[g],l.children[g],h))return!1;return!0}function c4(s,l){return Object.keys(l).length<=Object.keys(s).length&&Object.keys(l).every(h=>H2(s[h],l[h]))}function Z2(s,l,h){return X2(s,l,l.segments,h)}function X2(s,l,h,g){if(s.segments.length>h.length){let I=s.segments.slice(0,h.length);return!(!Au(I,h)||l.hasChildren()||!Ev(I,h,g))}else if(s.segments.length===h.length){if(!Au(s.segments,h)||!Ev(s.segments,h,g))return!1;for(let I in l.children)if(!s.children[I]||!Z2(s.children[I],l.children[I],g))return!1;return!0}else{let I=h.slice(0,s.segments.length),n=h.slice(s.segments.length);return!Au(s.segments,I)||!Ev(s.segments,I,g)||!s.children[Fn]?!1:X2(s.children[Fn],l,n,g)}}function Ev(s,l,h){return l.every((g,I)=>q2[h](s[I].parameters,g.parameters))}var Za=class{root;queryParams;fragment;_queryParamMap;constructor(l=new or([],{}),h={},g=null){this.root=l,this.queryParams=h,this.fragment=g}get queryParamMap(){return this._queryParamMap??=jd(this.queryParams),this._queryParamMap}toString(){return d4.serialize(this)}},or=class{segments;children;parent=null;constructor(l,h){this.segments=l,this.children=h,Object.values(h).forEach(g=>g.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Tv(this)}},Cu=class{path;parameters;_parameterMap;constructor(l,h){this.path=l,this.parameters=h}get parameterMap(){return this._parameterMap??=jd(this.parameters),this._parameterMap}toString(){return K2(this)}};function u4(s,l){return Au(s,l)&&s.every((h,g)=>na(h.parameters,l[g].parameters))}function Au(s,l){return s.length!==l.length?!1:s.every((h,g)=>h.path===l[g].path)}function h4(s,l){let h=[];return Object.entries(s.children).forEach(([g,I])=>{g===Fn&&(h=h.concat(l(I,g)))}),Object.entries(s.children).forEach(([g,I])=>{g!==Fn&&(h=h.concat(l(I,g)))}),h}var lE=(()=>{class s{static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:()=>new Vm,providedIn:"root"})}return s})(),Vm=class{parse(l){let h=new zw(l);return new Za(h.parseRootSegment(),h.parseQueryParams(),h.parseFragment())}serialize(l){let h=`/${km(l.root,!0)}`,g=m4(l.queryParams),I=typeof l.fragment=="string"?`#${f4(l.fragment)}`:"";return`${h}${g}${I}`}},d4=new Vm;function Tv(s){return s.segments.map(l=>K2(l)).join("/")}function km(s,l){if(!s.hasChildren())return Tv(s);if(l){let h=s.children[Fn]?km(s.children[Fn],!1):"",g=[];return Object.entries(s.children).forEach(([I,n])=>{I!==Fn&&g.push(`${I}:${km(n,!1)}`)}),g.length>0?`${h}(${g.join("//")})`:h}else{let h=h4(s,(g,I)=>I===Fn?[km(s.children[Fn],!1)]:[`${I}:${km(g,!1)}`]);return Object.keys(s.children).length===1&&s.children[Fn]!=null?`${Tv(s)}/${h[0]}`:`${Tv(s)}/(${h.join("//")})`}}function Y2(s){return encodeURIComponent(s).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function bv(s){return Y2(s).replace(/%3B/gi,";")}function f4(s){return encodeURI(s)}function Nw(s){return Y2(s).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Iv(s){return decodeURIComponent(s)}function z2(s){return Iv(s.replace(/\+/g,"%20"))}function K2(s){return`${Nw(s.path)}${p4(s.parameters)}`}function p4(s){return Object.entries(s).map(([l,h])=>`;${Nw(l)}=${Nw(h)}`).join("")}function m4(s){let l=Object.entries(s).map(([h,g])=>Array.isArray(g)?g.map(I=>`${bv(h)}=${bv(I)}`).join("&"):`${bv(h)}=${bv(g)}`).filter(h=>h);return l.length?`?${l.join("&")}`:""}var g4=/^[^\/()?;#]+/;function Rw(s){let l=s.match(g4);return l?l[0]:""}var _4=/^[^\/()?;=#]+/;function y4(s){let l=s.match(_4);return l?l[0]:""}var v4=/^[^=?&#]+/;function x4(s){let l=s.match(v4);return l?l[0]:""}var b4=/^[^&#]+/;function w4(s){let l=s.match(b4);return l?l[0]:""}var zw=class{url;remaining;constructor(l){this.url=l,this.remaining=l}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new or([],{}):new or([],this.parseChildren())}parseQueryParams(){let l={};if(this.consumeOptional("?"))do this.parseQueryParam(l);while(this.consumeOptional("&"));return l}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let l=[];for(this.peekStartsWith("(")||l.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),l.push(this.parseSegment());let h={};this.peekStartsWith("/(")&&(this.capture("/"),h=this.parseParens(!0));let g={};return this.peekStartsWith("(")&&(g=this.parseParens(!1)),(l.length>0||Object.keys(h).length>0)&&(g[Fn]=new or(l,h)),g}parseSegment(){let l=Rw(this.remaining);if(l===""&&this.peekStartsWith(";"))throw new tn(4009,!1);return this.capture(l),new Cu(Iv(l),this.parseMatrixParams())}parseMatrixParams(){let l={};for(;this.consumeOptional(";");)this.parseParam(l);return l}parseParam(l){let h=y4(this.remaining);if(!h)return;this.capture(h);let g="";if(this.consumeOptional("=")){let I=Rw(this.remaining);I&&(g=I,this.capture(g))}l[Iv(h)]=Iv(g)}parseQueryParam(l){let h=x4(this.remaining);if(!h)return;this.capture(h);let g="";if(this.consumeOptional("=")){let F=w4(this.remaining);F&&(g=F,this.capture(g))}let I=z2(h),n=z2(g);if(l.hasOwnProperty(I)){let F=l[I];Array.isArray(F)||(F=[F],l[I]=F),F.push(n)}else l[I]=n}parseParens(l){let h={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let g=Rw(this.remaining),I=this.remaining[g.length];if(I!=="/"&&I!==")"&&I!==";")throw new tn(4010,!1);let n;g.indexOf(":")>-1?(n=g.slice(0,g.indexOf(":")),this.capture(n),this.capture(":")):l&&(n=Fn);let F=this.parseChildren();h[n]=Object.keys(F).length===1?F[Fn]:new or([],F),this.consumeOptional("//")}return h}peekStartsWith(l){return this.remaining.startsWith(l)}consumeOptional(l){return this.peekStartsWith(l)?(this.remaining=this.remaining.substring(l.length),!0):!1}capture(l){if(!this.consumeOptional(l))throw new tn(4011,!1)}};function J2(s){return s.segments.length>0?new or([],{[Fn]:s}):s}function Q2(s){let l={};for(let[g,I]of Object.entries(s.children)){let n=Q2(I);if(g===Fn&&n.segments.length===0&&n.hasChildren())for(let[F,H]of Object.entries(n.children))l[F]=H;else(n.segments.length>0||n.hasChildren())&&(l[g]=n)}let h=new or(s.segments,l);return E4(h)}function E4(s){if(s.numberOfChildren===1&&s.children[Fn]){let l=s.children[Fn];return new or(s.segments.concat(l.segments),l.children)}return s}function Ru(s){return s instanceof Za}function T4(s,l,h=null,g=null){let I=eR(s);return tR(I,l,h,g)}function eR(s){let l;function h(n){let F={};for(let $ of n.children){let ae=h($);F[$.outlet]=ae}let H=new or(n.url,F);return n===s&&(l=H),H}let g=h(s.root),I=J2(g);return l??I}function tR(s,l,h,g){let I=s;for(;I.parent;)I=I.parent;if(l.length===0)return Pw(I,I,I,h,g);let n=I4(l);if(n.toRoot())return Pw(I,I,new or([],{}),h,g);let F=S4(n,I,s),H=F.processChildren?Nm(F.segmentGroup,F.index,n.commands):rR(F.segmentGroup,F.index,n.commands);return Pw(I,F.segmentGroup,H,h,g)}function Sv(s){return typeof s=="object"&&s!=null&&!s.outlets&&!s.segmentPath}function jm(s){return typeof s=="object"&&s!=null&&s.outlets}function Pw(s,l,h,g,I){let n={};g&&Object.entries(g).forEach(([$,ae])=>{n[$]=Array.isArray(ae)?ae.map(Te=>`${Te}`):`${ae}`});let F;s===l?F=h:F=nR(s,l,h);let H=J2(Q2(F));return new Za(H,n,I)}function nR(s,l,h){let g={};return Object.entries(s.children).forEach(([I,n])=>{n===l?g[I]=h:g[I]=nR(n,l,h)}),new or(s.segments,g)}var Dv=class{isAbsolute;numberOfDoubleDots;commands;constructor(l,h,g){if(this.isAbsolute=l,this.numberOfDoubleDots=h,this.commands=g,l&&g.length>0&&Sv(g[0]))throw new tn(4003,!1);let I=g.find(jm);if(I&&I!==G2(g))throw new tn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function I4(s){if(typeof s[0]=="string"&&s.length===1&&s[0]==="/")return new Dv(!0,0,s);let l=0,h=!1,g=s.reduce((I,n,F)=>{if(typeof n=="object"&&n!=null){if(n.outlets){let H={};return Object.entries(n.outlets).forEach(([$,ae])=>{H[$]=typeof ae=="string"?ae.split("/"):ae}),[...I,{outlets:H}]}if(n.segmentPath)return[...I,n.segmentPath]}return typeof n!="string"?[...I,n]:F===0?(n.split("/").forEach((H,$)=>{$==0&&H==="."||($==0&&H===""?h=!0:H===".."?l++:H!=""&&I.push(H))}),I):[...I,n]},[]);return new Dv(h,l,g)}var zd=class{segmentGroup;processChildren;index;constructor(l,h,g){this.segmentGroup=l,this.processChildren=h,this.index=g}};function S4(s,l,h){if(s.isAbsolute)return new zd(l,!0,0);if(!h)return new zd(l,!1,NaN);if(h.parent===null)return new zd(h,!0,0);let g=Sv(s.commands[0])?0:1,I=h.segments.length-1+g;return D4(h,I,s.numberOfDoubleDots)}function D4(s,l,h){let g=s,I=l,n=h;for(;n>I;){if(n-=I,g=g.parent,!g)throw new tn(4005,!1);I=g.segments.length}return new zd(g,!1,I-n)}function M4(s){return jm(s[0])?s[0].outlets:{[Fn]:s}}function rR(s,l,h){if(s??=new or([],{}),s.segments.length===0&&s.hasChildren())return Nm(s,l,h);let g=C4(s,l,h),I=h.slice(g.commandIndex);if(g.match&&g.pathIndex<s.segments.length){let n=new or(s.segments.slice(0,g.pathIndex),{});return n.children[Fn]=new or(s.segments.slice(g.pathIndex),s.children),Nm(n,0,I)}else return g.match&&I.length===0?new or(s.segments,{}):g.match&&!s.hasChildren()?Bw(s,l,h):g.match?Nm(s,0,I):Bw(s,l,h)}function Nm(s,l,h){if(h.length===0)return new or(s.segments,{});{let g=M4(h),I={};if(Object.keys(g).some(n=>n!==Fn)&&s.children[Fn]&&s.numberOfChildren===1&&s.children[Fn].segments.length===0){let n=Nm(s.children[Fn],l,h);return new or(s.segments,n.children)}return Object.entries(g).forEach(([n,F])=>{typeof F=="string"&&(F=[F]),F!==null&&(I[n]=rR(s.children[n],l,F))}),Object.entries(s.children).forEach(([n,F])=>{g[n]===void 0&&(I[n]=F)}),new or(s.segments,I)}}function C4(s,l,h){let g=0,I=l,n={match:!1,pathIndex:0,commandIndex:0};for(;I<s.segments.length;){if(g>=h.length)return n;let F=s.segments[I],H=h[g];if(jm(H))break;let $=`${H}`,ae=g<h.length-1?h[g+1]:null;if(I>0&&$===void 0)break;if($&&ae&&typeof ae=="object"&&ae.outlets===void 0){if(!V2($,ae,F))return n;g+=2}else{if(!V2($,{},F))return n;g++}I++}return{match:!0,pathIndex:I,commandIndex:g}}function Bw(s,l,h){let g=s.segments.slice(0,l),I=0;for(;I<h.length;){let n=h[I];if(jm(n)){let $=A4(n.outlets);return new or(g,$)}if(I===0&&Sv(h[0])){let $=s.segments[l];g.push(new Cu($.path,B2(h[0]))),I++;continue}let F=jm(n)?n.outlets[Fn]:`${n}`,H=I<h.length-1?h[I+1]:null;F&&H&&Sv(H)?(g.push(new Cu(F,B2(H))),I+=2):(g.push(new Cu(F,{})),I++)}return new or(g,{})}function A4(s){let l={};return Object.entries(s).forEach(([h,g])=>{typeof g=="string"&&(g=[g]),g!==null&&(l[h]=Bw(new or([],{}),0,g))}),l}function B2(s){let l={};return Object.entries(s).forEach(([h,g])=>l[h]=`${g}`),l}function V2(s,l,h){return s==h.path&&na(l,h.parameters)}var zm="imperative",Si=function(s){return s[s.NavigationStart=0]="NavigationStart",s[s.NavigationEnd=1]="NavigationEnd",s[s.NavigationCancel=2]="NavigationCancel",s[s.NavigationError=3]="NavigationError",s[s.RoutesRecognized=4]="RoutesRecognized",s[s.ResolveStart=5]="ResolveStart",s[s.ResolveEnd=6]="ResolveEnd",s[s.GuardsCheckStart=7]="GuardsCheckStart",s[s.GuardsCheckEnd=8]="GuardsCheckEnd",s[s.RouteConfigLoadStart=9]="RouteConfigLoadStart",s[s.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",s[s.ChildActivationStart=11]="ChildActivationStart",s[s.ChildActivationEnd=12]="ChildActivationEnd",s[s.ActivationStart=13]="ActivationStart",s[s.ActivationEnd=14]="ActivationEnd",s[s.Scroll=15]="Scroll",s[s.NavigationSkipped=16]="NavigationSkipped",s}(Si||{}),Ko=class{id;url;constructor(l,h){this.id=l,this.url=h}},Um=class extends Ko{type=Si.NavigationStart;navigationTrigger;restoredState;constructor(l,h,g="imperative",I=null){super(l,h),this.navigationTrigger=g,this.restoredState=I}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},As=class extends Ko{urlAfterRedirects;type=Si.NavigationEnd;constructor(l,h,g){super(l,h),this.urlAfterRedirects=g}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},wo=function(s){return s[s.Redirect=0]="Redirect",s[s.SupersededByNewNavigation=1]="SupersededByNewNavigation",s[s.NoDataFromResolver=2]="NoDataFromResolver",s[s.GuardRejected=3]="GuardRejected",s}(wo||{}),Vw=function(s){return s[s.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",s[s.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",s}(Vw||{}),Wa=class extends Ko{reason;code;type=Si.NavigationCancel;constructor(l,h,g,I){super(l,h),this.reason=g,this.code=I}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Pu=class extends Ko{reason;code;type=Si.NavigationSkipped;constructor(l,h,g,I){super(l,h),this.reason=g,this.code=I}},$m=class extends Ko{error;target;type=Si.NavigationError;constructor(l,h,g,I){super(l,h),this.error=g,this.target=I}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Mv=class extends Ko{urlAfterRedirects;state;type=Si.RoutesRecognized;constructor(l,h,g,I){super(l,h),this.urlAfterRedirects=g,this.state=I}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},jw=class extends Ko{urlAfterRedirects;state;type=Si.GuardsCheckStart;constructor(l,h,g,I){super(l,h),this.urlAfterRedirects=g,this.state=I}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Uw=class extends Ko{urlAfterRedirects;state;shouldActivate;type=Si.GuardsCheckEnd;constructor(l,h,g,I,n){super(l,h),this.urlAfterRedirects=g,this.state=I,this.shouldActivate=n}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},$w=class extends Ko{urlAfterRedirects;state;type=Si.ResolveStart;constructor(l,h,g,I){super(l,h),this.urlAfterRedirects=g,this.state=I}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Hw=class extends Ko{urlAfterRedirects;state;type=Si.ResolveEnd;constructor(l,h,g,I){super(l,h),this.urlAfterRedirects=g,this.state=I}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Gw=class{route;type=Si.RouteConfigLoadStart;constructor(l){this.route=l}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},qw=class{route;type=Si.RouteConfigLoadEnd;constructor(l){this.route=l}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Ww=class{snapshot;type=Si.ChildActivationStart;constructor(l){this.snapshot=l}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Zw=class{snapshot;type=Si.ChildActivationEnd;constructor(l){this.snapshot=l}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Xw=class{snapshot;type=Si.ActivationStart;constructor(l){this.snapshot=l}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Yw=class{snapshot;type=Si.ActivationEnd;constructor(l){this.snapshot=l}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Hm=class{},Ud=class{url;navigationBehaviorOptions;constructor(l,h){this.url=l,this.navigationBehaviorOptions=h}};function R4(s,l){return s.providers&&!s._injector&&(s._injector=uw(s.providers,l,`Route: ${s.path}`)),s._injector??l}function Cs(s){return s.outlet||Fn}function P4(s,l){let h=s.filter(g=>Cs(g)===l);return h.push(...s.filter(g=>Cs(g)!==l)),h}function Ym(s){if(!s)return null;if(s.routeConfig?._injector)return s.routeConfig._injector;for(let l=s.parent;l;l=l.parent){let h=l.routeConfig;if(h?._loadedInjector)return h._loadedInjector;if(h?._injector)return h._injector}return null}var Kw=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Ym(this.route?.snapshot)??this.rootInjector}constructor(l){this.rootInjector=l,this.children=new kv(this.rootInjector)}},kv=(()=>{class s{rootInjector;contexts=new Map;constructor(h){this.rootInjector=h}onChildOutletCreated(h,g){let I=this.getOrCreateContext(h);I.outlet=g,this.contexts.set(h,I)}onChildOutletDestroyed(h){let g=this.getContext(h);g&&(g.outlet=null,g.attachRef=null)}onOutletDeactivated(){let h=this.contexts;return this.contexts=new Map,h}onOutletReAttached(h){this.contexts=h}getOrCreateContext(h){let g=this.getContext(h);return g||(g=new Kw(this.rootInjector),this.contexts.set(h,g)),g}getContext(h){return this.contexts.get(h)||null}static \u0275fac=function(g){return new(g||s)(Hn(qo))};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),Cv=class{_root;constructor(l){this._root=l}get root(){return this._root.value}parent(l){let h=this.pathFromRoot(l);return h.length>1?h[h.length-2]:null}children(l){let h=Jw(l,this._root);return h?h.children.map(g=>g.value):[]}firstChild(l){let h=Jw(l,this._root);return h&&h.children.length>0?h.children[0].value:null}siblings(l){let h=Qw(l,this._root);return h.length<2?[]:h[h.length-2].children.map(I=>I.value).filter(I=>I!==l)}pathFromRoot(l){return Qw(l,this._root).map(h=>h.value)}};function Jw(s,l){if(s===l.value)return l;for(let h of l.children){let g=Jw(s,h);if(g)return g}return null}function Qw(s,l){if(s===l.value)return[l];for(let h of l.children){let g=Qw(s,h);if(g.length)return g.unshift(l),g}return[]}var bo=class{value;children;constructor(l,h){this.value=l,this.children=h}toString(){return`TreeNode(${this.value})`}};function Nd(s){let l={};return s&&s.children.forEach(h=>l[h.value.outlet]=h),l}var Av=class extends Cv{snapshot;constructor(l,h){super(l),this.snapshot=h,cE(this,l)}toString(){return this.snapshot.toString()}};function iR(s){let l=O4(s),h=new Ei([new Cu("",{})]),g=new Ei({}),I=new Ei({}),n=new Ei({}),F=new Ei(""),H=new Ou(h,g,n,F,I,Fn,s,l.root);return H.snapshot=l.root,new Av(new bo(H,[]),l)}function O4(s){let l={},h={},g={},I="",n=new Bd([],l,g,I,h,Fn,s,null,{});return new Pv("",new bo(n,[]))}var Ou=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(l,h,g,I,n,F,H,$){this.urlSubject=l,this.paramsSubject=h,this.queryParamsSubject=g,this.fragmentSubject=I,this.dataSubject=n,this.outlet=F,this.component=H,this._futureSnapshot=$,this.title=this.dataSubject?.pipe(Nn(ae=>ae[Xm]))??Pn(void 0),this.url=l,this.params=h,this.queryParams=g,this.fragment=I,this.data=n}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Nn(l=>jd(l))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Nn(l=>jd(l))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Rv(s,l,h="emptyOnly"){let g,{routeConfig:I}=s;return l!==null&&(h==="always"||I?.path===""||!l.component&&!l.routeConfig?.loadComponent)?g={params:$t($t({},l.params),s.params),data:$t($t({},l.data),s.data),resolve:$t($t($t($t({},s.data),l.data),I?.data),s._resolvedData)}:g={params:$t({},s.params),data:$t({},s.data),resolve:$t($t({},s.data),s._resolvedData??{})},I&&sR(I)&&(g.resolve[Xm]=I.title),g}var Bd=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Xm]}constructor(l,h,g,I,n,F,H,$,ae){this.url=l,this.params=h,this.queryParams=g,this.fragment=I,this.data=n,this.outlet=F,this.component=H,this.routeConfig=$,this._resolve=ae}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=jd(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=jd(this.queryParams),this._queryParamMap}toString(){let l=this.url.map(g=>g.toString()).join("/"),h=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${l}', path:'${h}')`}},Pv=class extends Cv{url;constructor(l,h){super(h),this.url=l,cE(this,h)}toString(){return oR(this._root)}};function cE(s,l){l.value._routerState=s,l.children.forEach(h=>cE(s,h))}function oR(s){let l=s.children.length>0?` { ${s.children.map(oR).join(", ")} } `:"";return`${s.value}${l}`}function Ow(s){if(s.snapshot){let l=s.snapshot,h=s._futureSnapshot;s.snapshot=h,na(l.queryParams,h.queryParams)||s.queryParamsSubject.next(h.queryParams),l.fragment!==h.fragment&&s.fragmentSubject.next(h.fragment),na(l.params,h.params)||s.paramsSubject.next(h.params),s4(l.url,h.url)||s.urlSubject.next(h.url),na(l.data,h.data)||s.dataSubject.next(h.data)}else s.snapshot=s._futureSnapshot,s.dataSubject.next(s._futureSnapshot.data)}function eE(s,l){let h=na(s.params,l.params)&&u4(s.url,l.url),g=!s.parent!=!l.parent;return h&&!g&&(!s.parent||eE(s.parent,l.parent))}function sR(s){return typeof s.title=="string"||s.title===null}var L4=new Dn(""),uE=(()=>{class s{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Fn;activateEvents=new vo;deactivateEvents=new vo;attachEvents=new vo;detachEvents=new vo;routerOutletData=Tm(void 0);parentContexts=Rt(kv);location=Rt(Sd);changeDetector=Rt(Od);inputBinder=Rt(hE,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(h){if(h.name){let{firstChange:g,previousValue:I}=h.name;if(g)return;this.isTrackedInParentContexts(I)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(I)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(h){return this.parentContexts.getContext(h)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let h=this.parentContexts.getContext(this.name);h?.route&&(h.attachRef?this.attach(h.attachRef,h.route):this.activateWith(h.route,h.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new tn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new tn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new tn(4012,!1);this.location.detach();let h=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(h.instance),h}attach(h,g){this.activated=h,this._activatedRoute=g,this.location.insert(h.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(h.instance)}deactivate(){if(this.activated){let h=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(h)}}activateWith(h,g){if(this.isActivated)throw new tn(4013,!1);this._activatedRoute=h;let I=this.location,F=h.snapshot.component,H=this.parentContexts.getOrCreateContext(this.name).children,$=new tE(h,H,I.injector,this.routerOutletData);this.activated=I.createComponent(F,{index:I.length,injector:$,environmentInjector:g}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(g){return new(g||s)};static \u0275dir=av({type:s,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Zy]})}return s})(),tE=class s{route;childContexts;parent;outletData;__ngOutletInjector(l){return new s(this.route,this.childContexts,l,this.outletData)}constructor(l,h,g,I){this.route=l,this.childContexts=h,this.parent=g,this.outletData=I}get(l,h){return l===Ou?this.route:l===kv?this.childContexts:l===L4?this.outletData:this.parent.get(l,h)}},hE=new Dn("");function k4(s,l,h){let g=Gm(s,l._root,h?h._root:void 0);return new Av(g,l)}function Gm(s,l,h){if(h&&s.shouldReuseRoute(l.value,h.value.snapshot)){let g=h.value;g._futureSnapshot=l.value;let I=F4(s,l,h);return new bo(g,I)}else{if(s.shouldAttach(l.value)){let n=s.retrieve(l.value);if(n!==null){let F=n.route;return F.value._futureSnapshot=l.value,F.children=l.children.map(H=>Gm(s,H)),F}}let g=N4(l.value),I=l.children.map(n=>Gm(s,n));return new bo(g,I)}}function F4(s,l,h){return l.children.map(g=>{for(let I of h.children)if(s.shouldReuseRoute(g.value,I.value.snapshot))return Gm(s,g,I);return Gm(s,g)})}function N4(s){return new Ou(new Ei(s.url),new Ei(s.params),new Ei(s.queryParams),new Ei(s.fragment),new Ei(s.data),s.outlet,s.component,s)}var qm=class{redirectTo;navigationBehaviorOptions;constructor(l,h){this.redirectTo=l,this.navigationBehaviorOptions=h}},aR="ngNavigationCancelingError";function Ov(s,l){let{redirectTo:h,navigationBehaviorOptions:g}=Ru(l)?{redirectTo:l,navigationBehaviorOptions:void 0}:l,I=lR(!1,wo.Redirect);return I.url=h,I.navigationBehaviorOptions=g,I}function lR(s,l){let h=new Error(`NavigationCancelingError: ${s||""}`);return h[aR]=!0,h.cancellationCode=l,h}function z4(s){return cR(s)&&Ru(s.url)}function cR(s){return!!s&&s[aR]}var B4=(s,l,h,g)=>Nn(I=>(new nE(l,I.targetRouterState,I.currentRouterState,h,g).activate(s),I)),nE=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(l,h,g,I,n){this.routeReuseStrategy=l,this.futureState=h,this.currState=g,this.forwardEvent=I,this.inputBindingEnabled=n}activate(l){let h=this.futureState._root,g=this.currState?this.currState._root:null;this.deactivateChildRoutes(h,g,l),Ow(this.futureState.root),this.activateChildRoutes(h,g,l)}deactivateChildRoutes(l,h,g){let I=Nd(h);l.children.forEach(n=>{let F=n.value.outlet;this.deactivateRoutes(n,I[F],g),delete I[F]}),Object.values(I).forEach(n=>{this.deactivateRouteAndItsChildren(n,g)})}deactivateRoutes(l,h,g){let I=l.value,n=h?h.value:null;if(I===n)if(I.component){let F=g.getContext(I.outlet);F&&this.deactivateChildRoutes(l,h,F.children)}else this.deactivateChildRoutes(l,h,g);else n&&this.deactivateRouteAndItsChildren(h,g)}deactivateRouteAndItsChildren(l,h){l.value.component&&this.routeReuseStrategy.shouldDetach(l.value.snapshot)?this.detachAndStoreRouteSubtree(l,h):this.deactivateRouteAndOutlet(l,h)}detachAndStoreRouteSubtree(l,h){let g=h.getContext(l.value.outlet),I=g&&l.value.component?g.children:h,n=Nd(l);for(let F of Object.values(n))this.deactivateRouteAndItsChildren(F,I);if(g&&g.outlet){let F=g.outlet.detach(),H=g.children.onOutletDeactivated();this.routeReuseStrategy.store(l.value.snapshot,{componentRef:F,route:l,contexts:H})}}deactivateRouteAndOutlet(l,h){let g=h.getContext(l.value.outlet),I=g&&l.value.component?g.children:h,n=Nd(l);for(let F of Object.values(n))this.deactivateRouteAndItsChildren(F,I);g&&(g.outlet&&(g.outlet.deactivate(),g.children.onOutletDeactivated()),g.attachRef=null,g.route=null)}activateChildRoutes(l,h,g){let I=Nd(h);l.children.forEach(n=>{this.activateRoutes(n,I[n.value.outlet],g),this.forwardEvent(new Yw(n.value.snapshot))}),l.children.length&&this.forwardEvent(new Zw(l.value.snapshot))}activateRoutes(l,h,g){let I=l.value,n=h?h.value:null;if(Ow(I),I===n)if(I.component){let F=g.getOrCreateContext(I.outlet);this.activateChildRoutes(l,h,F.children)}else this.activateChildRoutes(l,h,g);else if(I.component){let F=g.getOrCreateContext(I.outlet);if(this.routeReuseStrategy.shouldAttach(I.snapshot)){let H=this.routeReuseStrategy.retrieve(I.snapshot);this.routeReuseStrategy.store(I.snapshot,null),F.children.onOutletReAttached(H.contexts),F.attachRef=H.componentRef,F.route=H.route.value,F.outlet&&F.outlet.attach(H.componentRef,H.route.value),Ow(H.route.value),this.activateChildRoutes(l,null,F.children)}else F.attachRef=null,F.route=I,F.outlet&&F.outlet.activateWith(I,F.injector),this.activateChildRoutes(l,null,F.children)}else this.activateChildRoutes(l,null,g)}},Lv=class{path;route;constructor(l){this.path=l,this.route=this.path[this.path.length-1]}},Vd=class{component;route;constructor(l,h){this.component=l,this.route=h}};function V4(s,l,h){let g=s._root,I=l?l._root:null;return Fm(g,I,h,[g.value])}function j4(s){let l=s.routeConfig?s.routeConfig.canActivateChild:null;return!l||l.length===0?null:{node:s,guards:l}}function Hd(s,l){let h=Symbol(),g=l.get(s,h);return g===h?typeof s=="function"&&!MM(s)?s:l.get(s):g}function Fm(s,l,h,g,I={canDeactivateChecks:[],canActivateChecks:[]}){let n=Nd(l);return s.children.forEach(F=>{U4(F,n[F.value.outlet],h,g.concat([F.value]),I),delete n[F.value.outlet]}),Object.entries(n).forEach(([F,H])=>Bm(H,h.getContext(F),I)),I}function U4(s,l,h,g,I={canDeactivateChecks:[],canActivateChecks:[]}){let n=s.value,F=l?l.value:null,H=h?h.getContext(s.value.outlet):null;if(F&&n.routeConfig===F.routeConfig){let $=$4(F,n,n.routeConfig.runGuardsAndResolvers);$?I.canActivateChecks.push(new Lv(g)):(n.data=F.data,n._resolvedData=F._resolvedData),n.component?Fm(s,l,H?H.children:null,g,I):Fm(s,l,h,g,I),$&&H&&H.outlet&&H.outlet.isActivated&&I.canDeactivateChecks.push(new Vd(H.outlet.component,F))}else F&&Bm(l,H,I),I.canActivateChecks.push(new Lv(g)),n.component?Fm(s,null,H?H.children:null,g,I):Fm(s,null,h,g,I);return I}function $4(s,l,h){if(typeof h=="function")return h(s,l);switch(h){case"pathParamsChange":return!Au(s.url,l.url);case"pathParamsOrQueryParamsChange":return!Au(s.url,l.url)||!na(s.queryParams,l.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!eE(s,l)||!na(s.queryParams,l.queryParams);case"paramsChange":default:return!eE(s,l)}}function Bm(s,l,h){let g=Nd(s),I=s.value;Object.entries(g).forEach(([n,F])=>{I.component?l?Bm(F,l.children.getContext(n),h):Bm(F,null,h):Bm(F,l,h)}),I.component?l&&l.outlet&&l.outlet.isActivated?h.canDeactivateChecks.push(new Vd(l.outlet.component,I)):h.canDeactivateChecks.push(new Vd(null,I)):h.canDeactivateChecks.push(new Vd(null,I))}function Km(s){return typeof s=="function"}function H4(s){return typeof s=="boolean"}function G4(s){return s&&Km(s.canLoad)}function q4(s){return s&&Km(s.canActivate)}function W4(s){return s&&Km(s.canActivateChild)}function Z4(s){return s&&Km(s.canDeactivate)}function X4(s){return s&&Km(s.canMatch)}function uR(s){return s instanceof Oa||s?.name==="EmptyError"}var wv=Symbol("INITIAL_VALUE");function $d(){return bs(s=>sy(s.map(l=>l.pipe(La(1),pb(wv)))).pipe(Nn(l=>{for(let h of l)if(h!==!0){if(h===wv)return wv;if(h===!1||Y4(h))return h}return!0}),qi(l=>l!==wv),La(1)))}function Y4(s){return Ru(s)||s instanceof qm}function K4(s,l){return ri(h=>{let{targetSnapshot:g,currentSnapshot:I,guards:{canActivateChecks:n,canDeactivateChecks:F}}=h;return F.length===0&&n.length===0?Pn(lr($t({},h),{guardsResult:!0})):J4(F,g,I,s).pipe(ri(H=>H&&H4(H)?Q4(g,n,s,l):Pn(H)),Nn(H=>lr($t({},h),{guardsResult:H})))})}function J4(s,l,h,g){return ni(s).pipe(ri(I=>iV(I.component,I.route,h,l,g)),ka(I=>I!==!0,!0))}function Q4(s,l,h,g){return ni(l).pipe(sd(I=>od(tV(I.route.parent,g),eV(I.route,g),rV(s,I.path,h),nV(s,I.route,h))),ka(I=>I!==!0,!0))}function eV(s,l){return s!==null&&l&&l(new Xw(s)),Pn(!0)}function tV(s,l){return s!==null&&l&&l(new Ww(s)),Pn(!0)}function nV(s,l,h){let g=l.routeConfig?l.routeConfig.canActivate:null;if(!g||g.length===0)return Pn(!0);let I=g.map(n=>ay(()=>{let F=Ym(l)??h,H=Hd(n,F),$=q4(H)?H.canActivate(l,s):Is(F,()=>H(l,s));return oc($).pipe(ka())}));return Pn(I).pipe($d())}function rV(s,l,h){let g=l[l.length-1],n=l.slice(0,l.length-1).reverse().map(F=>j4(F)).filter(F=>F!==null).map(F=>ay(()=>{let H=F.guards.map($=>{let ae=Ym(F.node)??h,Te=Hd($,ae),Fe=W4(Te)?Te.canActivateChild(g,s):Is(ae,()=>Te(g,s));return oc(Fe).pipe(ka())});return Pn(H).pipe($d())}));return Pn(n).pipe($d())}function iV(s,l,h,g,I){let n=l&&l.routeConfig?l.routeConfig.canDeactivate:null;if(!n||n.length===0)return Pn(!0);let F=n.map(H=>{let $=Ym(l)??I,ae=Hd(H,$),Te=Z4(ae)?ae.canDeactivate(s,l,h,g):Is($,()=>ae(s,l,h,g));return oc(Te).pipe(ka())});return Pn(F).pipe($d())}function oV(s,l,h,g){let I=l.canLoad;if(I===void 0||I.length===0)return Pn(!0);let n=I.map(F=>{let H=Hd(F,s),$=G4(H)?H.canLoad(l,h):Is(s,()=>H(l,h));return oc($)});return Pn(n).pipe($d(),hR(g))}function hR(s){return sb(Ur(l=>{if(typeof l!="boolean")throw Ov(s,l)}),Nn(l=>l===!0))}function sV(s,l,h,g){let I=l.canMatch;if(!I||I.length===0)return Pn(!0);let n=I.map(F=>{let H=Hd(F,s),$=X4(H)?H.canMatch(l,h):Is(s,()=>H(l,h));return oc($)});return Pn(n).pipe($d(),hR(g))}var Wm=class{segmentGroup;constructor(l){this.segmentGroup=l||null}},Zm=class extends Error{urlTree;constructor(l){super(),this.urlTree=l}};function Fd(s){return id(new Wm(s))}function aV(s){return id(new tn(4e3,!1))}function lV(s){return id(lR(!1,wo.GuardRejected))}var rE=class{urlSerializer;urlTree;constructor(l,h){this.urlSerializer=l,this.urlTree=h}lineralizeSegments(l,h){let g=[],I=h.root;for(;;){if(g=g.concat(I.segments),I.numberOfChildren===0)return Pn(g);if(I.numberOfChildren>1||!I.children[Fn])return aV(`${l.redirectTo}`);I=I.children[Fn]}}applyRedirectCommands(l,h,g,I,n){if(typeof h!="string"){let H=h,{queryParams:$,fragment:ae,routeConfig:Te,url:Fe,outlet:Ze,params:ze,data:pt,title:vt}=I,Cn=Is(n,()=>H({params:ze,data:pt,queryParams:$,fragment:ae,routeConfig:Te,url:Fe,outlet:Ze,title:vt}));if(Cn instanceof Za)throw new Zm(Cn);h=Cn}let F=this.applyRedirectCreateUrlTree(h,this.urlSerializer.parse(h),l,g);if(h[0]==="/")throw new Zm(F);return F}applyRedirectCreateUrlTree(l,h,g,I){let n=this.createSegmentGroup(l,h.root,g,I);return new Za(n,this.createQueryParams(h.queryParams,this.urlTree.queryParams),h.fragment)}createQueryParams(l,h){let g={};return Object.entries(l).forEach(([I,n])=>{if(typeof n=="string"&&n[0]===":"){let H=n.substring(1);g[I]=h[H]}else g[I]=n}),g}createSegmentGroup(l,h,g,I){let n=this.createSegments(l,h.segments,g,I),F={};return Object.entries(h.children).forEach(([H,$])=>{F[H]=this.createSegmentGroup(l,$,g,I)}),new or(n,F)}createSegments(l,h,g,I){return h.map(n=>n.path[0]===":"?this.findPosParam(l,n,I):this.findOrReturn(n,g))}findPosParam(l,h,g){let I=g[h.path.substring(1)];if(!I)throw new tn(4001,!1);return I}findOrReturn(l,h){let g=0;for(let I of h){if(I.path===l.path)return h.splice(g),I;g++}return l}},iE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function cV(s,l,h,g,I){let n=dR(s,l,h);return n.matched?(g=R4(l,g),sV(g,l,h,I).pipe(Nn(F=>F===!0?n:$t({},iE)))):Pn(n)}function dR(s,l,h){if(l.path==="**")return uV(h);if(l.path==="")return l.pathMatch==="full"&&(s.hasChildren()||h.length>0)?$t({},iE):{matched:!0,consumedSegments:[],remainingSegments:h,parameters:{},positionalParamSegments:{}};let I=(l.matcher||o4)(h,s,l);if(!I)return $t({},iE);let n={};Object.entries(I.posParams??{}).forEach(([H,$])=>{n[H]=$.path});let F=I.consumed.length>0?$t($t({},n),I.consumed[I.consumed.length-1].parameters):n;return{matched:!0,consumedSegments:I.consumed,remainingSegments:h.slice(I.consumed.length),parameters:F,positionalParamSegments:I.posParams??{}}}function uV(s){return{matched:!0,parameters:s.length>0?G2(s).parameters:{},consumedSegments:s,remainingSegments:[],positionalParamSegments:{}}}function j2(s,l,h,g){return h.length>0&&fV(s,h,g)?{segmentGroup:new or(l,dV(g,new or(h,s.children))),slicedSegments:[]}:h.length===0&&pV(s,h,g)?{segmentGroup:new or(s.segments,hV(s,h,g,s.children)),slicedSegments:h}:{segmentGroup:new or(s.segments,s.children),slicedSegments:h}}function hV(s,l,h,g){let I={};for(let n of h)if(Fv(s,l,n)&&!g[Cs(n)]){let F=new or([],{});I[Cs(n)]=F}return $t($t({},g),I)}function dV(s,l){let h={};h[Fn]=l;for(let g of s)if(g.path===""&&Cs(g)!==Fn){let I=new or([],{});h[Cs(g)]=I}return h}function fV(s,l,h){return h.some(g=>Fv(s,l,g)&&Cs(g)!==Fn)}function pV(s,l,h){return h.some(g=>Fv(s,l,g))}function Fv(s,l,h){return(s.hasChildren()||l.length>0)&&h.pathMatch==="full"?!1:h.path===""}function mV(s,l,h){return l.length===0&&!s.children[h]}var oE=class{};function gV(s,l,h,g,I,n,F="emptyOnly"){return new sE(s,l,h,g,I,F,n).recognize()}var _V=31,sE=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(l,h,g,I,n,F,H){this.injector=l,this.configLoader=h,this.rootComponentType=g,this.config=I,this.urlTree=n,this.paramsInheritanceStrategy=F,this.urlSerializer=H,this.applyRedirects=new rE(this.urlSerializer,this.urlTree)}noMatchError(l){return new tn(4002,`'${l.segmentGroup}'`)}recognize(){let l=j2(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(l).pipe(Nn(({children:h,rootSnapshot:g})=>{let I=new bo(g,h),n=new Pv("",I),F=T4(g,[],this.urlTree.queryParams,this.urlTree.fragment);return F.queryParams=this.urlTree.queryParams,n.url=this.urlSerializer.serialize(F),{state:n,tree:F}}))}match(l){let h=new Bd([],Object.freeze({}),Object.freeze($t({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Fn,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,l,Fn,h).pipe(Nn(g=>({children:g,rootSnapshot:h})),Kl(g=>{if(g instanceof Zm)return this.urlTree=g.urlTree,this.match(g.urlTree.root);throw g instanceof Wm?this.noMatchError(g):g}))}processSegmentGroup(l,h,g,I,n){return g.segments.length===0&&g.hasChildren()?this.processChildren(l,h,g,n):this.processSegment(l,h,g,g.segments,I,!0,n).pipe(Nn(F=>F instanceof bo?[F]:[]))}processChildren(l,h,g,I){let n=[];for(let F of Object.keys(g.children))F==="primary"?n.unshift(F):n.push(F);return ni(n).pipe(sd(F=>{let H=g.children[F],$=P4(h,F);return this.processSegmentGroup(l,$,H,F,I)}),fb((F,H)=>(F.push(...H),F)),Jl(null),db(),ri(F=>{if(F===null)return Fd(g);let H=fR(F);return yV(H),Pn(H)}))}processSegment(l,h,g,I,n,F,H){return ni(h).pipe(sd($=>this.processSegmentAgainstRoute($._injector??l,h,$,g,I,n,F,H).pipe(Kl(ae=>{if(ae instanceof Wm)return Pn(null);throw ae}))),ka($=>!!$),Kl($=>{if(uR($))return mV(g,I,n)?Pn(new oE):Fd(g);throw $}))}processSegmentAgainstRoute(l,h,g,I,n,F,H,$){return Cs(g)!==F&&(F===Fn||!Fv(I,n,g))?Fd(I):g.redirectTo===void 0?this.matchSegmentAgainstRoute(l,I,g,n,F,$):this.allowRedirects&&H?this.expandSegmentAgainstRouteUsingRedirect(l,I,h,g,n,F,$):Fd(I)}expandSegmentAgainstRouteUsingRedirect(l,h,g,I,n,F,H){let{matched:$,parameters:ae,consumedSegments:Te,positionalParamSegments:Fe,remainingSegments:Ze}=dR(h,I,n);if(!$)return Fd(h);typeof I.redirectTo=="string"&&I.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>_V&&(this.allowRedirects=!1));let ze=new Bd(n,ae,Object.freeze($t({},this.urlTree.queryParams)),this.urlTree.fragment,U2(I),Cs(I),I.component??I._loadedComponent??null,I,$2(I)),pt=Rv(ze,H,this.paramsInheritanceStrategy);ze.params=Object.freeze(pt.params),ze.data=Object.freeze(pt.data);let vt=this.applyRedirects.applyRedirectCommands(Te,I.redirectTo,Fe,ze,l);return this.applyRedirects.lineralizeSegments(I,vt).pipe(ri(Cn=>this.processSegment(l,g,h,Cn.concat(Ze),F,!1,H)))}matchSegmentAgainstRoute(l,h,g,I,n,F){let H=cV(h,g,I,l,this.urlSerializer);return g.path==="**"&&(h.children={}),H.pipe(bs($=>$.matched?(l=g._injector??l,this.getChildConfig(l,g,I).pipe(bs(({routes:ae})=>{let Te=g._loadedInjector??l,{parameters:Fe,consumedSegments:Ze,remainingSegments:ze}=$,pt=new Bd(Ze,Fe,Object.freeze($t({},this.urlTree.queryParams)),this.urlTree.fragment,U2(g),Cs(g),g.component??g._loadedComponent??null,g,$2(g)),vt=Rv(pt,F,this.paramsInheritanceStrategy);pt.params=Object.freeze(vt.params),pt.data=Object.freeze(vt.data);let{segmentGroup:Cn,slicedSegments:En}=j2(h,Ze,ze,ae);if(En.length===0&&Cn.hasChildren())return this.processChildren(Te,ae,Cn,pt).pipe(Nn(mi=>new bo(pt,mi)));if(ae.length===0&&En.length===0)return Pn(new bo(pt,[]));let Ft=Cs(g)===n;return this.processSegment(Te,ae,Cn,En,Ft?Fn:n,!0,pt).pipe(Nn(mi=>new bo(pt,mi instanceof bo?[mi]:[])))}))):Fd(h)))}getChildConfig(l,h,g){return h.children?Pn({routes:h.children,injector:l}):h.loadChildren?h._loadedRoutes!==void 0?Pn({routes:h._loadedRoutes,injector:h._loadedInjector}):oV(l,h,g,this.urlSerializer).pipe(ri(I=>I?this.configLoader.loadChildren(l,h).pipe(Ur(n=>{h._loadedRoutes=n.routes,h._loadedInjector=n.injector})):lV(h))):Pn({routes:[],injector:l})}};function yV(s){s.sort((l,h)=>l.value.outlet===Fn?-1:h.value.outlet===Fn?1:l.value.outlet.localeCompare(h.value.outlet))}function vV(s){let l=s.value.routeConfig;return l&&l.path===""}function fR(s){let l=[],h=new Set;for(let g of s){if(!vV(g)){l.push(g);continue}let I=l.find(n=>g.value.routeConfig===n.value.routeConfig);I!==void 0?(I.children.push(...g.children),h.add(I)):l.push(g)}for(let g of h){let I=fR(g.children);l.push(new bo(g.value,I))}return l.filter(g=>!h.has(g))}function U2(s){return s.data||{}}function $2(s){return s.resolve||{}}function xV(s,l,h,g,I,n){return ri(F=>gV(s,l,h,g,F.extractedUrl,I,n).pipe(Nn(({state:H,tree:$})=>lr($t({},F),{targetSnapshot:H,urlAfterRedirects:$}))))}function bV(s,l){return ri(h=>{let{targetSnapshot:g,guards:{canActivateChecks:I}}=h;if(!I.length)return Pn(h);let n=new Set(I.map($=>$.route)),F=new Set;for(let $ of n)if(!F.has($))for(let ae of pR($))F.add(ae);let H=0;return ni(F).pipe(sd($=>n.has($)?wV($,g,s,l):($.data=Rv($,$.parent,s).resolve,Pn(void 0))),Ur(()=>H++),ad(1),ri($=>H===F.size?Pn(h):no))})}function pR(s){let l=s.children.map(h=>pR(h)).flat();return[s,...l]}function wV(s,l,h,g){let I=s.routeConfig,n=s._resolve;return I?.title!==void 0&&!sR(I)&&(n[Xm]=I.title),EV(n,s,l,g).pipe(Nn(F=>(s._resolvedData=F,s.data=Rv(s,s.parent,h).resolve,null)))}function EV(s,l,h,g){let I=Fw(s);if(I.length===0)return Pn({});let n={};return ni(I).pipe(ri(F=>TV(s[F],l,h,g).pipe(ka(),Ur(H=>{if(H instanceof qm)throw Ov(new Vm,H);n[F]=H}))),ad(1),Nn(()=>n),Kl(F=>uR(F)?no:id(F)))}function TV(s,l,h,g){let I=Ym(l)??g,n=Hd(s,I),F=n.resolve?n.resolve(l,h):Is(I,()=>n(l,h));return oc(F)}function Lw(s){return bs(l=>{let h=s(l);return h?ni(h).pipe(Nn(()=>l)):Pn(l)})}var mR=(()=>{class s{buildTitle(h){let g,I=h.root;for(;I!==void 0;)g=this.getResolvedTitleForRoute(I)??g,I=I.children.find(n=>n.outlet===Fn);return g}getResolvedTitleForRoute(h){return h.data[Xm]}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:()=>Rt(IV),providedIn:"root"})}return s})(),IV=(()=>{class s extends mR{title;constructor(h){super(),this.title=h}updateTitle(h){let g=this.buildTitle(h);g!==void 0&&this.title.setTitle(g)}static \u0275fac=function(g){return new(g||s)(Hn(F2))};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),dE=new Dn("",{providedIn:"root",factory:()=>({})}),SV=(()=>{class s{static \u0275fac=function(g){return new(g||s)};static \u0275cmp=so({type:s,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(g,I){g&1&&pi(0,"router-outlet")},dependencies:[uE],encapsulation:2})}return s})();function fE(s){let l=s.children&&s.children.map(fE),h=l?lr($t({},s),{children:l}):$t({},s);return!h.component&&!h.loadComponent&&(l||h.loadChildren)&&h.outlet&&h.outlet!==Fn&&(h.component=SV),h}var pE=new Dn(""),DV=(()=>{class s{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=Rt(yw);loadComponent(h){if(this.componentLoaders.get(h))return this.componentLoaders.get(h);if(h._loadedComponent)return Pn(h._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(h);let g=oc(h.loadComponent()).pipe(Nn(gR),Ur(n=>{this.onLoadEndListener&&this.onLoadEndListener(h),h._loadedComponent=n}),Qp(()=>{this.componentLoaders.delete(h)})),I=new rd(g,()=>new di).pipe(nd());return this.componentLoaders.set(h,I),I}loadChildren(h,g){if(this.childrenLoaders.get(g))return this.childrenLoaders.get(g);if(g._loadedRoutes)return Pn({routes:g._loadedRoutes,injector:g._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(g);let n=MV(g,this.compiler,h,this.onLoadEndListener).pipe(Qp(()=>{this.childrenLoaders.delete(g)})),F=new rd(n,()=>new di).pipe(nd());return this.childrenLoaders.set(g,F),F}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function MV(s,l,h,g){return oc(s.loadChildren()).pipe(Nn(gR),ri(I=>I instanceof cw||Array.isArray(I)?Pn(I):ni(l.compileModuleAsync(I))),Nn(I=>{g&&g(s);let n,F,H=!1;return Array.isArray(I)?(F=I,H=!0):(n=I.create(h).injector,F=n.get(pE,[],{optional:!0,self:!0}).flat()),{routes:F.map(fE),injector:n}}))}function CV(s){return s&&typeof s=="object"&&"default"in s}function gR(s){return CV(s)?s.default:s}var mE=(()=>{class s{static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:()=>Rt(AV),providedIn:"root"})}return s})(),AV=(()=>{class s{shouldProcessUrl(h){return!0}extract(h){return h}merge(h,g){return h}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),RV=new Dn("");var PV=new Dn(""),OV=(()=>{class s{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new di;transitionAbortSubject=new di;configLoader=Rt(DV);environmentInjector=Rt(qo);destroyRef=Rt(rc);urlSerializer=Rt(lE);rootContexts=Rt(kv);location=Rt(Rm);inputBindingEnabled=Rt(hE,{optional:!0})!==null;titleStrategy=Rt(mR);options=Rt(dE,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=Rt(mE);createViewTransition=Rt(RV,{optional:!0});navigationErrorHandler=Rt(PV,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Pn(void 0);rootComponentType=null;destroyed=!1;constructor(){let h=I=>this.events.next(new Gw(I)),g=I=>this.events.next(new qw(I));this.configLoader.onLoadEndListener=g,this.configLoader.onLoadStartListener=h,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(h){let g=++this.navigationId;this.transitions?.next(lr($t($t({},this.transitions.value),h),{id:g}))}setupNavigations(h,g,I){return this.transitions=new Ei({id:0,currentUrlTree:g,currentRawUrl:g,extractedUrl:this.urlHandlingStrategy.extract(g),urlAfterRedirects:this.urlHandlingStrategy.extract(g),rawUrl:g,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:zm,restoredState:null,currentSnapshot:I.snapshot,targetSnapshot:null,currentRouterState:I,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(qi(n=>n.id!==0),Nn(n=>lr($t({},n),{extractedUrl:this.urlHandlingStrategy.extract(n.rawUrl)})),bs(n=>{let F=!1,H=!1;return Pn(n).pipe(bs($=>{if(this.navigationId>n.id)return this.cancelNavigationTransition(n,"",wo.SupersededByNewNavigation),no;this.currentTransition=n,this.currentNavigation={id:$.id,initialUrl:$.rawUrl,extractedUrl:$.extractedUrl,targetBrowserUrl:typeof $.extras.browserUrl=="string"?this.urlSerializer.parse($.extras.browserUrl):$.extras.browserUrl,trigger:$.source,extras:$.extras,previousNavigation:this.lastSuccessfulNavigation?lr($t({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let ae=!h.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Te=$.extras.onSameUrlNavigation??h.onSameUrlNavigation;if(!ae&&Te!=="reload"){let Fe="";return this.events.next(new Pu($.id,this.urlSerializer.serialize($.rawUrl),Fe,Vw.IgnoredSameUrlNavigation)),$.resolve(!1),no}if(this.urlHandlingStrategy.shouldProcessUrl($.rawUrl))return Pn($).pipe(bs(Fe=>{let Ze=this.transitions?.getValue();return this.events.next(new Um(Fe.id,this.urlSerializer.serialize(Fe.extractedUrl),Fe.source,Fe.restoredState)),Ze!==this.transitions?.getValue()?no:Promise.resolve(Fe)}),xV(this.environmentInjector,this.configLoader,this.rootComponentType,h.config,this.urlSerializer,this.paramsInheritanceStrategy),Ur(Fe=>{n.targetSnapshot=Fe.targetSnapshot,n.urlAfterRedirects=Fe.urlAfterRedirects,this.currentNavigation=lr($t({},this.currentNavigation),{finalUrl:Fe.urlAfterRedirects});let Ze=new Mv(Fe.id,this.urlSerializer.serialize(Fe.extractedUrl),this.urlSerializer.serialize(Fe.urlAfterRedirects),Fe.targetSnapshot);this.events.next(Ze)}));if(ae&&this.urlHandlingStrategy.shouldProcessUrl($.currentRawUrl)){let{id:Fe,extractedUrl:Ze,source:ze,restoredState:pt,extras:vt}=$,Cn=new Um(Fe,this.urlSerializer.serialize(Ze),ze,pt);this.events.next(Cn);let En=iR(this.rootComponentType).snapshot;return this.currentTransition=n=lr($t({},$),{targetSnapshot:En,urlAfterRedirects:Ze,extras:lr($t({},vt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=Ze,Pn(n)}else{let Fe="";return this.events.next(new Pu($.id,this.urlSerializer.serialize($.extractedUrl),Fe,Vw.IgnoredByUrlHandlingStrategy)),$.resolve(!1),no}}),Ur($=>{let ae=new jw($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(ae)}),Nn($=>(this.currentTransition=n=lr($t({},$),{guards:V4($.targetSnapshot,$.currentSnapshot,this.rootContexts)}),n)),K4(this.environmentInjector,$=>this.events.next($)),Ur($=>{if(n.guardsResult=$.guardsResult,$.guardsResult&&typeof $.guardsResult!="boolean")throw Ov(this.urlSerializer,$.guardsResult);let ae=new Uw($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot,!!$.guardsResult);this.events.next(ae)}),qi($=>$.guardsResult?!0:(this.cancelNavigationTransition($,"",wo.GuardRejected),!1)),Lw($=>{if($.guards.canActivateChecks.length)return Pn($).pipe(Ur(ae=>{let Te=new $w(ae.id,this.urlSerializer.serialize(ae.extractedUrl),this.urlSerializer.serialize(ae.urlAfterRedirects),ae.targetSnapshot);this.events.next(Te)}),bs(ae=>{let Te=!1;return Pn(ae).pipe(bV(this.paramsInheritanceStrategy,this.environmentInjector),Ur({next:()=>Te=!0,complete:()=>{Te||this.cancelNavigationTransition(ae,"",wo.NoDataFromResolver)}}))}),Ur(ae=>{let Te=new Hw(ae.id,this.urlSerializer.serialize(ae.extractedUrl),this.urlSerializer.serialize(ae.urlAfterRedirects),ae.targetSnapshot);this.events.next(Te)}))}),Lw($=>{let ae=Te=>{let Fe=[];Te.routeConfig?.loadComponent&&!Te.routeConfig._loadedComponent&&Fe.push(this.configLoader.loadComponent(Te.routeConfig).pipe(Ur(Ze=>{Te.component=Ze}),Nn(()=>{})));for(let Ze of Te.children)Fe.push(...ae(Ze));return Fe};return sy(ae($.targetSnapshot.root)).pipe(Jl(null),La(1))}),Lw(()=>this.afterPreactivation()),bs(()=>{let{currentSnapshot:$,targetSnapshot:ae}=n,Te=this.createViewTransition?.(this.environmentInjector,$.root,ae.root);return Te?ni(Te).pipe(Nn(()=>n)):Pn(n)}),Nn($=>{let ae=k4(h.routeReuseStrategy,$.targetSnapshot,$.currentRouterState);return this.currentTransition=n=lr($t({},$),{targetRouterState:ae}),this.currentNavigation.targetRouterState=ae,n}),Ur(()=>{this.events.next(new Hm)}),B4(this.rootContexts,h.routeReuseStrategy,$=>this.events.next($),this.inputBindingEnabled),La(1),Ur({next:$=>{F=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new As($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects))),this.titleStrategy?.updateTitle($.targetRouterState.snapshot),$.resolve(!0)},complete:()=>{F=!0}}),mb(this.transitionAbortSubject.pipe(Ur($=>{throw $}))),Qp(()=>{!F&&!H&&this.cancelNavigationTransition(n,"",wo.SupersededByNewNavigation),this.currentTransition?.id===n.id&&(this.currentNavigation=null,this.currentTransition=null)}),Kl($=>{if(this.destroyed)return n.resolve(!1),no;if(H=!0,cR($))this.events.next(new Wa(n.id,this.urlSerializer.serialize(n.extractedUrl),$.message,$.cancellationCode)),z4($)?this.events.next(new Ud($.url,$.navigationBehaviorOptions)):n.resolve(!1);else{let ae=new $m(n.id,this.urlSerializer.serialize(n.extractedUrl),$,n.targetSnapshot??void 0);try{let Te=Is(this.environmentInjector,()=>this.navigationErrorHandler?.(ae));if(Te instanceof qm){let{message:Fe,cancellationCode:Ze}=Ov(this.urlSerializer,Te);this.events.next(new Wa(n.id,this.urlSerializer.serialize(n.extractedUrl),Fe,Ze)),this.events.next(new Ud(Te.redirectTo,Te.navigationBehaviorOptions))}else throw this.events.next(ae),$}catch(Te){this.options.resolveNavigationPromiseOnError?n.resolve(!1):n.reject(Te)}}return no}))}))}cancelNavigationTransition(h,g,I){let n=new Wa(h.id,this.urlSerializer.serialize(h.extractedUrl),g,I);this.events.next(n),h.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let h=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),g=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return h.toString()!==g?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function LV(s){return s!==zm}var kV=(()=>{class s{static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:()=>Rt(FV),providedIn:"root"})}return s})(),aE=class{shouldDetach(l){return!1}store(l,h){}shouldAttach(l){return!1}retrieve(l){return null}shouldReuseRoute(l,h){return l.routeConfig===h.routeConfig}},FV=(()=>{class s extends aE{static \u0275fac=(()=>{let h;return function(I){return(h||(h=j1(s)))(I||s)}})();static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),_R=(()=>{class s{static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:()=>Rt(NV),providedIn:"root"})}return s})(),NV=(()=>{class s extends _R{location=Rt(Rm);urlSerializer=Rt(lE);options=Rt(dE,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=Rt(mE);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Za;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=iR(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(h){return this.location.subscribe(g=>{g.type==="popstate"&&h(g.url,g.state)})}handleRouterEvent(h,g){if(h instanceof Um)this.stateMemento=this.createStateMemento();else if(h instanceof Pu)this.rawUrlTree=g.initialUrl;else if(h instanceof Mv){if(this.urlUpdateStrategy==="eager"&&!g.extras.skipLocationChange){let I=this.urlHandlingStrategy.merge(g.finalUrl,g.initialUrl);this.setBrowserUrl(g.targetBrowserUrl??I,g)}}else h instanceof Hm?(this.currentUrlTree=g.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(g.finalUrl,g.initialUrl),this.routerState=g.targetRouterState,this.urlUpdateStrategy==="deferred"&&!g.extras.skipLocationChange&&this.setBrowserUrl(g.targetBrowserUrl??this.rawUrlTree,g)):h instanceof Wa&&(h.code===wo.GuardRejected||h.code===wo.NoDataFromResolver)?this.restoreHistory(g):h instanceof $m?this.restoreHistory(g,!0):h instanceof As&&(this.lastSuccessfulId=h.id,this.currentPageId=this.browserPageId)}setBrowserUrl(h,g){let I=h instanceof Za?this.urlSerializer.serialize(h):h;if(this.location.isCurrentPathEqualTo(I)||g.extras.replaceUrl){let n=this.browserPageId,F=$t($t({},g.extras.state),this.generateNgRouterState(g.id,n));this.location.replaceState(I,"",F)}else{let n=$t($t({},g.extras.state),this.generateNgRouterState(g.id,this.browserPageId+1));this.location.go(I,"",n)}}restoreHistory(h,g=!1){if(this.canceledNavigationResolution==="computed"){let I=this.browserPageId,n=this.currentPageId-I;n!==0?this.location.historyGo(n):this.currentUrlTree===h.finalUrl&&n===0&&(this.resetState(h),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(g&&this.resetState(h),this.resetUrlToCurrentUrlTree())}resetState(h){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,h.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(h,g){return this.canceledNavigationResolution==="computed"?{navigationId:h,\u0275routerPageId:g}:{navigationId:h}}static \u0275fac=(()=>{let h;return function(I){return(h||(h=j1(s)))(I||s)}})();static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function zV(s,l){s.events.pipe(qi(h=>h instanceof As||h instanceof Wa||h instanceof $m||h instanceof Pu),Nn(h=>h instanceof As||h instanceof Pu?0:(h instanceof Wa?h.code===wo.Redirect||h.code===wo.SupersededByNewNavigation:!1)?2:1),qi(h=>h!==2),La(1)).subscribe(()=>{l()})}var BV={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},VV={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Jm=(()=>{class s{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=Rt(dw);stateManager=Rt(_R);options=Rt(dE,{optional:!0})||{};pendingTasks=Rt(Ed);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=Rt(OV);urlSerializer=Rt(lE);location=Rt(Rm);urlHandlingStrategy=Rt(mE);_events=new di;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=Rt(kV);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=Rt(pE,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!Rt(hE,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:h=>{this.console.warn(h)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Wr;subscribeToNavigationEvents(){let h=this.navigationTransitions.events.subscribe(g=>{try{let I=this.navigationTransitions.currentTransition,n=this.navigationTransitions.currentNavigation;if(I!==null&&n!==null){if(this.stateManager.handleRouterEvent(g,n),g instanceof Wa&&g.code!==wo.Redirect&&g.code!==wo.SupersededByNewNavigation)this.navigated=!0;else if(g instanceof As)this.navigated=!0;else if(g instanceof Ud){let F=g.navigationBehaviorOptions,H=this.urlHandlingStrategy.merge(g.url,I.currentRawUrl),$=$t({browserUrl:I.extras.browserUrl,info:I.extras.info,skipLocationChange:I.extras.skipLocationChange,replaceUrl:I.extras.replaceUrl||this.urlUpdateStrategy==="eager"||LV(I.source)},F);this.scheduleNavigation(H,zm,null,$,{resolve:I.resolve,reject:I.reject,promise:I.promise})}}UV(g)&&this._events.next(g)}catch(I){this.navigationTransitions.transitionAbortSubject.next(I)}});this.eventsSubscription.add(h)}resetRootComponentType(h){this.routerState.root.component=h,this.navigationTransitions.rootComponentType=h}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),zm,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((h,g)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(h,"popstate",g)},0)})}navigateToSyncWithBrowser(h,g,I){let n={replaceUrl:!0},F=I?.navigationId?I:null;if(I){let $=$t({},I);delete $.navigationId,delete $.\u0275routerPageId,Object.keys($).length!==0&&(n.state=$)}let H=this.parseUrl(h);this.scheduleNavigation(H,g,F,n)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(h){this.config=h.map(fE),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(h,g={}){let{relativeTo:I,queryParams:n,fragment:F,queryParamsHandling:H,preserveFragment:$}=g,ae=$?this.currentUrlTree.fragment:F,Te=null;switch(H??this.options.defaultQueryParamsHandling){case"merge":Te=$t($t({},this.currentUrlTree.queryParams),n);break;case"preserve":Te=this.currentUrlTree.queryParams;break;default:Te=n||null}Te!==null&&(Te=this.removeEmptyProps(Te));let Fe;try{let Ze=I?I.snapshot:this.routerState.snapshot.root;Fe=eR(Ze)}catch{(typeof h[0]!="string"||h[0][0]!=="/")&&(h=[]),Fe=this.currentUrlTree.root}return tR(Fe,h,Te,ae??null)}navigateByUrl(h,g={skipLocationChange:!1}){let I=Ru(h)?h:this.parseUrl(h),n=this.urlHandlingStrategy.merge(I,this.rawUrlTree);return this.scheduleNavigation(n,zm,null,g)}navigate(h,g={skipLocationChange:!1}){return jV(h),this.navigateByUrl(this.createUrlTree(h,g),g)}serializeUrl(h){return this.urlSerializer.serialize(h)}parseUrl(h){try{return this.urlSerializer.parse(h)}catch{return this.urlSerializer.parse("/")}}isActive(h,g){let I;if(g===!0?I=$t({},BV):g===!1?I=$t({},VV):I=g,Ru(h))return N2(this.currentUrlTree,h,I);let n=this.parseUrl(h);return N2(this.currentUrlTree,n,I)}removeEmptyProps(h){return Object.entries(h).reduce((g,[I,n])=>(n!=null&&(g[I]=n),g),{})}scheduleNavigation(h,g,I,n,F){if(this.disposed)return Promise.resolve(!1);let H,$,ae;F?(H=F.resolve,$=F.reject,ae=F.promise):ae=new Promise((Fe,Ze)=>{H=Fe,$=Ze});let Te=this.pendingTasks.add();return zV(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Te))}),this.navigationTransitions.handleNavigationRequest({source:g,restoredState:I,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:h,extras:n,resolve:H,reject:$,promise:ae,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ae.catch(Fe=>Promise.reject(Fe))}static \u0275fac=function(g){return new(g||s)};static \u0275prov=Mn({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function jV(s){for(let l=0;l<s.length;l++)if(s[l]==null)throw new tn(4008,!1)}function UV(s){return!(s instanceof Hm)&&!(s instanceof Ud)}var yR=(()=>{class s{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new di;constructor(h,g,I,n,F,H){this.router=h,this.route=g,this.tabIndexAttribute=I,this.renderer=n,this.el=F,this.locationStrategy=H;let $=F.nativeElement.tagName?.toLowerCase();this.isAnchorElement=$==="a"||$==="area",this.isAnchorElement?this.subscription=h.events.subscribe(ae=>{ae instanceof As&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(h){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",h)}ngOnChanges(h){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(h){h==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Ru(h)?this.routerLinkInput=h:this.routerLinkInput=Array.isArray(h)?h:[h],this.setTabIndexIfNotOnNativeEl("0"))}onClick(h,g,I,n,F){let H=this.urlTree;if(H===null||this.isAnchorElement&&(h!==0||g||I||n||F||typeof this.target=="string"&&this.target!="_self"))return!0;let $={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(H,$),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let h=this.urlTree;this.href=h!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(h)):null;let g=this.href===null?null:YC(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",g)}applyAttributeValue(h,g){let I=this.renderer,n=this.el.nativeElement;g!==null?I.setAttribute(n,h,g):I.removeAttribute(n,h)}get urlTree(){return this.routerLinkInput===null?null:Ru(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(g){return new(g||s)(Ds(Jm),Ds(Ou),U1("tabindex"),Ds(sv),Ds(ic),Ds(kd))};static \u0275dir=av({type:s,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(g,I){g&1&&Du("click",function(F){return I.onClick(F.button,F.ctrlKey,F.shiftKey,F.altKey,F.metaKey)}),g&2&&mw("target",I.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Mm],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Mm],replaceUrl:[2,"replaceUrl","replaceUrl",Mm],routerLink:"routerLink"},features:[Zy]})}return s})();var $V=new Dn("");function vR(s,...l){return Gy([{provide:pE,multi:!0,useValue:s},[],{provide:Ou,useFactory:HV,deps:[Jm]},{provide:pw,multi:!0,useFactory:GV},l.map(h=>h.\u0275providers)])}function HV(s){return s.routerState.root}function GV(){let s=Rt(Wo);return l=>{let h=s.get(nc);if(l!==h.components[0])return;let g=s.get(Jm),I=s.get(qV);s.get(WV)===1&&g.initialNavigation(),s.get(ZV,null,Bn.Optional)?.setUpPreloading(),s.get($V,null,Bn.Optional)?.init(),g.resetRootComponentType(h.componentTypes[0]),I.closed||(I.next(),I.complete(),I.unsubscribe())}}var qV=new Dn("",{factory:()=>new di}),WV=new Dn("",{providedIn:"root",factory:()=>1});var ZV=new Dn("");var Lu=Wx(Nv());var zv={mapboxkey:"pk.eyJ1IjoibnJ1eiIsImEiOiJjbHp4MXdvY3Mwb2NtMm5wbnFnZ2FkbG9vIn0.0Zu0IButCWD-RFkE-IIXzQ"};var XV=["map"],YV=(s,l)=>({latitude:s,longitude:l});Lu.default.accessToken=zv.mapboxkey;var Bv=class s{divElement=Dd("map");map=oo(null);zoom=oo(14);coordinates=oo({lng:-70.684,lat:-33.5955});zoomEffect=fv(()=>{this.map()&&this.map()?.setZoom(this.zoom())});ngAfterViewInit(){return Xl(this,null,function*(){if(!this.divElement()?.nativeElement)return;let l=this.divElement().nativeElement;yield new Promise(F=>setTimeout(F,80));let{lng:h,lat:g}=this.coordinates(),I=new Lu.default.Map({container:l,style:"mapbox://styles/mapbox/streets-v12",center:[h,g],zoom:this.zoom(),pitch:45});new Lu.default.Marker({draggable:!0,color:"#90EE90"}).setLngLat([h,g]).addTo(I).on("dragend",F=>{console.log(F)}),this.mapListeners(I)})}mapListeners(l){l.on("zoomend",h=>{let g=h.target.getZoom();this.zoom.set(g)}),l.on("moveend",()=>{let h=l.getCenter();this.coordinates.set(h)}),l.on("load",()=>{console.log("Map Loaded")}),l.addControl(new Lu.default.FullscreenControl),l.addControl(new Lu.default.NavigationControl),l.addControl(new Lu.default.ScaleControl),this.map.set(l)}static \u0275fac=function(h){return new(h||s)};static \u0275cmp=so({type:s,selectors:[["app-fullscreen-map-page"]],viewQuery:function(h,g){h&1&&Ad(g.divElement,XV,5),h&2&&Rd()},decls:17,vars:17,consts:[["map",""],["txtZoom",""],[1,"h-[60vh]","sm:h-[calc(100vh-64px)]"],["id","controls"],[1,"text","font-bold","text-black","mb-2"],[1,"text-gray-500","font-normal"],["type","range","min","0","max","100",1,"range","range-secondary",3,"input","value"]],template:function(h,g){if(h&1){let I=cv();pi(0,"div",2,0),rr(2,"section",3)(3,"h2",4),oi(4," Zoom "),rr(5,"small",5),oi(6),Ha(7,"number"),fr()(),rr(8,"input",6,1),Du("input",function(){xm(I);let F=YA(9);return bm(g.zoom.set(+F.value))}),fr(),rr(10,"h2"),oi(11," Coordenadas "),fr(),rr(12,"pre"),oi(13),Ha(14,"number"),Ha(15,"number"),Ha(16,"json"),fr()()}h&2&&(Lr(6),$a(uv(7,3,g.zoom(),"1.0-0")),Lr(2),Tu("value",g.zoom()),Lr(5),Ms("",Pd(16,12,JA(14,YV,uv(14,6,g.coordinates().lat,"1.4-4"),uv(15,9,g.coordinates().lng,"1.4-4"))),`
  `))},dependencies:[T2,_v],styles:["div[_ngcontent-%COMP%]{width:100vw;height:calc(100vh - 64px)}#controls[_ngcontent-%COMP%]{background-color:#fff;padding:10px;border-radius:5px;position:fixed;bottom:25px;right:20px;z-index:9999;box-shadow:0 0 10px #0000001a;border:1px solid #e2e8f0;width:250px}"]})};var bE=Wx(Nv());var Di=[];for(let s=0;s<256;++s)Di.push((s+256).toString(16).slice(1));function bR(s,l=0){return(Di[s[l+0]]+Di[s[l+1]]+Di[s[l+2]]+Di[s[l+3]]+"-"+Di[s[l+4]]+Di[s[l+5]]+"-"+Di[s[l+6]]+Di[s[l+7]]+"-"+Di[s[l+8]]+Di[s[l+9]]+"-"+Di[s[l+10]]+Di[s[l+11]]+Di[s[l+12]]+Di[s[l+13]]+Di[s[l+14]]+Di[s[l+15]]).toLowerCase()}var yE,KV=new Uint8Array(16);function vE(){if(!yE){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");yE=crypto.getRandomValues.bind(crypto)}return yE(KV)}var JV=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xE={randomUUID:JV};function QV(s,l,h){if(xE.randomUUID&&!l&&!s)return xE.randomUUID();s=s||{};let g=s.random??s.rng?.()??vE();if(g.length<16)throw new Error("Random bytes length must be >= 16");if(g[6]=g[6]&15|64,g[8]=g[8]&63|128,l){if(h=h||0,h<0||h+16>l.length)throw new RangeError(`UUID byte range ${h}:${h+15} is out of buffer bounds`);for(let I=0;I<16;++I)l[h+I]=g[I];return l}return bR(g)}var ku=QV;var e5=["map"],t5=s=>({backgroundColor:s}),n5=(s,l)=>l.id;function r5(s,l){if(s&1){let h=cv();rr(0,"div",7),Du("click",function(){let I=xm(h).$implicit,n=_w();return bm(n.flyToMarker(I.mapboxMarker.getLngLat()))})("dblclick",function(){let I=xm(h).$implicit,n=_w();return bm(n.deleteMarker(I))}),rr(1,"label",8)(2,"span",9),oi(3),Ha(4,"json"),fr(),pi(5,"input",10),fr()()}if(s&2){let h=l.$implicit;Lr(3),Ms(" ",Pd(4,3,h.mapboxMarker.getLngLat())," "),Lr(2),HA(KA(5,t5,h.mapboxMarker._color))}}function i5(s,l){s&1&&(rr(0,"div",6)(1,"p",11),oi(2,"No hay marcadores"),fr()())}var Vv=class s{divElement=Dd("map");map=oo(null);markers=oo([]);coordinates=oo({lng:-70.684,lat:-33.5955});ngAfterViewInit(){return Xl(this,null,function*(){if(!this.divElement()?.nativeElement)return;let l=this.divElement().nativeElement;yield new Promise(n=>setTimeout(n,80));let{lng:h,lat:g}=this.coordinates(),I=new bE.default.Map({container:l,style:"mapbox://styles/mapbox/streets-v12",center:[h,g],zoom:14});this.mapListeners(I)})}mapListeners(l){l.on("click",h=>this.mapClick(h)),this.map.set(l)}mapClick(l){if(!this.map())return;let{lng:h,lat:g}=l.lngLat,I="#xxxxxx".replace(/x/g,H=>(Math.random()*16|0).toString(16)),n=new bE.default.Marker({draggable:!1,color:I}).setLngLat([h,g]).addTo(this.map()),F={id:ku(),mapboxMarker:n};this.markers.update(H=>[F,...H]),n.on("dragend",H=>{console.log(H)})}flyToMarker(l){this.map()&&this.map()?.flyTo({center:l,zoom:14,speed:1.2,curve:1.42,essential:!0})}deleteMarker(l){if(!this.map())return;let h=this.map();l.mapboxMarker.remove(),this.markers.update(g=>g.filter(I=>I.id!==l.id))}static \u0275fac=function(h){return new(h||s)};static \u0275cmp=so({type:s,selectors:[["app-markers-page"]],viewQuery:function(h,g){h&1&&Ad(g.divElement,e5,5),h&2&&Rd()},decls:9,vars:1,consts:[["map",""],[1,"h-[60vh]","sm:h-[calc(100vh-64px)]"],[1,"h-[40vh]","sm:fixed","sm:w-[260px]","bg-white","sm:rounded","sm:top-20","sm:left-10","p-5","overflow-y-scroll"],[1,"text-xl","font-bold","text-black","mb-2"],[1,"flex","flex-col","gap-2"],[1,"form-control"],[1,"flex","justify-center","items-center","bg-blue-100","rounded","py-5"],[1,"form-control",3,"click","dblclick"],[1,"label","cursor-pointer"],[1,"label-text","text-black","text-xs"],["type","radio","name","radio-10","checked","checked",1,"radio"],[1,"text-xs","text-secondary"]],template:function(h,g){h&1&&(pi(0,"div",1,0),rr(2,"section",2)(3,"h2",3),oi(4,"Marcadores"),fr(),rr(5,"div",4),Iu(6,r5,6,7,"div",5,n5,!1,i5,3,0,"div",6),fr()()),h&2&&(Lr(6),Su(g.markers()))},dependencies:[_v],encapsulation:2})};var jv=Wx(Nv());var o5=["map"];jv.default.accessToken=zv.mapboxkey;var Uv=class s{divElement=Dd("map");lngLat=Tm.required();zoom=Tm(14);ngAfterViewInit(){return Xl(this,null,function*(){if(!this.divElement()?.nativeElement)return;yield new Promise(g=>setTimeout(g,80));let l=this.divElement().nativeElement,h=new jv.default.Map({container:l,style:"mapbox://styles/mapbox/streets-v12",center:this.lngLat(),zoom:this.zoom(),interactive:!1,pitch:30});new jv.default.Marker().setLngLat(this.lngLat()).addTo(h)})}static \u0275fac=function(h){return new(h||s)};static \u0275cmp=so({type:s,selectors:[["app-mini-map"]],viewQuery:function(h,g){h&1&&Ad(g.divElement,o5,5),h&2&&Rd()},inputs:{lngLat:[1,"lngLat"],zoom:[1,"zoom"]},decls:2,vars:0,consts:[["map",""],[1,"h-[60vh]","sm:h-[calc(100vh-64px)]"]],template:function(h,g){h&1&&pi(0,"div",1,0)},styles:['div[_ngcontent-%COMP%]{width:"100%";height:260px}']})};var s5=(s,l)=>l.id;function a5(s,l){s&1&&(rr(0,"div",8),oi(1,"Nuevo"),fr())}function l5(s,l){if(s&1&&(rr(0,"div",10),oi(1),fr()),s&2){let h=l.$implicit;Lr(),$a(h)}}function c5(s,l){if(s&1&&(rr(0,"div",4),pi(1,"app-mini-map",5),rr(2,"div",6)(3,"h2",7),oi(4),hw(5,a5,2,0,"div",8),fr(),rr(6,"p"),oi(7),fr(),rr(8,"div",9),Iu(9,l5,2,1,"div",10,XA),fr()()()),s&2){let h=l.$implicit,g=l.$index;Lr(),Tu("lngLat",h.lngLat),Lr(3),Ms(" ",h.name," "),Lr(),ZA(g===1?5:-1),Lr(2),$a(h.description),Lr(2),Su(h.tags)}}var $v=class s{houses=oo([{id:ku(),name:"Villa Serenidad",description:"Un refugio tranquilo con vistas panor\xE1micas al mar y jardines exuberantes.",price:5e5,lngLat:{lng:-.861526,lat:41.65649},tags:["Villa","Mar","Jardines"]},{id:ku(),name:"Casa del Sol",description:"Una casa luminosa y acogedora con amplias terrazas y piscina privada.",price:75e4,lngLat:{lng:-.862,lat:41.657},tags:["Casa","Sol","Terrazas"]},{id:ku(),name:"Residencia Esmeralda",description:"Elegante propiedad con acabados de lujo y un dise\xF1o arquitect\xF3nico moderno.",price:12e5,lngLat:{lng:-.863,lat:41.658},tags:["Casa","Esmeralda","Acabados"]}]);static \u0275fac=function(h){return new(h||s)};static \u0275cmp=so({type:s,selectors:[["app-houses-page"]],decls:7,vars:1,consts:[[1,"container","mx-auto"],[1,"text-3xl","font-bold","mb-2"],[1,"text-xl","text-gray-500","mb-2"],[1,"container","mx-auto","grid","grid-cols-1","sm:grid-flow-cols-2","xl:grid-cols-3","gap-2"],[1,"card","bg-base-100","shadow-xl","rounded-t-md","overflow-hidden"],[3,"lngLat"],[1,"card-body"],[1,"card-title"],[1,"badge","badge-secondary"],[1,"card-actions","justify-end"],[1,"badge","badge-outline","badge-accent"]],template:function(h,g){h&1&&(rr(0,"section",0),pi(1,"h2",1),rr(2,"h3",2),oi(3),fr()(),rr(4,"section",3),Iu(5,c5,11,4,"div",4,s5),fr()),h&2&&(Lr(3),Ms("",3," Casas Dispinibles"),Lr(2),Su(g.houses()))},dependencies:[Uv],encapsulation:2})};var Gd=[{path:"fullscreen",component:Bv,title:"FullScreen Map"},{path:"markers",component:Vv,title:"Marcadores"},{path:"houses",component:$v,title:"Propiedades Disponibles"},{path:"**",redirectTo:"fullscreen"}];var wR={providers:[i2({eventCoalescing:!0}),vR(Gd)]};function wE(s,l){let h=!l?.manualCleanup;h&&!l?.injector&&C1(wE);let g=h?l?.injector?.get(rc)??Rt(rc):null,I=u5(l?.equal),n;l?.requireSync?n=oo({kind:0},{equal:I}):n=oo({kind:1,value:l?.initialValue},{equal:I});let F=s.subscribe({next:H=>n.set({kind:1,value:H}),error:H=>{if(l?.rejectErrors)throw H;n.set({kind:2,error:H})}});if(l?.requireSync&&n().kind===0)throw new tn(601,!1);return g?.onDestroy(F.unsubscribe.bind(F)),a2(()=>{let H=n();switch(H.kind){case 1:return H.value;case 2:throw H.error;case 0:throw new tn(601,!1)}},{equal:l?.equal})}function u5(s=Object.is){return(l,h)=>l.kind===1&&h.kind===1&&s(l.value,h.value)}var h5=(s,l)=>l.path;function d5(s,l){if(s&1&&(rr(0,"li")(1,"a",11),oi(2),fr()()),s&2){let h=l.$implicit;Lr(),Tu("routerLink",h.path),Lr(),$a(h.title)}}var Hv=class s{router=Rt(Jm);routes=Gd.map(l=>({path:l.path,title:`${l.title??"Maps en Angular"}`})).filter(l=>l.path!=="**");pageTitle=wE(this.router.events.pipe(qi(l=>l instanceof As),Ur(l=>console.log(l)),Nn(l=>l.url),Nn(l=>Gd.find(h=>`/${h.path}`===l)?.title??"Mapas")));pageTitle$=this.router.events.pipe(qi(l=>l instanceof As),Ur(l=>console.log(l)),Nn(l=>l.url),Nn(l=>Gd.find(h=>`/${h.path}`===l)?.title??"Mapas"));static \u0275fac=function(h){return new(h||s)};static \u0275cmp=so({type:s,selectors:[["app-navbar"]],decls:16,vars:4,consts:[[1,"navbar","bg-base-100"],[1,"navbar-start"],[1,"dropdown"],["tabindex","0","role","button",1,"btn","btn-ghost","btn-circle"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16M4 18h7"],["tabindex","0",1,"menu","menu-sm","dropdown-content","bg-base-100","rounded-box","z-[1]","mt-3","w-52","p-2","shadow"],[1,"navbar-center"],[1,"btn","btn-g","host","text-xl"],[1,"btn","btn-ghost","text-xl"],[1,"navbar-end"],[3,"routerLink"]],template:function(h,g){h&1&&(rr(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),pC(),rr(4,"svg",4),pi(5,"path",5),fr()(),mC(),rr(6,"ul",6),Iu(7,d5,3,2,"li",null,h5),fr()()(),rr(9,"div",7)(10,"a",8),oi(11),fr(),rr(12,"a",9),oi(13),Ha(14,"async"),fr()(),pi(15,"div",10),fr()),h&2&&(Lr(7),Su(g.routes),Lr(4),$a(g.pageTitle()),Lr(2),Ms(" ",Pd(14,2,g.pageTitle$)," "))},dependencies:[E2,yR],encapsulation:2})};var Gv=class s{title="Mapas App";static \u0275fac=function(h){return new(h||s)};static \u0275cmp=so({type:s,selectors:[["app-root"]],decls:2,vars:0,template:function(h,g){h&1&&pi(0,"app-navbar")(1,"router-outlet")},dependencies:[uE,Hv],encapsulation:2})};k2(Gv,wR).catch(s=>console.error(s));
